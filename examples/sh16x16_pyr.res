=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.947       78.1
Field Avg  2.20                     70.7   0.947       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849b18)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=1,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838490,lgs_prof_alt=0x7fad1a819bc0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19030230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29584e+08,_skynphotons=101.871,_tt=[0.000450426,
 0.00196263],_lastvalidtt=[0.000450426,0.00196263],_upttcommand=[0,0],_refmes=
 0x7fad1a0e7c30,_tiprefv=0x7fad1a0dc630,_tiltrefv=0x7fad1917a630,_tiprefvn=
 0x7fad1a0e9e30,_tiltrefvn=0x7fad19173630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a16cc30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10acfa030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a16cc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1915d630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a01a288,_ctrlden=0x7fad1a837928,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c508f0,_xlast=0x7fad18c50a70,_ylast=[0x7fad19174430,
 0x7fad19174430,0x7fad19174430],_y0=0x7fad1915e030,_signus=0x7fad18c4ec90,
 _puppixoffset=[0,0],_nact=80,_def=0x10f0c7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d04a50,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8376c0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837688,xposition=0x7fad1a838538,yposition=
 0x7fad1a837ce0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8375e0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.947       78.1
Field Avg  2.20                     70.7   0.947       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849320)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838490,lgs_prof_alt=0x7fad1a819bc0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a12cc30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00160615,
 -0.00218175],_lastvalidtt=[-0.00160615,-0.00218175],_upttcommand=[0,0],_refmes=
 0x7fad1a0eac30,_tiprefv=0x7fad19036430,_tiltrefv=0x7fad19171830,_tiprefvn=
 0x7fad1916b230,_tiltrefvn=0x7fad1917a630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a870a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10ac41030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a870a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a069c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837960)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837ae8,_ctrlden=0x7fad1903ffd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e1a500,_ylast=[0x7fad1a0a8e30,
 0x7fad1a0a8e30,0x7fad1a0a8e30],_y0=0x7fad1a0fb430,_signus=0x7fad18e20c80,
 _puppixoffset=[0,0],_nact=80,_def=0x1107c0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f09ec0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8376c0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837688,xposition=0x7fad1a8199c8,yposition=
 0x7fad1a819b50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8375e0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.945       78.1
Field Avg  2.20                     70.7   0.945       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849540)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838490,lgs_prof_alt=0x7fad1a819bc0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1900e030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=81760.9,_skynphotons=101.871,_tt=[-0.000818584,
 0.000117669],_lastvalidtt=[-0.000818584,0.000117669],_upttcommand=[0,0],
 _refmes=0x7fad1a0dec30,_tiprefv=0x7fad1a0d7e30,_tiltrefv=0x7fad1a0eb430,
 _tiprefvn=0x7fad1a10da30,_tiltrefvn=0x7fad1a090e30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1917f030,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108cd4030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1917f030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a099230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8381f0,_ctrlden=0x7fad1a8371b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1d510,_xlast=0x7fad18e1bf00,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a092230,_signus=0x7fad18e21ba0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f0c7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5d070,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8376c0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837688,xposition=0x7fad1a819a38,yposition=
 0x7fad1a838570,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8375e0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       71.0   0.941       84.1
Field Avg  2.20                     71.0   0.941       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a848c38)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=10,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838490,lgs_prof_alt=0x7fad1a819bc0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19170c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=32549.5,_skynphotons=101.871,_tt=[-6.49377e-05,
 -0.000478108],_lastvalidtt=[-6.49377e-05,-0.000478108],_upttcommand=[0,0],
 _refmes=0x7fad1a100a30,_tiprefv=0x7fad19171430,_tiltrefv=0x7fad1915c230,
 _tiprefvn=0x7fad1915d030,_tiltrefvn=0x7fad1916b230,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1a107e30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108dbd030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a107e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19813c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837960)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838500,_ctrlden=0x7fad19035830,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18f09d10,_xlast=0x7fad18f09e90,_ylast=[0x7fad1a84b030,
 0x7fad1a84b030,0x7fad1a84b030],_y0=0x7fad1a80b030,_signus=0x7fad18f0a010,
 _puppixoffset=[0,0],_nact=80,_def=0x1107c0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5f4d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8376c0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837688,xposition=0x7fad1a8386f8,yposition=
 0x7fad1a8380a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8375e0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       72.0   0.839       90.1
Field Avg  2.20                     72.0   0.839       90.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a8488a0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=14,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838490,lgs_prof_alt=0x7fad1a819bc0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a0cd430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1635.21,_skynphotons=203.743,_tt=[-0.00811732,
 -0.000657679],_lastvalidtt=[-0.00811732,-0.000657679],_upttcommand=[0,0],
 _refmes=0x7fad1a0fc030,_tiprefv=0x7fad1a819e30,_tiltrefv=0x7fad19158230,
 _tiprefvn=0x7fad1a872230,_tiltrefvn=0x7fad1915c230,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1a11bc30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x10e926030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a11bc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1918da30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fad0,_ctrlden=0x7fad1a838570,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0bfd0,_xlast=0x7fad18c0cc70,_ylast=[0x7fad19131a30,
 0x7fad19131a30,0x7fad19131a30],_y0=0x7fad19159030,_signus=0x7fad18c0cf50,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e18170,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8376c0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837688,xposition=0x7fad1a837538,yposition=
 0x7fad19040048,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8375e0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       75.1   0.647      120.1
Field Avg  2.20                     75.1   0.647      120.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a8480a8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=15,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838490,lgs_prof_alt=0x7fad1a819bc0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19181030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=650.986,_skynphotons=203.743,_tt=[-0.0024633,
 0.0038681],_lastvalidtt=[-0.0024633,0.0038681],_upttcommand=[0,0],_refmes=
 0x7fad1a090e30,_tiprefv=0x7fad1a0cce30,_tiltrefv=0x7fad1a819e30,_tiprefvn=
 0x7fad1a0fc030,_tiltrefvn=0x7fad1a830230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1917e430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10acfa030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1917e430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19813c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837960)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8370d8,_ctrlden=0x7fad1a837880,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5f3e0,_xlast=0x7fad18c0bf70,_ylast=[0x7fad19159030,
 0x7fad19159030,0x7fad19159030],_y0=0x7fad19153230,_signus=0x7fad18c4e700,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0cbd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8376c0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837688,xposition=0x7fad1a837340,yposition=
 0x7fad1903fe18,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8375e0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       85.4   0.410      168.2
Field Avg  2.20                     85.4   0.410      168.2
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849980)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=16,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838490,lgs_prof_alt=0x7fad1a819bc0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1918ee30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647.905,_skynphotons=509.357,_tt=[-0.0109219,
 0.00275034],_lastvalidtt=[-0.0109219,0.00275034],_upttcommand=[0,0],_refmes=
 0x7fad1a12d430,_tiprefv=0x7fad1a0ed230,_tiltrefv=0x7fad1a0dc630,_tiprefvn=
 0x7fad1a0cce30,_tiltrefvn=0x7fad1a121030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a0fe230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108dbd030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a0fe230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1913e430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a819808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fbb0,_ctrlden=0x7fad1a8380d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0e080,_xlast=0x7fad18c0eaa0,_ylast=[0x7fad19153230,
 0x7fad19153230,0x7fad19153230],_y0=0x7fad19037230,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1d510,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8376c0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837688,xposition=0x7fad1a838768,yposition=
 0x7fad1a837570,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8375e0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849188)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=1,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ae8,lgs_prof_alt=0x7fad1a819808,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a0e2c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29584e+08,_skynphotons=101.871,_tt=
 [-0.000246971,-0.000173813],_lastvalidtt=[-0.000246971,-0.000173813],
 _upttcommand=[0,0],_refmes=0x7fad1a0e4030,_tiprefv=0x7fad1a0ed230,_tiltrefv=
 0x7fad1a0e5630,_tiprefvn=0x7fad1a0dec30,_tiltrefvn=0x7fad1a147c30,_reordervec=
 0x0,_npixels=0,_npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,
 _binindices=0x0,_binxy=0,_centroidw=0x0,_fimage=0x7fad1a141430,_fimage2=0x0,
 _imistart=0x0,_imjstart=0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,
 _unittilt=0x0,_lgs_defocuses=0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=
 0x0,_yoffset=0x0,_bias=0x0,_flat=0x0,_domask=0,_submask=0x108dfa030,_kernel=
 0x0,_kernels=0x0,_kerfftr=0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fad1a141430,_x=0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,
 _bckgrdcalib=0x7fad1a12e230,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a8370d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad19040048,_ctrlden=0x7fad1a838068,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18f09d10,_xlast=0x7fad18f09e90,_ylast=[0x7fad1a858430,
 0x7fad1a858430,0x7fad1a858430],_y0=0x7fad1a858030,_signus=0x7fad18f0a010,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e22860,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819920,xposition=0x7fad1a8386f8,yposition=
 0x7fad1903fd38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8382d0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.947       78.1
Field Avg  2.20                     70.7   0.947       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849210)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ae8,lgs_prof_alt=0x7fad1a819808,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a0eae30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[0.000703951,
 -0.00122409],_lastvalidtt=[0.000703951,-0.00122409],_upttcommand=[0,0],_refmes=
 0x7fad1a148a30,_tiprefv=0x7fad1a0e2830,_tiltrefv=0x7fad19152630,_tiprefvn=
 0x7fad1a0ed230,_tiltrefvn=0x7fad19173630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1914dc30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10e926030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1914dc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1913e430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fa60)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8381b8,_ctrlden=0x7fad1a838538,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c585a0,_xlast=0x7fad18c58e80,_ylast=[0x7fad19174430,
 0x7fad19174430,0x7fad19174430],_y0=0x7fad1916f830,_signus=0x7fad18c55bd0,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e17a60,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819920,xposition=0x7fad1903fad0,yposition=
 0x7fad1903ffd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8382d0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.946       78.1
Field Avg  2.20                     70.7   0.946       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849cb0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ae8,lgs_prof_alt=0x7fad1a819808,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19150430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=81760.9,_skynphotons=101.871,_tt=[-0.00207998,
 -0.000871861],_lastvalidtt=[-0.00207998,-0.000871861],_upttcommand=[0,0],
 _refmes=0x7fad1a0e7c30,_tiprefv=0x7fad1982b830,_tiltrefv=0x7fad1a0ed230,
 _tiprefvn=0x7fad1981d030,_tiltrefvn=0x7fad1a146430,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1914b430,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x10acfa030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1914b430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a0ee030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a8370d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fd00,_ctrlden=0x7fad1a01a288,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e20920,_xlast=0x7fad18e20aa0,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a0dd430,_signus=0x7fad18e20c20,
 _puppixoffset=[0,0],_nact=80,_def=0x10bbdf030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f09fd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819920,xposition=0x7fad1a838308,yposition=
 0x7fad1a819bc0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8382d0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       71.0   0.941       84.1
Field Avg  2.20                     71.0   0.941       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a8498f8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=10,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ae8,lgs_prof_alt=0x7fad1a819808,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19174030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=32549.5,_skynphotons=101.871,_tt=[0.0040848,
 0.00163438],_lastvalidtt=[0.0040848,0.00163438],_upttcommand=[0,0],_refmes=
 0x7fad1a145230,_tiprefv=0x7fad1a0e4030,_tiltrefv=0x7fad19170c30,_tiprefvn=
 0x7fad1a0e4e30,_tiltrefvn=0x7fad1918dc30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a0fe230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108e64030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a0fe230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a0a8e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fa60)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837148,_ctrlden=0x7fad1903fe50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e24e20,_xlast=0x7fad18e20920,_ylast=[0x7fad1a0dd430,
 0x7fad1a0dd430,0x7fad1a0dd430],_y0=0x7fad1a091830,_signus=0x7fad18e25e70,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e20aa0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819920,xposition=0x7fad1a838228,yposition=
 0x7fad1a8385a8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8382d0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       71.6   0.842       90.1
Field Avg  2.20                     71.6   0.842       90.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848d48)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=14,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ae8,lgs_prof_alt=0x7fad1a819808,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a106c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1635.21,_skynphotons=203.743,_tt=[0.00690431,
 -0.000318506],_lastvalidtt=[0.00690431,-0.000318506],_upttcommand=[0,0],
 _refmes=0x7fad1916b230,_tiprefv=0x7fad1915c230,_tiltrefv=0x7fad1a10a430,
 _tiprefvn=0x7fad1915d030,_tiltrefvn=0x7fad1a144e30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1a0e8a30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108d73030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a0e8a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19155030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a8370d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838618,_ctrlden=0x7fad1a837848,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5d090,_xlast=0x7fad18c0e760,_ylast=[0x7fad19131a30,
 0x7fad19131a30,0x7fad19131a30],_y0=0x7fad19116a30,_signus=0x7fad18c5be20,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1a3c0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819920,xposition=0x7fad1a8371b8,yposition=
 0x7fad1a837490,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8382d0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       76.0   0.654      120.1
Field Avg  2.20                     76.0   0.654      120.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a8497e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=15,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ae8,lgs_prof_alt=0x7fad1a819808,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19173c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=650.986,_skynphotons=203.743,_tt=[0.00116985,
 -0.00225267],_lastvalidtt=[0.00116985,-0.00225267],_upttcommand=[0,0],_refmes=
 0x7fad1918cc30,_tiprefv=0x7fad19151430,_tiltrefv=0x7fad1a0dc630,_tiprefvn=
 0x7fad1915c230,_tiltrefvn=0x7fad1a10a430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1917ea30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108e64030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1917ea30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a107c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fa60)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838340,_ctrlden=0x7fad1a838490,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cf50,_xlast=0x7fad18c5d070,_ylast=[0x7fad19116a30,
 0x7fad19116a30,0x7fad19116a30],_y0=0x7fad19174430,_signus=0x7fad18c0e700,
 _puppixoffset=[0,0],_nact=80,_def=0x10bbdf030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f0b3f0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819920,xposition=0x7fad19035830,yposition=
 0x7fad1a837d50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8382d0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       84.8   0.422      168.2
Field Avg  2.20                     84.8   0.422      168.2
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848570)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=16,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ae8,lgs_prof_alt=0x7fad1a819808,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad191a2430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647.905,_skynphotons=509.357,_tt=[-0.00797685,
 -0.00149],_lastvalidtt=[-0.00797685,-0.00149],_upttcommand=[0,0],_refmes=
 0x7fad1916b230,_tiprefv=0x7fad1913c630,_tiltrefv=0x7fad1918cc30,_tiprefvn=
 0x7fad19151430,_tiltrefvn=0x7fad1916c030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad191bd230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d73030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad191bd230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a0cce30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fd70)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838650,_ctrlden=0x7fad1a8376c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0e080,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad19174430,
 0x7fad19174430,0x7fad19174430],_y0=0x7fad19063030,_signus=0x7fad18c0cf50,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e22900,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819920,xposition=0x7fad1a819a00,yposition=
 0x7fad1a8377d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8382d0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849188)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=1,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838618,lgs_prof_alt=0x7fad1903fd70,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19160630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29584e+08,_skynphotons=101.871,_tt=[-0.00125713,
 -0.000188515],_lastvalidtt=[-0.00125713,-0.000188515],_upttcommand=[0,0],
 _refmes=0x7fad19173630,_tiprefv=0x7fad19170c30,_tiltrefv=0x7fad1915ce30,
 _tiprefvn=0x7fad1917aa30,_tiltrefvn=0x7fad1917d630,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1a17fc30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108ec9030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a17fc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1913e430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838340)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8384c8,_ctrlden=0x7fad1903fbb0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e17a60,_xlast=0x7fad18e17be0,_ylast=[0x7fad1a10e230,
 0x7fad1a10e230,0x7fad1a10e230],_y0=0x7fad1a0fb430,_signus=0x7fad18e1d510,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e24450,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8377d8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd38,xposition=0x7fad1a837ce0,yposition=
 0x7fad1a074278,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f9b8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.947       78.1
Field Avg  2.20                     70.7   0.947       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849e48)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838618,lgs_prof_alt=0x7fad1903fd70,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19192430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=
 [-0.000819817,0.000487203],_lastvalidtt=[-0.000819817,0.000487203],
 _upttcommand=[0,0],_refmes=0x7fad19173630,_tiprefv=0x7fad19036430,_tiltrefv=
 0x7fad1917e430,_tiprefvn=0x7fad19170c30,_tiltrefvn=0x7fad1915ce30,_reordervec=
 0x0,_npixels=0,_npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,
 _binindices=0x0,_binxy=0,_centroidw=0x0,_fimage=0x7fad1a0e0a30,_fimage2=0x0,
 _imistart=0x0,_imjstart=0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,
 _unittilt=0x0,_lgs_defocuses=0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=
 0x0,_yoffset=0x0,_bias=0x0,_flat=0x0,_domask=0,_submask=0x108d1e030,_kernel=
 0x0,_kernels=0x0,_kerfftr=0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fad1a0e0a30,_x=0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,
 _bckgrdcalib=0x7fad1a0a8e30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1903fec0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8383b0,_ctrlden=0x7fad1a837df8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e18170,_xlast=0x7fad18e17a60,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a108a30,_signus=0x7fad18e1b120,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d04a70,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8377d8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd38,xposition=0x7fad1a8381f0,yposition=
 0x7fad1903fda8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f9b8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.945       84.1
Field Avg  2.20                     70.7   0.945       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a8485f8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838618,lgs_prof_alt=0x7fad1903fd70,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a12ae30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=81760.9,_skynphotons=101.871,_tt=[-0.00108975,
 -0.0014978],_lastvalidtt=[-0.00108975,-0.0014978],_upttcommand=[0,0],_refmes=
 0x7fad19180430,_tiprefv=0x7fad19178430,_tiltrefv=0x7fad1a0cce30,_tiprefvn=
 0x7fad19036430,_tiltrefvn=0x7fad1a0eb430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad19238e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108bef030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad19238e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a13ce30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838340)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838730,_ctrlden=0x7fad1a8381b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e24060,_xlast=0x7fad18e18170,_ylast=[0x7fad1a108a30,
 0x7fad1a108a30,0x7fad1a108a30],_y0=0x7fad1a0a9630,_signus=0x7fad18e1a3c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0cbd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8377d8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd38,xposition=0x7fad1a8375e0,yposition=
 0x7fad1903fa98,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f9b8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       71.0   0.942       84.1
Field Avg  2.20                     71.0   0.942       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a848dd0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=10,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838618,lgs_prof_alt=0x7fad1903fd70,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a0dd030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=32549.5,_skynphotons=101.871,_tt=[-0.00103963,
 -0.00121732],_lastvalidtt=[-0.00103963,-0.00121732],_upttcommand=[0,0],_refmes=
 0x7fad1a0e4030,_tiprefv=0x7fad1a0e4e30,_tiltrefv=0x7fad1a0da030,_tiprefvn=
 0x7fad1a0e9630,_tiltrefvn=0x7fad1a0cce30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a15c830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d1e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a15c830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19158a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fec0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a819808,_ctrlden=0x7fad1a838420,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e20fd0,_xlast=0x7fad18e1ec00,_ylast=[0x7fad1a0a9630,
 0x7fad1a0a9630,0x7fad1a0a9630],_y0=0x7fad1a12e830,_signus=0x7fad18e21940,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1ed80,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8377d8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd38,xposition=0x7fad1a8386f8,yposition=
 0x7fad1a837490,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f9b8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       72.3   0.840       90.1
Field Avg  2.20                     72.3   0.840       90.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849ba0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=14,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838618,lgs_prof_alt=0x7fad1903fd70,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1913d030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1635.21,_skynphotons=203.743,_tt=[-0.00652565,
 -0.000480812],_lastvalidtt=[-0.00652565,-0.000480812],_upttcommand=[0,0],
 _refmes=0x7fad19170c30,_tiprefv=0x7fad19036430,_tiltrefv=0x7fad19821230,
 _tiprefvn=0x7fad19151430,_tiltrefvn=0x7fad1982fa30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad19191830,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108bef030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad19191830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a10aa30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838340)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837928,_ctrlden=0x7fad1a837960,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e18170,_xlast=0x7fad18e1e8d0,_ylast=[0x7fad1a12e830,
 0x7fad1a12e830,0x7fad1a12e830],_y0=0x7fad1a0dfa30,_signus=0x7fad18e1ea50,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5ec00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8377d8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd38,xposition=0x7fad1a01a288,yposition=
 0x7fad1a837688,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f9b8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       75.7   0.653      120.1
Field Avg  2.20                     75.7   0.653      120.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a8496d8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=15,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838618,lgs_prof_alt=0x7fad1903fd70,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a0e7c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=650.986,_skynphotons=203.743,_tt=[-0.00823792,
 -0.000350419],_lastvalidtt=[-0.00823792,-0.000350419],_upttcommand=[0,0],
 _refmes=0x7fad1a0eb030,_tiprefv=0x7fad1915c230,_tiltrefv=0x7fad1913ce30,
 _tiprefvn=0x7fad19036430,_tiltrefvn=0x7fad19170c30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1a126630,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108cd0030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a126630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19158a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fec0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837b90,_ctrlden=0x7fad1903f980,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cbd0,_xlast=0x7fad18c0eaa0,_ylast=[0x7fad19174430,
 0x7fad19174430,0x7fad19174430],_y0=0x7fad19171a30,_signus=0x7fad18c0cf50,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5ede0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8377d8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd38,xposition=0x7fad1903fe50,yposition=
 0x7fad1903f9f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f9b8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       84.8   0.398      174.2
Field Avg  2.20                     84.8   0.398      174.2
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a848cc0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=16,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838618,lgs_prof_alt=0x7fad1903fd70,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1918e230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647.905,_skynphotons=509.357,_tt=[-0.00296832,
 0.000911877],_lastvalidtt=[-0.00296832,0.000911877],_upttcommand=[0,0],_refmes=
 0x7fad1a0eb030,_tiprefv=0x7fad19152230,_tiltrefv=0x7fad1a0ed230,_tiprefvn=
 0x7fad1915c230,_tiltrefvn=0x7fad1a0fc030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad191b2a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108bef030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad191b2a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19158a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837110)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838458,_ctrlden=0x7fad1a838768,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c4ea50,_xlast=0x7fad18c0e080,_ylast=[0x7fad19171a30,
 0x7fad19171a30,0x7fad19171a30],_y0=0x7fad19179e30,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e232d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8377d8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd38,xposition=0x7fad1a837bc8,yposition=
 0x7fad1a838688,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f9b8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       53.3   0.910       63.1
Field Avg  1.65                     53.3   0.910       63.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849dc0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=1,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a837110,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19828230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29584e+08,_skynphotons=101.871,_tt=[-0.00101083,
 0.00209449],_lastvalidtt=[-0.00101083,0.00209449],_upttcommand=[0,0],_refmes=
 0x7fad19178430,_tiprefv=0x7fad1918e430,_tiltrefv=0x7fad19173630,_tiprefvn=
 0x7fad1916de30,_tiltrefvn=0x7fad1916ec30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1914ec30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1090dc030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1914ec30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19180c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837b90)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad19040010,_ctrlden=0x7fad1903fe50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e20920,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a108a30,_signus=0x7fad18e1f1d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c4f070,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837c38,xposition=0x7fad1a838260,yposition=
 0x7fad1903fb78,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fc58,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       53.3   0.908       63.1
Field Avg  1.65                     53.3   0.908       63.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849a90)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a837110,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19191830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=
 [-0.000794906,0.000531156],_lastvalidtt=[-0.000794906,0.000531156],
 _upttcommand=[0,0],_refmes=0x7fad1914a230,_tiprefv=0x7fad19036430,_tiltrefv=
 0x7fad1a146630,_tiprefvn=0x7fad1918e430,_tiltrefvn=0x7fad1a0e7c30,_reordervec=
 0x0,_npixels=0,_npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,
 _binindices=0x0,_binxy=0,_centroidw=0x0,_fimage=0x7fad191fb430,_fimage2=0x0,
 _imistart=0x0,_imjstart=0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,
 _unittilt=0x0,_lgs_defocuses=0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=
 0x0,_yoffset=0x0,_bias=0x0,_flat=0x0,_domask=0,_submask=0x108d1e030,_kernel=
 0x0,_kernels=0x0,_kerfftr=0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fad191fb430,_x=0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,
 _bckgrdcalib=0x7fad19155030,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838260,_ctrlden=0x7fad1a837ab0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c4e9e0,_xlast=0x7fad18c50630,_ylast=[0x7fad1916be30,
 0x7fad1916be30,0x7fad1916be30],_y0=0x7fad19037230,_signus=0x7fad18c4fb30,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c507b0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837c38,xposition=0x7fad1903fa60,yposition=
 0x7fad1903fbb0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fc58,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       53.3   0.905       63.1
Field Avg  1.65                     53.3   0.905       63.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848ee0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a837110,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19149230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=81760.9,_skynphotons=101.871,_tt=[-0.000506606,
 -0.000721572],_lastvalidtt=[-0.000506606,-0.000721572],_upttcommand=[0,0],
 _refmes=0x7fad191fec30,_tiprefv=0x7fad1914a230,_tiltrefv=0x7fad191a1630,
 _tiprefvn=0x7fad19036430,_tiltrefvn=0x7fad1914f030,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1a162230,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108fa7030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a162230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a10aa30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837b90)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8385a8,_ctrlden=0x7fad1a819990,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e20920,_xlast=0x7fad18e1a3c0,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a108a30,_signus=0x7fad18e221e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10cbe2030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c50930,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837c38,xposition=0x7fad1a8382d0,yposition=
 0x7fad1903fc20,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fc58,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       53.3   0.899       63.1
Field Avg  1.65                     53.3   0.899       63.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849b18)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=10,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a837110,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19170c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=32549.5,_skynphotons=101.871,_tt=[-0.00185616,
 -0.000240559],_lastvalidtt=[-0.00185616,-0.000240559],_upttcommand=[0,0],
 _refmes=0x7fad19850030,_tiprefv=0x7fad191fec30,_tiltrefv=0x7fad1a146030,
 _tiprefvn=0x7fad1914a230,_tiltrefvn=0x7fad1a139430,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1a13c430,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108c2c030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a13c430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a0dce30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fad0,_ctrlden=0x7fad1a837538,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e22ac0,_xlast=0x7fad18e22f90,_ylast=[0x7fad1a108a30,
 0x7fad1a108a30,0x7fad1a108a30],_y0=0x7fad1a0ee630,_signus=0x7fad18e17c10,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1a3c0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837c38,xposition=0x7fad1a838110,yposition=
 0x7fad1903f980,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fc58,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.735       72.1
Field Avg  1.65                     54.9   0.735       72.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848f68)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=14,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a837110,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1926b230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1635.21,_skynphotons=203.743,_tt=[-0.00299111,
 -0.00419874],_lastvalidtt=[-0.00299111,-0.00419874],_upttcommand=[0,0],_refmes=
 0x7fad1a155430,_tiprefv=0x7fad1a0dec30,_tiltrefv=0x7fad19170c30,_tiprefvn=
 0x7fad1a0ed230,_tiltrefvn=0x7fad19149e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a13fc30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d1e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a13fc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1913e430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837b90)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837df8,_ctrlden=0x7fad1903fbb0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0eaa0,_xlast=0x7fad18c0c650,_ylast=[0x7fad1915ce30,
 0x7fad1915ce30,0x7fad1915ce30],_y0=0x7fad19171a30,_signus=0x7fad18c4e320,
 _puppixoffset=[0,0],_nact=80,_def=0x10c4e1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e22f90,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837c38,xposition=0x7fad1a8381b8,yposition=
 0x7fad1a837960,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fc58,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       59.9   0.472      130.6
Field Avg  1.65                     59.9   0.472      130.6
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848ff0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=15,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a837110,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19814430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=650.986,_skynphotons=203.743,_tt=[-0.00612666,
 0.00338371],_lastvalidtt=[-0.00612666,0.00338371],_upttcommand=[0,0],_refmes=
 0x7fad1914ac30,_tiprefv=0x7fad19180c30,_tiltrefv=0x7fad1a0e7c30,_tiprefvn=
 0x7fad19178430,_tiltrefvn=0x7fad1a0e1a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a141e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108dfa030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a141e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19180230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838228,_ctrlden=0x7fad1903fda8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e20920,_xlast=0x7fad18e17b30,_ylast=[0x7fad1a0eb030,
 0x7fad1a0eb030,0x7fad1a0eb030],_y0=0x7fad1a092230,_signus=0x7fad18e20c90,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f0ace0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837c38,xposition=0x7fad1a838420,yposition=
 0x7fad1a838260,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fc58,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       76.0   0.222      184.7
Field Avg  1.65                     76.0   0.222      184.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a8484e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=16,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a837110,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a0ede30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647.905,_skynphotons=509.357,_tt=[-0.00299558,
 0.00937045],_lastvalidtt=[-0.00299558,0.00937045],_upttcommand=[0,0],_refmes=
 0x7fad19179230,_tiprefv=0x7fad1a0da030,_tiltrefv=0x7fad1a0ea230,_tiprefvn=
 0x7fad1a0e5230,_tiltrefvn=0x7fad1a0e7c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad198de630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d5f030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad198de630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1913e430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838180)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8199c8,_ctrlden=0x7fad1a819a38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18d04b40,_xlast=0x7fad18d064a0,_ylast=[0x7fad1980ae30,
 0x7fad1980ae30,0x7fad1980ae30],_y0=0x7fad19810430,_signus=0x7fad18d06620,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8e2030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d06a60,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837c38,xposition=0x7fad1a838570,yposition=
 0x7fad1a8376f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fc58,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.848       51.2
Field Avg  1.25                     40.3   0.848       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849cb0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=1,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8370a0,lgs_prof_alt=0x7fad1a838180,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19249830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29584e+08,_skynphotons=101.871,_tt=
 [-0.000512245,0.000730066],_lastvalidtt=[-0.000512245,0.000730066],
 _upttcommand=[0,0],_refmes=0x7fad1918e430,_tiprefv=0x7fad1917c230,_tiltrefv=
 0x7fad1a13fc30,_tiprefvn=0x7fad19152230,_tiltrefvn=0x7fad1a0e1230,_reordervec=
 0x0,_npixels=0,_npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,
 _binindices=0x0,_binxy=0,_centroidw=0x0,_fimage=0x7fad1a104230,_fimage2=0x0,
 _imistart=0x0,_imjstart=0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,
 _unittilt=0x0,_lgs_defocuses=0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=
 0x0,_yoffset=0x0,_bias=0x0,_flat=0x0,_domask=0,_submask=0x10903b030,_kernel=
 0x0,_kernels=0x0,_kerfftr=0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fad1a104230,_x=0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,
 _bckgrdcalib=0x7fad19155030,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a838228)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8378b8,_ctrlden=0x7fad1903ffd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1a3c0,_xlast=0x7fad18e20ad0,_ylast=[0x7fad1a0ebe30,
 0x7fad1a0ebe30,0x7fad1a0ebe30],_y0=0x7fad1a0e2030,_signus=0x7fad18e20c50,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c57570,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1903fcc8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819b50,xposition=0x7fad1a819a70,yposition=
 0x7fad1a837ab0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8384c8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.846       51.2
Field Avg  1.25                     40.3   0.846       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849100)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8370a0,lgs_prof_alt=0x7fad1a838180,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a0e5c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.0010108,
 -0.00031283],_lastvalidtt=[-0.0010108,-0.00031283],_upttcommand=[0,0],_refmes=
 0x7fad19173630,_tiprefv=0x7fad19179430,_tiltrefv=0x7fad1915c230,_tiprefvn=
 0x7fad1917c230,_tiltrefvn=0x7fad1918e430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1920d830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d1e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1920d830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad192eae30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838260)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838490,_ctrlden=0x7fad1a837260,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e23760,_xlast=0x7fad18e1a3c0,_ylast=[0x7fad1a0e2030,
 0x7fad1a0e2030,0x7fad1a0e2030],_y0=0x7fad1a0e9c30,_signus=0x7fad18e24860,
 _puppixoffset=[0,0],_nact=80,_def=0x10cce6030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e20aa0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1903fcc8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819b50,xposition=0x7fad1a837e30,yposition=
 0x7fad1903fd00,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8384c8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.5   0.842       51.2
Field Avg  1.25                     40.5   0.842       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849a08)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8370a0,lgs_prof_alt=0x7fad1a838180,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a13e230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=81760.9,_skynphotons=101.871,_tt=[-0.00176527,
 0.000401243],_lastvalidtt=[-0.00176527,0.000401243],_upttcommand=[0,0],_refmes=
 0x7fad1a129a30,_tiprefv=0x7fad19173630,_tiltrefv=0x7fad19151030,_tiprefvn=
 0x7fad19179430,_tiltrefvn=0x7fad1915c230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1921d030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108ff1030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1921d030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19155030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838228)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838570,_ctrlden=0x7fad1a837688,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c49850,_xlast=0x7fad18c0e700,_ylast=[0x7fad1916d230,
 0x7fad1916d230,0x7fad1916d230],_y0=0x7fad19174430,_signus=0x7fad18c59f70,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d04b20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1903fcc8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819b50,xposition=0x7fad1903fc20,yposition=
 0x7fad1903fb08,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8384c8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.5   0.831       51.2
Field Avg  1.25                     40.5   0.831       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a8498f8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=10,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8370a0,lgs_prof_alt=0x7fad1a838180,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a128e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=32549.5,_skynphotons=101.871,_tt=[-0.000636908,
 0.00278207],_lastvalidtt=[-0.000636908,0.00278207],_upttcommand=[0,0],_refmes=
 0x7fad19151e30,_tiprefv=0x7fad19150030,_tiltrefv=0x7fad1a117c30,_tiprefvn=
 0x7fad19173630,_tiltrefvn=0x7fad1a127c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a141e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d1e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a141e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a10aa30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838260)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fbe8,_ctrlden=0x7fad1903fd00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0da50,_xlast=0x7fad18c0dbd0,_ylast=[0x7fad19174430,
 0x7fad19174430,0x7fad19174430],_y0=0x7fad1913ea30,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10cce6030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1903fcc8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819b50,xposition=0x7fad1a838068,yposition=
 0x7fad1a837340,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8384c8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       43.3   0.588       85.3
Field Avg  1.25                     43.3   0.588       85.3
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a8497e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=14,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8370a0,lgs_prof_alt=0x7fad1a838180,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a0da030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1635.21,_skynphotons=203.743,_tt=[0.000157699,
 -1.03112e-05],_lastvalidtt=[0.000157699,-1.03112e-05],_upttcommand=[0,0],
 _refmes=0x7fad19203630,_tiprefv=0x7fad19151e30,_tiltrefv=0x7fad1917f830,
 _tiprefvn=0x7fad19150030,_tiltrefvn=0x7fad19173630,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1a13fc30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108dfa030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a13fc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19152c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838228)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837110,_ctrlden=0x7fad1a838618,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cbd0,_xlast=0x7fad18c0da50,_ylast=[0x7fad1913ea30,
 0x7fad1913ea30,0x7fad1913ea30],_y0=0x7fad1916d230,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c496e0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1903fcc8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819b50,xposition=0x7fad1a819990,yposition=
 0x7fad1a8198b0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8384c8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       49.3   0.291      150.1
Field Avg  1.25                     49.3   0.291      150.1
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a848cc0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=15,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8370a0,lgs_prof_alt=0x7fad1a838180,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a0ed230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=650.986,_skynphotons=203.743,_tt=[0.00713862,
 0.00190404],_lastvalidtt=[0.00713862,0.00190404],_upttcommand=[0,0],_refmes=
 0x7fad19277a30,_tiprefv=0x7fad19270e30,_tiltrefv=0x7fad1a146030,_tiprefvn=
 0x7fad19151e30,_tiltrefvn=0x7fad1a12d430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a104230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108c31030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a104230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19152c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838260)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837e30,_ctrlden=0x7fad1903fd70,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0e060,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad1916d230,
 0x7fad1916d230,0x7fad1916d230],_y0=0x7fad19278830,_signus=0x7fad18c58780,
 _puppixoffset=[0,0],_nact=80,_def=0x10c4e5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1a3c0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1903fcc8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819b50,xposition=0x7fad1a837538,yposition=
 0x7fad19040080,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8384c8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       75.8   0.109      201.3
Field Avg  1.25                     75.8   0.109      201.3
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849980)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=16,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.1,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8370a0,lgs_prof_alt=0x7fad1a838180,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19179a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647.905,_skynphotons=509.357,_tt=[0.00433102,
 -0.00823749],_lastvalidtt=[0.00433102,-0.00823749],_upttcommand=[0,0],_refmes=
 0x7fad1a12ba30,_tiprefv=0x7fad1915c230,_tiltrefv=0x7fad1a127630,_tiprefvn=
 0x7fad19270e30,_tiltrefvn=0x7fad1a146030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a85b230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d1e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a85b230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a0e8230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a8373b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fad0,_ctrlden=0x7fad1a837880,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0eb90,_xlast=0x7fad18c0e060,_ylast=[0x7fad19278830,
 0x7fad19278830,0x7fad19278830],_y0=0x7fad19174430,_signus=0x7fad18c49700,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c54910,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1903fcc8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819b50,xposition=0x7fad1a8381f0,yposition=
 0x7fad1a838458,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8384c8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.883       47.8
Field Avg  1.25                     40.2   0.883       47.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a8496d8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1922e230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647914,_skynphotons=50.9357,_tt=[0.000568847,
 3.98694e-05],_lastvalidtt=[0.000568847,3.98694e-05],_upttcommand=[0,0],_refmes=
 0x7fad1a114630,_tiprefv=0x7fad1917c230,_tiltrefv=0x7fad192ae030,_tiprefvn=
 0x7fad192aee30,_tiltrefvn=0x7fad19229a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad192a9630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108dfa030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192a9630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a832030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837c00,_ctrlden=0x7fad1a8371b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5eb80,_xlast=0x7fad18c0bea0,_ylast=[0x7fad192afc30,
 0x7fad192afc30,0x7fad192afc30],_y0=0x7fad1922a830,_signus=0x7fad18c54140,
 _puppixoffset=[0,0],_nact=80,_def=0x10dc64030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f09d10,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1903fd70,yposition=
 0x7fad1a837880,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.882       47.8
Field Avg  1.25                     40.2   0.882       47.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a848818)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a145630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647914,_skynphotons=50.9357,_tt=[0.000835403,
 -0.000161775],_lastvalidtt=[0.000835403,-0.000161775],_upttcommand=[0,0],
 _refmes=0x7fad19193630,_tiprefv=0x7fad191fca30,_tiltrefv=0x7fad19192830,
 _tiprefvn=0x7fad1917c230,_tiltrefvn=0x7fad192ae030,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1a10fa30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108ff1030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a10fa30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a832030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838538)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8382d0,_ctrlden=0x7fad1a074240,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c50440,_xlast=0x7fad18c5eb80,_ylast=[0x7fad1922a830,
 0x7fad1922a830,0x7fad1922a830],_y0=0x7fad19233230,_signus=0x7fad18c5f740,
 _puppixoffset=[0,0],_nact=80,_def=0x10f35d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e17b30,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1a838618,yposition=
 0x7fad1a8373b0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.871       47.8
Field Avg  1.25                     40.2   0.871       47.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849ba0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a13fc30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647914,_skynphotons=50.9357,_tt=[-0.00118445,
 0.00108109],_lastvalidtt=[-0.00118445,0.00108109],_upttcommand=[0,0],_refmes=
 0x7fad1a0ffe30,_tiprefv=0x7fad1922e230,_tiltrefv=0x7fad1a12be30,_tiprefvn=
 0x7fad191fca30,_tiltrefvn=0x7fad1a143630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a131230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d84030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a131230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a105230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838378,_ctrlden=0x7fad1903fe50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e18170,_ylast=[0x7fad1a0df230,
 0x7fad1a0df230,0x7fad1a0df230],_y0=0x7fad1a13e030,_signus=0x7fad18e22320,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8e6030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d04b20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad19040048,yposition=
 0x7fad1a8383e8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.7   0.849       51.2
Field Avg  1.25                     40.7   0.849       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a848c38)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19193e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647914,_skynphotons=50.9357,_tt=[0.00242865,
 -0.00176164],_lastvalidtt=[0.00242865,-0.00176164],_upttcommand=[0,0],_refmes=
 0x7fad192ae430,_tiprefv=0x7fad1985ca30,_tiltrefv=0x7fad1922e230,_tiprefvn=
 0x7fad1985d830,_tiltrefvn=0x7fad1929d030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a135c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108dfa030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a135c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a0a8e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838538)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad19040048,_ctrlden=0x7fad1a8386c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18f08e70,_xlast=0x7fad18f08ff0,_ylast=[0x7fad1a845830,
 0x7fad1a845830,0x7fad1a845830],_y0=0x7fad1a831430,_signus=0x7fad18f09170,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d050d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1a837688,yposition=
 0x7fad1903ffd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.55,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       48.5   0.082      286.6
Field Avg  1.25                     48.5   0.082      286.6
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849760)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1929b230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647914,_skynphotons=50.9357,_tt=[-0.0616659,
 0.0303799],_lastvalidtt=[-0.0616659,0.0303799],_upttcommand=[0,0],_refmes=
 0x7fad1a143630,_tiprefv=0x7fad1a144430,_tiltrefv=0x7fad1a111c30,_tiprefvn=
 0x7fad1a112a30,_tiltrefvn=0x7fad1a104430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a101c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108f33030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a101c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19227630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838068,_ctrlden=0x7fad1a819a00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1f350,_xlast=0x7fad18e25330,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a109e30,_signus=0x7fad18e248c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c4e5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0e7d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1903fd00,yposition=
 0x7fad1a819990,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0      112.0   0.037      402.6
Field Avg  1.25                    112.0   0.037      402.6
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849dc0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a114630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647914,_skynphotons=50.9357,_tt=[0.0619304,
 0.0616385],_lastvalidtt=[0.0619304,0.0616385],_upttcommand=[0,0],_refmes=
 0x7fad19294230,_tiprefv=0x7fad192a2e30,_tiltrefv=0x7fad19229e30,_tiprefvn=
 0x7fad19192830,_tiltrefvn=0x7fad1a804630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad19297230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108c5b030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad19297230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19227630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838538)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837378,_ctrlden=0x7fad1a838148,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e20fb0,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a139c30,_signus=0x7fad18e1de10,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e25300,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1a838228,yposition=
 0x7fad1903fc90,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.7,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.0   0.869       47.8
Field Avg  1.25                     40.0   0.869       47.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849430)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19233e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00143891,
 8.822e-05],_lastvalidtt=[-0.00143891,8.822e-05],_upttcommand=[0,0],_refmes=
 0x7fad1a0ffe30,_tiprefv=0x7fad1922e230,_tiltrefv=0x7fad19195030,_tiprefvn=
 0x7fad192a2e30,_tiltrefvn=0x7fad19229e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a0fc830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d46030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a0fc830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1914e630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a819990,_ctrlden=0x7fad1903fd38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1e0d0,_xlast=0x7fad18e1bf00,_ylast=[0x7fad1a139c30,
 0x7fad1a139c30,0x7fad1a139c30],_y0=0x7fad1a0df230,_signus=0x7fad18e21d50,
 _puppixoffset=[0,0],_nact=80,_def=0x10fed9030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f08e70,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1903f9b8,yposition=
 0x7fad1903f9f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.0   0.873       47.8
Field Avg  1.25                     40.0   0.873       47.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849540)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a10fa30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00102683,
 0.000277413],_lastvalidtt=[-0.00102683,0.000277413],_upttcommand=[0,0],_refmes=
 0x7fad1a86c230,_tiprefv=0x7fad1a101c30,_tiltrefv=0x7fad1a112230,_tiprefvn=
 0x7fad1a102a30,_tiltrefvn=0x7fad1a12c630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a121c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108c5b030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a121c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a13da30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838538)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8199c8,_ctrlden=0x7fad1903fad0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e18170,_xlast=0x7fad18e237c0,_ylast=[0x7fad1a0df230,
 0x7fad1a0df230,0x7fad1a0df230],_y0=0x7fad1a109e30,_signus=0x7fad18e1ea30,
 _puppixoffset=[0,0],_nact=80,_def=0x10dfdf030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0cbd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1903f868,yposition=
 0x7fad1a8370a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.866       47.8
Field Avg  1.25                     40.2   0.866       47.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849c28)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a104430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00207829,
 0.00130413],_lastvalidtt=[-0.00207829,0.00130413],_upttcommand=[0,0],_refmes=
 0x7fad19192830,_tiprefv=0x7fad192b3630,_tiltrefv=0x7fad19193630,_tiprefvn=
 0x7fad1922e230,_tiltrefvn=0x7fad19229230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad19854230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d46030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad19854230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19227630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837c00,_ctrlden=0x7fad1a838378,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0eaa0,_xlast=0x7fad18c0c650,_ylast=[0x7fad19230a30,
 0x7fad19230a30,0x7fad19230a30],_y0=0x7fad1922f030,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10f6d8030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1d510,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1a8371b8,yposition=
 0x7fad1a837880,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.9   0.846       51.2
Field Avg  1.25                     40.9   0.846       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849078)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a0fea30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=
 [-0.000169867,0.00032889],_lastvalidtt=[-0.000169867,0.00032889],_upttcommand=
 [0,0],_refmes=0x7fad1917c230,_tiprefv=0x7fad1a82fc30,_tiltrefv=0x7fad1a804630,
 _tiprefvn=0x7fad1a819e30,_tiltrefvn=0x7fad1a859030,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1a12ae30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108c5b030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a12ae30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a872a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838538)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8376c0,_ctrlden=0x7fad19035830,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c4e370,_xlast=0x7fad18c0eaa0,_ylast=[0x7fad1922f030,
 0x7fad1922f030,0x7fad1922f030],_y0=0x7fad19226a30,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dfdf030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f08e70,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1a074240,yposition=
 0x7fad1a837928,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.55,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       53.7   0.083      276.4
Field Avg  1.25                     53.7   0.083      276.4
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a8498f8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad191b5030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[0.00828263,
 0.0389248],_lastvalidtt=[0.00828263,0.0389248],_upttcommand=[0,0],_refmes=
 0x7fad19229230,_tiprefv=0x7fad1a143630,_tiltrefv=0x7fad1917c230,_tiprefvn=
 0x7fad1a101c30,_tiltrefvn=0x7fad19193430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad19198830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d46030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad19198830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19227630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838768,_ctrlden=0x7fad1903f8d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18d04b80,_xlast=0x7fad18d04fb0,_ylast=[0x7fad1980ae30,
 0x7fad1980ae30,0x7fad1980ae30],_y0=0x7fad19810430,_signus=0x7fad18d05a30,
 _puppixoffset=[0,0],_nact=80,_def=0x10f6d8030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5f9f0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1903fe50,yposition=
 0x7fad1a838730,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       93.6   0.039      399.2
Field Avg  1.25                     93.6   0.039      399.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a848ff0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad191b1230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[0.0740573,
 0.0739399],_lastvalidtt=[0.0740573,0.0739399],_upttcommand=[0,0],_refmes=
 0x7fad191ae230,_tiprefv=0x7fad192b3830,_tiltrefv=0x7fad192ae830,_tiprefvn=
 0x7fad191afe30,_tiltrefvn=0x7fad1917c230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a143630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108c5b030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a143630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1922e230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838538)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fa28,_ctrlden=0x7fad1903fd70,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c50610,_xlast=0x7fad18c50b90,_ylast=[0x7fad19230a30,
 0x7fad19230a30,0x7fad19230a30],_y0=0x7fad19226a30,_signus=0x7fad18c54140,
 _puppixoffset=[0,0],_nact=80,_def=0x10dfdf030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f09d10,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1a8386c0,yposition=
 0x7fad1a8199c8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.7,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.853       51.2
Field Avg  1.25                     40.2   0.853       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a848790)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192a5430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.00114295,
 -0.000273196],_lastvalidtt=[0.00114295,-0.000273196],_upttcommand=[0,0],
 _refmes=0x7fad1a143630,_tiprefv=0x7fad19192830,_tiltrefv=0x7fad192ad830,
 _tiprefvn=0x7fad192b3830,_tiltrefvn=0x7fad192ae830,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad192a6c30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192a6c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19227630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838490,_ctrlden=0x7fad1a838458,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18d050f0,_xlast=0x7fad18d04b20,_ylast=[0x7fad1981e230,
 0x7fad1981e230,0x7fad1981e230],_y0=0x7fad19810430,_signus=0x7fad18d05a30,
 _puppixoffset=[0,0],_nact=80,_def=0x10f6d8030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1a819a00,yposition=
 0x7fad1903fda8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.865       51.2
Field Avg  1.25                     40.3   0.865       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849cb0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192a2430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.000816118,
 3.95328e-05],_lastvalidtt=[0.000816118,3.95328e-05],_upttcommand=[0,0],_refmes=
 0x7fad1a0ff030,_tiprefv=0x7fad1a116430,_tiltrefv=0x7fad192b3430,_tiprefvn=
 0x7fad1a103630,_tiltrefvn=0x7fad192ad830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad19823e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d84030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad19823e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19227630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838538)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fd00,_ctrlden=0x7fad1a838420,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e18170,_xlast=0x7fad18e22a40,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a117230,_signus=0x7fad18e25150,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1a3c0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1a838148,yposition=
 0x7fad1a837110,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.861       51.2
Field Avg  1.25                     40.3   0.861       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a8495c8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192a1a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.000169867,
 0.000982696],_lastvalidtt=[0.000169867,0.000982696],_upttcommand=[0,0],_refmes=
 0x7fad19229230,_tiprefv=0x7fad1a144e30,_tiltrefv=0x7fad19194230,_tiprefvn=
 0x7fad1a116430,_tiltrefvn=0x7fad192b3430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1929dc30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108cab030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1929dc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19227630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a819808,_ctrlden=0x7fad1903fde0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c4f2d0,_xlast=0x7fad18c4f450,_ylast=[0x7fad19195030,
 0x7fad19195030,0x7fad19195030],_y0=0x7fad1922a830,_signus=0x7fad18c4f900,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0b540,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1903fd38,yposition=
 0x7fad1a837c00,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.843       51.2
Field Avg  1.25                     40.3   0.843       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849980)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19193a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=
 [-0.000561133,0.00229155],_lastvalidtt=[-0.000561133,0.00229155],_upttcommand=
 [0,0],_refmes=0x7fad1a118830,_tiprefv=0x7fad1a102a30,_tiltrefv=0x7fad19229230,
 _tiprefvn=0x7fad1a144e30,_tiltrefvn=0x7fad19194230,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1a147c30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108c4d030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a147c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1922e230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838538)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fd38,_ctrlden=0x7fad1a837e30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e17b90,_ylast=[0x7fad1a110630,
 0x7fad1a110630,0x7fad1a110630],_y0=0x7fad1a100830,_signus=0x7fad18e1ea30,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1d510,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1903fad0,yposition=
 0x7fad1903fa98,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.55,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       54.9   0.067      286.6
Field Avg  1.25                     54.9   0.067      286.6
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a848708)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a144230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[-0.013855,
 0.0452748],_lastvalidtt=[-0.013855,0.0452748],_upttcommand=[0,0],_refmes=
 0x7fad1a112030,_tiprefv=0x7fad19233e30,_tiltrefv=0x7fad192a5430,_tiprefvn=
 0x7fad1917c230,_tiltrefvn=0x7fad19229230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad191f5830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108cab030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad191f5830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19227630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad19040010,_ctrlden=0x7fad1a819920,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18f09fd0,_xlast=0x7fad18f0a150,_ylast=[0x7fad1a831430,
 0x7fad1a831430,0x7fad1a831430],_y0=0x7fad1a830830,_signus=0x7fad18f0a2d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0e7d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1a838378,yposition=
 0x7fad1a8382d0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0      134.1   0.028      395.8
Field Avg  1.25                    134.1   0.028      395.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a8494b8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a118830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[-0.00675081,
 0.00162881],_lastvalidtt=[-0.00675081,0.00162881],_upttcommand=[0,0],_refmes=
 0x7fad1a131230,_tiprefv=0x7fad1a144230,_tiltrefv=0x7fad1a87c830,_tiprefvn=
 0x7fad1a1a1c30,_tiltrefvn=0x7fad1a819e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a27d230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a27d230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19227630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838538)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837378,_ctrlden=0x7fad1a838068,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0c650,_xlast=0x7fad18c0cf50,_ylast=[0x7fad19230a30,
 0x7fad19230a30,0x7fad19230a30],_y0=0x7fad1922a830,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0cbd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad19035830,yposition=
 0x7fad1a838500,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.7,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.833       51.2
Field Avg  1.25                     40.2   0.833       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849210)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1984fe30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[0.000597255,
 -0.00131076],_lastvalidtt=[0.000597255,-0.00131076],_upttcommand=[0,0],_refmes=
 0x7fad1a89b230,_tiprefv=0x7fad1917c230,_tiltrefv=0x7fad1a11e630,_tiprefvn=
 0x7fad192b3630,_tiltrefvn=0x7fad1a144230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a126830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108ff1030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a126830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a13da30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838688,_ctrlden=0x7fad1903fa28,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e17b30,_xlast=0x7fad18c5f9e0,_ylast=[0x7fad1922a830,
 0x7fad1922a830,0x7fad1922a830],_y0=0x7fad19226a30,_signus=0x7fad18c0cf50,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f0ace0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1903f8d8,yposition=
 0x7fad1a838618,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.853       51.2
Field Avg  1.25                     40.2   0.853       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849d38)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a110230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[0.0003934,
 -0.000880907],_lastvalidtt=[0.0003934,-0.000880907],_upttcommand=[0,0],_refmes=
 0x7fad1a103630,_tiprefv=0x7fad19193e30,_tiltrefv=0x7fad191fb830,_tiprefvn=
 0x7fad1917c230,_tiltrefvn=0x7fad191fc630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1929c230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108cab030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1929c230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19229e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838538)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837848,_ctrlden=0x7fad1903fcc8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0da50,_xlast=0x7fad18c0e7d0,_ylast=[0x7fad19226a30,
 0x7fad19226a30,0x7fad19226a30],_y0=0x7fad192a4030,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0dbd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1903fd70,yposition=
 0x7fad1a838768,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.854       51.2
Field Avg  1.25                     40.3   0.854       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849650)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a10fa30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=
 [-0.000453343,-0.000704538],_lastvalidtt=[-0.000453343,-0.000704538],
 _upttcommand=[0,0],_refmes=0x7fad19294230,_tiprefv=0x7fad1a82fc30,_tiltrefv=
 0x7fad192cd230,_tiprefvn=0x7fad1a82d030,_tiltrefvn=0x7fad191fb830,_reordervec=
 0x0,_npixels=0,_npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,
 _binindices=0x0,_binxy=0,_centroidw=0x0,_fimage=0x7fad1a111230,_fimage2=0x0,
 _imistart=0x0,_imjstart=0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,
 _unittilt=0x0,_lgs_defocuses=0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=
 0x0,_yoffset=0x0,_bias=0x0,_flat=0x0,_domask=0,_submask=0x108bd3030,_kernel=
 0x0,_kernels=0x0,_kerfftr=0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fad1a111230,_x=0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,
 _bckgrdcalib=0x7fad19194a30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fbb0,_ctrlden=0x7fad1903fc20,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c4fc10,_xlast=0x7fad18c0da50,_ylast=[0x7fad192a4030,
 0x7fad192a4030,0x7fad192a4030],_y0=0x7fad192a3c30,_signus=0x7fad18c4b590,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1a838458,yposition=
 0x7fad1a838228,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.5   0.839       51.2
Field Avg  1.25                     40.5   0.839       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849100)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192cc830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=
 [-7.24628e-05,-0.00010787],_lastvalidtt=[-7.24628e-05,-0.00010787],
 _upttcommand=[0,0],_refmes=0x7fad19229230,_tiprefv=0x7fad1a11ec30,_tiltrefv=
 0x7fad191fc630,_tiprefvn=0x7fad1a101c30,_tiltrefvn=0x7fad192cd230,_reordervec=
 0x0,_npixels=0,_npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,
 _binindices=0x0,_binxy=0,_centroidw=0x0,_fimage=0x7fad192c8630,_fimage2=0x0,
 _imistart=0x0,_imjstart=0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,
 _unittilt=0x0,_lgs_defocuses=0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=
 0x0,_yoffset=0x0,_bias=0x0,_flat=0x0,_domask=0,_submask=0x108cab030,_kernel=
 0x0,_kernels=0x0,_kerfftr=0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fad192c8630,_x=0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,
 _bckgrdcalib=0x7fad1a102a30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a838538)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fc90,_ctrlden=0x7fad1a837ae8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e25730,_xlast=0x7fad18e1d550,_ylast=[0x7fad1a117230,
 0x7fad1a117230,0x7fad1a117230],_y0=0x7fad1a100830,_signus=0x7fad18e1ea30,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e17b30,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1a838420,yposition=
 0x7fad1903fd38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.55,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       66.6   0.056      283.2
Field Avg  1.25                     66.6   0.056      283.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a8496d8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a103430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[-0.00258961,
 0.030926],_lastvalidtt=[-0.00258961,0.030926],_upttcommand=[0,0],_refmes=
 0x7fad192a3430,_tiprefv=0x7fad19193230,_tiltrefv=0x7fad1a145030,_tiprefvn=
 0x7fad19194030,_tiltrefvn=0x7fad1a0ff830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a111230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108bd3030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a111230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1981d030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837260,_ctrlden=0x7fad1903fb40,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18d05a30,_xlast=0x7fad18d05bb0,_ylast=[0x7fad1980ae30,
 0x7fad1980ae30,0x7fad1980ae30],_y0=0x7fad19810430,_signus=0x7fad18d05d30,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f09130,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1903fde0,yposition=
 0x7fad1a838618,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 208 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0      144.3   0.028      395.8
Field Avg  1.25                    144.3   0.028      395.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a848708)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837c38,lgs_prof_alt=0x7fad1a8381f0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a12ce30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=208,_nsub4disp=0,_nmes=
 416,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[0.0756034,
 0.0795011],_lastvalidtt=[0.0756034,0.0795011],_upttcommand=[0,0],_refmes=
 0x7fad1929d030,_tiprefv=0x7fad1a101c30,_tiltrefv=0x7fad1929c230,_tiprefvn=
 0x7fad1a104230,_tiltrefvn=0x7fad19192830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1926b430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108cab030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1926b430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a13da30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a838538)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8381b8,_ctrlden=0x7fad19040080,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e22a40,_xlast=0x7fad18e1e120,_ylast=[0x7fad1a110630,
 0x7fad1a110630,0x7fad1a110630],_y0=0x7fad1a105030,_signus=0x7fad18e1ea30,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e21d50,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838260,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837768,xposition=0x7fad1a837e30,yposition=
 0x7fad1a838458,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a837ce0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.7,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.885       47.8
Field Avg  1.25                     40.2   0.885       47.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a8498f8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19298430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647914,_skynphotons=50.9357,_tt=[-0.00166713,
 -0.00141024],_lastvalidtt=[-0.00166713,-0.00141024],_upttcommand=[0,0],_refmes=
 0x7fad192aee30,_tiprefv=0x7fad1a104230,_tiltrefv=0x7fad1a10fa30,_tiprefvn=
 0x7fad1a111230,_tiltrefvn=0x7fad1a102830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad191f2e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108bd3030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad191f2e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a108430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a01a288,_ctrlden=0x7fad1a837e30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cbd0,_xlast=0x7fad18c0e7d0,_ylast=[0x7fad19230a30,
 0x7fad19230a30,0x7fad19230a30],_y0=0x7fad191fe030,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10db62030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1a3c0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1a837490,yposition=
 0x7fad1a837d88,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.0   0.888       47.8
Field Avg  1.25                     40.0   0.888       47.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849760)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad191fd830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647914,_skynphotons=50.9357,_tt=[-0.000739448,
 -0.000811537],_lastvalidtt=[-0.000739448,-0.000811537],_upttcommand=[0,0],
 _refmes=0x7fad19229230,_tiprefv=0x7fad19192830,_tiltrefv=0x7fad1a104230,
 _tiprefvn=0x7fad19193830,_tiltrefvn=0x7fad1a10fa30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1a861a30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a861a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a82c830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837c38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8376f8,_ctrlden=0x7fad1a8371b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0b6a0,_xlast=0x7fad18c4f050,_ylast=[0x7fad191fe030,
 0x7fad191fe030,0x7fad191fe030],_y0=0x7fad191fd430,_signus=0x7fad18c0bdc0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f25b030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e18170,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1a838068,yposition=
 0x7fad1a838148,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.876       47.8
Field Avg  1.25                     40.3   0.876       47.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849298)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a0ff830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647914,_skynphotons=50.9357,_tt=[-0.000368883,
 -0.00242509],_lastvalidtt=[-0.000368883,-0.00242509],_upttcommand=[0,0],
 _refmes=0x7fad192a3430,_tiprefv=0x7fad1a16fa30,_tiltrefv=0x7fad1981e230,
 _tiprefvn=0x7fad1a132c30,_tiltrefvn=0x7fad19855430,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1929c230,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108ff1030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1929c230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19227630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8370a0,_ctrlden=0x7fad1903fa60,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0e7d0,_xlast=0x7fad18c0eaa0,_ylast=[0x7fad191fd430,
 0x7fad191fd430,0x7fad191fd430],_y0=0x7fad19230a30,_signus=0x7fad18c0cf50,
 _puppixoffset=[0,0],_nact=80,_def=0x10d1e6030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1f310,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1903fa28,yposition=
 0x7fad1a074240,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.865       47.8
Field Avg  1.25                     40.3   0.865       47.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848dd0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a118830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647914,_skynphotons=50.9357,_tt=[-0.00370908,
 -0.00443359],_lastvalidtt=[-0.00370908,-0.00443359],_upttcommand=[0,0],_refmes=
 0x7fad1929c230,_tiprefv=0x7fad19193c30,_tiltrefv=0x7fad192ce430,_tiprefvn=
 0x7fad192a6c30,_tiltrefvn=0x7fad192b3430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad191faa30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad191faa30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19227630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837c38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837570,_ctrlden=0x7fad1903fda8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e22300,_xlast=0x7fad18e1d510,_ylast=[0x7fad1a108a30,
 0x7fad1a108a30,0x7fad1a108a30],_y0=0x7fad1a145a30,_signus=0x7fad18e1f050,
 _puppixoffset=[0,0],_nact=80,_def=0x10e8df030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f09d10,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1903fcc8,yposition=
 0x7fad1a838180,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.55,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.5   0.850       51.2
Field Avg  1.25                     40.5   0.850       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849dc0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a104230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647914,_skynphotons=50.9357,_tt=[0.00318059,
 0.00127385],_lastvalidtt=[0.00318059,0.00127385],_upttcommand=[0,0],_refmes=
 0x7fad19258a30,_tiprefv=0x7fad1a111230,_tiltrefv=0x7fad19825030,_tiprefvn=
 0x7fad1a112230,_tiltrefvn=0x7fad19826030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad192cbe30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d84030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192cbe30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a13da30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838570,_ctrlden=0x7fad1903fd00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5eb80,_xlast=0x7fad18c0eaa0,_ylast=[0x7fad19226a30,
 0x7fad19226a30,0x7fad19226a30],_y0=0x7fad19230a30,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10cde4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0cbd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1903fc20,yposition=
 0x7fad1a8386f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.9   0.779       54.6
Field Avg  1.25                     40.9   0.779       54.6
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849c28)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19193030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647914,_skynphotons=50.9357,_tt=[-0.00137913,
 0.00359551],_lastvalidtt=[-0.00137913,0.00359551],_upttcommand=[0,0],_refmes=
 0x7fad192aac30,_tiprefv=0x7fad1929ee30,_tiltrefv=0x7fad192a1630,_tiprefvn=
 0x7fad1924aa30,_tiltrefvn=0x7fad19249230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad19238630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad19238630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19227630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837c38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fc20,_ctrlden=0x7fad1903fec0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1a3c0,_xlast=0x7fad18e1d510,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a109e30,_signus=0x7fad18e17b30,
 _puppixoffset=[0,0],_nact=80,_def=0x10e4dd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0e7d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1a837ae8,yposition=
 0x7fad1a838500,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.7,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.853       51.2
Field Avg  1.25                     40.2   0.853       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849a90)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192cde30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00600339,
 0.00152189],_lastvalidtt=[-0.00600339,0.00152189],_upttcommand=[0,0],_refmes=
 0x7fad1a111e30,_tiprefv=0x7fad19245a30,_tiltrefv=0x7fad19192830,_tiprefvn=
 0x7fad1929ee30,_tiltrefvn=0x7fad192a1630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1929c230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108ff1030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1929c230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a804630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a819a00,_ctrlden=0x7fad1903f980,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1e0d0,_xlast=0x7fad18e1a3c0,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a139c30,_signus=0x7fad18e20920,
 _puppixoffset=[0,0],_nact=80,_def=0x10c1e2030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f09ec0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1903fa98,yposition=
 0x7fad1a837c00,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.871       47.8
Field Avg  1.25                     40.2   0.871       47.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a8484e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a150830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00461695,
 0.0010637],_lastvalidtt=[-0.00461695,0.0010637],_upttcommand=[0,0],_refmes=
 0x7fad192c1830,_tiprefv=0x7fad192aee30,_tiltrefv=0x7fad1a101c30,_tiprefvn=
 0x7fad19245a30,_tiltrefvn=0x7fad1a147c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a0fe230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a0fe230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19227630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837c38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837df8,_ctrlden=0x7fad1a838068,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0eaa0,_xlast=0x7fad18c4f5f0,_ylast=[0x7fad19226a30,
 0x7fad19226a30,0x7fad19226a30],_y0=0x7fad192a4030,_signus=0x7fad18c50c10,
 _puppixoffset=[0,0],_nact=80,_def=0x10e4dd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1d510,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1a837768,yposition=
 0x7fad1a837d88,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.868       47.8
Field Avg  1.25                     40.2   0.868       47.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849188)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1986b030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.006171,
 0.00215541],_lastvalidtt=[-0.006171,0.00215541],_upttcommand=[0,0],_refmes=
 0x7fad1a150830,_tiprefv=0x7fad1917c230,_tiltrefv=0x7fad1a14f830,_tiprefvn=
 0x7fad192aee30,_tiltrefvn=0x7fad1a101c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad191faa30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d84030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad191faa30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19227630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837490,_ctrlden=0x7fad1a8370a0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e21dc0,_xlast=0x7fad18e18170,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a0e6030,_signus=0x7fad18e1de10,
 _puppixoffset=[0,0],_nact=80,_def=0x10bae1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5ed40,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1a837e30,yposition=
 0x7fad1a8383e8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.859       51.2
Field Avg  1.25                     40.3   0.859       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849cb0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a102c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00316188,
 -0.00185458],_lastvalidtt=[-0.00316188,-0.00185458],_upttcommand=[0,0],_refmes=
 0x7fad1a158a30,_tiprefv=0x7fad192a1030,_tiltrefv=0x7fad191f5630,_tiprefvn=
 0x7fad1917c230,_tiltrefvn=0x7fad1929d230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a120230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a120230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19229230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837c38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837880,_ctrlden=0x7fad1a837c00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cbd0,_xlast=0x7fad18c4baf0,_ylast=[0x7fad192cf630,
 0x7fad192cf630,0x7fad192cf630],_y0=0x7fad19226a30,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10d5db030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1d510,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1a8371b8,yposition=
 0x7fad1a8384c8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.55,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.845       51.2
Field Avg  1.25                     40.3   0.845       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849540)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1981e230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00543319,
 -0.000440959],_lastvalidtt=[-0.00543319,-0.000440959],_upttcommand=[0,0],
 _refmes=0x7fad19822030,_tiprefv=0x7fad1a111230,_tiltrefv=0x7fad1a104230,
 _tiprefvn=0x7fad1a158430,_tiltrefvn=0x7fad1a153a30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad192c7830,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108ff1030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192c7830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a804630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838500,_ctrlden=0x7fad1a838180,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e20920,_xlast=0x7fad18e20aa0,_ylast=[0x7fad1a0e6030,
 0x7fad1a0e6030,0x7fad1a0e6030],_y0=0x7fad1a100830,_signus=0x7fad18e20c20,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecd4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c4eba0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1903fa60,yposition=
 0x7fad1903fb08,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.7   0.786       54.6
Field Avg  1.25                     40.7   0.786       54.6
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a8489b0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192a2430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00243157,
 -0.00345087],_lastvalidtt=[-0.00243157,-0.00345087],_upttcommand=[0,0],_refmes=
 0x7fad1a0ff230,_tiprefv=0x7fad192b3630,_tiltrefv=0x7fad192ccc30,_tiprefvn=
 0x7fad192a0230,_tiltrefvn=0x7fad192a1230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad192ab030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192ab030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19227630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837c38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fd38,_ctrlden=0x7fad1a837688,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0eb90,_xlast=0x7fad18c0cf50,_ylast=[0x7fad192cf630,
 0x7fad192cf630,0x7fad192cf630],_y0=0x7fad19234830,_signus=0x7fad18c4ff10,
 _puppixoffset=[0,0],_nact=80,_def=0x10d5db030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c4e320,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1903fda8,yposition=
 0x7fad1a838570,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.7,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       41.1   0.786       51.2
Field Avg  1.25                     41.1   0.786       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a8496d8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a104c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.0136716,
 -0.00042424],_lastvalidtt=[0.0136716,-0.00042424],_upttcommand=[0,0],_refmes=
 0x7fad1a15f630,_tiprefv=0x7fad192ac230,_tiltrefv=0x7fad1a111230,_tiprefvn=
 0x7fad192b3630,_tiltrefvn=0x7fad1a112230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad192a7830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d84030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192a7830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a116c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8373b0,_ctrlden=0x7fad1a8383b0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1d570,_xlast=0x7fad18e18170,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a0e6030,_signus=0x7fad18e17b30,
 _puppixoffset=[0,0],_nact=80,_def=0x10bae1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0eaa0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1903fd00,yposition=
 0x7fad1a8376f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.844       51.2
Field Avg  1.25                     40.2   0.844       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848570)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192c2e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.0110649,
 -0.00120993],_lastvalidtt=[0.0110649,-0.00120993],_upttcommand=[0,0],_refmes=
 0x7fad192ccc30,_tiprefv=0x7fad1929d230,_tiltrefv=0x7fad1a0fc830,_tiprefvn=
 0x7fad192ac230,_tiltrefvn=0x7fad1a111230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad192c7830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192c7830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a145430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837c38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fc20,_ctrlden=0x7fad1a838688,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c4e660,_xlast=0x7fad18c4efe0,_ylast=[0x7fad192cf630,
 0x7fad192cf630,0x7fad192cf630],_y0=0x7fad192a4030,_signus=0x7fad18c4f160,
 _puppixoffset=[0,0],_nact=80,_def=0x10e1dd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d04b20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1903fec0,yposition=
 0x7fad1903fbb0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.855       51.2
Field Avg  1.25                     40.3   0.855       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848790)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a0a8e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.0100684,
 -0.000950492],_lastvalidtt=[0.0100684,-0.000950492],_upttcommand=[0,0],_refmes=
 0x7fad1917c230,_tiprefv=0x7fad1a12c030,_tiltrefv=0x7fad1a0fd830,_tiprefvn=
 0x7fad1a0ff230,_tiltrefvn=0x7fad1a0fc830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a154630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108ff1030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a154630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a100230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837928,_ctrlden=0x7fad1a838500,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5f970,_xlast=0x7fad18c4e560,_ylast=[0x7fad192a4030,
 0x7fad192a4030,0x7fad192a4030],_y0=0x7fad19229e30,_signus=0x7fad18c4f420,
 _puppixoffset=[0,0],_nact=80,_def=0x10bae1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c4f120,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1903f980,yposition=
 0x7fad1a8199c8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.850       51.2
Field Avg  1.25                     40.3   0.850       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849078)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a114630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.00952258,
 -0.000194758],_lastvalidtt=[0.00952258,-0.000194758],_upttcommand=[0,0],
 _refmes=0x7fad1a126e30,_tiprefv=0x7fad1a102830,_tiltrefv=0x7fad1a104230,
 _tiprefvn=0x7fad1a12c030,_tiltrefvn=0x7fad1a0fd830,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1929f830,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1929f830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1917c230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837c38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837d50,_ctrlden=0x7fad1903fa98,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cbd0,_xlast=0x7fad18c5f930,_ylast=[0x7fad19229e30,
 0x7fad19229e30,0x7fad19229e30],_y0=0x7fad192cf630,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d5db030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d05d60,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1a838068,yposition=
 0x7fad1a837960,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.55,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.5   0.840       51.2
Field Avg  1.25                     40.5   0.840       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848ee0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a12ac30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.00831597,
 0.00166611],_lastvalidtt=[0.00831597,0.00166611],_upttcommand=[0,0],_refmes=
 0x7fad1929de30,_tiprefv=0x7fad1a14d630,_tiltrefv=0x7fad1929c230,_tiprefvn=
 0x7fad1a102830,_tiltrefvn=0x7fad192bd830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad192b9630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d84030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192b9630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19233e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903f9b8,_ctrlden=0x7fad1a837928,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cf50,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad192cf630,
 0x7fad192cf630,0x7fad192cf630],_y0=0x7fad19234830,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecd4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5f880,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1a8370a0,yposition=
 0x7fad1a8370d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.5   0.790       51.2
Field Avg  1.25                     40.5   0.790       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848cc0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a147c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.00551206,
 0.00244815],_lastvalidtt=[0.00551206,0.00244815],_upttcommand=[0,0],_refmes=
 0x7fad1a0ff230,_tiprefv=0x7fad1a0fc830,_tiltrefv=0x7fad1a104230,_tiprefvn=
 0x7fad1a14d630,_tiltrefvn=0x7fad1a0fd830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad192a0030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192a0030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a13da30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837c38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fad0,_ctrlden=0x7fad1a837260,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1e120,_xlast=0x7fad18e1a3c0,_ylast=[0x7fad1a0e6030,
 0x7fad1a0e6030,0x7fad1a0e6030],_y0=0x7fad1a109e30,_signus=0x7fad18e216e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d5db030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f09d10,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1a837c00,yposition=
 0x7fad1a838768,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.7,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       42.0   0.685       64.8
Field Avg  1.25                     42.0   0.685       64.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849210)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19829a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[0.00734224,
 -0.00314095],_lastvalidtt=[0.00734224,-0.00314095],_upttcommand=[0,0],_refmes=
 0x7fad192b3230,_tiprefv=0x7fad1a859030,_tiltrefv=0x7fad1a124c30,_tiprefvn=
 0x7fad1a89aa30,_tiltrefvn=0x7fad1a104230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1929de30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108ff1030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1929de30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad192a2030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838490,_ctrlden=0x7fad1903fa28,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cbd0,_xlast=0x7fad18c4eda0,_ylast=[0x7fad192b4230,
 0x7fad192b4230,0x7fad192b4230],_y0=0x7fad192a4030,_signus=0x7fad18c4f960,
 _puppixoffset=[0,0],_nact=80,_def=0x10bae1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f08e70,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1a838180,yposition=
 0x7fad1903f868,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       41.2   0.791       51.2
Field Avg  1.25                     41.2   0.791       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848818)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192a9830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[0.00534991,
 -0.00276707],_lastvalidtt=[0.00534991,-0.00276707],_upttcommand=[0,0],_refmes=
 0x7fad1a1c0030,_tiprefv=0x7fad192b2430,_tiltrefv=0x7fad1917c230,_tiprefvn=
 0x7fad1929de30,_tiltrefvn=0x7fad192a0e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1985c230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1985c230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad192a3430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837c38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837bc8,_ctrlden=0x7fad1a837730,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0eb00,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad192a4030,
 0x7fad192a4030,0x7fad192a4030],_y0=0x7fad1929d230,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10e1dd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1a3c0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1a837688,yposition=
 0x7fad1a074240,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.5   0.829       51.2
Field Avg  1.25                     40.5   0.829       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849ed0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192ac230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[0.00305553,
 1.07165e-06],_lastvalidtt=[0.00305553,1.07165e-06],_upttcommand=[0,0],_refmes=
 0x7fad1a101c30,_tiprefv=0x7fad1a1c1a30,_tiltrefv=0x7fad1a104230,_tiprefvn=
 0x7fad1a11a030,_tiltrefvn=0x7fad1a11ca30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a1dae30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d84030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a1dae30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a82fc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837d88,_ctrlden=0x7fad1a837490,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1d510,_xlast=0x7fad18e18170,_ylast=[0x7fad1a0e6030,
 0x7fad1a0e6030,0x7fad1a0e6030],_y0=0x7fad1a109e30,_signus=0x7fad18e1de10,
 _puppixoffset=[0,0],_nact=80,_def=0x10bae1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d04b20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1a8383b0,yposition=
 0x7fad1a074278,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.832       51.2
Field Avg  1.25                     40.3   0.832       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a8497e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a8d5830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[0.00110449,
 -0.000665781],_lastvalidtt=[0.00110449,-0.000665781],_upttcommand=[0,0],
 _refmes=0x7fad1929de30,_tiprefv=0x7fad1a101c30,_tiltrefv=0x7fad1a119030,
 _tiprefvn=0x7fad1a1c1a30,_tiltrefvn=0x7fad1a104230,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1a131230,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a131230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a82fc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837c38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8383b0,_ctrlden=0x7fad1903fec0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1a3c0,_xlast=0x7fad18e231f0,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a13e030,_signus=0x7fad18e23500,
 _puppixoffset=[0,0],_nact=80,_def=0x10d5db030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f09d10,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1a838688,yposition=
 0x7fad19040048,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.55,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.826       51.2
Field Avg  1.25                     40.3   0.826       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a8498f8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192b1030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[0.00115083,
 -0.00501584],_lastvalidtt=[0.00115083,-0.00501584],_upttcommand=[0,0],_refmes=
 0x7fad1a0fd830,_tiprefv=0x7fad192a7830,_tiltrefv=0x7fad1a0fc830,_tiprefvn=
 0x7fad192ab830,_tiltrefvn=0x7fad1a119030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a29c230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108ff1030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a29c230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad192a6c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a01a288,_ctrlden=0x7fad19040010,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0c650,_xlast=0x7fad18c0cf50,_ylast=[0x7fad1917ce30,
 0x7fad1917ce30,0x7fad1917ce30],_y0=0x7fad192b4230,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecd4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1a3c0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1a838500,yposition=
 0x7fad1a838420,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.7   0.786       54.6
Field Avg  1.25                     40.7   0.786       54.6
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849760)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1903fb40,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1929ce30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=
 [-0.000547021,-0.00419619],_lastvalidtt=[-0.000547021,-0.00419619],
 _upttcommand=[0,0],_refmes=0x7fad1a136630,_tiprefv=0x7fad192b3030,_tiltrefv=
 0x7fad192a3430,_tiprefvn=0x7fad192a7830,_tiltrefvn=0x7fad1929de30,_reordervec=
 0x0,_npixels=0,_npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,
 _binindices=0x0,_binxy=0,_centroidw=0x0,_fimage=0x7fad192c9a30,_fimage2=0x0,
 _imistart=0x0,_imjstart=0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,
 _unittilt=0x0,_lgs_defocuses=0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=
 0x0,_yoffset=0x0,_bias=0x0,_flat=0x0,_domask=0,_submask=0x109236030,_kernel=
 0x0,_kernels=0x0,_kerfftr=0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fad192c9a30,_x=0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,
 _bckgrdcalib=0x7fad1a145430,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a837c38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fb08,_ctrlden=0x7fad1903fd00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e20f70,_xlast=0x7fad18e1d510,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a29f630,_signus=0x7fad18e218f0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d5db030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e18170,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838458,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad19040080,xposition=0x7fad1903fa98,yposition=
 0x7fad1a8381f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.7,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       41.2   0.773       54.6
Field Avg  1.25                     41.2   0.773       54.6
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8480a8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a861c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00762049,
 0.00217761],_lastvalidtt=[-0.00762049,0.00217761],_upttcommand=[0,0],_refmes=
 0x7fad1a0fc830,_tiprefv=0x7fad19820a30,_tiltrefv=0x7fad1a101c30,_tiprefvn=
 0x7fad19821a30,_tiltrefvn=0x7fad1a11da30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad192c2630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d84030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192c2630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a830230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837928)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837340,_ctrlden=0x7fad1903fd38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18f0b160,_xlast=0x7fad18f0bde0,_ylast=[0x7fad1a831430,
 0x7fad1a831430,0x7fad1a831430],_y0=0x7fad1a832830,_signus=0x7fad18f0bf60,
 _puppixoffset=[0,0],_nact=80,_def=0x10bae1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0c650,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a837ce0,yposition=
 0x7fad1a8380d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.853       51.2
Field Avg  1.25                     40.2   0.853       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848dd0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192a6c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.0061918,
 0.00134188],_lastvalidtt=[-0.0061918,0.00134188],_upttcommand=[0,0],_refmes=
 0x7fad192cb230,_tiprefv=0x7fad192cc230,_tiltrefv=0x7fad1a104230,_tiprefvn=
 0x7fad192b2830,_tiltrefvn=0x7fad1a101c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad19859430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad19859430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a108430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fc58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837848,_ctrlden=0x7fad1a8375e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18d079e0,_xlast=0x7fad18d082c0,_ylast=[0x7fad19840c30,
 0x7fad19840c30,0x7fad19840c30],_y0=0x7fad19810430,_signus=0x7fad18d088f0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e1dd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a837260,yposition=
 0x7fad1903fe50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.871       47.8
Field Avg  1.25                     40.2   0.871       47.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848818)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a11f230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00473865,
 0.00107557],_lastvalidtt=[-0.00473865,0.00107557],_upttcommand=[0,0],_refmes=
 0x7fad1a870e30,_tiprefv=0x7fad1a86a630,_tiltrefv=0x7fad1a11d030,_tiprefvn=
 0x7fad1a82c830,_tiltrefvn=0x7fad1a104230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad192c0430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108ff1030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192c0430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a13da30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837928)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837d88,_ctrlden=0x7fad1a8380d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18d095a0,_xlast=0x7fad18d09720,_ylast=[0x7fad19810430,
 0x7fad19810430,0x7fad19810430],_y0=0x7fad19824830,_signus=0x7fad18d06760,
 _puppixoffset=[0,0],_nact=80,_def=0x10bae1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0cbd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1903fa28,yposition=
 0x7fad1a01a288,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.868       47.8
Field Avg  1.25                     40.2   0.868       47.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849e48)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a1a0c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00343106,
 0.00194757],_lastvalidtt=[-0.00343106,0.00194757],_upttcommand=[0,0],_refmes=
 0x7fad1a0fd830,_tiprefv=0x7fad192be230,_tiltrefv=0x7fad1a19fa30,_tiprefvn=
 0x7fad192bf230,_tiltrefvn=0x7fad1a11d030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad192ba230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192ba230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19194030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fc58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fad0,_ctrlden=0x7fad1a837bc8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1de10,_xlast=0x7fad18e22e20,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a0e6030,_signus=0x7fad18e1a3c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d5db030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e238f0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a837730,yposition=
 0x7fad1a838570,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.859       51.2
Field Avg  1.25                     40.3   0.859       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849188)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19193830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.0022264,
 -0.00175682],_lastvalidtt=[-0.0022264,-0.00175682],_upttcommand=[0,0],_refmes=
 0x7fad1929c230,_tiprefv=0x7fad192cb030,_tiltrefv=0x7fad192b0830,_tiprefvn=
 0x7fad192be230,_tiltrefvn=0x7fad192c7430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad192b9c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d84030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192b9c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a108430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837928)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837730,_ctrlden=0x7fad1903fbb0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e20920,_xlast=0x7fad18e1de10,_ylast=[0x7fad1a0e6030,
 0x7fad1a0e6030,0x7fad1a0e6030],_y0=0x7fad1a112630,_signus=0x7fad18e24640,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecd4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0bdc0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a837490,yposition=
 0x7fad1a837b90,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.55,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.846       51.2
Field Avg  1.25                     40.3   0.846       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849430)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a11f230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00200161,
 -0.000623058],_lastvalidtt=[-0.00200161,-0.000623058],_upttcommand=[0,0],
 _refmes=0x7fad1a0ff230,_tiprefv=0x7fad1a143630,_tiltrefv=0x7fad1a11e030,
 _tiprefvn=0x7fad1a144630,_tiltrefvn=0x7fad1a131230,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad19827830,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad19827830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a13da30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fc58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8376f8,_ctrlden=0x7fad1a01a288,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c527c0,_xlast=0x7fad18c51570,_ylast=[0x7fad192b4230,
 0x7fad192b4230,0x7fad192b4230],_y0=0x7fad1924f030,_signus=0x7fad18c51af0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d5db030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0e7d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1903fec0,yposition=
 0x7fad1a837148,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.5   0.785       54.6
Field Avg  1.25                     40.5   0.785       54.6
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8495c8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192b9a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00665418,
 -0.000280071],_lastvalidtt=[-0.00665418,-0.000280071],_upttcommand=[0,0],
 _refmes=0x7fad1a128430,_tiprefv=0x7fad1a104230,_tiltrefv=0x7fad1a11d030,
 _tiprefvn=0x7fad1a143630,_tiltrefvn=0x7fad1a11e030,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad192aee30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108ff1030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192aee30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad192bb230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837928)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838688,_ctrlden=0x7fad1a838340,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18d09270,_xlast=0x7fad18d093f0,_ylast=[0x7fad19857e30,
 0x7fad19857e30,0x7fad19857e30],_y0=0x7fad19810430,_signus=0x7fad18d09570,
 _puppixoffset=[0,0],_nact=80,_def=0x10bae1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0cbd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a838650,yposition=
 0x7fad1903fa60,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.7,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       43.3   0.619       71.7
Field Avg  1.25                     43.3   0.619       71.7
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848ee0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a873430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.0151763,
 -0.00113112],_lastvalidtt=[0.0151763,-0.00113112],_upttcommand=[0,0],_refmes=
 0x7fad1a870830,_tiprefv=0x7fad192cc030,_tiltrefv=0x7fad1985e430,_tiprefvn=
 0x7fad1929c230,_tiltrefvn=0x7fad1985f430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a85f630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a85f630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a82d830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fc58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837ab0,_ctrlden=0x7fad1a838228,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e20920,_xlast=0x7fad18e22ff0,_ylast=[0x7fad1a117230,
 0x7fad1a117230,0x7fad1a117230],_y0=0x7fad1a103630,_signus=0x7fad18e1f050,
 _puppixoffset=[0,0],_nact=80,_def=0x10e1dd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0e7d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad19040080,yposition=
 0x7fad1a838570,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       41.1   0.786       51.2
Field Avg  1.25                     41.1   0.786       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848790)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a114630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.0136477,
 -0.000260895],_lastvalidtt=[0.0136477,-0.000260895],_upttcommand=[0,0],_refmes=
 0x7fad1a0fc830,_tiprefv=0x7fad1a0fd830,_tiltrefv=0x7fad192b3230,_tiprefvn=
 0x7fad1a0ff230,_tiltrefvn=0x7fad192c0630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a119030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d84030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a119030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a82d230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837928)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903f9b8,_ctrlden=0x7fad1a074240,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e22120,_xlast=0x7fad18e20920,_ylast=[0x7fad1a103630,
 0x7fad1a103630,0x7fad1a103630],_y0=0x7fad1a109e30,_signus=0x7fad18e23ba0,
 _puppixoffset=[0,0],_nact=80,_def=0x10bae1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0bdc0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1903fd38,yposition=
 0x7fad19035830,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.844       51.2
Field Avg  1.25                     40.2   0.844       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849c28)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a143630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.011031,
 -0.0011538],_lastvalidtt=[0.011031,-0.0011538],_upttcommand=[0,0],_refmes=
 0x7fad1a870c30,_tiprefv=0x7fad192a3430,_tiltrefv=0x7fad192a0630,_tiprefvn=
 0x7fad192aee30,_tiltrefvn=0x7fad192b3230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad192a6c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192a6c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a108430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fc58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838570,_ctrlden=0x7fad1a8370a0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1e120,_xlast=0x7fad18e1a3c0,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a11c430,_signus=0x7fad18e17b30,
 _puppixoffset=[0,0],_nact=80,_def=0x10d5db030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e23a70,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a8375e0,yposition=
 0x7fad1903fcc8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.854       51.2
Field Avg  1.25                     40.3   0.854       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8489b0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a103230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.00944357,
 -0.00157299],_lastvalidtt=[0.00944357,-0.00157299],_upttcommand=[0,0],_refmes=
 0x7fad1a0fc830,_tiprefv=0x7fad192cc230,_tiltrefv=0x7fad192b8230,_tiprefvn=
 0x7fad192a3430,_tiltrefvn=0x7fad192a0630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad19897430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108ff1030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad19897430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1981e230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837928)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fad0,_ctrlden=0x7fad1a819920,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0e7d0,_xlast=0x7fad18c0bdc0,_ylast=[0x7fad192cf630,
 0x7fad192cf630,0x7fad192cf630],_y0=0x7fad19226a30,_signus=0x7fad18c0cf50,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecd4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f0b470,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a8380d8,yposition=
 0x7fad1a837500,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.850       51.2
Field Avg  1.25                     40.3   0.850       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849cb0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192b7030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.0103217,
 0.00021349],_lastvalidtt=[0.0103217,0.00021349],_upttcommand=[0,0],_refmes=
 0x7fad1a120230,_tiprefv=0x7fad1929c230,_tiltrefv=0x7fad1a150030,_tiprefvn=
 0x7fad192cc230,_tiltrefvn=0x7fad1a14bc30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a864630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a864630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a104a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fc58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837d88,_ctrlden=0x7fad1a838730,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5ede0,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad19226a30,
 0x7fad19226a30,0x7fad19226a30],_y0=0x7fad19195030,_signus=0x7fad18c4f580,
 _puppixoffset=[0,0],_nact=80,_def=0x10d5db030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e24040,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a837bc8,yposition=
 0x7fad1a837378,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.55,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.5   0.840       51.2
Field Avg  1.25                     40.5   0.840       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849100)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a82d430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.0071221,
 0.00146584],_lastvalidtt=[0.0071221,0.00146584],_upttcommand=[0,0],_refmes=
 0x7fad1a147c30,_tiprefv=0x7fad192a3430,_tiltrefv=0x7fad1a864430,_tiprefvn=
 0x7fad1929c230,_tiltrefvn=0x7fad1a86c830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a131230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d84030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a131230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1929ae30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837928)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8383b0,_ctrlden=0x7fad1a837df8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e22b50,_xlast=0x7fad18e22cd0,_ylast=[0x7fad1a112630,
 0x7fad1a112630,0x7fad1a112630],_y0=0x7fad1a109e30,_signus=0x7fad18e22e50,
 _puppixoffset=[0,0],_nact=80,_def=0x10bae1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1903fbb0,yposition=
 0x7fad1903fe50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.5   0.789       51.2
Field Avg  1.25                     40.5   0.789       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849650)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192b3030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.94374e+06,_skynphotons=152.807,_tt=[0.00500907,
 -0.000787894],_lastvalidtt=[0.00500907,-0.000787894],_upttcommand=[0,0],
 _refmes=0x7fad192bea30,_tiprefv=0x7fad192bda30,_tiltrefv=0x7fad191ad430,
 _tiprefvn=0x7fad192a3430,_tiltrefvn=0x7fad1929c230,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad19855830,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad19855830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a104a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fc58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a074278,_ctrlden=0x7fad1903fcc8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e17d80,_xlast=0x7fad18e22b50,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a0fe630,_signus=0x7fad18e1a3c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e1dd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0cbd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a01a288,yposition=
 0x7fad1a837538,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.7,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       44.7   0.497       92.1
Field Avg  1.25                     44.7   0.497       92.1
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848d48)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192bfa30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[0.00727927,
 -0.00607727],_lastvalidtt=[0.00727927,-0.00607727],_upttcommand=[0,0],_refmes=
 0x7fad19856630,_tiprefv=0x7fad192bea30,_tiltrefv=0x7fad1a0fc830,_tiprefvn=
 0x7fad192bda30,_tiltrefvn=0x7fad1a143630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad192b4e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108ff1030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad192b4e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a82c830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837928)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8385a8,_ctrlden=0x7fad1a8376c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0bdc0,_xlast=0x7fad18c0eaa0,_ylast=[0x7fad192cbe30,
 0x7fad192cbe30,0x7fad192cbe30],_y0=0x7fad192cae30,_signus=0x7fad18c0cf50,
 _puppixoffset=[0,0],_nact=80,_def=0x10bae1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f0b560,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a838340,yposition=
 0x7fad1a8377d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       42.0   0.685       64.8
Field Avg  1.25                     42.0   0.685       64.8
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849540)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad19889e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[0.00734284,
 -0.00316798],_lastvalidtt=[0.00734284,-0.00316798],_upttcommand=[0,0],_refmes=
 0x7fad1a11ea30,_tiprefv=0x7fad1929c230,_tiltrefv=0x7fad192b2830,_tiprefvn=
 0x7fad192bea30,_tiltrefvn=0x7fad19236430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad191c9c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad191c9c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1988e830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fc58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fa28,_ctrlden=0x7fad1903fda8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0e7d0,_xlast=0x7fad18c0bdc0,_ylast=[0x7fad192cae30,
 0x7fad192cae30,0x7fad192cae30],_y0=0x7fad19194830,_signus=0x7fad18c50ff0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d5db030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a838228,yposition=
 0x7fad1a837d88,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       41.1   0.791       51.2
Field Avg  1.25                     41.1   0.791       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848ff0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1989de30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[0.00514796,
 -0.00264945],_lastvalidtt=[0.00514796,-0.00264945],_upttcommand=[0,0],_refmes=
 0x7fad1a11e830,_tiprefv=0x7fad1a0fd830,_tiltrefv=0x7fad192b0630,_tiprefvn=
 0x7fad1a102430,_tiltrefvn=0x7fad192b2830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a29d830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d84030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a29d830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19233e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837928)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838228,_ctrlden=0x7fad1a837960,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cf50,_xlast=0x7fad18c0e7d0,_ylast=[0x7fad19194830,
 0x7fad19194830,0x7fad19194830],_y0=0x7fad19234830,_signus=0x7fad18c4e320,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecd4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f0c670,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a074240,yposition=
 0x7fad1a837730,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.5   0.829       51.2
Field Avg  1.25                     40.5   0.829       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849320)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192cba30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[0.00308423,
 0.000315458],_lastvalidtt=[0.00308423,0.000315458],_upttcommand=[0,0],_refmes=
 0x7fad1a143630,_tiprefv=0x7fad1a87c230,_tiltrefv=0x7fad1a144630,_tiprefvn=
 0x7fad1a859030,_tiltrefvn=0x7fad1a1dae30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a8f1430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a8f1430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19233e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fc58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a074240,_ctrlden=0x7fad1a838768,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1e8d0,_xlast=0x7fad18e1bf00,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a139c30,_signus=0x7fad18e1d510,
 _puppixoffset=[0,0],_nact=80,_def=0x10d5db030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d04b20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a8370a0,yposition=
 0x7fad1a838340,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.832       51.2
Field Avg  1.25                     40.3   0.832       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849210)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad1a82ce30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[0.00183667,
 -0.000537034],_lastvalidtt=[0.00183667,-0.000537034],_upttcommand=[0,0],
 _refmes=0x7fad192c6e30,_tiprefv=0x7fad1a86c830,_tiltrefv=0x7fad19834430,
 _tiprefvn=0x7fad1a87c230,_tiltrefvn=0x7fad19839030,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fad1a122430,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108ff1030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a122430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad19233e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837928)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a074278,_ctrlden=0x7fad1a837538,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18f0ba00,_xlast=0x7fad18f0cb90,_ylast=[0x7fad1a831430,
 0x7fad1a831430,0x7fad1a831430],_y0=0x7fad1a809630,_signus=0x7fad18f0cd10,
 _puppixoffset=[0,0],_nact=80,_def=0x10bae1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a819920,yposition=
 0x7fad1a8376f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.55,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.860       51.2
Field Avg  1.25                     40.3   0.860       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a34c8,layerfrac=0x7fce2b0a3440,
 layerspeed=0x7fce2b0a3550,layeralt=0x7fce2b0a33b8,winddir=0x7fce2b0a3330,
 _layeralt=0x7fce2b0a4fc0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=1,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b38b0,lgs_prof_alt=0x7fce2b0b3ae0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2b896e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29584e+08,_skynphotons=101.871,_tt=[-0.00701614,
 0.00200524],_lastvalidtt=[-0.00701614,0.00200524],_upttcommand=[0,0],_refmes=
 0x7fce2a0d2e30,_tiprefv=0x7fce2a0fae30,_tiltrefv=0x7fce2a8ebe30,_tiprefvn=
 0x7fce2a0fbe30,_tiltrefvn=0x7fce2a933230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0d9830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108940030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0d9830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0d5c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4ed8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4920,_ctrlden=0x7fce2a034d00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29e10bd0,_xlast=0x7fce29e11930,_ylast=[0x7fce2b079030,
 0x7fce2b079030,0x7fce2b079030],_y0=0x7fce2b068e30,_signus=0x7fce29e168a0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c43c00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4bf8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b48e8,xposition=0x7fce2b0b3878,yposition=
 0x7fce2b0b4e68,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b3bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.55,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.828       51.2
Field Avg  1.25                     40.3   0.828       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848928)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192b1030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[0.00243906,
 0.0014404],_lastvalidtt=[0.00243906,0.0014404],_upttcommand=[0,0],_refmes=
 0x7fad1929c230,_tiprefv=0x7fad1a0fc830,_tiltrefv=0x7fad192cae30,_tiprefvn=
 0x7fad1a0fd830,_tiltrefvn=0x7fad192a6c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a871030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x109236030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a871030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad192ae430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1903fc58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8199c8,_ctrlden=0x7fad1a837e30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0d090,_xlast=0x7fad18c0be20,_ylast=[0x7fad1929d230,
 0x7fad1929d230,0x7fad1929d230],_y0=0x7fad192cbe30,_signus=0x7fad18c4e320,
 _puppixoffset=[0,0],_nact=80,_def=0x10e1dd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e18170,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a838730,yposition=
 0x7fad1a838618,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.860       51.2
Field Avg  1.25                     40.3   0.860       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a34c8,layerfrac=0x7fce2b0a3440,
 layerspeed=0x7fce2b0a3550,layeralt=0x7fce2b0a33b8,winddir=0x7fce2b0a3330,
 _layeralt=0x7fce2b0a4960)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b38b0,lgs_prof_alt=0x7fce2b0b3ae0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0ed630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00391219,
 0.00123001],_lastvalidtt=[-0.00391219,0.00123001],_upttcommand=[0,0],_refmes=
 0x7fce2a164e30,_tiprefv=0x7fce2a0d2c30,_tiltrefv=0x7fce2a0da830,_tiprefvn=
 0x7fce2a0fae30,_tiltrefvn=0x7fce2a165e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2b0ed230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10d6e5030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2b0ed230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a8cb230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034ad0,_ctrlden=0x7fce2b0b3c30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d24a10,_xlast=0x7fce29d27c60,_ylast=[0x7fce2a8c4430,
 0x7fce2a8c4430,0x7fce2a8c4430],_y0=0x7fce2a956c30,_signus=0x7fce29d28540,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c0bd60,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4bf8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b48e8,xposition=0x7fce2b0b43a8,yposition=
 0x7fce2a034de0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b3bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.55,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.858       51.2
Field Avg  1.25                     40.3   0.858       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a34c8,layerfrac=0x7fce2b0a3440,
 layerspeed=0x7fce2b0a3550,layeralt=0x7fce2b0a33b8,winddir=0x7fce2b0a3330,
 _layeralt=0x7fce2b0a51e0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b38b0,lgs_prof_alt=0x7fce2b0b3ae0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a951e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=81760.9,_skynphotons=101.871,_tt=[-0.00443509,
 0.00271208],_lastvalidtt=[-0.00443509,0.00271208],_upttcommand=[0,0],_refmes=
 0x7fce2a9dc230,_tiprefv=0x7fce2a950830,_tiltrefv=0x7fce2a9d5630,_tiprefvn=
 0x7fce2a938830,_tiltrefvn=0x7fce2a9e5a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2aa93230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10d6a4030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2aa93230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a8ec630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4ed8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b46f0,_ctrlden=0x7fce2a034a28,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d27540,_xlast=0x7fce29d24a10,_ylast=[0x7fce2a956c30,
 0x7fce2a956c30,0x7fce2a956c30],_y0=0x7fce2a8e3a30,_signus=0x7fce29d27e30,
 _puppixoffset=[0,0],_nact=80,_def=0x10b9c2030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29e10bd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4bf8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b48e8,xposition=0x7fce2b0b4b18,yposition=
 0x7fce2b0b3ff0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b3bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.55,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.9   0.787       51.2
Field Avg  1.25                     40.9   0.787       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8485f8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838538,lgs_prof_alt=0x7fad19040010,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fad192b8a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=2.59166e+06,_skynphotons=203.743,_tt=[0.00149964,
 0.00305871],_lastvalidtt=[0.00149964,0.00305871],_upttcommand=[0,0],_refmes=
 0x7fad192b4e30,_tiprefv=0x7fad1a881a30,_tiltrefv=0x7fad1981f430,_tiprefvn=
 0x7fad1a86fa30,_tiltrefvn=0x7fad19860630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fad1a161230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108d84030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fad1a161230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fad1a82e030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fad1a837928)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fe18,_ctrlden=0x7fad1a8383b0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18f0c1c0,_xlast=0x7fad18f0c340,_ylast=[0x7fad1a809630,
 0x7fad1a809630,0x7fad1a809630],_y0=0x7fad1a831430,_signus=0x7fad18f0c4c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10bae1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c4b590,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8381f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd00,xposition=0x7fad1a837df8,yposition=
 0x7fad1a837bc8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838458,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.7,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.3   0.856       51.2
Field Avg  1.25                     40.3   0.856       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a34c8,layerfrac=0x7fce2b0a3440,
 layerspeed=0x7fce2b0a3550,layeralt=0x7fce2b0a33b8,winddir=0x7fce2b0a3330,
 _layeralt=0x7fce2b0a4c08)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=10,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.02,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b38b0,lgs_prof_alt=0x7fce2b0b3ae0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a9d6630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=32549.5,_skynphotons=101.871,_tt=[-0.00108345,
 -0.000410104],_lastvalidtt=[-0.00108345,-0.000410104],_upttcommand=[0,0],
 _refmes=0x7fce2a8eba30,_tiprefv=0x7fce2a8e2630,_tiltrefv=0x7fce2a0f9630,
 _tiprefvn=0x7fce2a950830,_tiltrefvn=0x7fce2a0ea630,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fce2a9d7630,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x10d6e5030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a9d7630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2b804a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b45d8,_ctrlden=0x7fce2b0b4958,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c0bd60,_xlast=0x7fce29c42e20,_ylast=[0x7fce2a0b9c30,
 0x7fce2a0b9c30,0x7fce2a0b9c30],_y0=0x7fce2a062030,_signus=0x7fce29c0c0e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e51a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d24440,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4bf8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b48e8,xposition=0x7fce2a0349f0,yposition=
 0x7fce2b0b4300,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b3bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.55,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       46.0   0.454       99.0
Field Avg  1.25                     46.0   0.454       99.0
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a34c8,layerfrac=0x7fce2b0a3440,
 layerspeed=0x7fce2b0a3550,layeralt=0x7fce2b0a33b8,winddir=0x7fce2b0a3330,
 _layeralt=0x7fce2b0a3bb0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=14,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.02,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b38b0,lgs_prof_alt=0x7fce2b0b3ae0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a8e3630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1635.21,_skynphotons=203.743,_tt=[-0.000522864,
 -0.010171],_lastvalidtt=[-0.000522864,-0.010171],_upttcommand=[0,0],_refmes=
 0x7fce2a0e8830,_tiprefv=0x7fce2a0eb630,_tiltrefv=0x7fce2a159e30,_tiprefvn=
 0x7fce2a0ec630,_tiltrefvn=0x7fce2a0f9630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a9db430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10860e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a9db430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2b083e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4ed8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4760,_ctrlden=0x7fce2b0b3f80,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d29cb0,_xlast=0x7fce29d29e30,_ylast=[0x7fce2a956c30,
 0x7fce2a956c30,0x7fce2a956c30],_y0=0x7fce2a8c4430,_signus=0x7fce29d264b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10fc13030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d24a10,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4bf8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b48e8,xposition=0x7fce2a034bb0,yposition=
 0x7fce2b0b4ea0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b3bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       66.2   0.166      167.2
Field Avg  1.25                     66.2   0.166      167.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a34c8,layerfrac=0x7fce2b0a3440,
 layerspeed=0x7fce2b0a3550,layeralt=0x7fce2b0a33b8,winddir=0x7fce2b0a3330,
 _layeralt=0x7fce2b0a4c90)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=15,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.02,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b38b0,lgs_prof_alt=0x7fce2b0b3ae0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a8e2e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=650.986,_skynphotons=203.743,_tt=[0.00337865,
 -0.00758341],_lastvalidtt=[0.00337865,-0.00758341],_upttcommand=[0,0],_refmes=
 0x7fce2a0fd030,_tiprefv=0x7fce2a9d5630,_tiltrefv=0x7fce2a0eb030,_tiprefvn=
 0x7fce2a9da230,_tiltrefvn=0x7fce2a159e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a166c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10d6e5030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a166c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0e8630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b3878,_ctrlden=0x7fce2b0b4568,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29e10bd0,_xlast=0x7fce29e11930,_ylast=[0x7fce2b068e30,
 0x7fce2b068e30,0x7fce2b068e30],_y0=0x7fce2b0c8230,_signus=0x7fce29e168a0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29e16b60,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4bf8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b48e8,xposition=0x7fce2b0b3a00,yposition=
 0x7fce2b0b4798,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b3bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0      112.0   0.067      228.6
Field Avg  1.25                    112.0   0.067      228.6
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a34c8,layerfrac=0x7fce2b0a3440,
 layerspeed=0x7fce2b0a3550,layeralt=0x7fce2b0a33b8,winddir=0x7fce2b0a3330,
 _layeralt=0x7fce2b0a4168)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=16,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.02,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b38b0,lgs_prof_alt=0x7fce2b0b3ae0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0e9030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647.905,_skynphotons=509.357,_tt=[-0.00488529,
 0.00143328],_lastvalidtt=[-0.00488529,0.00143328],_upttcommand=[0,0],_refmes=
 0x7fce2a9db230,_tiprefv=0x7fce2a0e7a30,_tiltrefv=0x7fce2a0f6430,_tiprefvn=
 0x7fce2a0f2030,_tiltrefvn=0x7fce2a0eb030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a9dc230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a9dc230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2b804a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b3b88)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4370,_ctrlden=0x7fce2b0b4840,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29e16d00,_xlast=0x7fce29e10bd0,_ylast=[0x7fce2b0c8230,
 0x7fce2b0c8230,0x7fce2b0c8230],_y0=0x7fce2b0c0a30,_signus=0x7fce29e17040,
 _puppixoffset=[0,0],_nact=80,_def=0x10bdc3030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d2a460,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4bf8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b48e8,xposition=0x7fce2b0b4530,yposition=
 0x7fce2b0b48b0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b3bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 212 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a4300)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0d5630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=212,_nsub4disp=0,_nmes=
 424,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00511031,
 0.00149691],_lastvalidtt=[-0.00511031,0.00149691],_upttcommand=[0,0],_refmes=
 0x7fce2a0cf630,_tiprefv=0x7fce2a0d2030,_tiltrefv=0x7fce2a177230,_tiprefvn=
 0x7fce2a0d2e30,_tiltrefvn=0x7fce2a0d3c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0e6230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10d6e5030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0e6230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a036c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a090678,_ctrlden=0x7fce2b0b41e8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c42e20,_xlast=0x7fce29c0c980,_ylast=[0x7fce2a0b9c30,
 0x7fce2a0b9c30,0x7fce2a0b9c30],_y0=0x7fce2a062030,_signus=0x7fce29c388b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e51a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d28850,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b3b50,yposition=
 0x7fce2a019288,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 212 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.958       78.1
Field Avg  2.20                     70.7   0.958       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a5048)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0d1030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=212,_nsub4disp=0,_nmes=
 424,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00764273,
 0.00374509],_lastvalidtt=[-0.00764273,0.00374509],_upttcommand=[0,0],_refmes=
 0x7fce2a942030,_tiprefv=0x7fce2a9dd830,_tiltrefv=0x7fce2a9fa430,_tiprefvn=
 0x7fce2a93ea30,_tiltrefvn=0x7fce2a93f830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a9f3630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10860e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a9f3630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a8e2030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b38b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b3ae0,_ctrlden=0x7fce2b0b3b50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c3a110,_xlast=0x7fce29c42e20,_ylast=[0x7fce2a062030,
 0x7fce2a062030,0x7fce2a062030],_y0=0x7fce2a037a30,_signus=0x7fce29c3f1f0,
 _puppixoffset=[0,0],_nact=80,_def=0x10bdc3030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d24a10,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2a034d00,yposition=
 0x7fce2b0b3a00,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 212 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.958       78.1
Field Avg  2.20                     70.7   0.958       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a4960)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.5,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a162230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=212,_nsub4disp=0,_nmes=
 424,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00742054,
 0.00296093],_lastvalidtt=[-0.00742054,0.00296093],_upttcommand=[0,0],_refmes=
 0x7fce2a15cc30,_tiprefv=0x7fce2a162a30,_tiltrefv=0x7fce2a176c30,_tiprefvn=
 0x7fce2a175030,_tiltrefvn=0x7fce2a0cf830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2b047230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10d6e5030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2b047230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a15f630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b45d8,_ctrlden=0x7fce2a034d38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c0bd60,_xlast=0x7fce29c0c140,_ylast=[0x7fce2a037a30,
 0x7fce2a037a30,0x7fce2a037a30],_y0=0x7fce2a15aa30,_signus=0x7fce29c388b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d23250,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b3c30,yposition=
 0x7fce2a034b78,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 212 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.958       78.1
Field Avg  2.20                     70.7   0.958       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a3ec0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.6,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a951a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=212,_nsub4disp=0,_nmes=
 424,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00930136,
 0.00383352],_lastvalidtt=[-0.00930136,0.00383352],_upttcommand=[0,0],_refmes=
 0x7fce2a9e7230,_tiprefv=0x7fce2a96bc30,_tiltrefv=0x7fce2a0eb030,_tiprefvn=
 0x7fce2a93a430,_tiltrefvn=0x7fce2a176c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a173a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10860e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a173a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0fdc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b38b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034d00,_ctrlden=0x7fce2a01f830,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c43c00,_xlast=0x7fce29c0bd60,_ylast=[0x7fce2a15aa30,
 0x7fce2a15aa30,0x7fce2a15aa30],_y0=0x7fce2a0d6430,_signus=0x7fce29c0c0e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c3ccf0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2a034a28,yposition=
 0x7fce2b0b4098,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 212 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.958       78.1
Field Avg  2.20                     70.7   0.958       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a3bb0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.7,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a9e5c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=212,_nsub4disp=0,_nmes=
 424,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00874067,
 0.00472393],_lastvalidtt=[-0.00874067,0.00472393],_upttcommand=[0,0],_refmes=
 0x7fce2a9e4830,_tiprefv=0x7fce2a8e2030,_tiltrefv=0x7fce2b01f830,_tiprefvn=
 0x7fce2a96bc30,_tiltrefvn=0x7fce2b0ee630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0e6630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10d6e5030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0e6630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0ecc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a035080,_ctrlden=0x7fce2b0b3920,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c42e20,_xlast=0x7fce29c43c00,_ylast=[0x7fce2a0d6430,
 0x7fce2a0d6430,0x7fce2a0d6430],_y0=0x7fce2a062030,_signus=0x7fce29c388b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d231d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b4958,yposition=
 0x7fce2b0b4ae0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 212 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.958       78.1
Field Avg  2.20                     70.7   0.958       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a4f38)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.8,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0d0030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=212,_nsub4disp=0,_nmes=
 424,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00915399,
 0.00494909],_lastvalidtt=[-0.00915399,0.00494909],_upttcommand=[0,0],_refmes=
 0x7fce2a187630,_tiprefv=0x7fce2a0f2e30,_tiltrefv=0x7fce2a9e4830,_tiprefvn=
 0x7fce2a0d5230,_tiltrefvn=0x7fce2a94f030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0c7e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10860e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0c7e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a159e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b38b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034980,_ctrlden=0x7fce2b0b4c30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c0c980,_xlast=0x7fce29c42e20,_ylast=[0x7fce2a062030,
 0x7fce2a062030,0x7fce2a062030],_y0=0x7fce2a0d6030,_signus=0x7fce29c3c0c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10b5c1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c43c00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b4ed8,yposition=
 0x7fce2b0b4300,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a4eb0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a945430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00203789,
 8.22236e-05],_lastvalidtt=[-0.00203789,8.22236e-05],_upttcommand=[0,0],_refmes=
 0x7fce2a96ec30,_tiprefv=0x7fce2a93a030,_tiltrefv=0x7fce2a9d8430,_tiprefvn=
 0x7fce2a8e2030,_tiltrefvn=0x7fce2a9e4830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0d1430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10d6e5030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0d1430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0c5c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4b18,_ctrlden=0x7fce2b0b4e68,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c0b7e0,_xlast=0x7fce29c0c980,_ylast=[0x7fce2a0d6030,
 0x7fce2a0d6030,0x7fce2a0d6030],_y0=0x7fce2a04e230,_signus=0x7fce29c0c0e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e51a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29f04d50,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b4bc0,yposition=
 0x7fce2b0b3f10,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a3908)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a1be230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00733074,
 0.000885836],_lastvalidtt=[-0.00733074,0.000885836],_upttcommand=[0,0],_refmes=
 0x7fce2b0a9030,_tiprefv=0x7fce2a93ae30,_tiltrefv=0x7fce2a036c30,_tiprefvn=
 0x7fce2a93a030,_tiltrefvn=0x7fce2a0fd230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a243a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1093c6030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a243a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0c9c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b38b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4ed8,_ctrlden=0x7fce2a034a28,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d2a2c0,_xlast=0x7fce29d23180,_ylast=[0x7fce2a8c4430,
 0x7fce2a8c4430,0x7fce2a8c4430],_y0=0x7fce2a956c30,_signus=0x7fce29d26460,
 _puppixoffset=[0,0],_nact=80,_def=0x10b5c1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d24050,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b3ed8,yposition=
 0x7fce2b0b4958,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a3770)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.5,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0c5c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00374096,
 -0.000440938],_lastvalidtt=[-0.00374096,-0.000440938],_upttcommand=[0,0],
 _refmes=0x7fce2a9d6630,_tiprefv=0x7fce2a8e2e30,_tiltrefv=0x7fce2aa0a630,
 _tiprefvn=0x7fce2a93ae30,_tiltrefvn=0x7fce2a9e7c30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fce2a0fae30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x1084a2030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0fae30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0eb030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4b18,_ctrlden=0x7fce2a034980,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d29f20,_xlast=0x7fce29d2a2c0,_ylast=[0x7fce2a956c30,
 0x7fce2a956c30,0x7fce2a956c30],_y0=0x7fce2a88e830,_signus=0x7fce29d27f10,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d24440,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b41e8,yposition=
 0x7fce2b0b4ae0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a3e38)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.6,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a941830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00951915,
 0.000973794],_lastvalidtt=[-0.00951915,0.000973794],_upttcommand=[0,0],_refmes=
 0x7fce2a0c5c30,_tiprefv=0x7fce2a0e8c30,_tiltrefv=0x7fce2a159e30,_tiprefvn=
 0x7fce2a0c7830,_tiltrefvn=0x7fce2a036c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a938c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a938c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2b083e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b38b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4338,_ctrlden=0x7fce2b0b3958,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c0b430,_xlast=0x7fce29c42e20,_ylast=[0x7fce2a04e230,
 0x7fce2a04e230,0x7fce2a04e230],_y0=0x7fce2a037a30,_signus=0x7fce29c388b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d22450,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b3b50,yposition=
 0x7fce2a034ec0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a4e28)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.7,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0d5630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00834729,
 0.00188115],_lastvalidtt=[-0.00834729,0.00188115],_upttcommand=[0,0],_refmes=
 0x7fce2a191830,_tiprefv=0x7fce2a0c5c30,_tiltrefv=0x7fce2a9f1230,_tiprefvn=
 0x7fce2a0e8c30,_tiltrefvn=0x7fce2a9fb430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0f6a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1084a2030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0f6a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0ecc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034b08,_ctrlden=0x7fce2a034a60,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d24070,_xlast=0x7fce29d27290,_ylast=[0x7fce2a956c30,
 0x7fce2a956c30,0x7fce2a956c30],_y0=0x7fce2a88e830,_signus=0x7fce29d27410,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c43c00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2a034d38,yposition=
 0x7fce2b0b47d0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.958       78.1
Field Avg  2.20                     70.7   0.958       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a50d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.8,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0c8230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00876264,
 0.000316656],_lastvalidtt=[-0.00876264,0.000316656],_upttcommand=[0,0],_refmes=
 0x7fce2a0f7a30,_tiprefv=0x7fce2a1b2230,_tiltrefv=0x7fce2a0d3830,_tiprefvn=
 0x7fce2a0c5c30,_tiltrefvn=0x7fce2a0ec430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a9d8830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a9d8830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a8eaa30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b38b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b3b50,_ctrlden=0x7fce2b0b3bc0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29e10bd0,_xlast=0x7fce29e11930,_ylast=[0x7fce2b0c8230,
 0x7fce2b0c8230,0x7fce2b0c8230],_y0=0x7fce2b020430,_signus=0x7fce29e174e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29f04d50,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2a01f830,yposition=
 0x7fce2b0b45d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a3aa0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a945430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00361423,
 -1.71339e-05],_lastvalidtt=[-0.00361423,-1.71339e-05],_upttcommand=[0,0],
 _refmes=0x7fce2a93aa30,_tiprefv=0x7fce2a0c7e30,_tiltrefv=0x7fce2a0f2030,
 _tiprefvn=0x7fce2a1b2230,_tiltrefvn=0x7fce2a0d3830,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fce2a93c830,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x1084a2030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a93c830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a8eaa30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b44c0,_ctrlden=0x7fce2a034bb0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c40f70,_xlast=0x7fce29c0bd60,_ylast=[0x7fce2a0ca230,
 0x7fce2a0ca230,0x7fce2a0ca230],_y0=0x7fce2a15aa30,_signus=0x7fce29c388b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d254c0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b3920,yposition=
 0x7fce2b0b3ed8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a49e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a9db030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.0036731,
 0.000948443],_lastvalidtt=[-0.0036731,0.000948443],_upttcommand=[0,0],_refmes=
 0x7fce2a15dc30,_tiprefv=0x7fce2a0e4030,_tiltrefv=0x7fce2a8e2030,_tiprefvn=
 0x7fce2a0c7e30,_tiltrefvn=0x7fce2a951430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a93c830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a93c830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a9dd430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b38b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4b88,_ctrlden=0x7fce2b0b3c30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d265f0,_xlast=0x7fce29d24050,_ylast=[0x7fce2a952230,
 0x7fce2a952230,0x7fce2a952230],_y0=0x7fce2a937030,_signus=0x7fce29d2a590,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d29020,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b4c30,yposition=
 0x7fce2b0b3ff0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a41f0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.5,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a8ec030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00538352,
 0.00107572],_lastvalidtt=[-0.00538352,0.00107572],_upttcommand=[0,0],_refmes=
 0x7fce2a9d6630,_tiprefv=0x7fce2a950630,_tiltrefv=0x7fce2aa2be30,_tiprefvn=
 0x7fce2a9d9630,_tiltrefvn=0x7fce2a8e2030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a9dae30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1084a2030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a9dae30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a9da430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034a98,_ctrlden=0x7fce2b0b4f80,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d24a10,_xlast=0x7fce29d28b20,_ylast=[0x7fce2a937030,
 0x7fce2a937030,0x7fce2a937030],_y0=0x7fce2a8e4030,_signus=0x7fce29d22520,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c0bd60,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b4e68,yposition=
 0x7fce2b0b3990,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a5268)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.6,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a935430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00503979,
 0.000570389],_lastvalidtt=[-0.00503979,0.000570389],_upttcommand=[0,0],_refmes=
 0x7fce2a934030,_tiprefv=0x7fce2a93ae30,_tiltrefv=0x7fce2a9d6630,_tiprefvn=
 0x7fce2a950630,_tiltrefvn=0x7fce2aa2be30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0f2030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0f2030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a036c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b38b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4ae0,_ctrlden=0x7fce2b0b44c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d26f60,_xlast=0x7fce29d24a10,_ylast=[0x7fce2a8e4030,
 0x7fce2a8e4030,0x7fce2a8e4030],_y0=0x7fce2a88e830,_signus=0x7fce29d2b3b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d29fc0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2a034a28,yposition=
 0x7fce2b0b46f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a4410)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.7,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a94f630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.0105287,
 0.00334258],_lastvalidtt=[-0.0105287,0.00334258],_upttcommand=[0,0],_refmes=
 0x7fce2a9dbe30,_tiprefv=0x7fce2aa45030,_tiltrefv=0x7fce2a934030,_tiprefvn=
 0x7fce2a93ae30,_tiltrefvn=0x7fce2a9d6630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a17d430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1084a2030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a17d430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a9d7430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b3840,_ctrlden=0x7fce2a090640,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d23180,_xlast=0x7fce29d26f60,_ylast=[0x7fce2a88e830,
 0x7fce2a88e830,0x7fce2a88e830],_y0=0x7fce2a956c30,_signus=0x7fce29d2a590,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c3cb20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2a034980,yposition=
 0x7fce2b0b44f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a4498)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.8,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a9dd230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00813976,
 0.00189617],_lastvalidtt=[-0.00813976,0.00189617],_upttcommand=[0,0],_refmes=
 0x7fce2a0d1c30,_tiprefv=0x7fce2a17d030,_tiltrefv=0x7fce2a8e3630,_tiprefvn=
 0x7fce2a17de30,_tiltrefvn=0x7fce2a934030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a1a0830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a1a0830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a17c630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b38b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a0349b8,_ctrlden=0x7fce2b0b40d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d21a30,_xlast=0x7fce29d23180,_ylast=[0x7fce2a956c30,
 0x7fce2a956c30,0x7fce2a956c30],_y0=0x7fce2a8c4430,_signus=0x7fce29d26460,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29f04d50,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b3958,yposition=
 0x7fce2b0b4300,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a4da0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2aa39a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00246554,
 0.000522193],_lastvalidtt=[-0.00246554,0.000522193],_upttcommand=[0,0],_refmes=
 0x7fce2a1a5830,_tiprefv=0x7fce2a9dfa30,_tiltrefv=0x7fce2a9e4830,_tiprefvn=
 0x7fce2a9e5630,_tiltrefvn=0x7fce2a8e3630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a94d030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1084a2030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a94d030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a036c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b3920,_ctrlden=0x7fce2b0b4530,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d2a2c0,_xlast=0x7fce29d21a30,_ylast=[0x7fce2a8c4430,
 0x7fce2a8c4430,0x7fce2a8c4430],_y0=0x7fce2a88e830,_signus=0x7fce29d27890,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d23180,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2a034a60,yposition=
 0x7fce2a035080,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a4388)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a9dbe30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00273463,
 0.000979193],_lastvalidtt=[-0.00273463,0.000979193],_upttcommand=[0,0],_refmes=
 0x7fce2a8e2030,_tiprefv=0x7fce2a951630,_tiltrefv=0x7fce2aa58830,_tiprefvn=
 0x7fce2a9dfa30,_tiltrefvn=0x7fce2a9e4830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0f2030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0f2030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a8e3630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b38b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034de0,_ctrlden=0x7fce2b0b4c30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c388b0,_xlast=0x7fce29c3e920,_ylast=[0x7fce2a062030,
 0x7fce2a062030,0x7fce2a062030],_y0=0x7fce2a0fda30,_signus=0x7fce29c39ca0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29f05990,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b3bc0,yposition=
 0x7fce2a034a98,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a4740)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.5,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a159e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00336346,
 -0.00133484],_lastvalidtt=[-0.00336346,-0.00133484],_upttcommand=[0,0],_refmes=
 0x7fce2a0cc430,_tiprefv=0x7fce2a0fc230,_tiltrefv=0x7fce2a8e2030,_tiprefvn=
 0x7fce2a0f6030,_tiltrefvn=0x7fce2aa58830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a9d9030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1084a2030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a9d9030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0fd030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4728,_ctrlden=0x7fce2a035048,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d28ea0,_xlast=0x7fce29d29780,_ylast=[0x7fce2a88e830,
 0x7fce2a88e830,0x7fce2a88e830],_y0=0x7fce2a8c4430,_signus=0x7fce29d27ba0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c43c00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2a034bb0,yposition=
 0x7fce2b0b3990,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a4630)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.6,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0f6e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.0036845,
 0.00610229],_lastvalidtt=[-0.0036845,0.00610229],_upttcommand=[0,0],_refmes=
 0x7fce2a0eb030,_tiprefv=0x7fce2a0d4630,_tiltrefv=0x7fce2a0fb430,_tiprefvn=
 0x7fce2a0fc230,_tiltrefvn=0x7fce2a0f2030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a94ca30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a94ca30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a036c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b38b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b49c8,_ctrlden=0x7fce2b0b3ae0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d24a10,_xlast=0x7fce29d23180,_ylast=[0x7fce2a8c4430,
 0x7fce2a8c4430,0x7fce2a8c4430],_y0=0x7fce2a9d7a30,_signus=0x7fce29d22520,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c3ce60,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b3c30,yposition=
 0x7fce2a0349f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a4300)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.7,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0e8430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00687096,
 0.00352992],_lastvalidtt=[-0.00687096,0.00352992],_upttcommand=[0,0],_refmes=
 0x7fce2a0f5030,_tiprefv=0x7fce2a8e2030,_tiltrefv=0x7fce2a8eaa30,_tiprefvn=
 0x7fce2a9da630,_tiltrefvn=0x7fce2a9d6630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a9db430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1084a2030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a9db430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a036c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034d00,_ctrlden=0x7fce2b0b4990,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c0bd60,_xlast=0x7fce29c42e20,_ylast=[0x7fce2a04e230,
 0x7fce2a04e230,0x7fce2a04e230],_y0=0x7fce2a15aa30,_signus=0x7fce29c39fb0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c46d00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b4f80,yposition=
 0x7fce2a034868,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a5048)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.8,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0fb430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.0101323,
 0.00470295],_lastvalidtt=[-0.0101323,0.00470295],_upttcommand=[0,0],_refmes=
 0x7fce2a0f9a30,_tiprefv=0x7fce2a9db430,_tiltrefv=0x7fce2a9f2430,_tiprefvn=
 0x7fce2a8e2030,_tiltrefvn=0x7fce2a8eaa30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a263a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a263a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a036c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b38b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b43e0,_ctrlden=0x7fce2b0b46b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c0c980,_xlast=0x7fce29c0bd60,_ylast=[0x7fce2a15aa30,
 0x7fce2a15aa30,0x7fce2a15aa30],_y0=0x7fce2a062030,_signus=0x7fce29c3df50,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29e10bd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b44c0,yposition=
 0x7fce2b0b4450,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a4960)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a93ae30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00370843,
 -0.00123262],_lastvalidtt=[-0.00370843,-0.00123262],_upttcommand=[0,0],_refmes=
 0x7fce2aa15a30,_tiprefv=0x7fce2aa14630,_tiltrefv=0x7fce2a9f5430,_tiprefvn=
 0x7fce2a9db430,_tiltrefvn=0x7fce2a9f2430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2aa10230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1084a2030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2aa10230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a036c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b3990,_ctrlden=0x7fce2b0b47d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d24a10,_xlast=0x7fce29d24050,_ylast=[0x7fce2a956c30,
 0x7fce2a956c30,0x7fce2a956c30],_y0=0x7fce2a8e4030,_signus=0x7fce29d29940,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c0bd60,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2a090640,yposition=
 0x7fce2b0b4140,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a3ec0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0f6e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00547528,
 0.00135276],_lastvalidtt=[-0.00547528,0.00135276],_upttcommand=[0,0],_refmes=
 0x7fce2a0fb230,_tiprefv=0x7fce2a0fce30,_tiltrefv=0x7fce2a0fc030,_tiprefvn=
 0x7fce2a0c7230,_tiltrefvn=0x7fce2a168030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a218430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a218430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a951630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b38b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4418,_ctrlden=0x7fce2b0b4a00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c0b430,_xlast=0x7fce29c0b7e0,_ylast=[0x7fce2a04e230,
 0x7fce2a04e230,0x7fce2a04e230],_y0=0x7fce2a062030,_signus=0x7fce29c3cc60,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d24a10,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b40d0,yposition=
 0x7fce2a034ec0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a3bb0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.5,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a9dfa30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00278812,
 0.000452198],_lastvalidtt=[-0.00278812,0.000452198],_upttcommand=[0,0],_refmes=
 0x7fce2a0d3630,_tiprefv=0x7fce2a168e30,_tiltrefv=0x7fce2a0eb030,_tiprefvn=
 0x7fce2a0fce30,_tiltrefvn=0x7fce2a0fc030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0d0e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1084a2030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0d0e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a036c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4bc0,_ctrlden=0x7fce2a034868,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c43c00,_xlast=0x7fce29c0bd60,_ylast=[0x7fce2a062030,
 0x7fce2a062030,0x7fce2a062030],_y0=0x7fce2a0f8e30,_signus=0x7fce29c388b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c0c980,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b4530,yposition=
 0x7fce2b0b4338,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a4f38)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.6,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a935e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00588497,
 -0.000237823],_lastvalidtt=[-0.00588497,-0.000237823],_upttcommand=[0,0],
 _refmes=0x7fce2a0d3030,_tiprefv=0x7fce2b883a30,_tiltrefv=0x7fce2a0fce30,
 _tiprefvn=0x7fce2b884830,_tiltrefvn=0x7fce2a0eb030,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fce2a94ca30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a94ca30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a168230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b38b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4450,_ctrlden=0x7fce2b0b4530,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c3c250,_xlast=0x7fce29c43c00,_ylast=[0x7fce2a0f8e30,
 0x7fce2a0f8e30,0x7fce2a0f8e30],_y0=0x7fce2a04e230,_signus=0x7fce29c3fe00,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d2a2c0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b4c30,yposition=
 0x7fce2b0b4798,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a4eb0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.7,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2b01f830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00725875,
 0.00523005],_lastvalidtt=[-0.00725875,0.00523005],_upttcommand=[0,0],_refmes=
 0x7fce2a938230,_tiprefv=0x7fce2a0f6030,_tiltrefv=0x7fce2a0f5230,_tiprefvn=
 0x7fce2a15b630,_tiltrefvn=0x7fce2a0fce30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2aa14630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1084a2030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2aa14630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0db630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4f10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a090678,_ctrlden=0x7fce2b0b4300,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c3c810,_xlast=0x7fce29c3c250,_ylast=[0x7fce2a04e230,
 0x7fce2a04e230,0x7fce2a04e230],_y0=0x7fce2a0c7e30,_signus=0x7fce29c45ce0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c43c00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2a035048,yposition=
 0x7fce2b0b3808,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3440,layerfrac=0x7fce2b0a3550,
 layerspeed=0x7fce2b0a34c8,layeralt=0x7fce2b0a35d8,winddir=0x7fce2b0a3660,
 _layeralt=0x7fce2b0a3908)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.8,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b4808,lgs_prof_alt=0x7fce2b0b3878,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a8eaa30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.0110789,
 0.00549781],_lastvalidtt=[-0.0110789,0.00549781],_upttcommand=[0,0],_refmes=
 0x7fce2a93aa30,_tiprefv=0x7fce2a0ec830,_tiltrefv=0x7fce2a0d0030,_tiprefvn=
 0x7fce2a0f6030,_tiltrefvn=0x7fce2a0f5230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0f9a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0f9a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a036c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b38b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b3840,_ctrlden=0x7fce2a035080,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d2a2c0,_xlast=0x7fce29d21a30,_ylast=[0x7fce2a88e830,
 0x7fce2a88e830,0x7fce2a88e830],_y0=0x7fce2a956c30,_signus=0x7fce29d22520,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d24440,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b48b0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b4840,xposition=0x7fce2b0b3ae0,yposition=
 0x7fce2b0b4b88,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bf8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 212 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a50d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a933230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=212,_nsub4disp=0,_nmes=
 424,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.0070424,
 0.00272645],_lastvalidtt=[-0.0070424,0.00272645],_upttcommand=[0,0],_refmes=
 0x7fce2a0f9a30,_tiprefv=0x7fce2a0f5830,_tiltrefv=0x7fce2a0fc230,_tiprefvn=
 0x7fce2a0cb630,_tiltrefvn=0x7fce2a0d4630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a208030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1084a2030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a208030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a94f030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b3a00,_ctrlden=0x7fce2a034e50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d1f370,_xlast=0x7fce29d23180,_ylast=[0x7fce2a956c30,
 0x7fce2a956c30,0x7fce2a956c30],_y0=0x7fce2a94fa30,_signus=0x7fce29d26460,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29e10bd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b4370,yposition=
 0x7fce2b0b45a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 212 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.958       78.1
Field Avg  2.20                     70.7   0.958       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a3e38)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a945430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=212,_nsub4disp=0,_nmes=
 424,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.0094146,
 0.000731688],_lastvalidtt=[-0.0094146,0.000731688],_upttcommand=[0,0],_refmes=
 0x7fce2a93a030,_tiprefv=0x7fce2b0f0030,_tiltrefv=0x7fce2a93ae30,_tiprefvn=
 0x7fce2b0bfc30,_tiltrefvn=0x7fce2a9e0830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a9e1630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10860e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a9e1630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a036c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a0349b8,_ctrlden=0x7fce2a034de0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c0da20,_xlast=0x7fce29c3a080,_ylast=[0x7fce2a0fda30,
 0x7fce2a0fda30,0x7fce2a0fda30],_y0=0x7fce2a0f8e30,_signus=0x7fce29c0c0e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29e11930,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b46b8,yposition=
 0x7fce2b0b3958,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 212 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.958       78.1
Field Avg  2.20                     70.7   0.958       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a4f38)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.5,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0eb030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=212,_nsub4disp=0,_nmes=
 424,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00850717,
 0.00371114],_lastvalidtt=[-0.00850717,0.00371114],_upttcommand=[0,0],_refmes=
 0x7fce2a0f9a30,_tiprefv=0x7fce2a0c7230,_tiltrefv=0x7fce2a0f2e30,_tiprefvn=
 0x7fce2a0f3c30,_tiltrefvn=0x7fce2a0d4a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0d7630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10d6e5030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0d7630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a8e2030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b3808,_ctrlden=0x7fce2b0b4aa8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c0bd60,_xlast=0x7fce29c42e20,_ylast=[0x7fce2a0f8e30,
 0x7fce2a0f8e30,0x7fce2a0f8e30],_y0=0x7fce2a062030,_signus=0x7fce29c39fd0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29f05b20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b47d0,yposition=
 0x7fce2a034da8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 212 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.958       78.1
Field Avg  2.20                     70.7   0.958       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a3880)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.6,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0e7430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=212,_nsub4disp=0,_nmes=
 424,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00835567,
 0.00307188],_lastvalidtt=[-0.00835567,0.00307188],_upttcommand=[0,0],_refmes=
 0x7fce2b873c30,_tiprefv=0x7fce2a0ec830,_tiltrefv=0x7fce2b875830,_tiprefvn=
 0x7fce2b874a30,_tiltrefvn=0x7fce2b885c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2b88ae30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10860e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2b88ae30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a164a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b3990,_ctrlden=0x7fce2b0b47d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c0c980,_xlast=0x7fce29c0bd60,_ylast=[0x7fce2a062030,
 0x7fce2a062030,0x7fce2a062030],_y0=0x7fce2a0fda30,_signus=0x7fce29c388b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10b740030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29e10bd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b4a00,yposition=
 0x7fce2b0b4f10,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 212 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.958       78.1
Field Avg  2.20                     70.7   0.958       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a4740)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.7,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a9dae30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=212,_nsub4disp=0,_nmes=
 424,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00903126,
 0.00427742],_lastvalidtt=[-0.00903126,0.00427742],_upttcommand=[0,0],_refmes=
 0x7fce2a17e030,_tiprefv=0x7fce2a0f9a30,_tiltrefv=0x7fce2a0fbc30,_tiprefvn=
 0x7fce2a0ec830,_tiltrefvn=0x7fce2a0fa830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2b04e030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10d6e5030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2b04e030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a8e3630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034d70,_ctrlden=0x7fce2b0b49c8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29e1a1c0,_xlast=0x7fce29e1a340,_ylast=[0x7fce2b068e30,
 0x7fce2b068e30,0x7fce2b068e30],_y0=0x7fce2b0c8230,_signus=0x7fce29e196c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e51a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29e19980,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2a034868,yposition=
 0x7fce2b0b44f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 212 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.958       78.1
Field Avg  2.20                     70.7   0.958       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a47c8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.8,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a94a830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=212,_nsub4disp=0,_nmes=
 424,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00929056,
 0.00498563],_lastvalidtt=[-0.00929056,0.00498563],_upttcommand=[0,0],_refmes=
 0x7fce2a0f2030,_tiprefv=0x7fce2a949430,_tiltrefv=0x7fce2a0f5230,_tiprefvn=
 0x7fce2a94b030,_tiltrefvn=0x7fce2a0fbc30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a18cc30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10860e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a18cc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0fa830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034868,_ctrlden=0x7fce2b0b40d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c0bd60,_xlast=0x7fce29c42e20,_ylast=[0x7fce2a0fda30,
 0x7fce2a0fda30,0x7fce2a0fda30],_y0=0x7fce2a062030,_signus=0x7fce29c39fd0,
 _puppixoffset=[0,0],_nact=80,_def=0x10b740030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c0c980,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b4530,yposition=
 0x7fce2b0b43a8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a4da0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a93b430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00354862,
 0.000965885],_lastvalidtt=[-0.00354862,0.000965885],_upttcommand=[0,0],_refmes=
 0x7fce2a9dae30,_tiprefv=0x7fce2a8e3630,_tiltrefv=0x7fce2a0f2030,_tiprefvn=
 0x7fce2a949430,_tiltrefvn=0x7fce2a0f5230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a25d830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10d6e5030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a25d830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0d9c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034e18,_ctrlden=0x7fce2b0b4610,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d224e0,_xlast=0x7fce29d22660,_ylast=[0x7fce2a956c30,
 0x7fce2a956c30,0x7fce2a956c30],_y0=0x7fce2a936e30,_signus=0x7fce29d298f0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d2a8e0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2a034a60,yposition=
 0x7fce2a035010,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a4eb0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a9dc630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00468202,
 -0.00118545],_lastvalidtt=[-0.00468202,-0.00118545],_upttcommand=[0,0],_refmes=
 0x7fce2a938230,_tiprefv=0x7fce2a93aa30,_tiltrefv=0x7fce2a939c30,_tiprefvn=
 0x7fce2a8e3630,_tiltrefvn=0x7fce2aa2c230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a1c0e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1093c6030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a1c0e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0c8230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4530,_ctrlden=0x7fce2b0b4958,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c3eaa0,_xlast=0x7fce29c3ec20,_ylast=[0x7fce2a0fda30,
 0x7fce2a0fda30,0x7fce2a0fda30],_y0=0x7fce2a0dc830,_signus=0x7fce29c3f270,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d23180,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b4840,yposition=
 0x7fce2b0b45a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a4fc0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.5,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0d8a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00702404,
 0.00394939],_lastvalidtt=[-0.00702404,0.00394939],_upttcommand=[0,0],_refmes=
 0x7fce2a0d9230,_tiprefv=0x7fce2a0f3a30,_tiltrefv=0x7fce2a93aa30,_tiprefvn=
 0x7fce2a0d7630,_tiltrefvn=0x7fce2a939c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0cb630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108486030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0cb630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0c8230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4338,_ctrlden=0x7fce2b0b46b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d21a30,_xlast=0x7fce29d2b590,_ylast=[0x7fce2a956c30,
 0x7fce2a956c30,0x7fce2a956c30],_y0=0x7fce2a9dba30,_signus=0x7fce29d224e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29e10bd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2a034e50,yposition=
 0x7fce2a0348d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a51e0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.6,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2aa69630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.0101028,
 0.00452343],_lastvalidtt=[-0.0101028,0.00452343],_upttcommand=[0,0],_refmes=
 0x7fce2a8eaa30,_tiprefv=0x7fce2aa68230,_tiltrefv=0x7fce2a938230,_tiprefvn=
 0x7fce2a9dc630,_tiltrefvn=0x7fce2a93aa30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a984230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a984230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0c8230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034fd8,_ctrlden=0x7fce2b0b3bc0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d2b9d0,_xlast=0x7fce29d21a30,_ylast=[0x7fce2a9dba30,
 0x7fce2a9dba30,0x7fce2a9dba30],_y0=0x7fce2a8e2a30,_signus=0x7fce29d27b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29e11930,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2a034de0,yposition=
 0x7fce2b0b3ae0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.958       78.1
Field Avg  2.20                     70.7   0.958       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a3b28)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.7,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2b0ac830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00786337,
 0.00231862],_lastvalidtt=[-0.00786337,0.00231862],_upttcommand=[0,0],_refmes=
 0x7fce2a9f2830,_tiprefv=0x7fce2a9f0e30,_tiltrefv=0x7fce2a8eaa30,_tiprefvn=
 0x7fce2aa68230,_tiltrefvn=0x7fce2a938230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0e2430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108486030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0e2430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0c8230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4ed8,_ctrlden=0x7fce2b0b3b18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d22670,_xlast=0x7fce29d29670,_ylast=[0x7fce2a8e2a30,
 0x7fce2a8e2a30,0x7fce2a8e2a30],_y0=0x7fce2a9d0230,_signus=0x7fce29d2b820,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29f05b20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b4aa8,yposition=
 0x7fce2b0b4b18,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.958       78.1
Field Avg  2.20                     70.7   0.958       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a5268)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.8,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0f2030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.0120295,
 0.00621185],_lastvalidtt=[-0.0120295,0.00621185],_upttcommand=[0,0],_refmes=
 0x7fce2a0e7230,_tiprefv=0x7fce2a9dae30,_tiltrefv=0x7fce2a9d6630,_tiprefvn=
 0x7fce2a9f0e30,_tiltrefvn=0x7fce2a8eaa30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0cb630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0cb630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a9de030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b39c8,_ctrlden=0x7fce2b0b46f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d23180,_xlast=0x7fce29d22670,_ylast=[0x7fce2a9d0230,
 0x7fce2a9d0230,0x7fce2a9d0230],_y0=0x7fce2a88e830,_signus=0x7fce29d26790,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d224e0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b47d0,yposition=
 0x7fce2a0349b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a52f0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2aa80630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00313099,
 0.000268531],_lastvalidtt=[-0.00313099,0.000268531],_upttcommand=[0,0],_refmes=
 0x7fce2a939030,_tiprefv=0x7fce2a939e30,_tiltrefv=0x7fce2a938230,_tiprefvn=
 0x7fce2a9dae30,_tiltrefvn=0x7fce2a9d6630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0cec30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108486030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0cec30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0d4830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034868,_ctrlden=0x7fce2b0b4760,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d21a30,_xlast=0x7fce29d23180,_ylast=[0x7fce2a88e830,
 0x7fce2a88e830,0x7fce2a88e830],_y0=0x7fce2a934430,_signus=0x7fce29d26460,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c46bc0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b49c8,yposition=
 0x7fce2a034e18,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a41f0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0f2030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00369091,
 0.00195724],_lastvalidtt=[-0.00369091,0.00195724],_upttcommand=[0,0],_refmes=
 0x7fce2b0a9030,_tiprefv=0x7fce2a0d4830,_tiltrefv=0x7fce2a9dae30,_tiprefvn=
 0x7fce2a0cec30,_tiltrefvn=0x7fce2a938230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0f2830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0f2830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0f5630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a0349b8,_ctrlden=0x7fce2b0b4f10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c0b540,_xlast=0x7fce29c46780,_ylast=[0x7fce2a062030,
 0x7fce2a062030,0x7fce2a062030],_y0=0x7fce2a0d3c30,_signus=0x7fce29c3e330,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d1f370,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b40d0,yposition=
 0x7fce2b0b3ed8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a5378)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.5,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a936a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00524563,
 0.00356565],_lastvalidtt=[-0.00524563,0.00356565],_upttcommand=[0,0],_refmes=
 0x7fce2a9dd230,_tiprefv=0x7fce2a94d430,_tiltrefv=0x7fce2a0d4830,_tiprefvn=
 0x7fce2a93aa30,_tiltrefvn=0x7fce2a0f2030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a984030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108486030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a984030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2b804a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4aa8,_ctrlden=0x7fce2a034cc8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d28370,_xlast=0x7fce29d2a200,_ylast=[0x7fce2a8e2a30,
 0x7fce2a8e2a30,0x7fce2a8e2a30],_y0=0x7fce2a94e230,_signus=0x7fce29d287c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29e10bd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b4610,yposition=
 0x7fce2b0b4a38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a3990)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.6,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a9ea430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00521773,
 -0.000841103],_lastvalidtt=[-0.00521773,-0.000841103],_upttcommand=[0,0],
 _refmes=0x7fce2a9dce30,_tiprefv=0x7fce2a938230,_tiltrefv=0x7fce2a8e3630,
 _tiprefvn=0x7fce2a94d430,_tiltrefvn=0x7fce2a93aa30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fce2a0f9a30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0f9a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0c8230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034b08,_ctrlden=0x7fce2a090678,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c3a0e0,_xlast=0x7fce29c0b4a0,_ylast=[0x7fce2a062030,
 0x7fce2a062030,0x7fce2a062030],_y0=0x7fce2a0f8e30,_signus=0x7fce29c388b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d1f370,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b4958,yposition=
 0x7fce2a034e50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a48d8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.7,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0cc630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00675521,
 0.00272575],_lastvalidtt=[-0.00675521,0.00272575],_upttcommand=[0,0],_refmes=
 0x7fce2b0e5e30,_tiprefv=0x7fce2a939030,_tiltrefv=0x7fce2a9d6e30,_tiprefvn=
 0x7fce2a938230,_tiltrefvn=0x7fce2a8e3630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a0e5430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108486030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a0e5430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a93aa30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4568,_ctrlden=0x7fce2a034be8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d24440,_xlast=0x7fce29d224e0,_ylast=[0x7fce2a8c4430,
 0x7fce2a8c4430,0x7fce2a8c4430],_y0=0x7fce2a88e830,_signus=0x7fce29d26460,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d22660,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b46b8,yposition=
 0x7fce2b0b4450,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a3bb0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.8,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a1b5c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.0100006,
 0.002264],_lastvalidtt=[-0.0100006,0.002264],_upttcommand=[0,0],_refmes=
 0x7fce2a0d8430,_tiprefv=0x7fce2a0d0e30,_tiltrefv=0x7fce2a1cf030,_tiprefvn=
 0x7fce2a0d1c30,_tiltrefvn=0x7fce2a0d9230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2aa37030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2aa37030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0fc830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4e68,_ctrlden=0x7fce2b0b3ff0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c40140,_xlast=0x7fce29c40940,_ylast=[0x7fce2a0f8e30,
 0x7fce2a0f8e30,0x7fce2a0f8e30],_y0=0x7fce2a062030,_signus=0x7fce29c3eca0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d224e0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b3bc0,yposition=
 0x7fce2a034868,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a4388)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a1c7230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00400947,
 0.00127342],_lastvalidtt=[-0.00400947,0.00127342],_upttcommand=[0,0],_refmes=
 0x7fce2a1c9c30,_tiprefv=0x7fce2a0d8230,_tiltrefv=0x7fce2a1cc430,_tiprefvn=
 0x7fce2a0d0e30,_tiltrefvn=0x7fce2a1cf030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a151830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108486030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a151830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a1c9030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034a28,_ctrlden=0x7fce2b0b4a00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d27cb0,_xlast=0x7fce29d27e30,_ylast=[0x7fce2a936630,
 0x7fce2a936630,0x7fce2a936630],_y0=0x7fce2a94fa30,_signus=0x7fce29d26990,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d2a930,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b3b18,yposition=
 0x7fce2a034bb0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a45a8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a951630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00311364,
 0.000816857],_lastvalidtt=[-0.00311364,0.000816857],_upttcommand=[0,0],_refmes=
 0x7fce2a935430,_tiprefv=0x7fce2a0e5a30,_tiltrefv=0x7fce2a163c30,_tiprefvn=
 0x7fce2a0d8230,_tiltrefvn=0x7fce2a1cc430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a15b630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a15b630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0c8230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034d00,_ctrlden=0x7fce2b0b45d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c3f2e0,_xlast=0x7fce29c0bd60,_ylast=[0x7fce2a0f8e30,
 0x7fce2a0f8e30,0x7fce2a0f8e30],_y0=0x7fce2a0d5230,_signus=0x7fce29c388b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29f05ca0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b46f0,yposition=
 0x7fce2b0b3b50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a4d18)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.5,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a93ae30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00683772,
 0.00195991],_lastvalidtt=[-0.00683772,0.00195991],_upttcommand=[0,0],_refmes=
 0x7fce2a93d630,_tiprefv=0x7fce2a9d6630,_tiltrefv=0x7fce2a938230,_tiprefvn=
 0x7fce2a9d7430,_tiltrefvn=0x7fce2a939c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2aa02630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108486030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2aa02630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0c8230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4a70,_ctrlden=0x7fce2b0b4568,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d289f0,_xlast=0x7fce29d29190,_ylast=[0x7fce2a93aa30,
 0x7fce2a93aa30,0x7fce2a93aa30],_y0=0x7fce2a939830,_signus=0x7fce29d29af0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d29310,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b4760,yposition=
 0x7fce2b0b4178,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a36e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.6,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0f2830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00262855,
 0.00325247],_lastvalidtt=[-0.00262855,0.00325247],_upttcommand=[0,0],_refmes=
 0x7fce2a8e2030,_tiprefv=0x7fce2aa82c30,_tiltrefv=0x7fce2a8e3630,_tiprefvn=
 0x7fce2a9d6630,_tiltrefvn=0x7fce2a938230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a940c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a940c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2b083e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b45a0,_ctrlden=0x7fce2a019288,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c3a0f0,_xlast=0x7fce29c43c00,_ylast=[0x7fce2a062030,
 0x7fce2a062030,0x7fce2a062030],_y0=0x7fce2a0f8e30,_signus=0x7fce29c0c0e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d29490,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b4f10,yposition=
 0x7fce2b0b4680,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a50d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.7,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a935430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00765211,
 -0.00131859],_lastvalidtt=[-0.00765211,-0.00131859],_upttcommand=[0,0],_refmes=
 0x7fce2a9cfa30,_tiprefv=0x7fce2b02a430,_tiltrefv=0x7fce2a0d0e30,_tiprefvn=
 0x7fce2b0acc30,_tiltrefvn=0x7fce2a0fb430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a263e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108486030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a263e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0fc230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034b78,_ctrlden=0x7fce2b0b4f80,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c388b0,_xlast=0x7fce29c3a0f0,_ylast=[0x7fce2a0f8e30,
 0x7fce2a0f8e30,0x7fce2a0f8e30],_y0=0x7fce2a0df030,_signus=0x7fce29c3df50,
 _puppixoffset=[0,0],_nact=80,_def=0x10d726030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29e10bd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2a034cc8,yposition=
 0x7fce2b0b4878,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a3e38)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.8,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a93ae30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00654967,
 0.00373684],_lastvalidtt=[-0.00654967,0.00373684],_upttcommand=[0,0],_refmes=
 0x7fce2a9a2830,_tiprefv=0x7fce2a939e30,_tiltrefv=0x7fce2a0ec830,_tiprefvn=
 0x7fce2a933230,_tiltrefvn=0x7fce2a0d0e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a94c230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a94c230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0cb630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034a28,_ctrlden=0x7fce2b0b4370,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d29250,_xlast=0x7fce29d293d0,_ylast=[0x7fce2a8c4430,
 0x7fce2a8c4430,0x7fce2a8c4430],_y0=0x7fce2a936e30,_signus=0x7fce29d29550,
 _puppixoffset=[0,0],_nact=80,_def=0x10ee1f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29e168a0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2a090678,yposition=
 0x7fce2a034da8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a4f38)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a9f3630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00367841,
 0.00198747],_lastvalidtt=[-0.00367841,0.00198747],_upttcommand=[0,0],_refmes=
 0x7fce2a938230,_tiprefv=0x7fce2a0cb630,_tiltrefv=0x7fce2a8eaa30,_tiprefvn=
 0x7fce2a18d630,_tiltrefvn=0x7fce2a933230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a94bc30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108486030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a94bc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0c8230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a034868,_ctrlden=0x7fce2b0b4140,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c46ca0,_xlast=0x7fce29c461e0,_ylast=[0x7fce2a0f8e30,
 0x7fce2a0f8e30,0x7fce2a0f8e30],_y0=0x7fce2a0b9c30,_signus=0x7fce29c39ce0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d726030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29f05b20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2a034be8,yposition=
 0x7fce2a034c58,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a3880)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a0d3830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00347369,
 -0.000188667],_lastvalidtt=[-0.00347369,-0.000188667],_upttcommand=[0,0],
 _refmes=0x7fce2a943030,_tiprefv=0x7fce2a943e30,_tiltrefv=0x7fce2aa03430,
 _tiprefvn=0x7fce2a949230,_tiltrefvn=0x7fce2a8eaa30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fce2aa15030,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2aa15030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0c8230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4aa8,_ctrlden=0x7fce2b0b46f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c0b020,_xlast=0x7fce29c3ea90,_ylast=[0x7fce2a0b9c30,
 0x7fce2a0b9c30,0x7fce2a0b9c30],_y0=0x7fce2a062030,_signus=0x7fce29c39fa0,
 _puppixoffset=[0,0],_nact=80,_def=0x10ee1f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d1f370,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b3ff0,yposition=
 0x7fce2a0349f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a4740)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.5,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a951630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00532927,
 -0.000922561],_lastvalidtt=[-0.00532927,-0.000922561],_upttcommand=[0,0],
 _refmes=0x7fce2aa16430,_tiprefv=0x7fce2b01f830,_tiltrefv=0x7fce2a94ba30,
 _tiprefvn=0x7fce2b0aba30,_tiltrefvn=0x7fce2aa03430,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fce2aabd630,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x108486030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2aabd630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0c8230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b3ae0,_ctrlden=0x7fce2b0b3f80,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c43c60,_xlast=0x7fce29c0bd60,_ylast=[0x7fce2a062030,
 0x7fce2a062030,0x7fce2a062030],_y0=0x7fce2a0f8e30,_signus=0x7fce29c388b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d726030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d23180,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b4a00,yposition=
 0x7fce2a034b08,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a47c8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.6,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a949a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00417737,
 0.000132338],_lastvalidtt=[-0.00417737,0.000132338],_upttcommand=[0,0],_refmes=
 0x7fce2aa0d630,_tiprefv=0x7fce2a942030,_tiltrefv=0x7fce2aabe830,_tiprefvn=
 0x7fce2a933230,_tiltrefvn=0x7fce2a94ba30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2aa3e630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2aa3e630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a0c8230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4610,_ctrlden=0x7fce2a034d00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d273f0,_xlast=0x7fce29d28380,_ylast=[0x7fce2a956c30,
 0x7fce2a956c30,0x7fce2a956c30],_y0=0x7fce2a8c4430,_signus=0x7fce29d29ce0,
 _puppixoffset=[0,0],_nact=80,_def=0x10ee1f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d28500,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b45d8,yposition=
 0x7fce2b0b3958,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a4da0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.7,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2aa4b230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00597098,
 0.0047216],_lastvalidtt=[-0.00597098,0.0047216],_upttcommand=[0,0],_refmes=
 0x7fce2a94ee30,_tiprefv=0x7fce2a94c830,_tiltrefv=0x7fce2a0d4830,_tiprefvn=
 0x7fce2a942030,_tiltrefvn=0x7fce2a0f9a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2a9c8a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x108486030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2a9c8a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a93d230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4e68,_ctrlden=0x7fce2b0b4a70,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29c39ca0,_xlast=0x7fce29c0c9e0,_ylast=[0x7fce2a0d3c30,
 0x7fce2a0d3c30,0x7fce2a0d3c30],_y0=0x7fce2a0fce30,_signus=0x7fce29c45ec0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d726030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c43c00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2b0b4568,yposition=
 0x7fce2b0b3b18,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 204 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.957       78.1
Field Avg  2.20                     70.7   0.957       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3330,winddir=0x7fce2b0a33b8,
 _layeralt=0x7fce2b0a4eb0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.8,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3b88,lgs_prof_alt=0x7fce2b0b4300,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fce2a943a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=204,_nsub4disp=0,_nmes=
 408,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00713888,
 0.00494229],_lastvalidtt=[-0.00713888,0.00494229],_upttcommand=[0,0],_refmes=
 0x7fce2a0cdc30,_tiprefv=0x7fce2a0d0430,_tiltrefv=0x7fce2a0fa830,_tiprefvn=
 0x7fce2a0d1230,_tiltrefvn=0x7fce2a0d4830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fce2aaccc30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1083eb030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fce2aaccc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fce2a934a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fce2b0b4808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b41e8,_ctrlden=0x7fce2b0b3990,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d28d30,_xlast=0x7fce29d27fc0,_ylast=[0x7fce2a956c30,
 0x7fce2a956c30,0x7fce2a956c30],_y0=0x7fce2a94fa30,_signus=0x7fce29d2c220,
 _puppixoffset=[0,0],_nact=80,_def=0x10ee1f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c42e20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b4b88,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2a035080,xposition=0x7fce2a019288,yposition=
 0x7fce2a034c90,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b48b0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7ff913059640,layerfrac=0x7ff913059750,
 layerspeed=0x7ff9130596c8,layeralt=0x7ff913059530,winddir=0x7ff9130595b8,
 _layeralt=0x7ff91305abe8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=1,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7ff91306a6f8,lgs_prof_alt=0x7ff913069b20,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7ff9130c0c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29584e+08,_skynphotons=101.871,_tt=[-0.00499739,
 0.00125482],_lastvalidtt=[-0.00499739,0.00125482],_upttcommand=[0,0],_refmes=
 0x7ff911863a30,_tiprefv=0x7ff9121b2e30,_tiltrefv=0x7ff912039430,_tiprefvn=
 0x7ff91219aa30,_tiltrefvn=0x7ff9121ea830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7ff911876630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x102625030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7ff911876630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7ff912185430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7ff913069dc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7ff91200d430,_ctrlden=0x7ff912046848,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7ff911555e00,_xlast=0x7ff911513130,_ylast=[0x7ff9120a7030,
 0x7ff9120a7030,0x7ff9120a7030],_y0=0x7ff912063230,_signus=0x7ff91154eb60,
 _puppixoffset=[0,0],_nact=80,_def=0x10778d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7ff91170f4d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7ff91306a848,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7ff913069ab0,xposition=0x7ff91306a5a8,yposition=
 0x7ff913069df8,xspeed=0x0,yspeed=0x0,dispzoom=0x7ff913069d50,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7ff913059640,layerfrac=0x7ff913059750,
 layerspeed=0x7ff9130596c8,layeralt=0x7ff913059530,winddir=0x7ff9130595b8,
 _layeralt=0x7ff91305a1d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7ff91306a6f8,lgs_prof_alt=0x7ff913069b20,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7ff911858230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1.29583e+06,_skynphotons=101.871,_tt=[-0.00492442,
 0.00145503],_lastvalidtt=[-0.00492442,0.00145503],_upttcommand=[0,0],_refmes=
 0x7ff911934830,_tiprefv=0x7ff91186e430,_tiltrefv=0x7ff911874430,_tiprefvn=
 0x7ff911875430,_tiltrefvn=0x7ff911888e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7ff912245a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1073ef030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7ff912245a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7ff9130c0830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7ff91306a378)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7ff91306ad18,_ctrlden=0x7ff9120461b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7ff911417ea0,_xlast=0x7ff911419920,_ylast=[0x7ff911813e30,
 0x7ff911813e30,0x7ff911813e30],_y0=0x7ff91184fa30,_signus=0x7ff911414220,
 _puppixoffset=[0,0],_nact=80,_def=0x108e86030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7ff9115120c0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7ff91306a848,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7ff913069ab0,xposition=0x7ff913069a40,yposition=
 0x7ff91306a650,xspeed=0x0,yspeed=0x0,dispzoom=0x7ff913069d50,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.956       78.1
Field Avg  2.20                     70.7   0.956       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7ff913059640,layerfrac=0x7ff913059750,
 layerspeed=0x7ff9130596c8,layeralt=0x7ff913059530,winddir=0x7ff9130595b8,
 _layeralt=0x7ff91305a610)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7ff91306a6f8,lgs_prof_alt=0x7ff913069b20,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7ff91189c230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=81760.9,_skynphotons=101.871,_tt=[-0.00537114,
 0.00109977],_lastvalidtt=[-0.00537114,0.00109977],_upttcommand=[0,0],_refmes=
 0x7ff91218cc30,_tiprefv=0x7ff912191830,_tiltrefv=0x7ff9122c5a30,_tiprefvn=
 0x7ff912192830,_tiltrefvn=0x7ff9122c0e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7ff911874430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1044b2030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7ff911874430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7ff911871230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7ff913069dc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7ff9120464c8,_ctrlden=0x7ff91306ab58,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7ff911551630,_xlast=0x7ff9115115c0,_ylast=[0x7ff91203a230,
 0x7ff91203a230,0x7ff91203a230],_y0=0x7ff91218dc30,_signus=0x7ff91154eb60,
 _puppixoffset=[0,0],_nact=80,_def=0x1044fc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7ff91170f4d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7ff91306a848,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7ff913069ab0,xposition=0x7ff91306a8b8,yposition=
 0x7ff91306ac70,xspeed=0x0,yspeed=0x0,dispzoom=0x7ff913069d50,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.955       78.1
Field Avg  2.20                     70.7   0.955       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7ff913059640,layerfrac=0x7ff913059750,
 layerspeed=0x7ff9130596c8,layeralt=0x7ff913059530,winddir=0x7ff9130595b8,
 _layeralt=0x7ff91305ad80)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=10,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.02,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7ff91306a6f8,lgs_prof_alt=0x7ff913069b20,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7ff911869630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=32549.5,_skynphotons=101.871,_tt=[-0.00501896,
 0.00044622],_lastvalidtt=[-0.00501896,0.00044622],_upttcommand=[0,0],_refmes=
 0x7ff911875430,_tiprefv=0x7ff911863630,_tiltrefv=0x7ff911874430,_tiprefvn=
 0x7ff911876430,_tiltrefvn=0x7ff9118a4e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7ff911915c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1073ef030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7ff911915c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7ff9130bd230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7ff91306a378)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7ff91306a260,_ctrlden=0x7ff912046490,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7ff911513130,_xlast=0x7ff911551630,_ylast=[0x7ff91218dc30,
 0x7ff91218dc30,0x7ff91218dc30],_y0=0x7ff912061a30,_signus=0x7ff9115553e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10778d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7ff9115115c0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7ff91306a848,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7ff913069ab0,xposition=0x7ff91306a538,yposition=
 0x7ff912046420,xspeed=0x0,yspeed=0x0,dispzoom=0x7ff913069d50,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       74.2   0.741       96.1
Field Avg  2.20                     74.2   0.741       96.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7ff913059640,layerfrac=0x7ff913059750,
 layerspeed=0x7ff9130596c8,layeralt=0x7ff913059530,winddir=0x7ff9130595b8,
 _layeralt=0x7ff91305a7a8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=14,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.02,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7ff91306a6f8,lgs_prof_alt=0x7ff913069b20,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7ff911862e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=1635.21,_skynphotons=203.743,_tt=[-0.00270354,
 -0.010343],_lastvalidtt=[-0.00270354,-0.010343],_upttcommand=[0,0],_refmes=
 0x7ff9118b8430,_tiprefv=0x7ff912810230,_tiltrefv=0x7ff9121d1830,_tiprefvn=
 0x7ff91281f430,_tiltrefvn=0x7ff9121d3830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7ff91219f630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10380d030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7ff91219f630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7ff91185d430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7ff913069dc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7ff91306a730,_ctrlden=0x7ff91202a288,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7ff9115120c0,_xlast=0x7ff911513130,_ylast=[0x7ff912061a30,
 0x7ff912061a30,0x7ff912061a30],_y0=0x7ff9120a7030,_signus=0x7ff9115129a0,
 _puppixoffset=[0,0],_nact=80,_def=0x1044fc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7ff911551630,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7ff91306a848,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7ff913069ab0,xposition=0x7ff91306a340,yposition=
 0x7ff91306a458,xspeed=0x0,yspeed=0x0,dispzoom=0x7ff913069d50,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       82.1   0.472      150.1
Field Avg  2.20                     82.1   0.472      150.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7ff913059640,layerfrac=0x7ff913059750,
 layerspeed=0x7ff9130596c8,layeralt=0x7ff913059530,winddir=0x7ff9130595b8,
 _layeralt=0x7ff913059970)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=15,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.02,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7ff91306a6f8,lgs_prof_alt=0x7ff913069b20,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7ff91219e830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=650.986,_skynphotons=203.743,_tt=[-0.00278626,
 0.00272626],_lastvalidtt=[-0.00278626,0.00272626],_upttcommand=[0,0],_refmes=
 0x7ff912196a30,_tiprefv=0x7ff912828630,_tiltrefv=0x7ff911869630,_tiprefvn=
 0x7ff912810230,_tiltrefvn=0x7ff91186a630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7ff911882630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1073ef030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7ff911882630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7ff91219de30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7ff91306a378)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7ff9120462d0,_ctrlden=0x7ff91306a618,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7ff911412930,_xlast=0x7ff911412ab0,_ylast=[0x7ff91184fa30,
 0x7ff91184fa30,0x7ff91184fa30],_y0=0x7ff911813e30,_signus=0x7ff91141f920,
 _puppixoffset=[0,0],_nact=80,_def=0x10778d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7ff911513130,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7ff91306a848,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7ff913069ab0,xposition=0x7ff91306a110,yposition=
 0x7ff913069ca8,xspeed=0x0,yspeed=0x0,dispzoom=0x7ff913069d50,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
Pyramid w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 232 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0      114.1   0.225      198.2
Field Avg  2.20                    114.1   0.225      198.2
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_pyr-imav.fits
Some other graphics in sh16x16_pyr.ps

Original parameter file: sh16x16_pyr.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "Pyramid w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here about the wind speed in different layers
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 16;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=0.1031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="Pyramid w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7ff913059640,layerfrac=0x7ff913059750,
 layerspeed=0x7ff9130596c8,layeralt=0x7ff913059530,winddir=0x7ff9130595b8,
 _layeralt=0x7ff91305a3f0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=16,skymag=
 17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0.02,pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=
 "after",pyr_denom="subap",shmethod=0,shnxsub=16,npixpersub=11,pixsize=0,
 npixels=0,spotpitch=0,extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7ff91306a6f8,lgs_prof_alt=0x7ff913069b20,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7ff912827830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=232,_nsub4disp=0,_nmes=
 464,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=647.905,_skynphotons=509.357,_tt=[-0.0105308,
 0.00408101],_lastvalidtt=[-0.0105308,0.00408101],_upttcommand=[0,0],_refmes=
 0x7ff911874430,_tiprefv=0x7ff913090030,_tiltrefv=0x7ff91280fc30,_tiprefvn=
 0x7ff9130bf830,_tiltrefvn=0x7ff91281d230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7ff91187e630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1044b2030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7ff91187e630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7ff91185d430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7ff91306ad50)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_pyr-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7ff912046650,_ctrlden=0x7ff912046458,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_pyr-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7ff911417ea0,_xlast=0x7ff911412930,_ylast=[0x7ff911813e30,
 0x7ff911813e30,0x7ff911813e30],_y0=0x7ff911834430,_signus=0x7ff91141c200,
 _puppixoffset=[0,0],_nact=80,_def=0x108e86030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_pyr-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7ff9114121c0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7ff91306a848,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_pyr-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7ff913069ab0,xposition=0x7ff91306a5e0,yposition=
 0x7ff91306ae30,xspeed=0x0,yspeed=0x0,dispzoom=0x7ff913069d50,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
