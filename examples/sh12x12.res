=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.1964  0.1964  0.1964   6.28  6.28  6.28   32x32   32x32    176.8
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2376  0.0774  1.2376   2.48  2.48  2.48    2x 2    2x 2    174.3
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2376  0.0774  1.2376   2.48  2.48  2.48    2x 2    2x 2    174.3
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2376  0.0774  1.2376   2.48  2.48  2.48    2x 2    2x 2    174.3
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2376  0.0774  1.2376   2.48  2.48  2.48    2x 2    2x 2    174.3
 
Summary:
Mirror #1, stackarray, 45 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 112 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 42.4; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.483      221.3
Field Avg  1.65                     55.4   0.483      221.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 120; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 0;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 42.44;                    // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  how is r0 derived here…
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); //Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    //Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         //WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 10.;        //WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shmethod	   = 2;          //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 wfs(n).shnxsub	   = 12;         //# of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).pixsize     = 1.25;  //0.087;      //Focal plane: Subaperture CCD pixel size in arcsec ;arcsec
 wfs(n).npixels     = 36;         //Focal plane: Final # of pixels per subaperture; int
 wfs(n).noise       = 5;          //Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        //Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         //Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          //# of iterations over which to integrate before delivering slopes
 
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	        = "stackarray"; //Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 dm(n).iffile	    = “”;           //Influence function file name. Leave it alone.
 dm(n).nxact	        = 7;          //Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 dm(n).pitch	        = 20;            //Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 
 dm(n).alt           = 0.;           //Conjugation altitude, at zenith
 dm(n).unitpervolt   = 0.01;         //Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: arcsec/Volt.
 dm(n).push4imat     = 100;          //Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      //Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            //iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           //Telescope diameter, in meters, float
 //tel.cobs	       = 0.1125;        //Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     //Image wavelengths in micron -H band
 target.xposition   = &([0.]);       //“Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.6;           //Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          //Total number of iterations
 loop.ittime	       = 2e-3;          //Iteration time (sampling time)
 loop.startskip     = 10;            //Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         //In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         //See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 120,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=256,_cent=128.5)
 atm_struct(dr0at05mic=42.44,screen=0x7fcaa191a220,layerfrac=0x7fcaa191a198,
 layerspeed=0x7fcaa191a110,layeralt=0x7fcaa191a088,winddir=0x7fcaa1919a28,
 _layeralt=0x7fcaa19195e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=0,pixsize=1.23762,npixels=2,
 spotpitch=2,extfield=2.47525,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.47525,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fcaa0834dc0,lgs_prof_alt=
 0x7fcaa085f0d8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fcaa06436e0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fcaa044af40,_origpixsize=1.25,_rebinfactor=16,_gsalt=0,_gsdepth=
 0,_nsub=112,_nsub4disp=132,_nmes=224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x1084fc030,_masks=0x0,_fluxpersub=0x7fcaa0449f80,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fcaa0440640,_skyfluxpersub=
 0x7fcaa0440890,_nphotons=174.277,_skynphotons=0,_tt=[-0.0166962,0.00464636],
 _lastvalidtt=[-0.0166962,0.00464636],_upttcommand=[0,0],_refmes=0x7fcaa0643080,
 _tiprefv=0x7fcaa1017030,_tiltrefv=0x7fcaa19a8430,_tiprefvn=0x7fcaa1015630,
 _tiltrefvn=0x7fcaa19a8c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=32,
 _nx4fft=32,_istart=0x7fcaa044b190,_jstart=0x7fcaa0449d30,_binindices=
 0x7fcaa198b230,_binxy=2,_centroidw=0x7fcaa085f650,_fimage=0x7fcaa08dde30,
 _fimage2=0x0,_imistart=0x7fcaa063f880,_imjstart=0x7fcaa0642100,_imistart2=
 0x7fcaa0642350,_imjstart2=0x7fcaa06425a0,_unittip=0x7fcaa043b8c0,_unittilt=
 0x7fcaa0439c80,_lgs_defocuses=0x7fcaa085f340,_unitdefocus=0x108053030,_fimnx=
 24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7fcaa08b9a30,_flat=
 0x7fcaa08e0630,_domask=1,_submask=0x7fcaa08ab830,_kernel=0x7fcaa19a3430,
 _kernels=0x10843e030,_kerfftr=0x11515b030,_kerffti=0x1150d6030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fcaa0861630,_x=0x7fcaa08de830,_y=0x7fcaa08dee30,
 _centroidgain=1,_rayleigh=0x7fcaa085f880,_bckgrdcalib=0x7fcaa0911e30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fcaa083e7d8)]
 [dm_struct(type="stackarray",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=20,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fcaa085f5e0,_ctrlden=0x7fcaa0838750,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=7,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=0,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=1e-05,
 regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fcaa196b488,_xlast=0x7fcaa196bfe0,_ylast=[0x7fcaa063eee0,
 0x7fcaa063eee0,0x7fcaa063eee0],_y0=0x7fcaa063dcc0,_signus=0x7fcaa0641f50,
 _puppixoffset=[0,0],_nact=45,_def=0x10c495030,_x=0x7fcaa196b8a8,_y=
 0x7fcaa196bab8,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,_indval=0x7fcaa043ba90,
 _indext=0x7fcaa0845ac0,_eiffile="sh12x12-if1-ext.fits",_edef=0x115055030,_ex=
 0x7fcaa085f500,_ey=0x7fcaa083e810,_enact=4,_n1=60,_n2=197,_pupil=0x0,_command=
 0x7fcaa196b698,_flat_command=0x0,_extrapcmat=0x7fcaa2021430,_eltdefsize=0,
 _regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fcaa083e068,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0,tipvib_white_rms=0,tipvib_1overf_rms=0,tipvib_peaks=
 0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=0,
 tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fcaa085f810,xposition=0x7fcaa083e6c0,yposition=
 0x7fcaa085f0a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fcaa085edc0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.2321  0.0774  0.2321   2.48  0.93  0.93    4x 4    4x 4    174.3
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.2321  0.0774  0.2321   2.48  0.93  0.93    4x 4    4x 4    174.3
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.2321  0.0774  0.2321   2.48  0.93  0.93    4x 4    4x 4    174.3
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.2321  0.0774  0.2321   2.48  0.93  0.93    4x 4    4x 4    174.3
 
Summary:
Mirror #1, stackarray, 4 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 112 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 42.4; 5000 iterations
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.1238  0.1238  0.1238   0.50  0.50  0.50    4x 4    4x 4    165.3
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.1238  0.1238  0.1238   0.50  0.50  0.50    4x 4    4x 4    165.3
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.2475  0.1238  0.2475   0.50  0.50  0.50    2x 2    2x 2    169.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.2475  0.1238  0.2475   0.50  0.50  0.50    2x 2    2x 2    169.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.2475  0.1238  0.2475   0.50  0.50  0.50    2x 2    2x 2    169.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.003      628.3
Field Avg  1.65                   1418.0   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 10.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.30;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*15)*206265 = 1.55 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 4;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      //Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            //iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           //Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        //Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     //Image wavelengths in micron -H band
 target.xposition   = &([0.]);       //“Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.6;           //Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          //Total number of iterations
 loop.ittime	       = 2e-3;          //Iteration time (sampling time)
 loop.startskip     = 10;            //Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         //In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         //See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051888,layerfrac=0x7fedfd051910,
 layerspeed=0x7fedfd051a20,layeralt=0x7fedfc84d878,winddir=0x7fedfc84da10,
 _layeralt=0x7fedfd051c40)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.247525,npixels=2,
 spotpitch=2,extfield=0.495049,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.495049,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866b10,lgs_prof_alt=
 0x7fedfc866718,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbf0c3d0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbe3d970,_origpixsize=0.3,_rebinfactor=2,_gsalt=0,_gsdepth=0,
 _nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x7fedfc1e9830,_masks=0x0,_fluxpersub=0x7fedfbe3f1a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fedfbe3f3f0,_skyfluxpersub=0x7fedfbe3f640,
 _nphotons=169.492,_skynphotons=0,_tt=[-0.0308126,0.0645887],_lastvalidtt=
 [-0.0308126,0.0645887],_upttcommand=[0,0],_refmes=0x7fedfbd0aaf0,_tiprefv=
 0x7fedfd881e30,_tiltrefv=0x7fedfd87f430,_tiprefvn=0x7fedfd883230,_tiltrefvn=
 0x7fedfd883a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=4,_nx=4,_nx4fft=4,
 _istart=0x7fedfbe42720,_jstart=0x7fedfbe45900,_binindices=0x7fedfd050de8,
 _binxy=2,_centroidw=0x7fedfc867168,_fimage=0x7fedfc88a030,_fimage2=0x0,
 _imistart=0x7fedfbc376d0,_imjstart=0x7fedfbc37bb0,_imistart2=0x7fedfbc37e00,
 _imjstart2=0x7fedfbc38050,_unittip=0x7fedfc866f38,_unittilt=0x7fedfc866e20,
 _lgs_defocuses=0x7fedfc846248,_unitdefocus=0x7fedfd0d5e30,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fedfc053830,_flat=0x7fedfc211230,_domask=1,
 _submask=0x7fedfc84ded8,_kernel=0x7fedfc84dba8,_kernels=0x7fedfc20f030,
 _kerfftr=0x7fedfc133430,_kerffti=0x7fedfc14e830,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fedfc881830,_x=0x7fedfd099630,_y=0x7fedfd0bc230,_centroidgain=1,
 _rayleigh=0x7fedfc867130,_bckgrdcalib=0x7fedfc211c30,_bckgrdinit=0,_bckgrdsub=
 1,_meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc866c98)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc845fe0,_ctrlden=0x7fedfc845b10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc36a60,_xlast=0x7fedfbc361c0,_ylast=[0x7fedfc073c30,0x7fedfc073c30,
 0x7fedfc073c30],_y0=0x7fedfc04e430,_signus=0x7fedfbc385f0,_puppixoffset=[0,0],
 _nact=80,_def=0x101d4f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbc37920,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866670,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc845f38,xposition=0x7fedfc8460f8,yposition=
 0x7fedfc866d40,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc866d08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.1238  0.1238  0.1238   0.50  0.25  0.25    2x 2    2x 2    169.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1394.6   0.003      628.3
Field Avg  1.65                   1394.6   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 10.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.0972;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      //Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            //iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           //Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        //Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     //Image wavelengths in micron -H band
 target.xposition   = &([0.]);       //“Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.6;           //Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          //Total number of iterations
 loop.ittime	       = 2e-3;          //Iteration time (sampling time)
 loop.startskip     = 10;            //Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         //In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         //See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051910,layerfrac=0x7fedfd051a20,
 layerspeed=0x7fedfd051888,layeralt=0x7fedfc84dba8,winddir=0x7fedfc84ded8,
 _layeralt=0x7fedfd051c40)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.123762,npixels=2,
 spotpitch=2,extfield=0.247525,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.247525,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866670,lgs_prof_alt=
 0x7fedfc866d40,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbe48150,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbe3f9e0,_origpixsize=0.0972,_rebinfactor=1,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x7fedfc15aa30,_masks=0x0,_fluxpersub=0x7fedfbc36ee0,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbe47910,_skyfluxpersub=
 0x7fedfbe47b60,_nphotons=169.492,_skynphotons=0,_tt=[-3.05361e-08,
 -3.05361e-08],_lastvalidtt=[-3.05361e-08,-3.05361e-08],_upttcommand=[0,0],
 _refmes=0x7fedfbc384f0,_tiprefv=0x7fedfc04e030,_tiltrefv=0x7fedfc1e6430,
 _tiprefvn=0x7fedfc1ed030,_tiltrefvn=0x7fedfc170430,_reordervec=0x0,_npixels=2,
 _npb=0,_sdim=4,_nx=2,_nx4fft=2,_istart=0x7fedfbe3ff70,_jstart=0x7fedfbe401c0,
 _binindices=0x7fedfc866718,_binxy=2,_centroidw=0x7fedfc866bf0,_fimage=
 0x7fedfd076e30,_fimage2=0x0,_imistart=0x7fedfbc39c50,_imjstart=0x7fedfbc354a0,
 _imistart2=0x7fedfbc36a40,_imjstart2=0x7fedfbc36c90,_unittip=0x7fedfc83c830,
 _unittilt=0x7fedfc8670c0,_lgs_defocuses=0x7fedfc866ec8,_unitdefocus=
 0x7fedfd0dd830,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=
 0x7fedfd0b3c30,_flat=0x7fedfd0b3230,_domask=1,_submask=0x7fedfc867248,_kernel=
 0x7fedfc867050,_kernels=0x7fedfc053830,_kerfftr=0x7fedfc04d630,_kerffti=
 0x7fedfc04cc30,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfd077830,_x=
 0x7fedfd0bcc30,_y=0x7fedfd0a2030,_centroidgain=1,_rayleigh=0x7fedfc866cd0,
 _bckgrdcalib=0x7fedfd0c3e30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc866c28)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc845f00,_ctrlden=0x7fedfc866aa0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc35320,_xlast=0x7fedfbc38890,_ylast=[0x7fedfc154630,0x7fedfc154630,
 0x7fedfc154630],_y0=0x7fedfc135a30,_signus=0x7fedfbc35760,_puppixoffset=[0,0],
 _nact=80,_def=0x101d4f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbc37130,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866b10,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc845b10,xposition=0x7fedfc846248,yposition=
 0x7fedfc866e20,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc867168,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.1238  0.1238  0.1238   0.50  0.25  0.25    2x 2    2x 2    169.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1406.5   0.003      628.3
Field Avg  1.65                   1406.5   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 10.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.0972;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      //Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            //iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           //Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        //Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     //Image wavelengths in micron -H band
 target.xposition   = &([0.]);       //“Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.2;           //Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          //Total number of iterations
 loop.ittime	       = 2e-3;          //Iteration time (sampling time)
 loop.startskip     = 10;            //Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         //In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         //See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051a20,layerfrac=0x7fedfd051888,
 layerspeed=0x7fedfd051910,layeralt=0x7fedfc84da10,winddir=0x7fedfc84d878,
 _layeralt=0x7fedfd051c40)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.123762,npixels=2,
 spotpitch=2,extfield=0.247525,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.247525,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866670,lgs_prof_alt=
 0x7fedfc845f00,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbe48720,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbd097f0,_origpixsize=0.0972,_rebinfactor=1,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x7fedfd833a30,_masks=0x0,_fluxpersub=0x7fedfbe48970,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbe48bc0,_skyfluxpersub=
 0x7fedfbe48e10,_nphotons=169.492,_skynphotons=0,_tt=[-3.05361e-08,
 -3.05361e-08],_lastvalidtt=[-3.05361e-08,-3.05361e-08],_upttcommand=[0,0],
 _refmes=0x7fedfbd062f0,_tiprefv=0x7fedfd839a30,_tiltrefv=0x7fedfd829430,
 _tiprefvn=0x7fedfd83a230,_tiltrefvn=0x7fedfd839030,_reordervec=0x0,_npixels=2,
 _npb=0,_sdim=4,_nx=2,_nx4fft=2,_istart=0x7fedfbd09a40,_jstart=0x7fedfbd09c90,
 _binindices=0x7fedfc83c830,_binxy=2,_centroidw=0x7fedfc866fa8,_fimage=
 0x7fedfd0fa230,_fimage2=0x0,_imistart=0x7fedfbd0a840,_imjstart=0x7fedfbd0aa90,
 _imistart2=0x7fedfbd0ace0,_imjstart2=0x7fedfbd0af30,_unittip=0x7fedfc867130,
 _unittilt=0x7fedfc867018,_lgs_defocuses=0x7fedfc8671d8,_unitdefocus=
 0x7fedfc14e830,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=
 0x7fedfd099630,_flat=0x7fedfd0b2c30,_domask=1,_submask=0x7fedfc866c98,_kernel=
 0x7fedfc866750,_kernels=0x7fedfd838630,_kerfftr=0x7fedfd837c30,_kerffti=
 0x7fedfd82b830,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfd0dbc30,_x=
 0x7fedfd829c30,_y=0x7fedfd82a230,_centroidgain=1,_rayleigh=0x7fedfc866db0,
 _bckgrdcalib=0x7fedfd0dc630,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc866f38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc840230,_ctrlden=0x7fedfc866a68,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc361c0,_xlast=0x7fedfbc2e630,_ylast=[0x7fedfc036430,0x7fedfc036430,
 0x7fedfc036430],_y0=0x7fedfc073c30,_signus=0x7fedfbc2cd90,_puppixoffset=[0,0],
 _nact=80,_def=0x101d4f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbc352c0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866bf0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc866718,xposition=0x7fedfc867050,yposition=
 0x7fedfc867248,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc8670c0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.1238  0.1238  0.1238   0.50  0.25  0.25    2x 2    2x 2    169.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1349.3   0.004      628.3
Field Avg  1.65                   1349.3   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 10.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.0972;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      //Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            //iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           //Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        //Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     //Image wavelengths in micron -H band
 target.xposition   = &([0.]);       //“Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.05;           //Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          //Total number of iterations
 loop.ittime	       = 2e-3;          //Iteration time (sampling time)
 loop.startskip     = 10;            //Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         //In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         //See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051888,layerfrac=0x7fedfd051910,
 layerspeed=0x7fedfd051a20,layeralt=0x7fedfc84ded8,winddir=0x7fedfc84dba8,
 _layeralt=0x7fedfd051c40)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.123762,npixels=2,
 spotpitch=2,extfield=0.247525,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.247525,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866670,lgs_prof_alt=
 0x7fedfc840230,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbe49a80,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbc36410,_origpixsize=0.0972,_rebinfactor=1,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x7fedfd0d8430,_masks=0x0,_fluxpersub=0x7fedfbc2e590,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbc36c90,_skyfluxpersub=
 0x7fedfbc372c0,_nphotons=169.492,_skynphotons=0,_tt=[-3.05361e-08,
 -3.05361e-08],_lastvalidtt=[-3.05361e-08,-3.05361e-08],_upttcommand=[0,0],
 _refmes=0x7fedfbe47cb0,_tiprefv=0x7fedfd0c7230,_tiltrefv=0x7fedfd0dc830,
 _tiprefvn=0x7fedfd0fa230,_tiltrefvn=0x7fedfd0d7c30,_reordervec=0x0,_npixels=2,
 _npb=0,_sdim=4,_nx=2,_nx4fft=2,_istart=0x7fedfbc2cd90,_jstart=0x7fedfbc36a40,
 _binindices=0x7fedfc867130,_binxy=2,_centroidw=0x7fedfc846168,_fimage=
 0x7fedfc04cc30,_fimage2=0x0,_imistart=0x7fedfbe48970,_imjstart=0x7fedfbe495e0,
 _imistart2=0x7fedfbe49830,_imjstart2=0x7fedfbe4a3f0,_unittip=0x7fedfc866cd0,
 _unittilt=0x7fedfc845fe0,_lgs_defocuses=0x7fedfc867210,_unitdefocus=
 0x7fedfc179c30,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=
 0x7fedfc04dc30,_flat=0x7fedfd0c5c30,_domask=1,_submask=0x7fedfc866c28,_kernel=
 0x7fedfc845b10,_kernels=0x7fedfd0c3e30,_kerfftr=0x7fedfd0fec30,_kerffti=
 0x7fedfd0c4830,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfc1e5630,_x=
 0x7fedfc04b430,_y=0x7fedfc057030,_centroidgain=1,_rayleigh=0x7fedfc845b48,
 _bckgrdcalib=0x7fedfd0c5230,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc866d40)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc8671d8,_ctrlden=0x7fedfc866f70,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbe40300,_xlast=0x7fedfbe3f720,_ylast=[0x7fedfd0b4e30,0x7fedfd0b4e30,
 0x7fedfd0b4e30],_y0=0x7fedfd0b5e30,_signus=0x7fedfbe48050,_puppixoffset=[0,0],
 _nact=80,_def=0x101d4f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbf144b0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866fa8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc83c830,xposition=0x7fedfc866750,yposition=
 0x7fedfc866c98,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc867018,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.05,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.1238  0.1238  0.1238   0.50  0.25  0.25    2x 2    2x 2    169.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1417.1   0.003      628.3
Field Avg  1.65                   1417.1   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 10.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.0972;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      //Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            //iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           //Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        //Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     //Image wavelengths in micron -H band
 target.xposition   = &([0.]);       //“Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 1.0;           //Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          //Total number of iterations
 loop.ittime	       = 2e-3;          //Iteration time (sampling time)
 loop.startskip     = 10;            //Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         //In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         //See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051910,layerfrac=0x7fedfd051a20,
 layerspeed=0x7fedfd051888,layeralt=0x7fedfc84d878,winddir=0x7fedfc84da10,
 _layeralt=0x7fedfd051c40)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.123762,npixels=2,
 spotpitch=2,extfield=0.247525,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.247525,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866670,lgs_prof_alt=
 0x7fedfc8671d8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbc37360,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbc38080,_origpixsize=0.0972,_rebinfactor=1,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x7fedfd0fec30,_masks=0x0,_fluxpersub=0x7fedfbc35760,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbc38670,_skyfluxpersub=
 0x7fedfbc388c0,_nphotons=169.492,_skynphotons=0,_tt=[-3.05361e-08,
 -3.05361e-08],_lastvalidtt=[-3.05361e-08,-3.05361e-08],_upttcommand=[0,0],
 _refmes=0x7fedfbd0a1b0,_tiprefv=0x7fedfd835830,_tiltrefv=0x7fedfd82ee30,
 _tiprefvn=0x7fedfd836030,_tiltrefvn=0x7fedfd84fe30,_reordervec=0x0,_npixels=2,
 _npb=0,_sdim=4,_nx=2,_nx4fft=2,_istart=0x7fedfbc352c0,_jstart=0x7fedfbc35510,
 _binindices=0x7fedfc866cd0,_binxy=2,_centroidw=0x7fedfc8667c0,_fimage=
 0x7fedfd0c3e30,_fimage2=0x0,_imistart=0x7fedfbe40180,_imjstart=0x7fedfbe47b60,
 _imistart2=0x7fedfbe47db0,_imjstart2=0x7fedfbe48000,_unittip=0x7fedfc866db0,
 _unittilt=0x7fedfc866aa0,_lgs_defocuses=0x7fedfc83c7c0,_unitdefocus=
 0x7fedfc164c30,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=
 0x7fedfc04dc30,_flat=0x7fedfc04d230,_domask=1,_submask=0x7fedfc866f38,_kernel=
 0x7fedfc866718,_kernels=0x7fedfd0c4830,_kerfftr=0x7fedfd0b2c30,_kerffti=
 0x7fedfd0c5230,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfd0e0a30,_x=
 0x7fedfc049830,_y=0x7fedfc04fa30,_centroidgain=1,_rayleigh=0x7fedfc866f00,
 _bckgrdcalib=0x7fedfc1d6830,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc866ad8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc866830,_ctrlden=0x7fedfc866b48,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbe45be0,_xlast=0x7fedfbe3f720,_ylast=[0x7fedfd103430,0x7fedfd103430,
 0x7fedfd103430],_y0=0x7fedfd0e1630,_signus=0x7fedfbe3fa20,_puppixoffset=[0,0],
 _nact=80,_def=0x101d4f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbe3f8a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc846168,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc867130,xposition=0x7fedfc845b10,yposition=
 0x7fedfc866c28,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc845fe0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,ittime=
 0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.1238  0.1238  0.1238   0.50  0.25  0.25    2x 2    2x 2    169.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.003      628.3
Field Avg  1.65                   1418.0   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 10.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.0972;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      //Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            //iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           //Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        //Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     //Image wavelengths in micron -H band
 target.xposition   = &([0.]);       //“Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 2.0;           //Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          //Total number of iterations
 loop.ittime	       = 2e-3;          //Iteration time (sampling time)
 loop.startskip     = 10;            //Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         //In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         //See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051a20,layerfrac=0x7fedfd051888,
 layerspeed=0x7fedfd051910,layeralt=0x7fedfc84dba8,winddir=0x7fedfc84ded8,
 _layeralt=0x7fedfd051c40)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.123762,npixels=2,
 spotpitch=2,extfield=0.247525,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.247525,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866670,lgs_prof_alt=
 0x7fedfc866830,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbc39530,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbe47910,_origpixsize=0.0972,_rebinfactor=1,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x7fedfc16ba30,_masks=0x0,_fluxpersub=0x7fedfbe3f970,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbe480a0,_skyfluxpersub=
 0x7fedfbe3f720,_nphotons=169.492,_skynphotons=0,_tt=[-3.05361e-08,
 -3.05361e-08],_lastvalidtt=[-3.05361e-08,-3.05361e-08],_upttcommand=[0,0],
 _refmes=0x7fedfbe3ff60,_tiprefv=0x7fedfd0c5230,_tiltrefv=0x7fedfd0fa030,
 _tiprefvn=0x7fedfd077830,_tiltrefvn=0x7fedfd129230,_reordervec=0x0,_npixels=2,
 _npb=0,_sdim=4,_nx=2,_nx4fft=2,_istart=0x7fedfbe47e50,_jstart=0x7fedfbe48380,
 _binindices=0x7fedfc866db0,_binxy=2,_centroidw=0x7fedfc866d08,_fimage=
 0x7fedfc133030,_fimage2=0x0,_imistart=0x7fedfbc398b0,_imjstart=0x7fedfbc36e30,
 _imistart2=0x7fedfbc37080,_imjstart2=0x7fedfbc372d0,_unittip=0x7fedfc845b48,
 _unittilt=0x7fedfc845f00,_lgs_defocuses=0x7fedfc8672f0,_unitdefocus=
 0x7fedfd11c830,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=
 0x7fedfd099630,_flat=0x7fedfc156c30,_domask=1,_submask=0x7fedfc866d40,_kernel=
 0x7fedfc83c830,_kernels=0x7fedfc133a30,_kerfftr=0x7fedfc1e5630,_kerffti=
 0x7fedfc134430,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfc15f230,_x=
 0x7fedfd0bcc30,_y=0x7fedfd129a30,_centroidgain=1,_rayleigh=0x7fedfc866de8,
 _bckgrdcalib=0x7fedfc134e30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc840230)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc8671d8,_ctrlden=0x7fedfc845a68,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc361c0,_xlast=0x7fedfbc36cb0,_ylast=[0x7fedfc1e6030,0x7fedfc1e6030,
 0x7fedfc1e6030],_y0=0x7fedfc16fc30,_signus=0x7fedfbc38d10,_puppixoffset=[0,0],
 _nact=80,_def=0x101d4f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbc36a40,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc8667c0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc866cd0,xposition=0x7fedfc866718,yposition=
 0x7fedfc866f38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc866aa0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=2,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,ittime=
 0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.1238  0.1238  0.1238   0.50  0.25  0.25    2x 2    2x 2    169.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.1238  0.1238  0.1238   0.50  0.25  0.25    2x 2    2x 2    16949.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.003      628.3
Field Avg  1.65                   1418.0   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.0972;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.9;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051888,layerfrac=0x7fedfd051910,
 layerspeed=0x7fedfd051a20,layeralt=0x7fedfc84da10,winddir=0x7fedfc84d878,
 _layeralt=0x7fedfc84d768)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.123762,npixels=2,
 spotpitch=2,extfield=0.247525,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.247525,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866670,lgs_prof_alt=
 0x7fedfc8671d8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbc37430,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbc352c0,_origpixsize=0.0972,_rebinfactor=1,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x7fedfd17e030,_masks=0x0,_fluxpersub=0x7fedfbc35840,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbc33210,_skyfluxpersub=
 0x7fedfbc41680,_nphotons=16949.2,_skynphotons=0,_tt=[-7.47223e-09,
 -2.93147e-08],_lastvalidtt=[-7.47223e-09,-2.93147e-08],_upttcommand=[0,0],
 _refmes=0x7fedfbf14c40,_tiprefv=0x7fedfc887e30,_tiltrefv=0x7fedfc843030,
 _tiprefvn=0x7fedfc889c30,_tiltrefvn=0x7fedfc88ae30,_reordervec=0x0,_npixels=2,
 _npb=0,_sdim=4,_nx=2,_nx4fft=2,_istart=0x7fedfbc2e590,_jstart=0x7fedfbc36410,
 _binindices=0x7fedfc8667f8,_binxy=2,_centroidw=0x7fedfc866a68,_fimage=
 0x7fedfc11cc30,_fimage2=0x0,_imistart=0x7fedfbe49550,_imjstart=0x7fedfbe3fd60,
 _imistart2=0x7fedfbe3ffb0,_imjstart2=0x7fedfbe48550,_unittip=0x7fedfc8672b8,
 _unittilt=0x7fedfc8666a8,_lgs_defocuses=0x7fedfc866c60,_unitdefocus=
 0x7fedfc179c30,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=
 0x7fedfc051a30,_flat=0x7fedfd0c5230,_domask=1,_submask=0x7fedfc866ad8,_kernel=
 0x7fedfc866b80,_kernels=0x7fedfd0da630,_kerfftr=0x7fedfd0ea630,_kerffti=
 0x7fedfd0c3e30,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfc04de30,_x=
 0x7fedfc049830,_y=0x7fedfc170830,_centroidgain=1,_rayleigh=0x7fedfc845fe0,
 _bckgrdcalib=0x7fedfd0c4830,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc845f38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc866f70,_ctrlden=0x7fedfc866d78,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbe45be0,_xlast=0x7fedfbe40260,_ylast=[0x7fedfd0eb030,0x7fedfd0eb030,
 0x7fedfd0eb030],_y0=0x7fedfd0e1630,_signus=0x7fedfbe3f920,_puppixoffset=[0,0],
 _nact=80,_def=0x101d4f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbe48220,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866f00,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc845f00,xposition=0x7fedfc8670f8,yposition=
 0x7fedfc866db0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc8672f0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.003      628.3
Field Avg  1.65                   1418.0   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.0972;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.9;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051888,layerfrac=0x7fedfd051910,
 layerspeed=0x7fedfd051a20,layeralt=0x7fedfc84da10,winddir=0x7fedfc84d878,
 _layeralt=0x7fedfc84d768)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.123762,npixels=2,
 spotpitch=2,extfield=0.247525,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.247525,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866670,lgs_prof_alt=
 0x7fedfc8671d8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbe3fcc0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbc37ec0,_origpixsize=0.0972,_rebinfactor=1,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x7fedfd82ec30,_masks=0x0,_fluxpersub=0x7fedfbd08b70,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbd062f0,_skyfluxpersub=
 0x7fedfbd06540,_nphotons=16949.2,_skynphotons=0,_tt=[-7.47223e-09,
 -2.93147e-08],_lastvalidtt=[-7.47223e-09,-2.93147e-08],_upttcommand=[0,0],
 _refmes=0x7fedfbf14c40,_tiprefv=0x7fedfc887e30,_tiltrefv=0x7fedfc843030,
 _tiprefvn=0x7fedfc889c30,_tiltrefvn=0x7fedfc88ae30,_reordervec=0x0,_npixels=2,
 _npb=0,_sdim=4,_nx=2,_nx4fft=2,_istart=0x7fedfbc352c0,_jstart=0x7fedfbc2e590,
 _binindices=0x7fedfc8666a8,_binxy=2,_centroidw=0x7fedfc8671a0,_fimage=
 0x7fedfd0bc230,_fimage2=0x0,_imistart=0x7fedfbc38360,_imjstart=0x7fedfbc385b0,
 _imistart2=0x7fedfbc38800,_imjstart2=0x7fedfbc38a50,_unittip=0x7fedfc846168,
 _unittilt=0x7fedfc866c60,_lgs_defocuses=0x7fedfc846130,_unitdefocus=
 0x7fedfc8eca30,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=
 0x7fedfc04cc30,_flat=0x7fedfd838830,_domask=1,_submask=0x7fedfc866b80,_kernel=
 0x7fedfc866b48,_kernels=0x7fedfd833830,_kerfftr=0x7fedfd832e30,_kerffti=
 0x7fedfd834230,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfd0ea630,_x=
 0x7fedfc052430,_y=0x7fedfc052a30,_centroidgain=1,_rayleigh=0x7fedfc8667f8,
 _bckgrdcalib=0x7fedfd835230,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc845f38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc866b10,_ctrlden=0x7fedfc8670c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc361c0,_xlast=0x7fedfbc36f30,_ylast=[0x7fedfc0ff430,0x7fedfc0ff430,
 0x7fedfc0ff430],_y0=0x7fedfc1e4a30,_signus=0x7fedfbc418d0,_puppixoffset=[0,0],
 _nact=80,_def=0x101d4f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbc370b0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866f00,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc845f00,xposition=0x7fedfc8670f8,yposition=
 0x7fedfc866db0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc8672f0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.1238  0.1238  0.1238   0.50  0.25  0.25    2x 2    2x 2    16949.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.1238  0.1238  0.1238   0.50  0.25  0.25    2x 2    2x 2    16949.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.003      628.3
Field Avg  1.65                   1418.0   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.0972;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.9;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051a20,layerfrac=0x7fedfd051888,
 layerspeed=0x7fedfd051910,layeralt=0x7fedfc84d878,winddir=0x7fedfc84da10,
 _layeralt=0x7fedfc84d768)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.123762,npixels=2,
 spotpitch=2,extfield=0.247525,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.247525,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866670,lgs_prof_alt=
 0x7fedfc866c60,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbc3b620,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbe48850,_origpixsize=0.0972,_rebinfactor=1,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x7fedfc1f9030,_masks=0x0,_fluxpersub=0x7fedfbe45900,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbe480e0,_skyfluxpersub=
 0x7fedfbe47910,_nphotons=16949.2,_skynphotons=0,_tt=[-7.47223e-09,
 -2.93147e-08],_lastvalidtt=[-7.47223e-09,-2.93147e-08],_upttcommand=[0,0],
 _refmes=0x7fedfbf0deb0,_tiprefv=0x7fedfc887e30,_tiltrefv=0x7fedfc898030,
 _tiprefvn=0x7fedfc843030,_tiltrefvn=0x7fedfc88a830,_reordervec=0x0,_npixels=2,
 _npb=0,_sdim=4,_nx=2,_nx4fft=2,_istart=0x7fedfbe3d970,_jstart=0x7fedfbe42720,
 _binindices=0x7fedfc845a68,_binxy=2,_centroidw=0x7fedfc866aa0,_fimage=
 0x7fedfc11ec30,_fimage2=0x0,_imistart=0x7fedfbc36ee0,_imjstart=0x7fedfbc37130,
 _imistart2=0x7fedfbc37380,_imjstart2=0x7fedfbc375d0,_unittip=0x7fedfc8667f8,
 _unittilt=0x7fedfc866e90,_lgs_defocuses=0x7fedfc866fa8,_unitdefocus=
 0x7fedfd0d9630,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=
 0x7fedfd077a30,_flat=0x7fedfd829430,_domask=1,_submask=0x7fedfc846248,_kernel=
 0x7fedfc845f00,_kernels=0x7fedfc1e1a30,_kerfftr=0x7fedfc12ee30,_kerffti=
 0x7fedfc1e2430,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfc11fa30,_x=
 0x7fedfd09b230,_y=0x7fedfd076e30,_centroidgain=1,_rayleigh=0x7fedfc8670f8,
 _bckgrdcalib=0x7fedfd828a30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc867210)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc8667c0,_ctrlden=0x7fedfc867050,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc39e70,_xlast=0x7fedfbc39ff0,_ylast=[0x7fedfc16fc30,0x7fedfc16fc30,
 0x7fedfc16fc30],_y0=0x7fedfc1e6030,_signus=0x7fedfbc3a170,_puppixoffset=[0,0],
 _nact=80,_def=0x101d4f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbc3a950,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866e20,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc845fa8,xposition=0x7fedfc846210,yposition=
 0x7fedfc866de8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc846168,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.2475  0.1238  0.2475   0.50  0.50  0.50    2x 2    2x 2    16949.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.002      628.3
Field Avg  1.65                   1418.0   0.002      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.19;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.9;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051888,layerfrac=0x7fedfd051910,
 layerspeed=0x7fedfd051a20,layeralt=0x7fedfc84dba8,winddir=0x7fedfc84ded8,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.247525,npixels=2,
 spotpitch=2,extfield=0.495049,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.495049,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866670,lgs_prof_alt=
 0x7fedfc8667c0,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbc37fd0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbc36a60,_origpixsize=0.19,_rebinfactor=2,_gsalt=0,_gsdepth=0,
 _nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x7fedfd137830,_masks=0x0,_fluxpersub=0x7fedfbc3a0f0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fedfbc3a340,_skyfluxpersub=0x7fedfbc38300,
 _nphotons=16949.2,_skynphotons=0,_tt=[0.0272035,0.0341552],_lastvalidtt=
 [0.0272035,0.0341552],_upttcommand=[0,0],_refmes=0x7fedfbc35780,_tiprefv=
 0x7fedfc170830,_tiltrefv=0x7fedfc15f430,_tiprefvn=0x7fedfc04cc30,_tiltrefvn=
 0x7fedfc1e5630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=4,_nx=4,_nx4fft=4,
 _istart=0x7fedfbc39c50,_jstart=0x7fedfbc39ea0,_binindices=0x7fedfc84e428,
 _binxy=2,_centroidw=0x7fedfc845fe0,_fimage=0x7fedfc053430,_fimage2=0x0,
 _imistart=0x7fedfbe48820,_imjstart=0x7fedfbe48a70,_imistart2=0x7fedfbe48cc0,
 _imjstart2=0x7fedfbe48f10,_unittip=0x7fedfc866718,_unittilt=0x7fedfc8665c8,
 _lgs_defocuses=0x7fedfc8671d8,_unitdefocus=0x7fedfc118a30,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fedfd0c6030,_flat=0x7fedfd0c6a30,_domask=1,
 _submask=0x7fedfc84dd40,_kernel=0x7fedfc84e868,_kernels=0x7fedfd0d5630,
 _kerfftr=0x7fedfd0c3e30,_kerffti=0x7fedfd11f430,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fedfc120a30,_x=0x7fedfc04b430,_y=0x7fedfc049830,_centroidgain=1,
 _rayleigh=0x7fedfc867398,_bckgrdcalib=0x7fedfd121630,_bckgrdinit=0,_bckgrdsub=
 1,_meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc8401c0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc866fa8,_ctrlden=0x7fedfc8670f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbe4b520,_xlast=0x7fedfbe47b60,_ylast=[0x7fedfd04d830,0x7fedfd04d830,
 0x7fedfd04d830],_y0=0x7fedfd0bce30,_signus=0x7fedfbe48190,_puppixoffset=[0,0],
 _nact=80,_def=0x101d4f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbe485d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866aa0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc845a68,xposition=0x7fedfc845f00,yposition=
 0x7fedfc846248,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc866e90,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.1238  0.1238  0.1238   0.50  0.25  0.25    2x 2    2x 2    16949.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.003      628.3
Field Avg  1.65                   1418.0   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.1;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.6;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051910,layerfrac=0x7fedfd051a20,
 layerspeed=0x7fedfd051888,layeralt=0x7fedfc84e868,winddir=0x7fedfc84dd40,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.123762,npixels=2,
 spotpitch=2,extfield=0.247525,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.247525,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866aa0,lgs_prof_alt=
 0x7fedfc846248,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbf0d6f0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbc36410,_origpixsize=0.1,_rebinfactor=1,_gsalt=0,_gsdepth=0,
 _nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x7fedfd0f4030,_masks=0x0,_fluxpersub=0x7fedfbc38850,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fedfbc38d60,_skyfluxpersub=0x7fedfbc37830,
 _nphotons=16949.2,_skynphotons=0,_tt=[-7.47223e-09,-2.93147e-08],_lastvalidtt=
 [-7.47223e-09,-2.93147e-08],_upttcommand=[0,0],_refmes=0x7fedfbd06d80,_tiprefv=
 0x7fedfd833c30,_tiltrefv=0x7fedfd83d430,_tiprefvn=0x7fedfd82cc30,_tiltrefvn=
 0x7fedfd82de30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=4,_nx=2,_nx4fft=2,
 _istart=0x7fedfbc380d0,_jstart=0x7fedfbc35780,_binindices=0x7fedfc8667c0,
 _binxy=2,_centroidw=0x7fedfc8671a0,_fimage=0x7fedfd107630,_fimage2=0x0,
 _imistart=0x7fedfbe4ba10,_imjstart=0x7fedfbe4bc60,_imistart2=0x7fedfbe4beb0,
 _imjstart2=0x7fedfbe4c100,_unittip=0x7fedfc867328,_unittilt=0x7fedfc866f00,
 _lgs_defocuses=0x7fedfc83c7c0,_unitdefocus=0x7fedfc118a30,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fedfc1d6e30,_flat=0x7fedfd0c4830,_domask=1,
 _submask=0x7fedfc866c98,_kernel=0x7fedfc845fa8,_kernels=0x7fedfd0f8230,
 _kerfftr=0x7fedfd076e30,_kerffti=0x7fedfd0c3e30,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fedfd0bc230,_x=0x7fedfc04b430,_y=0x7fedfc124c30,_centroidgain=1,
 _rayleigh=0x7fedfc866bf0,_bckgrdcalib=0x7fedfd0c5230,_bckgrdinit=0,_bckgrdsub=
 1,_meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc866c60)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc846130,_ctrlden=0x7fedfc867280,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbe482d0,_xlast=0x7fedfbe45330,_ylast=[0x7fedfd0b4230,0x7fedfd0b4230,
 0x7fedfd0b4230],_y0=0x7fedfd04d830,_signus=0x7fedfbe45900,_puppixoffset=[0,0],
 _nact=80,_def=0x101d4f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbe4cba0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866670,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc8670f8,xposition=0x7fedfc8671d8,yposition=
 0x7fedfc8665c8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc845fe0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.2475  0.1238  0.2475   0.50  0.50  0.50    2x 2    2x 2    16949.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.002      628.3
Field Avg  1.65                   1418.0   0.002      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.194;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.6;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051a20,layerfrac=0x7fedfd051888,
 layerspeed=0x7fedfd051910,layeralt=0x7fedfc84ded8,winddir=0x7fedfc84dba8,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.247525,npixels=2,
 spotpitch=2,extfield=0.495049,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.495049,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866aa0,lgs_prof_alt=
 0x7fedfc846130,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbc2e590,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbe4c040,_origpixsize=0.194,_rebinfactor=2,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x7fedfc179c30,_masks=0x0,_fluxpersub=0x7fedfbe4d400,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbe4d650,_skyfluxpersub=
 0x7fedfbe4ba10,_nphotons=16949.2,_skynphotons=0,_tt=[-0.0616249,0.0424649],
 _lastvalidtt=[-0.0616249,0.0424649],_upttcommand=[0,0],_refmes=0x7fedfbc37ae0,
 _tiprefv=0x7fedfc052230,_tiltrefv=0x7fedfc15f430,_tiprefvn=0x7fedfc052a30,
 _tiltrefvn=0x7fedfc1e5630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=4,_nx=4,
 _nx4fft=4,_istart=0x7fedfbe4c5c0,_jstart=0x7fedfbe4d1b0,_binindices=
 0x7fedfc84df60,_binxy=2,_centroidw=0x7fedfc8461d8,_fimage=0x7fedfc15ea30,
 _fimage2=0x0,_imistart=0x7fedfbc37150,_imjstart=0x7fedfbc373a0,_imistart2=
 0x7fedfbc375f0,_imjstart2=0x7fedfbc37840,_unittip=0x7fedfc867398,_unittilt=
 0x7fedfc866d40,_lgs_defocuses=0x7fedfc866cd0,_unitdefocus=0x7fedfd0e6430,
 _fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7fedfc1d7c30,_flat=
 0x7fedfc12c030,_domask=1,_submask=0x7fedfc84e428,_kernel=0x7fedfc84da98,
 _kernels=0x7fedfc129e30,_kerfftr=0x7fedfc16dc30,_kerffti=0x7fedfc16ba30,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfc12d430,_x=0x7fedfd0ea630,_y=
 0x7fedfd099630,_centroidgain=1,_rayleigh=0x7fedfc866ec8,_bckgrdcalib=
 0x7fedfc12ca30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7fedfc866718)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc846248,_ctrlden=0x7fedfc867130,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc352e0,_xlast=0x7fedfbc35780,_ylast=[0x7fedfc0ff430,0x7fedfc0ff430,
 0x7fedfc0ff430],_y0=0x7fedfc036430,_signus=0x7fedfbc38fb0,_puppixoffset=[0,0],
 _nact=80,_def=0x101d4f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbe45b80,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc8671a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc8667c0,xposition=0x7fedfc845fa8,yposition=
 0x7fedfc866c98,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc866f00,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.2475  0.1238  0.2475   0.50  0.50  0.50    2x 2    2x 2    16949.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.002      628.3
Field Avg  1.65                   1418.0   0.002      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.194;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.1;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051888,layerfrac=0x7fedfd051910,
 layerspeed=0x7fedfd051a20,layeralt=0x7fedfc84da98,winddir=0x7fedfc84e428,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.247525,npixels=2,
 spotpitch=2,extfield=0.495049,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.495049,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc8671a0,lgs_prof_alt=
 0x7fedfc866c98,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbe4c9c0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbc391b0,_origpixsize=0.194,_rebinfactor=2,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x7fedfd824830,_masks=0x0,_fluxpersub=0x7fedfbe45290,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbe4ba10,_skyfluxpersub=
 0x7fedfbe4bc60,_nphotons=16949.2,_skynphotons=0,_tt=[-0.0235358,-0.0330653],
 _lastvalidtt=[-0.0235358,-0.0330653],_upttcommand=[0,0],_refmes=0x7fedfbd094c0,
 _tiprefv=0x7fedfc15f230,_tiltrefv=0x7fedfc15ea30,_tiprefvn=0x7fedfc120a30,
 _tiltrefvn=0x7fedfc052230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=4,_nx=4,
 _nx4fft=4,_istart=0x7fedfbc38990,_jstart=0x7fedfbc37e30,_binindices=
 0x7fedfc84e290,_binxy=2,_centroidw=0x7fedfc866bb8,_fimage=0x7fedfd0db630,
 _fimage2=0x0,_imistart=0x7fedfbd09d00,_imjstart=0x7fedfbd09f50,_imistart2=
 0x7fedfbd0a1a0,_imjstart2=0x7fedfbd0a3f0,_unittip=0x7fedfc866bf0,_unittilt=
 0x7fedfc866e20,_lgs_defocuses=0x7fedfc866c28,_unitdefocus=0x7fedfc164c30,
 _fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7fedfc052a30,_flat=
 0x7fedfc1d7a30,_domask=1,_submask=0x7fedfc84e758,_kernel=0x7fedfc84dd40,
 _kernels=0x7fedfd833c30,_kerfftr=0x7fedfd82a630,_kerffti=0x7fedfd870230,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfd0b3a30,_x=0x7fedfc04b430,_y=
 0x7fedfc057030,_centroidgain=1,_rayleigh=0x7fedfc8670f8,_bckgrdcalib=
 0x7fedfc053430,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7fedfc840230)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc867398,_ctrlden=0x7fedfc8460f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbe4b520,_xlast=0x7fedfbe45110,_ylast=[0x7fedfd04d830,0x7fedfd04d830,
 0x7fedfd04d830],_y0=0x7fedfd0b4e30,_signus=0x7fedfbe45900,_puppixoffset=[0,0],
 _nact=80,_def=0x101d4f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbf0cbe0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866aa0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc867130,xposition=0x7fedfc866cd0,yposition=
 0x7fedfc866d40,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc8461d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.2475  0.1238  0.2475   0.50  0.50  0.50    2x 2    2x 2    16949.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.002      628.3
Field Avg  1.65                   1418.0   0.002      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.194;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.1;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051a20,layerfrac=0x7fedfd051888,
 layerspeed=0x7fedfd051910,layeralt=0x7fedfc84df60,winddir=0x7fedfc84d6e0,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.247525,npixels=2,
 spotpitch=2,extfield=0.495049,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.495049,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866de8,lgs_prof_alt=
 0x7fedfc866d78,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbc39c50,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbc2e590,_origpixsize=0.194,_rebinfactor=2,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x7fedfd128830,_masks=0x0,_fluxpersub=0x7fedfbc36410,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbc38110,_skyfluxpersub=
 0x7fedfbc38360,_nphotons=16949.2,_skynphotons=0,_tt=[-0.0235358,-0.0330653],
 _lastvalidtt=[-0.0235358,-0.0330653],_upttcommand=[0,0],_refmes=0x7fedfbc37990,
 _tiprefv=0x7fedfc1d7630,_tiltrefv=0x7fedfc1d6e30,_tiprefvn=0x7fedfc1d7e30,
 _tiltrefvn=0x7fedfc04d630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=4,_nx=4,
 _nx4fft=4,_istart=0x7fedfbc36a40,_jstart=0x7fedfbc37350,_binindices=
 0x7fedfc84e5c0,_binxy=2,_centroidw=0x7fedfc867398,_fimage=0x7fedfc052c30,
 _fimage2=0x0,_imistart=0x7fedfbe4cbd0,_imjstart=0x7fedfbe4ce20,_imistart2=
 0x7fedfbe4d070,_imjstart2=0x7fedfbe4d2c0,_unittip=0x7fedfc8670f8,_unittilt=
 0x7fedfc866830,_lgs_defocuses=0x7fedfc8667f8,_unitdefocus=0x7fedfc164c30,
 _fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7fedfd0bc830,_flat=
 0x7fedfd0b3a30,_domask=1,_submask=0x7fedfd051228,_kernel=0x7fedfc84d7f0,
 _kernels=0x7fedfd0cd230,_kerfftr=0x7fedfd0d0230,_kerffti=0x7fedfd0df830,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfc04cc30,_x=0x7fedfc049830,_y=
 0x7fedfc124c30,_centroidgain=1,_rayleigh=0x7fedfc866f38,_bckgrdcalib=
 0x7fedfd0cf430,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7fedfc845fe0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc866aa0,_ctrlden=0x7fedfc866fa8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbe45330,_xlast=0x7fedfbe4b500,_ylast=[0x7fedfd0eb030,0x7fedfd0eb030,
 0x7fedfd0eb030],_y0=0x7fedfd0d3830,_signus=0x7fedfbe4c140,_puppixoffset=[0,0],
 _nact=80,_def=0x101f84030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbc352c0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866b48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc866c28,xposition=0x7fedfc8401c0,yposition=
 0x7fedfc866d40,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc83c7c0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.2475  0.1238  0.2475   0.50  0.50  0.50    2x 2    2x 2    16949.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.002      628.3
Field Avg  1.65                   1418.0   0.002      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.194;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 6;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.1;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 5000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051910,layerfrac=0x7fedfd051a20,
 layerspeed=0x7fedfd051888,layeralt=0x7fedfc84dba8,winddir=0x7fedfc84e538,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.247525,npixels=2,
 spotpitch=2,extfield=0.495049,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.495049,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc845f00,lgs_prof_alt=
 0x7fedfc8670c0,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbc3b220,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbe42720,_origpixsize=0.194,_rebinfactor=2,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x7fedfc1cb030,_masks=0x0,_fluxpersub=0x7fedfbe4bc60,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbe45110,_skyfluxpersub=
 0x7fedfbe4beb0,_nphotons=16949.2,_skynphotons=0,_tt=[-0.0235358,-0.0330653],
 _lastvalidtt=[-0.0235358,-0.0330653],_upttcommand=[0,0],_refmes=0x7fedfbf0d670,
 _tiprefv=0x7fedfc890e30,_tiltrefv=0x7fedfc890630,_tiprefvn=0x7fedfc880430,
 _tiltrefvn=0x7fedfc887c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=4,_nx=4,
 _nx4fft=4,_istart=0x7fedfbe45900,_jstart=0x7fedfbe4ba10,_binindices=
 0x7fedfc84ddc8,_binxy=2,_centroidw=0x7fedfc840230,_fimage=0x7fedfc1d1e30,
 _fimage2=0x0,_imistart=0x7fedfbc3bbe0,_imjstart=0x7fedfbc3be30,_imistart2=
 0x7fedfbc3c080,_imjstart2=0x7fedfbc3c2d0,_unittip=0x7fedfc866f38,_unittilt=
 0x7fedfc867280,_lgs_defocuses=0x7fedfc866de8,_unitdefocus=0x7fedfd0d8e30,
 _fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7fedfd077830,_flat=
 0x7fedfc1e3c30,_domask=1,_submask=0x7fedfc84db20,_kernel=0x7fedfc84d988,
 _kernels=0x7fedfc1cf230,_kerfftr=0x7fedfc1e1a30,_kerffti=0x7fedfc164c30,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfc1d2830,_x=0x7fedfd0eae30,_y=
 0x7fedfd099c30,_centroidgain=1,_rayleigh=0x7fedfc83c830,_bckgrdcalib=
 0x7fedfc1d1430,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7fedfc8671a0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc866ec8,_ctrlden=0x7fedfc866bb8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc3aa00,_xlast=0x7fedfbc3ab80,_ylast=[0x7fedfc053e30,0x7fedfc053e30,
 0x7fedfc053e30],_y0=0x7fedfc1efe30,_signus=0x7fedfbc3b550,_puppixoffset=[0,0],
 _nact=80,_def=0x101dd0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbe45b50,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc867050,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc866b80,xposition=0x7fedfc866750,yposition=
 0x7fedfc866d40,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc867130,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.1856  0.0928  0.1856   1.49  0.37  0.37    2x 2    2x 2    17526.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.1856  0.0928  0.1856   1.49  0.37  0.37    2x 2    2x 2    17526.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     4247.1   0.000     1885.0
Field Avg  1.65                   4247.1   0.000     1885.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 72; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 6;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.194;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.1;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 1000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 72,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=256,_cent=128.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051910,layerfrac=0x7fedfd051a20,
 layerspeed=0x7fedfd051888,layeralt=0x7fedfc84e208,winddir=0x7fedfc84e0f8,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=6,pixsize=0.185644,npixels=2,
 spotpitch=2,extfield=0.371287,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.371287,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc867050,lgs_prof_alt=
 0x7fedfc866bb8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbc3be70,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbe4cb50,_origpixsize=0.194,_rebinfactor=2,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x102107030,_masks=0x0,_fluxpersub=0x7fedfbe45110,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbe4d760,_skyfluxpersub=
 0x7fedfbe4d9b0,_nphotons=17526.8,_skynphotons=0,_tt=[-1.14815e-09,
 -1.30857e-08],_lastvalidtt=[-1.14815e-09,-1.30857e-08],_upttcommand=[0,0],
 _refmes=0x7fedfbd094c0,_tiprefv=0x7fedfd099630,_tiltrefv=0x7fedfd831430,
 _tiprefvn=0x7fedfd099e30,_tiltrefvn=0x7fedfd831c30,_reordervec=0x0,_npixels=2,
 _npb=0,_sdim=16,_nx=4,_nx4fft=4,_istart=0x7fedfbe4c300,_jstart=0x7fedfbe4d0d0,
 _binindices=0x7fedfc84d7f0,_binxy=2,_centroidw=0x7fedfc866c28,_fimage=
 0x7fedfc167030,_fimage2=0x0,_imistart=0x7fedfbc3b010,_imjstart=0x7fedfbc3b260,
 _imistart2=0x7fedfbc3b4b0,_imjstart2=0x7fedfbc3b700,_unittip=0x7fedfd084328,
 _unittilt=0x7fedfd084118,_lgs_defocuses=0x7fedfd0e9220,_unitdefocus=
 0x101ed1030,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7fedfd0e0230,
 _flat=0x7fedfd0bc830,_domask=1,_submask=0x7fedfc84e4b0,_kernel=0x7fedfc84dc30,
 _kernels=0x7fedfc16dc30,_kerfftr=0x7fedfc16ba30,_kerffti=0x7fedfc131430,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfc04cc30,_x=0x7fedfd0e9e30,_y=
 0x7fedfd0b2c30,_centroidgain=1,_rayleigh=0x7fedfc866aa0,_bckgrdcalib=
 0x7fedfd0e0c30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7fedfc8671a0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc8672b8,_ctrlden=0x7fedfc8666a8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc350b0,_xlast=0x7fedfbc35270,_ylast=[0x7fedfc0ff430,0x7fedfc0ff430,
 0x7fedfc0ff430],_y0=0x7fedfc0db030,_signus=0x7fedfbc36410,_puppixoffset=[0,0],
 _nact=80,_def=0x105eca030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=84,_n2=173,_pupil=0x0,_command=0x7fedfbc3b950,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc845f00,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc866de8,xposition=0x7fedfc866db0,yposition=
 0x7fedfc866ec8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc866e20,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.2475  0.1238  0.2475   0.50  0.50  0.50    2x 2    2x 2    16949.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.003      628.3
Field Avg  1.65                   1418.0   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.194;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.1;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 1000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051888,layerfrac=0x7fedfd051910,
 layerspeed=0x7fedfd051a20,layeralt=0x7fedfc84e0f8,winddir=0x7fedfc84e208,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.247525,npixels=2,
 spotpitch=2,extfield=0.495049,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.495049,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc845b48,lgs_prof_alt=
 0x7fedfc867130,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbd0a350,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbf14ab0,_origpixsize=0.194,_rebinfactor=2,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x7fedfc19e830,_masks=0x0,_fluxpersub=0x7fedfbe45110,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbe4d120,_skyfluxpersub=
 0x7fedfbe4c3c0,_nphotons=16949.2,_skynphotons=0,_tt=[0.00505972,-0.0170479],
 _lastvalidtt=[0.00505972,-0.0170479],_upttcommand=[0,0],_refmes=0x7fedfbe45900,
 _tiprefv=0x7fedfd0b2c30,_tiltrefv=0x7fedfd0e8630,_tiprefvn=0x7fedfd0f7430,
 _tiltrefvn=0x7fedfd0c6a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=4,_nx=4,
 _nx4fft=4,_istart=0x7fedfbf14d00,_jstart=0x7fedfbf14f50,_binindices=
 0x7fedfd051c40,_binxy=2,_centroidw=0x7fedfc8671d8,_fimage=0x7fedfd827630,
 _fimage2=0x0,_imistart=0x7fedfbc3aba0,_imjstart=0x7fedfbc3adf0,_imistart2=
 0x7fedfbc3b040,_imjstart2=0x7fedfbc3b290,_unittip=0x7fedfc866aa0,_unittilt=
 0x7fedfc846210,_lgs_defocuses=0x7fedfc867600,_unitdefocus=0x7fedfc88c430,
 _fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7fedfd0b3430,_flat=
 0x7fedfc134030,_domask=1,_submask=0x7fedfd051998,_kernel=0x7fedfc84e648,
 _kernels=0x7fedfc131e30,_kerfftr=0x7fedfc165c30,_kerffti=0x7fedfc129c30,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfd828030,_x=0x7fedfc82c630,_y=
 0x7fedfc890630,_centroidgain=1,_rayleigh=0x7fedfc867280,_bckgrdcalib=
 0x7fedfc15ea30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7fedfc8670f8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc8672b8,_ctrlden=0x7fedfc8672f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbe42720,_xlast=0x7fedfbe428a0,_ylast=[0x7fedfd0b4e30,0x7fedfd0b4e30,
 0x7fedfd0b4e30],_y0=0x7fedfd04d830,_signus=0x7fedfbe4cce0,_puppixoffset=[0,0],
 _nact=80,_def=0x102695030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbc3a950,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfd0e9220,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc845f00,xposition=0x7fedfc866de8,yposition=
 0x7fedfc866ec8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc867050,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.2475  0.1238  0.2475   0.50  0.50  0.50    2x 2    2x 2    16949.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.003      628.3
Field Avg  1.65                   1418.0   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.194;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.1;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 1000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051a20,layerfrac=0x7fedfd051888,
 layerspeed=0x7fedfd051910,layeralt=0x7fedfc84dc30,winddir=0x7fedfc84d5d0,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.247525,npixels=2,
 spotpitch=2,extfield=0.495049,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.495049,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866b10,lgs_prof_alt=
 0x7fedfc866e20,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbe45900,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbc35780,_origpixsize=0.194,_rebinfactor=2,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x7fedfd127e30,_masks=0x0,_fluxpersub=0x7fedfbc3a0f0,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbc3a990,_skyfluxpersub=
 0x7fedfbc3abe0,_nphotons=16949.2,_skynphotons=0,_tt=[0.00505972,-0.0170479],
 _lastvalidtt=[0.00505972,-0.0170479],_upttcommand=[0,0],_refmes=0x7fedfbc3b8c0,
 _tiprefv=0x7fedfc120a30,_tiltrefv=0x7fedfc053630,_tiprefvn=0x7fedfc121230,
 _tiltrefvn=0x7fedfc12f430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=4,_nx=4,
 _nx4fft=4,_istart=0x7fedfbc39c50,_jstart=0x7fedfbc39ea0,_binindices=
 0x7fedfc84e538,_binxy=2,_centroidw=0x7fedfc867520,_fimage=0x7fedfd0f7430,
 _fimage2=0x0,_imistart=0x7fedfbe4ca90,_imjstart=0x7fedfbe4cce0,_imistart2=
 0x7fedfbe4da80,_imjstart2=0x7fedfbe4dcd0,_unittip=0x7fedfc867280,_unittilt=
 0x7fedfc8673d0,_lgs_defocuses=0x7fedfc8670c0,_unitdefocus=0x7fedfc129e30,
 _fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7fedfc052230,_flat=
 0x7fedfd0b2c30,_domask=1,_submask=0x7fedfc84e868,_kernel=0x7fedfc84e0f8,
 _kernels=0x7fedfd0c3e30,_kerfftr=0x7fedfd0e6430,_kerffti=0x7fedfd0dae30,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfd0f7e30,_x=0x7fedfc16fa30,_y=
 0x7fedfc04b430,_centroidgain=1,_rayleigh=0x7fedfc867360,_bckgrdcalib=
 0x7fedfd0c6030,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7fedfc8671a0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc866ad8,_ctrlden=0x7fedfc845a68,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbe4b5a0,_xlast=0x7fedfbe45360,_ylast=[0x7fedfd0b4e30,0x7fedfd0b4e30,
 0x7fedfd0b4e30],_y0=0x7fedfd04d830,_signus=0x7fedfbe4d500,_puppixoffset=[0,0],
 _nact=80,_def=0x101f84030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbe4cf30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc867600,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc8672f0,xposition=0x7fedfc866ec8,yposition=
 0x7fedfd0e9220,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc8671d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.6704  0.6704  0.6704   2.68  1.34  1.34    2x 2    2x 2    17648.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 100 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     7680.8   0.000     3403.5
Field Avg  1.65                   7680.8   0.000     3403.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 130; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.194;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.1;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 1000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 130,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051888,layerfrac=0x7fedfd051910,
 layerspeed=0x7fedfd051a20,layeralt=0x7fedfc84e0f8,winddir=0x7fedfc84e868,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.670379,npixels=2,
 spotpitch=2,extfield=1.34076,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=1.34076,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc867600,lgs_prof_alt=
 0x7fedfd0e9220,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbc3ad50,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbe4bdd0,_origpixsize=0.194,_rebinfactor=1,_gsalt=0,_gsdepth=
 0,_nsub=100,_nsub4disp=112,_nmes=200,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x1021e8030,_masks=0x0,_fluxpersub=0x7fedfbc3cbd0,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbf14ab0,_skyfluxpersub=
 0x7fedfbf15070,_nphotons=17648.3,_skynphotons=0,_tt=[0.000586054,-0.00130357],
 _lastvalidtt=[0.000586054,-0.00130357],_upttcommand=[0,0],_refmes=
 0x7fedfbe4cf90,_tiprefv=0x7fedfc884630,_tiltrefv=0x7fedfc880c30,_tiprefvn=
 0x7fedfc884e30,_tiltrefvn=0x7fedfc880230,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=4,_nx=2,_nx4fft=2,_istart=0x7fedfbe4b500,_jstart=0x7fedfbe4c230,
 _binindices=0x7fedfc866e20,_binxy=2,_centroidw=0x7fedfc866830,_fimage=
 0x7fedfc04d430,_fimage2=0x0,_imistart=0x7fedfbc3ba50,_imjstart=0x7fedfbc3c210,
 _imistart2=0x7fedfbc3c410,_imjstart2=0x7fedfbc3c610,_unittip=0x7fedfc866b80,
 _unittilt=0x7fedfc867018,_lgs_defocuses=0x7fedfc8401c0,_unitdefocus=
 0x108e25030,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7fedfc881e30,
 _flat=0x7fedfc82c630,_domask=1,_submask=0x7fedfc866bf0,_kernel=0x7fedfc866de8,
 _kernels=0x7fedfc052a30,_kerfftr=0x7fedfc052230,_kerffti=0x7fedfc053230,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfc1f6c30,_x=0x7fedfbe4f780,_y=
 0x7fedfbe4fb40,_centroidgain=1,_rayleigh=0x7fedfd0e9300,_bckgrdcalib=
 0x7fedfc883c30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7fedfc845b48)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc866ad8,_ctrlden=0x7fedfc840150,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc35330,_xlast=0x7fedfbc3b5e0,_ylast=[0x7fedfc1e6030,0x7fedfc1e6030,
 0x7fedfc1e6030],_y0=0x7fedfc135230,_signus=0x7fedfbc39c50,_puppixoffset=[0,0],
 _nact=80,_def=0x106b65030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=183,_n2=330,_pupil=0x0,_command=0x7fedfbf15270,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866b10,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc845a68,xposition=0x7fedfc8670c0,yposition=
 0x7fedfc8673d0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc867520,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.7426  0.7426  0.7426   2.97  1.49  1.49    2x 2    2x 2    17655.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 92 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 1000 iterations
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      0.2475  0.1238  0.2475   0.50  0.50  0.50    2x 2    2x 2    16949.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.003      628.3
Field Avg  1.65                   1418.0   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 2;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 0.194;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 dm(n).iffile	    = “”; 
 dm(n).nxact	        = 20; 
 dm(n).pitch	        = 1; 
 dm(n).nzer          = 80;
 dm(n).alt           = 0.;
 dm(n).unitpervolt   = 0.01; 
 dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.0985;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.1;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 1000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051a20,layerfrac=0x7fedfd051888,
 layerspeed=0x7fedfd051910,layeralt=0x7fedfc84e868,winddir=0x7fedfc84e0f8,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=2,pixsize=0.247525,npixels=2,
 spotpitch=2,extfield=0.495049,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=0.495049,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc867600,lgs_prof_alt=
 0x7fedfc867018,nzer=0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fedfbe47b60,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fedfbe47910,_origpixsize=0.194,_rebinfactor=2,_gsalt=0,_gsdepth=
 0,_nsub=108,_nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=
 0x0,_tiltsh=0x7fedfc1d0030,_masks=0x0,_fluxpersub=0x7fedfbe4bc60,_rayleighflux=
 0x0,_sodiumflux=0x0,_raylfluxpersub=0x7fedfbe4beb0,_skyfluxpersub=
 0x7fedfbe4c100,_nphotons=16949.2,_skynphotons=0,_tt=[0.00505972,-0.0170479],
 _lastvalidtt=[0.00505972,-0.0170479],_upttcommand=[0,0],_refmes=0x7fedfbe47f00,
 _tiprefv=0x7fedfd081230,_tiltrefv=0x7fedfd0e9e30,_tiprefvn=0x7fedfd0f7430,
 _tiltrefvn=0x7fedfd0b3630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=4,_nx=4,
 _nx4fft=4,_istart=0x7fedfbe45900,_jstart=0x7fedfbe4ba10,_binindices=
 0x7fedfd051778,_binxy=2,_centroidw=0x7fedfc867398,_fimage=0x7fedfd0efe30,
 _fimage2=0x0,_imistart=0x7fedfbc3aa00,_imjstart=0x7fedfbc39e50,_imistart2=
 0x7fedfbc3a0a0,_imjstart2=0x7fedfbc350b0,_unittip=0x7fedfd0e9300,_unittilt=
 0x7fedfc866c28,_lgs_defocuses=0x7fedfd0e9370,_unitdefocus=0x7fedfd0da430,
 _fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7fedfc04de30,_flat=
 0x7fedfc053630,_domask=1,_submask=0x7fedfc84d900,_kernel=0x7fedfc84e4b0,
 _kernels=0x7fedfc132030,_kerfftr=0x7fedfc1e1a30,_kerffti=0x7fedfc164c30,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfd0de630,_x=0x7fedfd0e8830,_y=
 0x7fedfd0eae30,_centroidgain=1,_rayleigh=0x7fedfc845a68,_bckgrdcalib=
 0x7fedfc1e3c30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7fedfc866bb8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=1,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc866ad8,_ctrlden=0x7fedfc866b10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc35320,_xlast=0x7fedfbc2e590,_ylast=[0x7fedfc065a30,0x7fedfc065a30,
 0x7fedfc065a30],_y0=0x7fedfc1e6030,_signus=0x7fedfbc36410,_puppixoffset=[0,0],
 _nact=80,_def=0x101d7d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=12,_n2=53,_pupil=0x0,_command=0x7fedfbe45b50,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866d78,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.0985,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc845f38,xposition=0x7fedfc8671a0,yposition=
 0x7fedfc867750,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc866b80,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    17648.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 1), 108 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       61.9   0.218      307.4
Field Avg  1.65                     61.9   0.218      307.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;//24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 1;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 11;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 1.2;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 wfs(n).fssize      = 2.4;
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 //dm(n).iffile	    = “”; 
 //dm(n).nxact	        = 20; 
 dm(n).pitch	        = 7; //miss some actuators...
 dm(n).nzer          = 80;
 //dm(n).alt           = 0.;
 //dm(n).unitpervolt   = 0.01; 
 //dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.1;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)64/6.5
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.1;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 1000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051888,layerfrac=0x7fedfd051910,
 layerspeed=0x7fedfd051a20,layeralt=0x7fedfc84e4b0,winddir=0x7fedfc84d900,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=1,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866d78,lgs_prof_alt=0x7fedfc867750,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=1,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fedfbe48030,
 _origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=108,_nsub4disp=108,
 _nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x101f84030,
 _masks=0x0,_fluxpersub=0x7fedfbc2e590,_rayleighflux=0x0,_sodiumflux=0x0,
 _raylfluxpersub=0x7fedfbc36410,_skyfluxpersub=0x7fedfbc35450,_nphotons=17648.8,
 _skynphotons=0,_tt=[0.012628,0.00365407],_lastvalidtt=[0.012628,0.00365407],
 _upttcommand=[0,0],_refmes=0x7fedfbc350b0,_tiprefv=0x7fedfc880c30,_tiltrefv=
 0x7fedfd0d5a30,_tiprefvn=0x7fedfc883c30,_tiltrefvn=0x7fedfd081230,_reordervec=
 0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,_istart=0x7fedfbe49fb0,
 _jstart=0x7fedfbe4a1a0,_binindices=0x7fedfd0e3c30,_binxy=2,_centroidw=
 0x7fedfc867718,_fimage=0x7fedfd0c7030,_fimage2=0x0,_imistart=0x7fedfbe48650,
 _imjstart=0x7fedfbe4a580,_imistart2=0x7fedfbe4a770,_imjstart2=0x7fedfbe4a960,
 _unittip=0x7fedfbe47bd0,_unittilt=0x7fedfbe47e00,_lgs_defocuses=0x7fedfc840150,
 _unitdefocus=0x107fff030,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=
 0x7fedfd077830,_flat=0x7fedfd076e30,_domask=1,_submask=0x7fedfc17ce30,_kernel=
 0x7fedfc87fa30,_kernels=0x102352030,_kerfftr=0x1020d8030,_kerffti=0x102085030,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfd0b3630,_x=0x7fedfbe49130,_y=
 0x7fedfbe494d0,_centroidgain=1,_rayleigh=0x7fedfd0e9220,_bckgrdcalib=
 0x7fedfd0dfc30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7fedfc8667c0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc8670f8,_ctrlden=0x7fedfc8676e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbe45b10,_xlast=0x7fedfbe42720,_ylast=[0x7fedfd0b5e30,0x7fedfd0b5e30,
 0x7fedfd0b5e30],_y0=0x7fedfd0f0830,_signus=0x7fedfbe47910,_puppixoffset=[0,0],
 _nact=80,_def=0x107921030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fedfbc361c0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc845a68,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc867600,xposition=0x7fedfd0e9370,yposition=
 0x7fedfc866c28,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc867398,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    17648.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 1), 108 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.8   0.567      128.4
Field Avg  1.65                     54.8   0.567      128.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;//24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 1;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 11;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 1.2;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 wfs(n).fssize      = 2.4;
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 //dm(n).iffile	    = “”; 
 //dm(n).nxact	        = 20; 
 dm(n).pitch	        = 7; //miss some actuators...
 dm(n).nzer          = 80;
 //dm(n).alt           = 0.;
 //dm(n).unitpervolt   = 0.01; 
 //dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.1;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)64/6.5
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.5;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 1000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051910,layerfrac=0x7fedfd051a20,
 layerspeed=0x7fedfd051888,layeralt=0x7fedfc84e0f8,winddir=0x7fedfc84e868,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=1,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866c28,lgs_prof_alt=0x7fedfc867600,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=1,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fedfbe42720,
 _origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=108,_nsub4disp=108,
 _nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x102615030,
 _masks=0x0,_fluxpersub=0x7fedfbf0e0d0,_rayleighflux=0x0,_sodiumflux=0x0,
 _raylfluxpersub=0x7fedfbf0e2c0,_skyfluxpersub=0x7fedfbf0e850,_nphotons=17648.8,
 _skynphotons=0,_tt=[0.00206884,-0.000326474],_lastvalidtt=[0.00206884,
 -0.000326474],_upttcommand=[0,0],_refmes=0x7fedfbc3a000,_tiprefv=
 0x7fedfc17ae30,_tiltrefv=0x7fedfc17a630,_tiprefvn=0x7fedfc17b630,_tiltrefvn=
 0x7fedfc165c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fedfbe49dd0,_jstart=0x7fedfbe49fc0,_binindices=0x7fedfd0bc230,
 _binxy=2,_centroidw=0x7fedfc866d40,_fimage=0x7fedfd0c7030,_fimage2=0x0,
 _imistart=0x7fedfbe48470,_imjstart=0x7fedfbe4a3a0,_imistart2=0x7fedfbe4a590,
 _imjstart2=0x7fedfbe4a780,_unittip=0x7fedfbe47ef0,_unittilt=0x7fedfbe3d970,
 _lgs_defocuses=0x7fedfc866ad8,_unitdefocus=0x106562030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fedfc881e30,_flat=0x7fedfc82c630,_domask=1,
 _submask=0x7fedfc883c30,_kernel=0x7fedfd0ec630,_kernels=0x102271030,_kerfftr=
 0x1020d8030,_kerffti=0x102085030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fedfd0ebc30,_x=0x7fedfbe48f50,_y=0x7fedfbe492f0,_centroidgain=1,_rayleigh=
 0x7fedfc867018,_bckgrdcalib=0x7fedfc87fa30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc866bf0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc867750,_ctrlden=0x7fedfc866b10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc361c0,_xlast=0x7fedfbc33400,_ylast=[0x7fedfc121a30,0x7fedfc121a30,
 0x7fedfc121a30],_y0=0x7fedfc214e30,_signus=0x7fedfbc36410,_puppixoffset=[0,0],
 _nact=80,_def=0x106c66030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fedfbe4a1b0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfd0e9220,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc8670f8,xposition=0x7fedfc840150,yposition=
 0x7fedfc867718,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc866d78,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    17648.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 1), 108 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.1   0.567      128.4
Field Avg  1.65                     55.1   0.567      128.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;//24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 1;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 11;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 1.2;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 wfs(n).fssize      = 2.4;
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 //dm(n).iffile	    = “”; 
 //dm(n).nxact	        = 20; 
 dm(n).pitch	        = 7; //miss some actuators...
 dm(n).nzer          = 80;
 //dm(n).alt           = 0.;
 //dm(n).unitpervolt   = 0.01; 
 //dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.1;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)64/6.5
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.8;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 1000;          // Total number of iterations
 loop.ittime	       = 2e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051a20,layerfrac=0x7fedfd051888,
 layerspeed=0x7fedfd051910,layeralt=0x7fedfc84d900,winddir=0x7fedfc84e4b0,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=1,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc867718,lgs_prof_alt=0x7fedfc8670f8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=1,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fedfbc33210,
 _origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=108,_nsub4disp=108,
 _nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x1029f1030,
 _masks=0x0,_fluxpersub=0x7fedfbe3e040,_rayleighflux=0x0,_sodiumflux=0x0,
 _raylfluxpersub=0x7fedfbe3e230,_skyfluxpersub=0x7fedfbe3e7c0,_nphotons=17648.8,
 _skynphotons=0,_tt=[0.000519597,0.000189446],_lastvalidtt=[0.000519597,
 0.000189446],_upttcommand=[0,0],_refmes=0x7fedfbe48470,_tiprefv=0x7fedfc885a30,
 _tiltrefv=0x7fedfd0c5630,_tiprefvn=0x7fedfc886230,_tiltrefvn=0x7fedfd0b2c30,
 _reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,_istart=
 0x7fedfbc350f0,_jstart=0x7fedfbc42f30,_binindices=0x7fedfc134030,_binxy=2,
 _centroidw=0x7fedfc8672b8,_fimage=0x7fedfc121430,_fimage2=0x0,_imistart=
 0x7fedfbc41690,_imjstart=0x7fedfbc37470,_imistart2=0x7fedfbc37660,_imjstart2=
 0x7fedfbc37850,_unittip=0x7fedfbc36410,_unittilt=0x7fedfbc2e590,_lgs_defocuses=
 0x7fedfd0e9370,_unitdefocus=0x106762030,_fimnx=24,_fimny=24,_fimny2=0x0,
 _yoffset=0x0,_bias=0x7fedfd0c6e30,_flat=0x7fedfc17a630,_domask=1,_submask=
 0x7fedfd0bc230,_kernel=0x7fedfc17c030,_kernels=0x102352030,_kerfftr=
 0x1020d8030,_kerffti=0x102085030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fedfc179c30,_x=0x7fedfbc427f0,_y=0x7fedfbc42b90,_centroidgain=1,_rayleigh=
 0x7fedfc866d08,_bckgrdcalib=0x7fedfc1d7630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc8401c0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc867600,_ctrlden=0x7fedfc866e20,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbe4b500,_xlast=0x7fedfbe3d970,_ylast=[0x7fedfd0b5e30,0x7fedfd0b5e30,
 0x7fedfd0b5e30],_y0=0x7fedfd0f0830,_signus=0x7fedfbe45a80,_puppixoffset=[0,0],
 _nact=80,_def=0x10a99d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fedfbe428a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc867018,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc867750,xposition=0x7fedfc866ad8,yposition=
 0x7fedfc866d40,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc866c28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.8,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 1), 108 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.0   0.592      114.9
Field Avg  1.65                     54.0   0.592      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;//24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 1;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 11;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 1.2;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 wfs(n).fssize      = 2.4;
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 //dm(n).iffile	    = “”; 
 //dm(n).nxact	        = 20; 
 dm(n).pitch	        = 7; //miss some actuators...
 dm(n).nzer          = 80;
 //dm(n).alt           = 0.;
 //dm(n).unitpervolt   = 0.01; 
 //dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.1;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)64/6.5
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.8;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 1000;          // Total number of iterations
 loop.ittime	       = 1e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051888,layerfrac=0x7fedfd051910,
 layerspeed=0x7fedfd051a20,layeralt=0x7fedfc84e868,winddir=0x7fedfc84e0f8,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=1,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866d40,lgs_prof_alt=0x7fedfc867750,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=1,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fedfbe4a430,
 _origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=108,_nsub4disp=108,
 _nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x102b9f030,
 _masks=0x0,_fluxpersub=0x7fedfbc2e590,_rayleighflux=0x0,_sodiumflux=0x0,
 _raylfluxpersub=0x7fedfbc39210,_skyfluxpersub=0x7fedfbc39400,_nphotons=8824.39,
 _skynphotons=0,_tt=[0.00165042,-0.000486338],_lastvalidtt=[0.00165042,
 -0.000486338],_upttcommand=[0,0],_refmes=0x7fedfbc38e70,_tiprefv=
 0x7fedfc82c630,_tiltrefv=0x7fedfd825030,_tiprefvn=0x7fedfc87fa30,_tiltrefvn=
 0x7fedfd825830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fedfbe49fe0,_jstart=0x7fedfbe3e750,_binindices=0x7fedfd0dfc30,
 _binxy=2,_centroidw=0x7fedfc866ec8,_fimage=0x7fedfd081230,_fimage2=0x0,
 _imistart=0x7fedfbe48680,_imjstart=0x7fedfbe4d350,_imistart2=0x7fedfbe4d540,
 _imjstart2=0x7fedfbe4d730,_unittip=0x7fedfbe4aac0,_unittilt=0x7fedfbe3d970,
 _lgs_defocuses=0x7fedfc867670,_unitdefocus=0x102716030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fedfc053630,_flat=0x7fedfc121430,_domask=1,
 _submask=0x7fedfc11a430,_kernel=0x7fedfd0bc230,_kernels=0x10227f030,_kerfftr=
 0x1020d8030,_kerffti=0x102085030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fedfd0e8230,_x=0x7fedfbe49160,_y=0x7fedfbe49500,_centroidgain=1,_rayleigh=
 0x7fedfc83c7c0,_bckgrdcalib=0x7fedfc11b230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc867398)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc866c28,_ctrlden=0x7fedfd0e9220,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc361c0,_xlast=0x7fedfbc42e70,_ylast=[0x7fedfc065a30,0x7fedfc065a30,
 0x7fedfc065a30],_y0=0x7fedfc11d230,_signus=0x7fedfbc36410,_puppixoffset=[0,0],
 _nact=80,_def=0x107445030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fedfbc42ff0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866d08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc867600,xposition=0x7fedfd0e9370,yposition=
 0x7fedfc8672b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc867718,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.8,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 1), 108 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.0   0.592      114.9
Field Avg  1.65                     54.0   0.592      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;//24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 1;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 11;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 1.2;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 wfs(n).fssize      = 2.4;
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 //dm(n).iffile	    = “”; 
 //dm(n).nxact	        = 20; 
 dm(n).pitch	        = 7; //miss some actuators...
 dm(n).nzer          = 80;
 //dm(n).alt           = 0.;
 //dm(n).unitpervolt   = 0.01; 
 //dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.1;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)64/6.5
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.8;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 1000;          // Total number of iterations
 loop.ittime	       = 1e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee598735b8,winddir=0x7fee598730f0,
 _layeralt=0x7fee598727e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=1,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5914c0c8,lgs_prof_alt=0x7fee59142988,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=1,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fee58d2f5f0,
 _origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=108,_nsub4disp=108,
 _nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x11b4fb030,
 _masks=0x0,_fluxpersub=0x7fee58d28ab0,_rayleighflux=0x0,_sodiumflux=0x0,
 _raylfluxpersub=0x7fee58c51c10,_skyfluxpersub=0x7fee58c55980,_nphotons=8824.39,
 _skynphotons=0,_tt=[0.00165042,-0.000486338],_lastvalidtt=[0.00165042,
 -0.000486338],_upttcommand=[0,0],_refmes=0x7fee58c52390,_tiprefv=
 0x7fee5918be30,_tiltrefv=0x7fee59217030,_tiprefvn=0x7fee59237630,_tiltrefvn=
 0x7fee59239a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d302d0,_jstart=0x7fee58d22d50,_binindices=0x7fee598aec30,
 _binxy=2,_centroidw=0x7fee5916bfe8,_fimage=0x7fee598b8030,_fimage2=0x0,
 _imistart=0x7fee58d2fb90,_imjstart=0x7fee58d28140,_imistart2=0x7fee58d28330,
 _imjstart2=0x7fee58d28520,_unittip=0x7fee58d2f200,_unittilt=0x7fee58d22b20,
 _lgs_defocuses=0x7fee5914c2c0,_unitdefocus=0x1120f7030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee59231e30,_flat=0x7fee59231430,_domask=1,
 _submask=0x7fee598c6e30,_kernel=0x7fee598b5c30,_kernels=0x11274b030,_kerfftr=
 0x11ba50030,_kerffti=0x11b9fd030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee598b8a30,_x=0x7fee58d27470,_y=0x7fee58d27810,_centroidgain=1,_rayleigh=
 0x7fee5916bf40,_bckgrdcalib=0x7fee59216230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916b838)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5914c3a0,_ctrlden=0x7fee5916ba30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c54770,_xlast=0x7fee58c50940,_ylast=[0x7fee5906bc30,0x7fee5906bc30,
 0x7fee5906bc30],_y0=0x7fee59081430,_signus=0x7fee58c52730,_puppixoffset=[0,0],
 _nact=80,_def=0x11d6db030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58d232d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916b8a8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c2f8,xposition=0x7fee5914c410,yposition=
 0x7fee5914c3d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5914c368,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.8,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=1000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 1), 108 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 10000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.1   0.574      125.0
Field Avg  1.65                     55.1   0.574      125.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;//24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 1;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 11;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 1.2;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 wfs(n).fssize      = 2.4;
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 //dm(n).iffile	    = “”; 
 //dm(n).nxact	        = 20; 
 dm(n).pitch	        = 7; //miss some actuators...
 dm(n).nzer          = 80;
 //dm(n).alt           = 0.;
 //dm(n).unitpervolt   = 0.01; 
 //dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.1;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)64/6.5
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.8;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 10000;          // Total number of iterations
 loop.ittime	       = 1e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873310,layerfrac=0x7fee59873288,
 layerspeed=0x7fee59873398,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee598727e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=1,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5914c3d8,lgs_prof_alt=0x7fee5914c2f8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=1,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fee58d2ff30,
 _origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=108,_nsub4disp=108,
 _nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x11b3fa030,
 _masks=0x0,_fluxpersub=0x7fee58c51360,_rayleighflux=0x0,_sodiumflux=0x0,
 _raylfluxpersub=0x7fee58c55780,_skyfluxpersub=0x7fee58c55d10,_nphotons=8824.39,
 _skynphotons=0,_tt=[-0.000355949,-0.000131788],_lastvalidtt=[-0.000355949,
 -0.000131788],_upttcommand=[0,0],_refmes=0x7fee58c52540,_tiprefv=
 0x7fee598a8c30,_tiltrefv=0x7fee5922a230,_tiprefvn=0x7fee5989ae30,_tiltrefvn=
 0x7fee5922aa30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d27bb0,_jstart=0x7fee58d28400,_binindices=0x7fee598b8030,
 _binxy=2,_centroidw=0x7fee5914bc68,_fimage=0x7fee598a7430,_fimage2=0x0,
 _imistart=0x7fee58d28060,_imjstart=0x7fee58d285f0,_imistart2=0x7fee58d287e0,
 _imjstart2=0x7fee58d289d0,_unittip=0x7fee58d22b20,_unittilt=0x7fee58d20df0,
 _lgs_defocuses=0x7fee5916c100,_unitdefocus=0x111df4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee59226630,_flat=0x7fee598df630,_domask=1,
 _submask=0x7fee5922e830,_kernel=0x7fee598de830,_kernels=0x112bf6030,_kerfftr=
 0x11b9fd030,_kerffti=0x11ba50030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee598a7e30,_x=0x7fee58d270d0,_y=0x7fee58d27470,_centroidgain=1,_rayleigh=
 0x7fee5916c1e0,_bckgrdcalib=0x7fee598aec30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916b950)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916b918,_ctrlden=0x7fee5914bd48,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c539d0,_xlast=0x7fee58c528e0,_ylast=[0x7fee59081430,0x7fee59081430,
 0x7fee59081430],_y0=0x7fee5922b230,_signus=0x7fee58c56090,_puppixoffset=[0,0],
 _nact=80,_def=0x11511e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58c53090,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf40,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c3a0,xposition=0x7fee5914c2c0,yposition=
 0x7fee5916bfe8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5914c0c8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.8,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=10000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 1), 108 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 10000 iterations
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 10000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       61.4   0.304      310.8
Field Avg  1.65                     61.4   0.304      310.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;//24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 11;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 1.2;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 wfs(n).fssize      = 2.4;
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 //dm(n).iffile	    = “”; 
 //dm(n).nxact	        = 20; 
 dm(n).pitch	        = 7; //miss some actuators...
 dm(n).nzer          = 80;
 //dm(n).alt           = 0.;
 //dm(n).unitpervolt   = 0.01; 
 //dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.1;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)64/6.5
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.8;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 10000;          // Total number of iterations
 loop.ittime	       = 1e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873310,layerfrac=0x7fee59873288,
 layerspeed=0x7fee59873398,layeralt=0x7fee59153e30,winddir=0x7fee591539f0,
 _layeralt=0x7fee598727e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5914c3a0,lgs_prof_alt=0x7fee5914bd10,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58f03740,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d220e0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=108,
 _nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x111ff6030,_masks=0x0,_fluxpersub=0x7fee58c55700,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58c55950,_skyfluxpersub=0x7fee58c55ba0,
 _nphotons=8824.39,_skynphotons=0,_tt=[0.0137275,-0.0324977],_lastvalidtt=
 [0.0137275,-0.0324977],_upttcommand=[0,0],_refmes=0x7fee58f049c0,_tiprefv=
 0x7fee5a01de30,_tiltrefv=0x7fee59864a30,_tiprefvn=0x7fee5a000030,_tiltrefvn=
 0x7fee59865230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d22330,_jstart=0x7fee58d22580,_binindices=0x7fee59215e30,
 _binxy=2,_centroidw=0x7fee5916c480,_fimage=0x7fee59217630,_fimage2=0x0,
 _imistart=0x7fee58c54dc0,_imjstart=0x7fee58c55010,_imistart2=0x7fee58c55260,
 _imjstart2=0x7fee58c554b0,_unittip=0x7fee58d302a0,_unittilt=0x7fee58d21eb0,
 _lgs_defocuses=0x7fee59146430,_unitdefocus=0x113c97030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5922a430,_flat=0x7fee5922c630,_domask=1,
 _submask=0x7fee59218e30,_kernel=0x7fee59218030,_kernels=0x10f4c4030,_kerfftr=
 0x11255e030,_kerffti=0x1125dd030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee5922d830,_x=0x7fee598aec30,_y=0x7fee598af230,_centroidgain=1,_rayleigh=
 0x7fee5914bd48,_bckgrdcalib=0x7fee5922ae30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5914c368)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5914c0c8,_ctrlden=0x7fee5916c250,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c52920,_xlast=0x7fee58c515d0,_ylast=[0x7fee5906bc30,0x7fee5906bc30,
 0x7fee5906bc30],_y0=0x7fee59081430,_signus=0x7fee58c50940,_puppixoffset=[0,0],
 _nact=80,_def=0x1165b8030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58d2f5d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916c2f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5916bd80,xposition=0x7fee5916c288,yposition=
 0x7fee5916bf08,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916bd10,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.8,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=10000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 10000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       61.4   0.304      310.8
Field Avg  1.65                     61.4   0.304      310.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;//24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 2;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 11;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 1.2;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 wfs(n).fssize      = 2.4;
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 //dm(n).iffile	    = “”; 
 //dm(n).nxact	        = 20; 
 dm(n).pitch	        = 7; //miss some actuators...
 dm(n).nzer          = 80;
 //dm(n).alt           = 0.;
 //dm(n).unitpervolt   = 0.01; 
 //dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.1;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)64/6.5
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.8;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 10000;          // Total number of iterations
 loop.ittime	       = 1e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873288,layerfrac=0x7fee59873398,
 layerspeed=0x7fee59873310,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee598727e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916bf08,lgs_prof_alt=0x7fee5916bd80,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c52760,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d2f7f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=108,
 _nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x111ef5030,_masks=0x0,_fluxpersub=0x7fee58f03e40,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58f04090,_skyfluxpersub=0x7fee58f042e0,
 _nphotons=8824.39,_skynphotons=0,_tt=[0.0137275,-0.0324977],_lastvalidtt=
 [0.0137275,-0.0324977],_upttcommand=[0,0],_refmes=0x7fee58e07340,_tiprefv=
 0x7fee598aec30,_tiltrefv=0x7fee5a822e30,_tiprefvn=0x7fee598af430,_tiltrefvn=
 0x7fee5a823630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d2fa40,_jstart=0x7fee58d2fc90,_binindices=0x7fee59215e30,
 _binxy=2,_centroidw=0x7fee5916bdb8,_fimage=0x7fee59214e30,_fimage2=0x0,
 _imistart=0x7fee58c54380,_imjstart=0x7fee58c57770,_imistart2=0x7fee58c579c0,
 _imjstart2=0x7fee58c57c10,_unittip=0x7fee58d20df0,_unittilt=0x7fee58d26d20,
 _lgs_defocuses=0x7fee5916bed0,_unitdefocus=0x1123f9030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5a820830,_flat=0x7fee5a81fe30,_domask=1,
 _submask=0x7fee5a81d030,_kernel=0x7fee5928b630,_kernels=0x10eee9030,_kerfftr=
 0x10ee83030,_kerffti=0x1125dd030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee5922ee30,_x=0x7fee598b8830,_y=0x7fee598b8030,_centroidgain=1,_rayleigh=
 0x7fee5914c2f8,_bckgrdcalib=0x7fee5a821230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916b870)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916b800,_ctrlden=0x7fee5916c410,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c52460,_xlast=0x7fee58c525e0,_ylast=[0x7fee5906bc30,0x7fee5906bc30,
 0x7fee5906bc30],_y0=0x7fee59081430,_signus=0x7fee58c56910,_puppixoffset=[0,0],
 _nact=80,_def=0x114698030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58f04530,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5914bd48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c0c8,xposition=0x7fee59146430,yposition=
 0x7fee5916c480,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5914c3a0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.8,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=10000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 1), 108 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 10000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.1   0.574      125.0
Field Avg  1.65                     55.1   0.574      125.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //MMT H band wave front sensor, lambda = 1.65 microns
 //——————————————— sim outline ——————————— 
 sim.name           = "SH12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;//24; //pupil diameter in the units of pixels D/r0*3=6.5m/15cm*3 = 130(pixel),according to section 3.1.1, only 120 works... I do not know why... 
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //——————————————— atm parameters ——————— 
 atm.dr0at05mic     = 43.33;                   // Dr0 at 0.5 microns, at zenith  D/r0, r0 at 0.5 micron…?(what???)  6.5m/15cm = 43.33
 //from Brusa 2003
 atm.screen	       = &(Y_USER+"data/screen"+["1","2","3","4"]+".fits"); // Phase screen file names 
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);    // Layer fraction. Sum to one is insured in aoinit 
 atm.layerspeed     = &([11.,20.,29.,35.]);    // layer speed; meter/sec  
 atm.layeralt	   = &([0.,400.,6000.,9000.]);// Layer altitude, at Zenith  ;meter
 atm.winddir        = &([0,0,0,0]);            // Wind dir (not operational, use 0 for now) 
 
 
 //————————  WFS —————————    
 nwfs               = 1;          // number of WFSs (>1 if e.g. mcao) now is SCAO
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann"; // type of the WFS
 wfs(n).lambda	   = 0.65;       // WFS wavelength in microns ??? Infrared or the optical…
 wfs(n).shmethod	   = 1;          // 1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation… so this is which type???
 
 wfs(n).gspos       = [0.,0.];    // WFS guide star position [x,y] unit:arc-sec …???
 wfs(n).gsalt       = 0.;         // WFS guide star altitude, at zenith. 0 for infinity. unit:meter
 wfs(n).gsmag       = 5.;        // WFS guide star magnitude. For LGSs, see below. Beware to set to something bright when doing your iMat
 
 wfs(n).shnxsub	   = 12;         // # of subapertures in telescope diameter, listed in McGuire(1999) table 1.(number of sub-apertures)
 wfs(n).npixpersub  = 11;          // # of pixels per sub-aperture
 wfs(n).pixsize     = 1.2;  //0.15;       // Focal plane: Subaperture CCD pixel size in arcsec;  72um/(6.5m*23.5)*206265 = 0.0972 arcsec, Suresh told that the f-number should be 15 of this telescope
 // so the field of view per sub-aperture should be 4*0.15 = 0.6 arc sec,  1.65um / 6.5 m *24 = 1.25 arcsec
 
 wfs(n).npixels     = 2;          // Focal plane: Final # of pixels per subaperture; int
 wfs(n).fracIllum   = 0.75;       // Fraction of sub-aperture illuminated. 108./144=0.75
 
 wfs(n).noise       = 5;          // Enable noise (photon noise & read out noise), there is no units here. what is it !!!
 //4.5 -5 for in the abstract/McGuiqre(1999) table1
 wfs(n).ron         = 3.7;        // Read out noise (float)
 //EEV manufacturing specification3.7 e at 170 kHz in McGuire(1999) Section 3.1
 
 wfs(n).shthreshold = 0.;         // Threshold for the computation of the subaperture signal from CCD spots >= 0
 wfs(n).nintegcycles= 1;          // # of iterations over which to integrate before delivering slopes
 wfs(n).fstop       = "square";
 wfs(n).fssize      = 2.4;
 
 //———————————————Deformable mirrors————————————
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 //dm(n).type	        = "stackarray"; // Valid types are "bimorph", "stackarray" "tiptilt", "zernike", "diskharmonic", "kl", "segmented", "aniso" or "user_function", where user_function is the name of a function provided by the user
 //what does the stack array here means
 //dm(n).iffile	    = “”;           // Influence function file name. Leave it alone.
 //dm(n).nxact	        = 18;           // Number of actuator in pupil diameter,which is listed in the last sentence before the section 4.
 //dm(n).pitch	        = 1;            // Actuator pitch (pixel). (“stackarray/segmented” only) pitch size/pixel size = 144/24 =6 ,64cm/20=32mm,32mm/72um = 444
 //dm(n).alt           = 0.;           // Conjugation altitude, at zenith
 //dm(n).unitpervolt   = 0.01;         // Influence function sensitivity in unit/volt(what does the volt here means). Stackarray: micron/Volt, Tip-tilt: //arcsec/Volt.
 //dm(n).push4imat     = 100;          // Voltage to apply for iMat calibration. Note: the default is not OK for many configs. Change at will
 dm(n).type          = "zernike";
 //dm(n).iffile	    = “”; 
 //dm(n).nxact	        = 20; 
 dm(n).pitch	        = 7; //miss some actuators...
 dm(n).nzer          = 80;
 //dm(n).alt           = 0.;
 //dm(n).unitpervolt   = 0.01; 
 //dm(n).push4imat     = 100; 
 
 
 //n  =2;
 //dm(n).type	     = "tiptilt";
 //dm(n).iffile	     = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);      // Condition numbers for SVD, per subsystem.
 mat.file	       = “”;            // iMat and cMat filename. Leave it alone.
 
 //-------------------------------
 tel.diam	       = 6.5;           // Telescope diameter, in meters, float
 tel.cobs	       = 0.1;        // Central obstruction / telescope diameter ratio (the cover in the centre compared with the total diameter of the telescope)64/6.5
 
 //-------------------------------
 target.lambda	   = &([1.65]);     // Image wavelengths in micron -H band
 target.xposition   = &([0.]);       // “Targets" X positions in the field of view
 target.yposition   = &([0]);        // "Targets" Y positions in the field of view
 target.dispzoom    = &([1.]);       // Display zoom, useful for multi-targets. Typically around 1
 
 //-------------------------------
 gs.zeropoint	   = 1e11;          // Photometric zero point (#photons@pupil/s/full_aper, mag0 star).
 
 //———————————————Looping parameters——————————— 
 loop.gain	       = 0.8;           // Loop gain. Optional, but important!
 loop.framedelay    = 1;             // Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2
 loop.niter	       = 10000;          // Total number of iterations
 loop.ittime	       = 1e-3;          // Iteration time (sampling time)
 loop.startskip     = 10;            // Number of iteration to skip before collecting statistics
 loop.skipevery     = 10000;         // In phase screen, skip by "skipby" steps every "skipevery" iterations (0=none). See doc
 loop.skipby        = 10000;         // See above. This is to get better statistical coverage
 loop.modalgainfile = "simulModeGains.fits"; //Name of file with mode gains
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH12x12 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee591539f0,winddir=0x7fee59153e30,
 _layeralt=0x7fee598727e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=1,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=0,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916c480,lgs_prof_alt=0x7fee5914c0c8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=1,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fee58c53090,
 _origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=108,_nsub4disp=108,
 _nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x111cf3030,
 _masks=0x0,_fluxpersub=0x7fee58c59580,_rayleighflux=0x0,_sodiumflux=0x0,
 _raylfluxpersub=0x7fee58c534f0,_skyfluxpersub=0x7fee58c59b10,_nphotons=8824.39,
 _skynphotons=0,_tt=[-0.000355949,-0.000131788],_lastvalidtt=[-0.000355949,
 -0.000131788],_upttcommand=[0,0],_refmes=0x7fee58d26350,_tiprefv=
 0x7fee59864a30,_tiltrefv=0x7fee598dce30,_tiprefvn=0x7fee5989ae30,_tiltrefvn=
 0x7fee598b8830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58c564a0,_jstart=0x7fee58c56ac0,_binindices=0x7fee591b1230,
 _binxy=2,_centroidw=0x7fee5916c100,_fimage=0x7fee5922c630,_fimage2=0x0,
 _imistart=0x7fee58c57270,_imjstart=0x7fee58c58c10,_imistart2=0x7fee58c58e00,
 _imjstart2=0x7fee58c58ff0,_unittip=0x7fee58c532c0,_unittilt=0x7fee58c50940,
 _lgs_defocuses=0x7fee5916bfb0,_unitdefocus=0x11e497030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5927ca30,_flat=0x7fee5922d830,_domask=1,
 _submask=0x7fee5927bc30,_kernel=0x7fee5927ae30,_kernels=0x10ef4f030,_kerfftr=
 0x10eda5030,_kerffti=0x10ee83030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee5922ee30,_x=0x7fee58c57d50,_y=0x7fee58c580f0,_centroidgain=1,_rayleigh=
 0x7fee5916c288,_bckgrdcalib=0x7fee59277a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5914bd10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916b988,_ctrlden=0x7fee5916c2f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c5d860,_xlast=0x7fee58c5d1d0,_ylast=[0x7fee5906bc30,0x7fee5906bc30,
 0x7fee5906bc30],_y0=0x7fee59081430,_signus=0x7fee58c56d50,_puppixoffset=[0,0],
 _nact=80,_def=0x115b32030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58c59770,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5914c2f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5916b800,xposition=0x7fee5916bed0,yposition=
 0x7fee5916bdb8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916bf08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.8,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=10000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH6x6 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    882438.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 2000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     7798.9   0.000     3455.8
Field Avg  1.65                   7798.9   0.000     3455.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH6x6 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 //wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 //wfs(n).noise       = 1;
 //wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).iffile	   = "";
 dm(n).nxact	       = 20;
 dm(n).nzer         = 80;
 //dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 dm(n).unitpervolt  = 0.01;
 dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 1;
 loop.niter	       = 2000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH6x6 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051910,layerfrac=0x7fedfd051a20,
 layerspeed=0x7fedfd051888,layeralt=0x7fedfc84e4b0,winddir=0x7fedfc84d900,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=0,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=0,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=0,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fedfc8672b8,lgs_prof_alt=0x7fedfc866c28,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fedfbc38510,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fedfbc39210,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x102898030,_masks=0x0,_fluxpersub=0x7fedfbe47910,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fedfbe47b60,_skyfluxpersub=0x7fedfbe47db0,
 _nphotons=882439,_skynphotons=0,_tt=[0.000214677,6.53312e-05],_lastvalidtt=
 [0.000214677,6.53312e-05],_upttcommand=[0,0],_refmes=0x7fedfc036430,_tiprefv=
 0x7fedfd0c4630,_tiltrefv=0x7fedfc1d7630,_tiprefvn=0x7fedfd0c4e30,_tiltrefvn=
 0x7fedfc1d7e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fedfbc37130,_jstart=0x7fedfbc37380,_binindices=0x7fedfc166830,
 _binxy=2,_centroidw=0x7fedfc866e20,_fimage=0x7fedfc11ca30,_fimage2=0x0,
 _imistart=0x7fedfbc3b7a0,_imjstart=0x7fedfbc37e20,_imistart2=0x7fedfbc38070,
 _imjstart2=0x7fedfbc382c0,_unittip=0x7fedfbc38fe0,_unittilt=0x7fedfbc36f00,
 _lgs_defocuses=0x7fedfc845f38,_unitdefocus=0x10242a030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fedfd077830,_flat=0x7fedfc17c830,_domask=1,
 _submask=0x7fedfd0dfc30,_kernel=0x7fedfd0bc230,_kernels=0x102352030,_kerfftr=
 0x102591030,_kerffti=0x10252b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fedfc052230,_x=0x7fedfc124c30,_y=0x7fedfc053630,_centroidgain=1,_rayleigh=
 0x7fedfd0e9220,_bckgrdcalib=0x7fedfc132630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc8670f8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=0,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc867590,_ctrlden=0x7fedfc867018,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc37ca0,_xlast=0x7fedfbc38830,_ylast=[0x7fedfc060a30,0x7fedfc060a30,
 0x7fedfc060a30],_y0=0x7fedfc065a30,_signus=0x7fedfbc33210,_puppixoffset=[0,0],
 _nact=80,_def=0x106c66030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fedfbe42720,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc867750,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc866d08,xposition=0x7fedfc867360,yposition=
 0x7fedfc867670,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc866ec8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=2000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH6x6 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  1.19  1.19    1x 1    1x 1    882438.8
=============================
SH6x6 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  1.19  1.19    1x 1    1x 1    882438.8
=============================
SH6x6 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    882438.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 2000 iterations
=============================
SH6x6 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    882438.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 2000 iterations
=============================
SH6x6 w/ TT mirror and WFS, full diffraction WFS
=============================
SH6x6 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    882438.8
=============================
SH6x6 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    882438.8
 
Summary:
Mirror #1, stackarray, 148 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 2000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       56.0   0.287      594.6
Field Avg  1.65                     56.0   0.287      594.6
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH6x6 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 //wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 //wfs(n).noise       = 1;
 //wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "stackarray";
 //dm(n).iffile	   = "";
 dm(n).nxact	       = 20;
 //dm(n).nzer         = 80;
 dm(n).pitch	       =11;
 //dm(n).alt          = 0.;
 dm(n).unitpervolt  = 0.01;
 dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 1;
 loop.niter	       = 2000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH6x6 w/ TT mirror and WFS, full diffraction WFS",pupildiam=
 132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,svipc_wfs_forknb=
 0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051a20,layerfrac=0x7fedfd051888,
 layerspeed=0x7fedfd051910,layeralt=0x7fedfc84e868,winddir=0x7fedfc84e0f8,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=0,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=0,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=0,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fedfc867440,lgs_prof_alt=0x7fedfc845b10,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fedfbc3dc40,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fedfbe49090,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x107344030,_masks=0x0,_fluxpersub=0x7fedfbd09590,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fedfbd097e0,_skyfluxpersub=0x7fedfbd09a30,
 _nphotons=882439,_skynphotons=0,_tt=[-0.00409721,-0.000699109],_lastvalidtt=
 [-0.00409721,-0.000699109],_upttcommand=[0,0],_refmes=0x7fedfd0f8c30,_tiprefv=
 0x7fedfc885c30,_tiltrefv=0x7fedfc17a430,_tiprefvn=0x7fedfc886430,_tiltrefvn=
 0x7fedfc1d7630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fedfbe48060,_jstart=0x7fedfbe482b0,_binindices=0x7fedfc11bc30,
 _binxy=2,_centroidw=0x7fedfc866de8,_fimage=0x7fedfc121430,_fimage2=0x0,
 _imistart=0x7fedfbc3dee0,_imjstart=0x7fedfbc3e130,_imistart2=0x7fedfbc3ef60,
 _imjstart2=0x7fedfbc3f1b0,_unittip=0x7fedfbe47930,_unittilt=0x7fedfbe47e30,
 _lgs_defocuses=0x7fedfc8671d8,_unitdefocus=0x106762030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fedfd826e30,_flat=0x7fedfd826430,_domask=1,
 _submask=0x7fedfd824830,_kernel=0x7fedfc17ba30,_kernels=0x102af2030,_kerfftr=
 0x10213e030,_kerffti=0x1020b1030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fedfc120a30,_x=0x7fedfd081230,_y=0x7fedfd0c4830,_centroidgain=1,_rayleigh=
 0x7fedfc867558,_bckgrdcalib=0x7fedfd825630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc846168)]
 [dm_struct(type="stackarray",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=11,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc866aa0,_ctrlden=0x7fedfc845f38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=0,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=1e-05,
 regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fedfbc3a820,_xlast=0x7fedfbc3cbd0,_ylast=[0x7fedfc1d7e30,
 0x7fedfc1d7e30,0x7fedfc1d7e30],_y0=0x7fedfc166830,_signus=0x7fedfc17ac30,
 _puppixoffset=[0,0],_nact=148,_def=0x10f562030,_x=0x7fedfbc3bfd0,_y=
 0x7fedfbc3c260,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,_indval=0x7fedfc1e5e30,
 _indext=0x7fedfc134e30,_eiffile="sh12x12-if1-ext.fits",_edef=0x109abd030,_ex=
 0x7fedfbc3c4f0,_ey=0x7fedfbc3c860,_enact=204,_n1=182,_n2=331,_pupil=0x0,
 _command=0x7fedfbf15e10,_flat_command=0x0,_extrapcmat=0x102393030,_eltdefsize=
 0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc867670,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc846248,xposition=0x7fedfc867d08,yposition=
 0x7fedfc8672b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc8671a0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=2000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    882438.8

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      378.1   0.014      567.5
Field Avg  1.65                    378.1   0.014      567.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 //wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 //wfs(n).noise       = 1;
 //wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "stackarray";
 //dm(n).iffile	   = "";
 dm(n).nxact	       = 20;
 //dm(n).nzer         = 80;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 dm(n).unitpervolt  = 0.01;
 dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 1;
 loop.niter	       = 2000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051888,layerfrac=0x7fedfd051910,
 layerspeed=0x7fedfd051a20,layeralt=0x7fedfc84e4b0,winddir=0x7fedfc84d900,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=0,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=0,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=0,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fedfc8672b8,lgs_prof_alt=0x7fedfc846248,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fedfbe4a7e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fedfbe4a1e0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x105a60030,_masks=0x0,_fluxpersub=0x7fedfbc2e590,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fedfbc35860,_skyfluxpersub=0x7fedfbc3db40,
 _nphotons=882439,_skynphotons=0,_tt=[-0.0218702,0.0854573],_lastvalidtt=
 [-0.0218702,0.0854573],_upttcommand=[0,0],_refmes=0x7fedfc0ff430,_tiprefv=
 0x7fedfc17a430,_tiltrefv=0x7fedfd0d5830,_tiprefvn=0x7fedfc1d7630,_tiltrefvn=
 0x7fedfd076e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fedfbe47910,_jstart=0x7fedfbe47b60,_binindices=0x7fedfd0e5430,
 _binxy=2,_centroidw=0x7fedfc867c98,_fimage=0x7fedfc16ba30,_fimage2=0x0,
 _imistart=0x7fedfbe4ade0,_imjstart=0x7fedfbe4b030,_imistart2=0x7fedfbe3dca0,
 _imjstart2=0x7fedfbe3def0,_unittip=0x7fedfbe3d990,_unittilt=0x7fedfbe42720,
 _lgs_defocuses=0x7fedfc8677c0,_unitdefocus=0x101d7d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fedfd0e7630,_flat=0x7fedfd0e8030,_domask=1,
 _submask=0x7fedfc11bc30,_kernel=0x7fedfc1da630,_kernels=0x102229030,_kerfftr=
 0x10213e030,_kerffti=0x1020b1030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fedfc16da30,_x=0x7fedfd0c4630,_y=0x7fedfd0c4c30,_centroidgain=1,_rayleigh=
 0x7fedfc8677f8,_bckgrdcalib=0x7fedfd0e2230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc867018)]
 [dm_struct(type="stackarray",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc845a68,_ctrlden=0x7fedfc840150,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=0,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=1e-05,
 regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fedfd09b230,_xlast=0x7fedfd0eae30,_ylast=[0x7fedfd0eec30,
 0x7fedfd0eec30,0x7fedfd0eec30],_y0=0x7fedfd0ed430,_signus=0x7fedfd077630,
 _puppixoffset=[0,0],_nact=324,_def=0x109abd030,_x=0x7fedfd081230,_y=
 0x7fedfd0bc230,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,_indval=0x7fedfd0b2c30,
 _indext=0x7fedfbe45110,_eiffile="sh12x12-if1-ext.fits",_edef=0x107445030,_ex=
 0x7fedfc1e7898,_ey=0x7fedfc1e6e48,_enact=28,_n1=182,_n2=331,_pupil=0x0,
 _command=0x7fedfc057030,_flat_command=0x0,_extrapcmat=0x7fedfd0fa030,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866aa0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc845f38,xposition=0x7fedfc8671d8,yposition=
 0x7fedfc866de8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc867440,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=2000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    882438.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 2000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     7798.9   0.000     3455.8
Field Avg  1.65                   7798.9   0.000     3455.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 //wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 //wfs(n).noise       = 1;
 //wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 //dm(n).iffile	   = "";
 dm(n).nxact	       = 20;
 dm(n).nzer         = 80;
 dm(n).pitch	       = 6;
 //dm(n).alt          = 0.;
 dm(n).unitpervolt  = 0.01;
 dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 1;
 loop.niter	       = 2000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051910,layerfrac=0x7fedfd051a20,
 layerspeed=0x7fedfd051888,layeralt=0x7fedfc84e0f8,winddir=0x7fedfc84e868,
 _layeralt=0x7fedfc84da10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=0,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=0,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=0,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866de8,lgs_prof_alt=0x7fedfc845f38,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fedfbc3dab0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fedfbe40c20,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x102898030,_masks=0x0,_fluxpersub=0x7fedfbe41310,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fedfbe41560,_skyfluxpersub=0x7fedfbe417b0,
 _nphotons=882439,_skynphotons=0,_tt=[0.000214677,6.53312e-05],_lastvalidtt=
 [0.000214677,6.53312e-05],_upttcommand=[0,0],_refmes=0x7fedfc121a30,_tiprefv=
 0x7fedfd0bca30,_tiltrefv=0x7fedfd0bc230,_tiprefvn=0x7fedfd0ed430,_tiltrefvn=
 0x7fedfd077830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fedfbe40e70,_jstart=0x7fedfbe410c0,_binindices=0x7fedfc16d430,
 _binxy=2,_centroidw=0x7fedfc8670c0,_fimage=0x7fedfd081230,_fimage2=0x0,
 _imistart=0x7fedfbc3c550,_imjstart=0x7fedfbc36410,_imistart2=0x7fedfbc3d4d0,
 _imjstart2=0x7fedfbc3a9a0,_unittip=0x7fedfbe42720,_unittilt=0x7fedfbe45960,
 _lgs_defocuses=0x7fedfc866830,_unitdefocus=0x101f84030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fedfc1da630,_flat=0x7fedfc04d430,_domask=1,
 _submask=0x7fedfd0ee230,_kernel=0x7fedfc15e630,_kernels=0x102817030,_kerfftr=
 0x10213e030,_kerffti=0x1020b1030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fedfd076e30,_x=0x7fedfd0b3a30,_y=0x7fedfd0e9e30,_centroidgain=1,_rayleigh=
 0x7fedfc845b10,_bckgrdcalib=0x7fedfc04de30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfd0e9300)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=6,alt=0,hyst=0,push4imat=100,thresholdresp=0.3,
 unitpervolt=0.01,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc867440,_ctrlden=0x7fedfc867558,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=20,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc361c0,_xlast=0x7fedfbc3a820,_ylast=[0x7fedfc11c830,0x7fedfc11c830,
 0x7fedfc11c830],_y0=0x7fedfc0ff430,_signus=0x7fedfbc3c290,_puppixoffset=[0,0],
 _nact=80,_def=0x108927030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fedfbe45b90,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc8677f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc840150,xposition=0x7fedfc8677c0,yposition=
 0x7fedfc867c98,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc8672b8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=2000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    882438.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 2000 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    882438.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 2000 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    882438.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 2000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.8   0.555      135.1
Field Avg  1.65                     54.8   0.555      135.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 //wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 //wfs(n).noise       = 1;
 //wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).nzer         = 80;
 //dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 1;
 loop.niter	       = 2000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfc84e4b0,layerfrac=0x7fedfd051888,
 layerspeed=0x7fedfd051910,layeralt=0x7fedfc84da10,winddir=0x7fedfc84d900,
 _layeralt=0x7fedfd050de8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=0,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=0,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=0,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fedfc845b10,lgs_prof_alt=0x7fedfc8674e8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fedfbe4c3e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fedfbf0d750,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x105b61030,_masks=0x0,_fluxpersub=0x7fedfbd0a7e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fedfbd0bb10,_skyfluxpersub=0x7fedfbd09870,
 _nphotons=882439,_skynphotons=0,_tt=[0.000388243,0.0030352],_lastvalidtt=
 [0.000388243,0.0030352],_upttcommand=[0,0],_refmes=0x7fedfc83d030,_tiprefv=
 0x7fedfd82c030,_tiltrefv=0x7fedfd0e5a30,_tiprefvn=0x7fedfd828830,_tiltrefvn=
 0x7fedfd0e2230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fedfbf0ddd0,_jstart=0x7fedfbf0e020,_binindices=0x7fedfc16ec30,
 _binxy=2,_centroidw=0x7fedfc866d08,_fimage=0x7fedfd0b3c30,_fimage2=0x0,
 _imistart=0x7fedfbc33210,_imjstart=0x7fedfbc371c0,_imistart2=0x7fedfbc37410,
 _imjstart2=0x7fedfbc37660,_unittip=0x7fedfbf0d2f0,_unittilt=0x7fedfbf0d520,
 _lgs_defocuses=0x7fedfc867de8,_unitdefocus=0x104ede030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fedfd825230,_flat=0x7fedfd824830,_domask=1,
 _submask=0x7fedfd0bc230,_kernel=0x7fedfd0dfc30,_kernels=0x1025d2030,_kerfftr=
 0x102bed030,_kerffti=0x1021f3030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fedfd081230,_x=0x7fedfc87ec30,_y=0x7fedfc87f230,_centroidgain=1,_rayleigh=
 0x7fedfc1333f0,_bckgrdcalib=0x7fedfd829a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc866bb8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc845fe0,_ctrlden=0x7fedfc867c98,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbd0bd80,_xlast=0x7fedfbd0bf00,_ylast=[0x7fedfd82b430,0x7fedfd82b430,
 0x7fedfd82b430],_y0=0x7fedfd826030,_signus=0x7fedfbd0c080,_puppixoffset=[0,0],
 _nact=80,_def=0x109abd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fedfbe45bc0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866e20,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc845f38,xposition=0x7fedfc846210,yposition=
 0x7fedfc8677f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc867280,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=2000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    882438.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 1), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 2000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      143.7   0.082      331.1
Field Avg  1.65                    143.7   0.082      331.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 //wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 1; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 //wfs(n).noise       = 1;
 //wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).nzer         = 80;
 //dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.6;
 loop.framedelay    = 1;
 loop.niter	       = 2000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051888,layerfrac=0x7fedfd051910,
 layerspeed=0x7fedfc84e4b0,layeralt=0x7fedfd051a20,winddir=0x7fedfc84e868,
 _layeralt=0x7fedfd050de8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=0,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=0,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=1,shnxsub=12,npixpersub=0,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fedfc8677f8,lgs_prof_alt=0x7fedfc845f38,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=1,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fedfbe4dab0,
 _origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=120,
 _nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x102292030,
 _masks=0x0,_fluxpersub=0x7fedfbe4ea70,_rayleighflux=0x0,_sodiumflux=0x0,
 _raylfluxpersub=0x7fedfbe4ec90,_skyfluxpersub=0x7fedfbe4eeb0,_nphotons=882439,
 _skynphotons=0,_tt=[0.0109677,0.111806],_lastvalidtt=[0.0109677,0.111806],
 _upttcommand=[0,0],_refmes=0x7fedfc036430,_tiprefv=0x7fedfc17a430,_tiltrefv=
 0x7fedfc87ec30,_tiprefvn=0x7fedfc164c30,_tiltrefvn=0x7fedfc887c30,_reordervec=
 0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,_istart=0x7fedfbe4dcd0,
 _jstart=0x7fedfbe4def0,_binindices=0x7fedfd0e5430,_binxy=2,_centroidw=
 0x7fedfc866e20,_fimage=0x7fedfd076e30,_fimage2=0x0,_imistart=0x7fedfbe4e550,
 _imjstart=0x7fedfbe4f6d0,_imistart2=0x7fedfbe4f8f0,_imjstart2=0x7fedfbe4fb10,
 _unittip=0x7fedfbe45110,_unittilt=0x7fedfbe4cba0,_lgs_defocuses=0x7fedfc867718,
 _unitdefocus=0x1029f1030,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=
 0x7fedfd0c4630,_flat=0x7fedfd081230,_domask=1,_submask=0x7fedfd0ed430,_kernel=
 0x7fedfd0bc230,_kernels=0x101eca030,_kerfftr=0x102bed030,_kerffti=0x1021f3030,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfd0e8230,_x=0x7fedfd0b5e30,_y=
 0x7fedfd0b4e30,_centroidgain=1,_rayleigh=0x7fedfc867638,_bckgrdcalib=
 0x7fedfd0c5030,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7fedfc867590)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc845a68,_ctrlden=0x7fedfc867018,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc361c0,_xlast=0x7fedfbc3ad30,_ylast=[0x7fedfc0ff430,0x7fedfc0ff430,
 0x7fedfc0ff430],_y0=0x7fedfc17da30,_signus=0x7fedfbc36410,_puppixoffset=[0,0],
 _nact=80,_def=0x106c66030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fedfbd09870,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc1333f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc867c98,xposition=0x7fedfc867de8,yposition=
 0x7fedfc866d08,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc845b10,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=2000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    882438.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 1), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 2000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      146.1   0.077      337.8
Field Avg  1.65                    146.1   0.077      337.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 //wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 1; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 //wfs(n).noise       = 1;
 //wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).nzer         = 80;
 //dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 2000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051910,layerfrac=0x7fedfc84e4b0,
 layerspeed=0x7fedfd051888,layeralt=0x7fedfc84d900,winddir=0x7fedfc84da10,
 _layeralt=0x7fedfd050de8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=0,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=0,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=1,shnxsub=12,npixpersub=0,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866d08,lgs_prof_alt=0x7fedfc867c98,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=1,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fedfbc35180,
 _origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=120,
 _nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x101d7d030,
 _masks=0x0,_fluxpersub=0x7fedfbc3e800,_rayleighflux=0x0,_sodiumflux=0x0,
 _raylfluxpersub=0x7fedfbc3ea20,_skyfluxpersub=0x7fedfbe45130,_nphotons=882439,
 _skynphotons=0,_tt=[0.00853547,0.111026],_lastvalidtt=[0.00853547,0.111026],
 _upttcommand=[0,0],_refmes=0x7fedfd0b4e30,_tiprefv=0x7fedfd0e7230,_tiltrefv=
 0x7fedfc1da630,_tiprefvn=0x7fedfd0e7a30,_tiltrefvn=0x7fedfc04de30,_reordervec=
 0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,_istart=0x7fedfbc3d700,
 _jstart=0x7fedfbc3d920,_binindices=0x7fedfc11bc30,_binxy=2,_centroidw=
 0x7fedfc1333f0,_fimage=0x7fedfc134230,_fimage2=0x0,_imistart=0x7fedfbc3df80,
 _imjstart=0x7fedfbc3e1a0,_imistart2=0x7fedfbc3e3c0,_imjstart2=0x7fedfbc3e5e0,
 _unittip=0x7fedfbc33210,_unittilt=0x7fedfbc3d4d0,_lgs_defocuses=0x7fedfc867aa0,
 _unitdefocus=0x102716030,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=
 0x7fedfd077830,_flat=0x7fedfd081230,_domask=1,_submask=0x7fedfc17ba30,_kernel=
 0x7fedfc15e630,_kernels=0x1025d2030,_kerfftr=0x1021f3030,_kerffti=0x101eca030,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7fedfc134c30,_x=0x7fedfc0ff430,_y=
 0x7fedfc060a30,_centroidgain=1,_rayleigh=0x7fedfc8670c0,_bckgrdcalib=
 0x7fedfd0dfc30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7fedfc8671a0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc866bb8,_ctrlden=0x7fedfc867520,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbf0e380,_xlast=0x7fedfbf0e500,_ylast=[0x7fedfc89a230,0x7fedfc89a230,
 0x7fedfc89a230],_y0=0x7fedfc83d030,_signus=0x7fedfbf0e680,_puppixoffset=[0,0],
 _nact=80,_def=0x1096bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fedfbc3db40,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc867638,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc867018,xposition=0x7fedfc867718,yposition=
 0x7fedfc866e20,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc8677f8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=2000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    882438.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 2000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.534      152.0
Field Avg  1.65                     55.4   0.534      152.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 //wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 //wfs(n).noise       = 1;
 //wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).nzer         = 80;
 //dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 2000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfc84e4b0,layerfrac=0x7fedfd051888,
 layerspeed=0x7fedfd051910,layeralt=0x7fedfc84e868,winddir=0x7fedfd051a20,
 _layeralt=0x7fedfd050de8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=0,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=0,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=0,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866e20,lgs_prof_alt=0x7fedfc867018,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fedfbd0a450,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fedfbc3dab0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x104ede030,_masks=0x0,_fluxpersub=0x7fedfbe4d590,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fedfbe41310,_skyfluxpersub=0x7fedfbe41560,
 _nphotons=882439,_skynphotons=0,_tt=[0.000538176,0.00245693],_lastvalidtt=
 [0.000538176,0.00245693],_upttcommand=[0,0],_refmes=0x7fedfd0b4e30,_tiprefv=
 0x7fedfc134230,_tiltrefv=0x7fedfc121430,_tiprefvn=0x7fedfc134a30,_tiltrefvn=
 0x7fedfc17c430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fedfbc3dd00,_jstart=0x7fedfbc3ebf0,_binindices=0x7fedfd076e30,
 _binxy=2,_centroidw=0x7fedfc866b80,_fimage=0x7fedfd0ed430,_fimage2=0x0,
 _imistart=0x7fedfbe410c0,_imjstart=0x7fedfbe4c260,_imistart2=0x7fedfbe4ba10,
 _imjstart2=0x7fedfbe4d340,_unittip=0x7fedfbc3e740,_unittilt=0x7fedfbc35860,
 _lgs_defocuses=0x7fedfc8671d8,_unitdefocus=0x101f84030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fedfd162230,_flat=0x7fedfd081230,_domask=1,
 _submask=0x7fedfd0c5a30,_kernel=0x7fedfd161430,_kernels=0x102259030,_kerfftr=
 0x1025d2030,_kerffti=0x1021f3030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fedfd0ede30,_x=0x7fedfc049830,_y=0x7fedfc04b430,_centroidgain=1,_rayleigh=
 0x7fedfc867638,_bckgrdcalib=0x7fedfd0c6830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc845b10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc867590,_ctrlden=0x7fedfc845a68,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbe45bc0,_xlast=0x7fedfbe4c0e0,_ylast=[0x7fedfd0b5e30,0x7fedfd0b5e30,
 0x7fedfd0b5e30],_y0=0x7fedfd01e830,_signus=0x7fedfbe4cf20,_puppixoffset=[0,0],
 _nact=80,_def=0x109d9b030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fedfbe4d7e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc8670c0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc867520,xposition=0x7fedfc867aa0,yposition=
 0x7fedfc1333f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc866d08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=2000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 2000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.534      152.0
Field Avg  1.65                     55.4   0.534      152.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 //wfs(n).noise       = 1;
 //wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).nzer         = 80;
 //dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 2000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051888,layerfrac=0x7fedfd051910,
 layerspeed=0x7fedfc84e4b0,layeralt=0x7fedfc84da10,winddir=0x7fedfc84d900,
 _layeralt=0x7fedfd050de8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=0,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=0,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fedfc1333f0,lgs_prof_alt=0x7fedfc867520,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fedfbf0ce40,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fedfbe40c20,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1029f1030,_masks=0x0,_fluxpersub=0x7fedfbe3f1a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fedfbe41310,_skyfluxpersub=0x7fedfbe4ba10,
 _nphotons=8824.39,_skynphotons=0,_tt=[0.000538165,0.00245687],_lastvalidtt=
 [0.000538165,0.00245687],_upttcommand=[0,0],_refmes=0x7fedfc17ae30,_tiprefv=
 0x7fedfd077c30,_tiltrefv=0x7fedfc1d7630,_tiprefvn=0x7fedfd0e9e30,_tiltrefvn=
 0x7fedfc1d7e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fedfbe40e70,_jstart=0x7fedfbe410c0,_binindices=0x7fedfc11bc30,
 _binxy=2,_centroidw=0x7fedfc867bb8,_fimage=0x7fedfc17c430,_fimage2=0x0,
 _imistart=0x7fedfbc3de40,_imjstart=0x7fedfbc3e090,_imistart2=0x7fedfbc3e2e0,
 _imjstart2=0x7fedfbc3e530,_unittip=0x7fedfbe45110,_unittilt=0x7fedfbe4c6b0,
 _lgs_defocuses=0x7fedfc866aa0,_unitdefocus=0x106b65030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fedfc132630,_flat=0x7fedfc053030,_domask=1,
 _submask=0x7fedfd076e30,_kernel=0x7fedfd835830,_kernels=0x102bed030,_kerfftr=
 0x1025d2030,_kerffti=0x1021f3030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fedfd0bc830,_x=0x7fedfd081230,_y=0x7fedfd0bc230,_centroidgain=1,_rayleigh=
 0x7fedfc8670c0,_bckgrdcalib=0x7fedfc166430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfd0e9300)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc866d08,_ctrlden=0x7fedfc866bb8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc361c0,_xlast=0x7fedfbc35180,_ylast=[0x7fedfc073c30,0x7fedfc073c30,
 0x7fedfc073c30],_y0=0x7fedfc0ff430,_signus=0x7fedfbc3fce0,_puppixoffset=[0,0],
 _nact=80,_def=0x108fdf030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fedfbd09a20,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc867590,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc845a68,xposition=0x7fedfc8671d8,yposition=
 0x7fedfc866b80,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc866e20,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=2000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.527      158.8
Field Avg  1.65                     54.9   0.527      158.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 //wfs(n).noise       = 1;
 //wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).nzer         = 80;
 //dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fedfd051910,layerfrac=0x7fedfc84e4b0,
 layerspeed=0x7fedfd051888,layeralt=0x7fedfd051a20,winddir=0x7fedfc84e868,
 _layeralt=0x7fedfd050de8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=0,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=0,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fedfc866b80,lgs_prof_alt=0x7fedfc845a68,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fedfbc3ec60,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fedfbe3f8f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x102716030,_masks=0x0,_fluxpersub=0x7fedfbe45110,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fedfbe4c330,_skyfluxpersub=0x7fedfbe4c580,
 _nphotons=8824.39,_skynphotons=0,_tt=[0.00230778,0.00246452],_lastvalidtt=
 [0.00230778,0.00246452],_upttcommand=[0,0],_refmes=0x7fedfc17ae30,_tiprefv=
 0x7fedfd0bc230,_tiltrefv=0x7fedfd0e9e30,_tiprefvn=0x7fedfd0bca30,_tiltrefvn=
 0x7fedfd0edc30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fedfbe4ba10,_jstart=0x7fedfbe4c0e0,_binindices=0x7fedfc052230,
 _binxy=2,_centroidw=0x7fedfc8677c0,_fimage=0x7fedfc04d430,_fimage2=0x0,
 _imistart=0x7fedfbc44ec0,_imjstart=0x7fedfbc3d720,_imistart2=0x7fedfbc3d970,
 _imjstart2=0x7fedfbc3de80,_unittip=0x7fedfbe3f490,_unittilt=0x7fedfbe3f6c0,
 _lgs_defocuses=0x7fedfc866db0,_unitdefocus=0x105b61030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fedfc04de30,_flat=0x7fedfc224c30,_domask=1,
 _submask=0x7fedfd0b2c30,_kernel=0x7fedfc16ee30,_kernels=0x102259030,_kerfftr=
 0x1025d2030,_kerffti=0x1021f3030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fedfc16e230,_x=0x7fedfd0dfc30,_y=0x7fedfd0c6630,_centroidgain=1,_rayleigh=
 0x7fedfc867590,_bckgrdcalib=0x7fedfc17ba30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fedfc8671a0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fedfc845b10,_ctrlden=0x7fedfc867718,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fedfbc361c0,_xlast=0x7fedfbc33390,_ylast=[0x7fedfc17da30,0x7fedfc17da30,
 0x7fedfc17da30],_y0=0x7fedfc0ff430,_signus=0x7fedfbc3dbc0,_puppixoffset=[0,0],
 _nact=80,_def=0x1096bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fedfbd09870,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fedfc866d08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fedfc866bb8,xposition=0x7fedfc866aa0,yposition=
 0x7fedfc867bb8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fedfc1333f0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.527      158.8
Field Avg  1.65                     54.9   0.527      158.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 //dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873288,layerfrac=0x7fee59873398,
 layerspeed=0x7fee59873310,layeralt=0x7fee591541e8,winddir=0x7fee59154518,
 _layeralt=0x7fee598727e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b790,lgs_prof_alt=0x7fee5916c330,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58d262b0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d2fda0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f706030,_masks=0x0,_fluxpersub=0x7fee58f03140,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58f03390,_skyfluxpersub=0x7fee58f035e0,
 _nphotons=8824.39,_skynphotons=0,_tt=[0.00230778,0.00246452],_lastvalidtt=
 [0.00230778,0.00246452],_upttcommand=[0,0],_refmes=0x7fee598b2830,_tiprefv=
 0x7fee5a000a30,_tiltrefv=0x7fee59284a30,_tiprefvn=0x7fee5a022c30,_tiltrefvn=
 0x7fee5927d430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d2fff0,_jstart=0x7fee58d30240,_binindices=0x7fee5922d830,
 _binxy=2,_centroidw=0x7fee5916c3d8,_fimage=0x7fee59864a30,_fimage2=0x0,
 _imistart=0x7fee58c52720,_imjstart=0x7fee58c57ee0,_imistart2=0x7fee58c58130,
 _imjstart2=0x7fee58c58380,_unittip=0x7fee58d2fae0,_unittilt=0x7fee58d21870,
 _lgs_defocuses=0x7fee5916b988,_unitdefocus=0x113c97030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5a823a30,_flat=0x7fee5a802e30,_domask=1,
 _submask=0x7fee5a822c30,_kernel=0x7fee5925ca30,_kernels=0x10f19a030,_kerfftr=
 0x10ee83030,_kerffti=0x1125dd030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee598b8a30,_x=0x7fee5989ae30,_y=0x7fee598abc30,_centroidgain=1,_rayleigh=
 0x7fee5916b838,_bckgrdcalib=0x7fee5a824430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5914bd48)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916bf08,_ctrlden=0x7fee5914c138,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c53860,_xlast=0x7fee58c573e0,_ylast=[0x7fee59285230,0x7fee59285230,
 0x7fee59285230],_y0=0x7fee591b1c30,_signus=0x7fee58c57560,_puppixoffset=[0,0],
 _nact=80,_def=0x11680d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58c53610,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5914c3a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5916c448,xposition=0x7fee5916b8a8,yposition=
 0x7fee5916b800,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5914c100,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.527      158.8
Field Avg  1.65                     54.9   0.527      158.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee598727e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58d2f1c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d27300,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1120f7030,_masks=0x0,_fluxpersub=0x7fee58d30dd0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58d31020,_skyfluxpersub=0x7fee58d31270,
 _nphotons=8824.39,_skynphotons=0,_tt=[0.00230778,0.00246452],_lastvalidtt=
 [0.00230778,0.00246452],_upttcommand=[0,0],_refmes=0x7fee5a016430,_tiprefv=
 0x7fee59964c30,_tiltrefv=0x7fee59964430,_tiprefvn=0x7fee59965430,_tiltrefvn=
 0x7fee59865230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d306d0,_jstart=0x7fee58d30920,_binindices=0x7fee59227e30,
 _binxy=2,_centroidw=0x7fee5916b870,_fimage=0x7fee59993830,_fimage2=0x0,
 _imistart=0x7fee58c58020,_imjstart=0x7fee58c58270,_imistart2=0x7fee58c584c0,
 _imjstart2=0x7fee58c52460,_unittip=0x7fee58d284a0,_unittilt=0x7fee58d270d0,
 _lgs_defocuses=0x7fee5916bf40,_unitdefocus=0x112760030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee59969c30,_flat=0x7fee59969230,_domask=1,
 _submask=0x7fee59968430,_kernel=0x7fee59223230,_kernels=0x10efee030,_kerfftr=
 0x10ef35030,_kerffti=0x10ee83030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee598aec30,_x=0x7fee598a8430,_y=0x7fee598a8a30,_centroidgain=1,_rayleigh=
 0x7fee5916bc68,_bckgrdcalib=0x7fee59224030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916bdb8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916bfe8,_ctrlden=0x7fee5914c3d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58d2f5d0,_xlast=0x7fee58d302c0,_ylast=[0x7fee598b2830,0x7fee598b2830,
 0x7fee598b2830],_y0=0x7fee59822830,_signus=0x7fee58d28060,_puppixoffset=[0,0],
 _nact=80,_def=0x116054030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58d25ad0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916b988,yposition=
 0x7fee5916c3d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       57.0   0.421      226.3
Field Avg  1.65                     57.0   0.421      226.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee591546b0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58d22ef0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d21bf0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x111df4030,_masks=0x0,_fluxpersub=0x7fee58c56000,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58c52460,_skyfluxpersub=0x7fee58c569b0,
 _nphotons=8824.39,_skynphotons=0,_tt=[0.00276647,0.005492],_lastvalidtt=
 [0.00276647,0.005492],_upttcommand=[0,0],_refmes=0x7fee59082430,_tiprefv=
 0x7fee5989b430,_tiltrefv=0x7fee599a9230,_tiprefvn=0x7fee59964c30,_tiltrefvn=
 0x7fee59964430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d21e40,_jstart=0x7fee58d22430,_binindices=0x7fee599a6030,
 _binxy=2,_centroidw=0x7fee5916bd80,_fimage=0x7fee598c7e30,_fimage2=0x0,
 _imistart=0x7fee58d22b20,_imjstart=0x7fee58d30880,_imistart2=0x7fee58d270d0,
 _imjstart2=0x7fee58d27320,_unittip=0x7fee58d20df0,_unittilt=0x7fee58d30080,
 _lgs_defocuses=0x7fee5914bd10,_unitdefocus=0x10fac4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee59214e30,_flat=0x7fee598aec30,_domask=1,
 _submask=0x7fee59215830,_kernel=0x7fee598c8830,_kernels=0x10f180030,_kerfftr=
 0x10f11a030,_kerffti=0x10efee030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee599a7e30,_x=0x7fee598b8830,_y=0x7fee59865230,_centroidgain=1,_rayleigh=
 0x7fee5916bc68,_bckgrdcalib=0x7fee599a8830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916bed0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916bdb8,_ctrlden=0x7fee5916bfe8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c538f0,_xlast=0x7fee58c53090,_ylast=[0x7fee59081430,0x7fee59081430,
 0x7fee59081430],_y0=0x7fee5922f630,_signus=0x7fee58c566f0,_puppixoffset=[0,0],
 _nact=80,_def=0x115298030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58e06300,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916c330,yposition=
 0x7fee5914c2c0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.544      148.6
Field Avg  1.65                     54.4   0.544      148.6
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee59153c10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58f03be0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d28290,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x114098030,_masks=0x0,_fluxpersub=0x7fee58c54e40,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58c55090,_skyfluxpersub=0x7fee58c552e0,
 _nphotons=8824.39,_skynphotons=0,_tt=[0.00148985,0.00096981],_lastvalidtt=
 [0.00148985,0.00096981],_upttcommand=[0,0],_refmes=0x7fee59176230,_tiprefv=
 0x7fee59218030,_tiltrefv=0x7fee598a9630,_tiprefvn=0x7fee59216830,_tiltrefvn=
 0x7fee59865230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d306d0,_jstart=0x7fee58d284e0,_binindices=0x7fee5922d830,
 _binxy=2,_centroidw=0x7fee5916c330,_fimage=0x7fee598bf430,_fimage2=0x0,
 _imistart=0x7fee58c542d0,_imjstart=0x7fee58c54520,_imistart2=0x7fee58c549a0,
 _imjstart2=0x7fee58c54bf0,_unittip=0x7fee58d28060,_unittilt=0x7fee58d20df0,
 _lgs_defocuses=0x7fee591429c0,_unitdefocus=0x1121f8030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5928c230,_flat=0x7fee598e1e30,_domask=1,
 _submask=0x7fee5928f630,_kernel=0x7fee598ab030,_kernels=0x10efec030,_kerfftr=
 0x10f31b030,_kerffti=0x10ee85030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee598aec30,_x=0x7fee598b8e30,_y=0x7fee598a8c30,_centroidgain=1,_rayleigh=
 0x7fee5916c560,_bckgrdcalib=0x7fee598e2830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5914c2c0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916c218,_ctrlden=0x7fee5916bdb8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c56c10,_xlast=0x7fee58c564a0,_ylast=[0x7fee5922f630,0x7fee5922f630,
 0x7fee5922f630],_y0=0x7fee59082430,_signus=0x7fee58c56000,_puppixoffset=[0,0],
 _nact=80,_def=0x114199030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58f029d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916b9c0,yposition=
 0x7fee5916bed0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.7   0.548      145.3
Field Avg  1.65                     54.7   0.548      145.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee591548d0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58d21bf0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58e066a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x112760030,_masks=0x0,_fluxpersub=0x7fee58c55700,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58c55950,_skyfluxpersub=0x7fee58c55ba0,
 _nphotons=8824.39,_skynphotons=0,_tt=[0.000462957,0.000134901],_lastvalidtt=
 [0.000462957,0.000134901],_upttcommand=[0,0],_refmes=0x7fee59822830,_tiprefv=
 0x7fee5a822430,_tiltrefv=0x7fee5928de30,_tiprefvn=0x7fee5a81d630,_tiltrefvn=
 0x7fee5928e630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58e07260,_jstart=0x7fee58e074b0,_binindices=0x7fee5922d830,
 _binxy=2,_centroidw=0x7fee59142a30,_fimage=0x7fee598f3a30,_fimage2=0x0,
 _imistart=0x7fee58c54dc0,_imjstart=0x7fee58c55010,_imistart2=0x7fee58c55260,
 _imjstart2=0x7fee58c554b0,_unittip=0x7fee58e06ce0,_unittilt=0x7fee58e05f80,
 _lgs_defocuses=0x7fee5916c138,_unitdefocus=0x111cf3030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee598a8c30,_flat=0x7fee598a9630,_domask=1,
 _submask=0x7fee59293030,_kernel=0x7fee59292230,_kernels=0x10f11a030,_kerfftr=
 0x10ee85030,_kerffti=0x10efec030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee598f4a30,_x=0x7fee5a000630,_y=0x7fee5a01b430,_centroidgain=1,_rayleigh=
 0x7fee5916c560,_bckgrdcalib=0x7fee598ba430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5914c410)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5914c3d8,_ctrlden=0x7fee5916c218,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58f03a60,_xlast=0x7fee58f03be0,_ylast=[0x7fee5a824830,0x7fee5a824830,
 0x7fee5a824830],_y0=0x7fee5a801230,_signus=0x7fee58f04080,_puppixoffset=[0,0],
 _nact=80,_def=0x115197030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58c56b60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916bdf0,yposition=
 0x7fee5916b838,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.7   0.549      141.9
Field Avg  1.65                     54.7   0.549      141.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee591539f0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c526c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d26910,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f706030,_masks=0x0,_fluxpersub=0x7fee58d306d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58d30920,_skyfluxpersub=0x7fee58d30b70,
 _nphotons=8824.39,_skynphotons=0,_tt=[-0.00040061,-0.00041062],_lastvalidtt=
 [-0.00040061,-0.00041062],_upttcommand=[0,0],_refmes=0x7fee59157830,_tiprefv=
 0x7fee5922a430,_tiltrefv=0x7fee59291a30,_tiprefvn=0x7fee59293030,_tiltrefvn=
 0x7fee5922ac30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d30060,_jstart=0x7fee58d21e20,_binindices=0x7fee5922d830,
 _binxy=2,_centroidw=0x7fee5916bdf0,_fimage=0x7fee598f1830,_fimage2=0x0,
 _imistart=0x7fee58c58110,_imjstart=0x7fee58c58360,_imistart2=0x7fee58c556f0,
 _imjstart2=0x7fee58c53e30,_unittip=0x7fee58d21bf0,_unittilt=0x7fee58d26390,
 _lgs_defocuses=0x7fee5916be60,_unitdefocus=0x10eeeb030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee59284c30,_flat=0x7fee59226630,_domask=1,
 _submask=0x7fee598dfa30,_kernel=0x7fee59288630,_kernels=0x10efec030,_kerfftr=
 0x10f41c030,_kerffti=0x10f180030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee598aec30,_x=0x7fee598ab030,_y=0x7fee598b8830,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee59227030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916b838)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916c5d0,_ctrlden=0x7fee5914c3d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c56e90,_xlast=0x7fee58c57010,_ylast=[0x7fee59286a30,0x7fee59286a30,
 0x7fee59286a30],_y0=0x7fee59176230,_signus=0x7fee58c55fb0,_puppixoffset=[0,0],
 _nact=80,_def=0x115197030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58d25b30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5914c410,yposition=
 0x7fee5916bd10,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.7   0.548      141.9
Field Avg  1.65                     54.7   0.548      141.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee59153c98)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c538f0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d21bf0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1121f8030,_masks=0x0,_fluxpersub=0x7fee58c543d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58c58540,_skyfluxpersub=0x7fee58c58790,
 _nphotons=8824.39,_skynphotons=0,_tt=[-0.00133284,-0.00135035],_lastvalidtt=
 [-0.00133284,-0.00135035],_upttcommand=[0,0],_refmes=0x7fee59822830,_tiprefv=
 0x7fee598e3030,_tiltrefv=0x7fee5a000a30,_tiprefvn=0x7fee598e3830,_tiltrefvn=
 0x7fee5a018430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d2f040,_jstart=0x7fee58d20df0,_binindices=0x7fee5a017230,
 _binxy=2,_centroidw=0x7fee5916c4b8,_fimage=0x7fee59291830,_fimage2=0x0,
 _imistart=0x7fee58e06c50,_imjstart=0x7fee58e06ea0,_imistart2=0x7fee58e070f0,
 _imjstart2=0x7fee58e07340,_unittip=0x7fee58d26130,_unittilt=0x7fee58d302b0,
 _lgs_defocuses=0x7fee5914c2c0,_unitdefocus=0x1123f9030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee59229e30,_flat=0x7fee59905230,_domask=1,
 _submask=0x7fee5922d830,_kernel=0x7fee5a01f830,_kernels=0x10ee85030,_kerfftr=
 0x10f180030,_kerffti=0x10efec030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee59286030,_x=0x7fee598ab030,_y=0x7fee598ab630,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee598af230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916c410)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916bdb8,_ctrlden=0x7fee5916c5d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c60540,_xlast=0x7fee58c606c0,_ylast=[0x7fee59176230,0x7fee59176230,
 0x7fee59176230],_y0=0x7fee5906bc30,_signus=0x7fee58c56e20,_puppixoffset=[0,0],
 _nact=80,_def=0x11459a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58f029d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916c330,yposition=
 0x7fee5916bfe8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.515      165.5
Field Avg  1.65                     55.4   0.515      165.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee59153b88)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58d28060,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d26130,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10fac4030,_masks=0x0,_fluxpersub=0x7fee58d27a60,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58d284d0,_skyfluxpersub=0x7fee58d28720,
 _nphotons=8824.39,_skynphotons=0,_tt=[-0.00608481,0.00306611],_lastvalidtt=
 [-0.00608481,0.00306611],_upttcommand=[0,0],_refmes=0x7fee598aba30,_tiprefv=
 0x7fee598ab030,_tiltrefv=0x7fee5a01be30,_tiprefvn=0x7fee598e3030,_tiltrefvn=
 0x7fee5a000a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d275c0,_jstart=0x7fee58d27810,_binindices=0x7fee5922d830,
 _binxy=2,_centroidw=0x7fee5916b9c0,_fimage=0x7fee59938430,_fimage2=0x0,
 _imistart=0x7fee58c56940,_imjstart=0x7fee58c56b90,_imistart2=0x7fee58c56de0,
 _imjstart2=0x7fee58c581c0,_unittip=0x7fee58d20df0,_unittilt=0x7fee58d2f290,
 _lgs_defocuses=0x7fee5914c410,_unitdefocus=0x10fbc5030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5992b630,_flat=0x7fee5928b430,_domask=1,
 _submask=0x7fee59929830,_kernel=0x7fee59227430,_kernels=0x10eeeb030,_kerfftr=
 0x10efec030,_kerffti=0x10ee85030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee59937a30,_x=0x7fee598a9630,_y=0x7fee5989b430,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee5928aa30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916b870)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916c170,_ctrlden=0x7fee5916bdb8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c538f0,_xlast=0x7fee58c53e30,_ylast=[0x7fee5906bc30,0x7fee5906bc30,
 0x7fee5906bc30],_y0=0x7fee59291e30,_signus=0x7fee58c54270,_puppixoffset=[0,0],
 _nact=80,_def=0x115197030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58f03140,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916b838,yposition=
 0x7fee5916c480,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.7,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       60.0   0.348      280.4
Field Avg  1.65                     60.0   0.348      280.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee59154380)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58d26b70,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58c58080,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x115096030,_masks=0x0,_fluxpersub=0x7fee58c58770,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58c589c0,_skyfluxpersub=0x7fee58c564a0,
 _nphotons=8824.39,_skynphotons=0,_tt=[-0.00707261,-0.0094574],_lastvalidtt=
 [-0.00707261,-0.0094574],_upttcommand=[0,0],_refmes=0x7fee5a801230,_tiprefv=
 0x7fee598aec30,_tiltrefv=0x7fee5989b430,_tiprefvn=0x7fee598ab030,_tiltrefvn=
 0x7fee59929c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58c582d0,_jstart=0x7fee58c58520,_binindices=0x7fee5996ba30,
 _binxy=2,_centroidw=0x7fee5916bd48,_fimage=0x7fee59973030,_fimage2=0x0,
 _imistart=0x7fee58d2bd00,_imjstart=0x7fee58d2bf50,_imistart2=0x7fee58d2c1a0,
 _imjstart2=0x7fee58d30060,_unittip=0x7fee58c57c20,_unittilt=0x7fee58c57e50,
 _lgs_defocuses=0x7fee5916c250,_unitdefocus=0x10f31b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee59969630,_flat=0x7fee5996e030,_domask=1,
 _submask=0x7fee5922d830,_kernel=0x7fee5996d230,_kernels=0x10ef51030,_kerfftr=
 0x10ee85030,_kerffti=0x10eeeb030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee5996c830,_x=0x7fee5922b630,_y=0x7fee59228230,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee5996ea30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5914bd10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916b870,_ctrlden=0x7fee5916c170,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c56c00,_xlast=0x7fee58c538f0,_ylast=[0x7fee59291e30,0x7fee59291e30,
 0x7fee59291e30],_y0=0x7fee59081430,_signus=0x7fee58c56d80,_puppixoffset=[0,0],
 _nact=80,_def=0x11459a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58d2f5f0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916c218,yposition=
 0x7fee5916c410,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.8,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       68.5   0.163      388.5
Field Avg  1.65                     68.5   0.163      388.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee59154a68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c57220,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58c59150,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f907030,_masks=0x0,_fluxpersub=0x7fee58c56e50,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58c57c10,_skyfluxpersub=0x7fee58c57e60,
 _nphotons=8824.39,_skynphotons=0,_tt=[0.0237107,0.0135297],_lastvalidtt=
 [0.0237107,0.0135297],_upttcommand=[0,0],_refmes=0x7fee5906bc30,_tiprefv=
 0x7fee59288630,_tiltrefv=0x7fee5a01de30,_tiprefvn=0x7fee59288e30,_tiltrefvn=
 0x7fee5a01ba30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58c580c0,_jstart=0x7fee58c58310,_binindices=0x7fee5927e430,
 _binxy=2,_centroidw=0x7fee5916c1e0,_fimage=0x7fee59228830,_fimage2=0x0,
 _imistart=0x7fee58c58b60,_imjstart=0x7fee58c57770,_imistart2=0x7fee58c579c0,
 _imjstart2=0x7fee58c56c00,_unittip=0x7fee58c564c0,_unittilt=0x7fee58c538f0,
 _lgs_defocuses=0x7fee5916c3a0,_unitdefocus=0x10f21a030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5922b030,_flat=0x7fee598b8830,_domask=1,
 _submask=0x7fee59289e30,_kernel=0x7fee59282230,_kernels=0x10efb7030,_kerfftr=
 0x10eeeb030,_kerffti=0x10ef51030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee59227430,_x=0x7fee59228230,_y=0x7fee5927a430,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee598ab030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5914c100)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5914bd10,_ctrlden=0x7fee5916b870,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58d20df0,_xlast=0x7fee58d27890,_ylast=[0x7fee59801430,0x7fee59801430,
 0x7fee59801430],_y0=0x7fee59822830,_signus=0x7fee58d27a10,_puppixoffset=[0,0],
 _nact=80,_def=0x115197030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58d306d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916c0c8,yposition=
 0x7fee5914c3d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    88.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       66.8   0.167      388.5
Field Avg  1.65                     66.8   0.167      388.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee591537d0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c598d0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58c56920,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1123f9030,_masks=0x0,_fluxpersub=0x7fee58e07110,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58e07360,_skyfluxpersub=0x7fee58e075b0,
 _nphotons=88.2439,_skynphotons=0,_tt=[-0.00472266,-0.0269029],_lastvalidtt=
 [-0.00472266,-0.0269029],_upttcommand=[0,0],_refmes=0x7fee598af830,_tiprefv=
 0x7fee59950830,_tiltrefv=0x7fee5a000a30,_tiprefvn=0x7fee59951030,_tiltrefvn=
 0x7fee59950030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58c56b70,_jstart=0x7fee58c56dc0,_binindices=0x7fee5999ee30,
 _binxy=2,_centroidw=0x7fee5916bed0,_fimage=0x7fee5927a430,_fimage2=0x0,
 _imistart=0x7fee58d265d0,_imjstart=0x7fee58d26820,_imistart2=0x7fee58d26a70,
 _imjstart2=0x7fee58d26cc0,_unittip=0x7fee58c564c0,_unittilt=0x7fee58c566f0,
 _lgs_defocuses=0x7fee5916c138,_unitdefocus=0x1120f7030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5a049e30,_flat=0x7fee5a019a30,_domask=1,
 _submask=0x7fee5a01b430,_kernel=0x7fee59949630,_kernels=0x10ee85030,_kerfftr=
 0x10ef51030,_kerffti=0x10efb7030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee59291630,_x=0x7fee5922e030,_y=0x7fee5922b430,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee5a04a830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916be98)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916bdb8,_ctrlden=0x7fee5914bd10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58d25b40,_xlast=0x7fee58d2f300,_ylast=[0x7fee59822830,0x7fee59822830,
 0x7fee59822830],_y0=0x7fee598aba30,_signus=0x7fee58d20df0,_puppixoffset=[0,0],
 _nact=80,_def=0x11459a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58f029d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916b988,yposition=
 0x7fee5916c5d0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    88.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       60.0   0.346      280.4
Field Avg  1.65                     60.0   0.346      280.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee59153d20)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58d28c00,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58c57360,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10fbc5030,_masks=0x0,_fluxpersub=0x7fee58d20df0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58d27280,_skyfluxpersub=0x7fee58d26390,
 _nphotons=88.2439,_skynphotons=0,_tt=[0.000305179,-0.00451818],_lastvalidtt=
 [0.000305179,-0.00451818],_upttcommand=[0,0],_refmes=0x7fee59801430,_tiprefv=
 0x7fee5a018630,_tiltrefv=0x7fee5a017e30,_tiprefvn=0x7fee5a01be30,_tiltrefvn=
 0x7fee5a000a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58c575b0,_jstart=0x7fee58c57800,_binindices=0x7fee5928d230,
 _binxy=2,_centroidw=0x7fee5916be28,_fimage=0x7fee592bf030,_fimage2=0x0,
 _imistart=0x7fee58c58050,_imjstart=0x7fee58c582a0,_imistart2=0x7fee58c584f0,
 _imjstart2=0x7fee58c58740,_unittip=0x7fee58c59b60,_unittilt=0x7fee58c57130,
 _lgs_defocuses=0x7fee5916bfb0,_unitdefocus=0x111df4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5928fe30,_flat=0x7fee59290830,_domask=1,
 _submask=0x7fee5992c630,_kernel=0x7fee5928f030,_kernels=0x10eeeb030,_kerfftr=
 0x10efb7030,_kerffti=0x10ee85030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee5922d830,_x=0x7fee5922ac30,_y=0x7fee5922b230,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee59291230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916bdf0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916be98,_ctrlden=0x7fee5916bdb8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58d302c0,_xlast=0x7fee58d25ad0,_ylast=[0x7fee598aba30,0x7fee598aba30,
 0x7fee598aba30],_y0=0x7fee59933430,_signus=0x7fee58d315b0,_puppixoffset=[0,0],
 _nact=80,_def=0x115197030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58c57a50,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5914c100,yposition=
 0x7fee5916c100,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.8,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    88.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.515      165.5
Field Avg  1.65                     55.4   0.515      165.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee591542f8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c573e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d20df0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f31b030,_masks=0x0,_fluxpersub=0x7fee58d30920,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58d2bdd0,_skyfluxpersub=0x7fee58d2c020,
 _nphotons=88.2439,_skynphotons=0,_tt=[-0.00608566,0.0030561],_lastvalidtt=
 [-0.00608566,0.0030561],_upttcommand=[0,0],_refmes=0x7fee5a016430,_tiprefv=
 0x7fee59288e30,_tiltrefv=0x7fee59288630,_tiprefvn=0x7fee59289e30,_tiltrefvn=
 0x7fee5928a630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d2f060,_jstart=0x7fee58d306d0,_binindices=0x7fee59291430,
 _binxy=2,_centroidw=0x7fee5916c528,_fimage=0x7fee59290230,_fimage2=0x0,
 _imistart=0x7fee58c56aa0,_imjstart=0x7fee58c56cf0,_imistart2=0x7fee58c56f40,
 _imjstart2=0x7fee58c57190,_unittip=0x7fee58d30290,_unittilt=0x7fee58d28060,
 _lgs_defocuses=0x7fee5916c3d8,_unitdefocus=0x114098030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5922ee30,_flat=0x7fee5922d830,_domask=1,
 _submask=0x7fee598aec30,_kernel=0x7fee5928dc30,_kernels=0x10ef51030,_kerfftr=
 0x10ee85030,_kerffti=0x10eeeb030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee5928f430,_x=0x7fee598ab830,_y=0x7fee598a8c30,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee5928ea30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916c2f8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916bdf0,_ctrlden=0x7fee5916be98,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c538f0,_xlast=0x7fee58c58270,_ylast=[0x7fee59176230,0x7fee59176230,
 0x7fee59176230],_y0=0x7fee59082430,_signus=0x7fee58c583f0,_puppixoffset=[0,0],
 _nact=80,_def=0x11459a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58d25ad0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916bf40,yposition=
 0x7fee5916c170,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.7,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    88.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.7   0.548      141.9
Field Avg  1.65                     54.7   0.548      141.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee59153968)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58d28060,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58c58270,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f21a030,_masks=0x0,_fluxpersub=0x7fee58c56c70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58c56ec0,_skyfluxpersub=0x7fee58c569f0,
 _nphotons=88.2439,_skynphotons=0,_tt=[-0.0013329,-0.00135038],_lastvalidtt=
 [-0.0013329,-0.00135038],_upttcommand=[0,0],_refmes=0x7fee59157830,_tiprefv=
 0x7fee5a017a30,_tiltrefv=0x7fee59288e30,_tiprefvn=0x7fee5a000a30,_tiltrefvn=
 0x7fee59288630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58c584c0,_jstart=0x7fee58c58710,_binindices=0x7fee5a81f430,
 _binxy=2,_centroidw=0x7fee5916bd10,_fimage=0x7fee5995e030,_fimage2=0x0,
 _imistart=0x7fee58f05ac0,_imjstart=0x7fee58f05d10,_imistart2=0x7fee58f03140,
 _imjstart2=0x7fee58f03390,_unittip=0x7fee58c538f0,_unittilt=0x7fee58c53090,
 _lgs_defocuses=0x7fee5914c2c0,_unitdefocus=0x112760030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee598b8830,_flat=0x7fee598a8c30,_domask=1,
 _submask=0x7fee5928b830,_kernel=0x7fee5a018230,_kernels=0x10efb7030,_kerfftr=
 0x10eeeb030,_kerffti=0x10ef51030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee5995c630,_x=0x7fee5928a630,_y=0x7fee5928ac30,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee598aec30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5914c218)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5914bd10,_ctrlden=0x7fee5916bdf0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58f04210,_xlast=0x7fee58f04390,_ylast=[0x7fee5a801230,0x7fee5a801230,
 0x7fee5a801230],_y0=0x7fee5a820430,_signus=0x7fee58f05200,_puppixoffset=[0,0],
 _nact=80,_def=0x115197030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58d2f5d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916b870,yposition=
 0x7fee5916bc68,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.6,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    88.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.7   0.549      141.9
Field Avg  1.65                     54.7   0.549      141.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee591545a0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58d27980,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d2f270,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1120f7030,_masks=0x0,_fluxpersub=0x7fee58c54200,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58e07110,_skyfluxpersub=0x7fee58e07360,
 _nphotons=88.2439,_skynphotons=0,_tt=[-0.000400608,-0.000410616],_lastvalidtt=
 [-0.000400608,-0.000410616],_upttcommand=[0,0],_refmes=0x7fee5922ba30,_tiprefv=
 0x7fee5a81fa30,_tiltrefv=0x7fee5a017c30,_tiprefvn=0x7fee5a821230,_tiltrefvn=
 0x7fee5a01a430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d30060,_jstart=0x7fee58d306d0,_binindices=0x7fee59222830,
 _binxy=2,_centroidw=0x7fee5916c218,_fimage=0x7fee59949e30,_fimage2=0x0,
 _imistart=0x7fee58c54c60,_imjstart=0x7fee58c54eb0,_imistart2=0x7fee58c55100,
 _imjstart2=0x7fee58c53fb0,_unittip=0x7fee58d20e10,_unittilt=0x7fee58d2f040,
 _lgs_defocuses=0x7fee5916bf40,_unitdefocus=0x111cf3030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5a019a30,_flat=0x7fee5a017230,_domask=1,
 _submask=0x7fee59289e30,_kernel=0x7fee59224a30,_kernels=0x10ee85030,_kerfftr=
 0x10ef51030,_kerffti=0x10efb7030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee59949430,_x=0x7fee598ab830,_y=0x7fee598b8e30,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee5a018430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916bd80)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916bdb8,_ctrlden=0x7fee5914bd10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c52460,_xlast=0x7fee58c569d0,_ylast=[0x7fee5906bc30,0x7fee5906bc30,
 0x7fee5906bc30],_y0=0x7fee59157830,_signus=0x7fee58c564a0,_puppixoffset=[0,0],
 _nact=80,_def=0x11459a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58f029d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916c2f8,yposition=
 0x7fee5916be60,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    88.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.7   0.548      145.3
Field Avg  1.65                     54.7   0.548      145.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee591536c0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58d32060,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d27c10,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x111df4030,_masks=0x0,_fluxpersub=0x7fee58c526b0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58d30060,_skyfluxpersub=0x7fee58d306d0,
 _nphotons=88.2439,_skynphotons=0,_tt=[0.000462932,0.000134863],_lastvalidtt=
 [0.000462932,0.000134863],_upttcommand=[0,0],_refmes=0x7fee5a016430,_tiprefv=
 0x7fee59949430,_tiltrefv=0x7fee598aec30,_tiprefvn=0x7fee598d8230,_tiltrefvn=
 0x7fee598d9430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d20df0,_jstart=0x7fee58d2f040,_binindices=0x7fee5922d830,
 _binxy=2,_centroidw=0x7fee5916c0c8,_fimage=0x7fee598d7830,_fimage2=0x0,
 _imistart=0x7fee58c54390,_imjstart=0x7fee58c545e0,_imistart2=0x7fee58c54830,
 _imjstart2=0x7fee58c52460,_unittip=0x7fee58d27320,_unittilt=0x7fee58d302b0,
 _lgs_defocuses=0x7fee5916b870,_unitdefocus=0x10f706030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5996de30,_flat=0x7fee5996fe30,_domask=1,
 _submask=0x7fee59225830,_kernel=0x7fee5928e430,_kernels=0x10eeeb030,_kerfftr=
 0x10efb7030,_kerffti=0x10ee85030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee598e1e30,_x=0x7fee59949c30,_y=0x7fee59970e30,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee5995c830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5914c2f8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5914c0c8,_ctrlden=0x7fee5916bdb8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58d25ad0,_xlast=0x7fee58d2f5d0,_ylast=[0x7fee59822830,0x7fee59822830,
 0x7fee59822830],_y0=0x7fee59801430,_signus=0x7fee58d27950,_puppixoffset=[0,0],
 _nact=80,_def=0x115197030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58d26130,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916b8a8,yposition=
 0x7fee5914c218,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    88.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.544      148.6
Field Avg  1.65                     54.4   0.544      148.6
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee591549e0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c551a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d27300,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x114098030,_masks=0x0,_fluxpersub=0x7fee58d306f0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58d30940,_skyfluxpersub=0x7fee58d30b90,
 _nphotons=88.2439,_skynphotons=0,_tt=[0.00148981,0.000969775],_lastvalidtt=
 [0.00148981,0.000969775],_upttcommand=[0,0],_refmes=0x7fee5a000030,_tiprefv=
 0x7fee59290630,_tiltrefv=0x7fee598af430,_tiprefvn=0x7fee59290e30,_tiltrefvn=
 0x7fee598aec30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d27550,_jstart=0x7fee58d277a0,_binindices=0x7fee5922b030,
 _binxy=2,_centroidw=0x7fee5916b838,_fimage=0x7fee59218630,_fimage2=0x0,
 _imistart=0x7fee58c55a20,_imjstart=0x7fee58c55c70,_imistart2=0x7fee58c55ec0,
 _imjstart2=0x7fee58c56110,_unittip=0x7fee58d2f180,_unittilt=0x7fee58d270d0,
 _lgs_defocuses=0x7fee5916c2f8,_unitdefocus=0x1121f8030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5922a630,_flat=0x7fee5922d830,_domask=1,
 _submask=0x7fee598cec30,_kernel=0x7fee5927ae30,_kernels=0x10ef51030,_kerfftr=
 0x10ee85030,_kerffti=0x10eeeb030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee59216c30,_x=0x7fee598a8c30,_y=0x7fee598b8830,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee5927bc30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916c330)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5914c2f8,_ctrlden=0x7fee5914c0c8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c53470,_xlast=0x7fee58c52900,_ylast=[0x7fee59224430,0x7fee59224430,
 0x7fee59224430],_y0=0x7fee59227a30,_signus=0x7fee58c53e30,_puppixoffset=[0,0],
 _nact=80,_def=0x11459a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58d25ad0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916bd80,yposition=
 0x7fee5916be98,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    88.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.527      158.8
Field Avg  1.65                     54.9   0.527      158.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee591546b0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c55090,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d277f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x112760030,_masks=0x0,_fluxpersub=0x7fee58d2cf70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58d2dbd0,_skyfluxpersub=0x7fee58d2de20,
 _nphotons=88.2439,_skynphotons=0,_tt=[0.00230777,0.00246451],_lastvalidtt=
 [0.00230777,0.00246451],_upttcommand=[0,0],_refmes=0x7fee5a01a830,_tiprefv=
 0x7fee5a000830,_tiltrefv=0x7fee5a000030,_tiprefvn=0x7fee5a02a830,_tiltrefvn=
 0x7fee5a02d030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d27a40,_jstart=0x7fee58d2cd20,_binindices=0x7fee59291430,
 _binxy=2,_centroidw=0x7fee5914c3d8,_fimage=0x7fee5927c230,_fimage2=0x0,
 _imistart=0x7fee58c54450,_imjstart=0x7fee58c546a0,_imistart2=0x7fee58c548f0,
 _imjstart2=0x7fee58c54b40,_unittip=0x7fee58d27390,_unittilt=0x7fee58d275c0,
 _lgs_defocuses=0x7fee5916c138,_unitdefocus=0x10fac4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5927a430,_flat=0x7fee5922b030,_domask=1,
 _submask=0x7fee598a8c30,_kernel=0x7fee59289e30,_kernels=0x10efb7030,_kerfftr=
 0x10eeeb030,_kerffti=0x10ef51030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee5927d030,_x=0x7fee59899c30,_y=0x7fee598b8830,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee5928ac30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916b950)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5914bd10,_ctrlden=0x7fee5914c2f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c532e0,_xlast=0x7fee58c53460,_ylast=[0x7fee59227a30,0x7fee59227a30,
 0x7fee59227a30],_y0=0x7fee59082430,_signus=0x7fee58c52720,_puppixoffset=[0,0],
 _nact=80,_def=0x115197030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58e01360,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916bdf0,yposition=
 0x7fee5916c058,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    88.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       57.0   0.421      226.3
Field Avg  1.65                     57.0   0.421      226.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee59154848)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58d28d60,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d28290,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x111cf3030,_masks=0x0,_fluxpersub=0x7fee58c54730,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58c54980,_skyfluxpersub=0x7fee58c565e0,
 _nphotons=88.2439,_skynphotons=0,_tt=[0.00276645,0.005492],_lastvalidtt=
 [0.00276645,0.005492],_upttcommand=[0,0],_refmes=0x7fee5922ba30,_tiprefv=
 0x7fee59228630,_tiltrefv=0x7fee5921de30,_tiprefvn=0x7fee59216230,_tiltrefvn=
 0x7fee5922a030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d284e0,_jstart=0x7fee58d28730,_binindices=0x7fee59288630,
 _binxy=2,_centroidw=0x7fee5916c5d0,_fimage=0x7fee598dd430,_fimage2=0x0,
 _imistart=0x7fee58c55be0,_imjstart=0x7fee58c55e30,_imistart2=0x7fee58c54290,
 _imjstart2=0x7fee58c544e0,_unittip=0x7fee58d2f290,_unittilt=0x7fee58d28060,
 _lgs_defocuses=0x7fee5916bfb0,_unitdefocus=0x115096030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee598c8830,_flat=0x7fee598c9230,_domask=1,
 _submask=0x7fee5928e830,_kernel=0x7fee59228e30,_kernels=0x10ee85030,_kerfftr=
 0x10ef51030,_kerffti=0x10efb7030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee598dca30,_x=0x7fee598ab830,_y=0x7fee598c7c30,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee598c9c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916c528)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916bdb8,_ctrlden=0x7fee5914bd10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c53fb0,_xlast=0x7fee58c53240,_ylast=[0x7fee59082430,0x7fee59082430,
 0x7fee59082430],_y0=0x7fee59157830,_signus=0x7fee58c56af0,_puppixoffset=[0,0],
 _nact=80,_def=0x11459a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58e06300,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916c330,yposition=
 0x7fee5916bd10,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    17648.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.524      162.2
Field Avg  1.65                     55.4   0.524      162.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee591548d0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c56620,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d29460,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f706030,_masks=0x0,_fluxpersub=0x7fee58d2a420,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58d2a670,_skyfluxpersub=0x7fee58d2a8c0,
 _nphotons=17648.8,_skynphotons=0,_tt=[-0.00709864,-0.000668633],_lastvalidtt=
 [-0.00709864,-0.000668633],_upttcommand=[0,0],_refmes=0x7fee59801430,_tiprefv=
 0x7fee5a017a30,_tiltrefv=0x7fee598c7630,_tiprefvn=0x7fee5a000a30,_tiltrefvn=
 0x7fee598c7e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d2a1d0,_jstart=0x7fee58d28060,_binindices=0x7fee5922d830,
 _binxy=2,_centroidw=0x7fee5916c100,_fimage=0x7fee59228630,_fimage2=0x0,
 _imistart=0x7fee58c55070,_imjstart=0x7fee58c52720,_imistart2=0x7fee58c53fb0,
 _imjstart2=0x7fee58c54200,_unittip=0x7fee58d28750,_unittilt=0x7fee58d29df0,
 _lgs_defocuses=0x7fee5916bfe8,_unitdefocus=0x10f907030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee59229030,_flat=0x7fee5928b830,_domask=1,
 _submask=0x7fee598ce830,_kernel=0x7fee59226a30,_kernels=0x10eeeb030,_kerfftr=
 0x10efb7030,_kerffti=0x10ee85030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee59226030,_x=0x7fee598cc430,_y=0x7fee598c8630,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee5928c230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916b918)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916c528,_ctrlden=0x7fee5916bdb8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c53e30,_xlast=0x7fee58c53090,_ylast=[0x7fee59157830,0x7fee59157830,
 0x7fee59157830],_y0=0x7fee5922a430,_signus=0x7fee58c52460,_puppixoffset=[0,0],
 _nact=80,_def=0x115197030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58e01360,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5916b950,yposition=
 0x7fee5916c3a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    264.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       53.9   0.559      148.6
Field Avg  1.65                     53.9   0.559      148.6
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee5900da50)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c56870,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58f03860,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1121f8030,_masks=0x0,_fluxpersub=0x7fee58c53fb0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58c56620,_skyfluxpersub=0x7fee58c538f0,
 _nphotons=264.732,_skynphotons=0,_tt=[3.0548e-05,-3.83987e-05],_lastvalidtt=
 [3.0548e-05,-3.83987e-05],_upttcommand=[0,0],_refmes=0x7fee598b9030,_tiprefv=
 0x7fee598ba430,_tiltrefv=0x7fee59280830,_tiprefvn=0x7fee5a017a30,_tiltrefvn=
 0x7fee59281030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58f03ab0,_jstart=0x7fee58f03d00,_binindices=0x7fee598aec30,
 _binxy=2,_centroidw=0x7fee5916c170,_fimage=0x7fee592c9030,_fimage2=0x0,
 _imistart=0x7fee58d287d0,_imjstart=0x7fee58d28a20,_imistart2=0x7fee58d28c70,
 _imjstart2=0x7fee58d28ec0,_unittip=0x7fee58f03400,_unittilt=0x7fee58f03630,
 _lgs_defocuses=0x7fee5916c480,_unitdefocus=0x1123f9030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee598cb830,_flat=0x7fee598cc230,_domask=1,
 _submask=0x7fee5922a830,_kernel=0x7fee598caa30,_kernels=0x10ef51030,_kerfftr=
 0x10ee85030,_kerffti=0x10eeeb030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee5922ee30,_x=0x7fee5a803430,_y=0x7fee5a81d630,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee598ccc30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916c218)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916b918,_ctrlden=0x7fee5916c528,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c56c50,_xlast=0x7fee58c53e30,_ylast=[0x7fee5922a430,0x7fee5922a430,
 0x7fee5922a430],_y0=0x7fee59176230,_signus=0x7fee58c55fc0,_puppixoffset=[0,0],
 _nact=80,_def=0x11459a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58d25af0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5914c0c8,yposition=
 0x7fee5914c410,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=3e-05,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    88.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.531      192.6
Field Avg  1.65                     54.1   0.531      192.6
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.2;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873398,layerfrac=0x7fee59873310,
 layerspeed=0x7fee59873288,layeralt=0x7fee59873200,winddir=0x7fee598728f8,
 _layeralt=0x7fee59154af0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916b800,lgs_prof_alt=0x7fee5916c448,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c564a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58e07e90,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10fac4030,_masks=0x0,_fluxpersub=0x7fee58d306d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58d270d0,_skyfluxpersub=0x7fee58d20df0,
 _nphotons=88.2439,_skynphotons=0,_tt=[-0.00029809,7.27152e-05],_lastvalidtt=
 [-0.00029809,7.27152e-05],_upttcommand=[0,0],_refmes=0x7fee598b9030,_tiprefv=
 0x7fee59229c30,_tiltrefv=0x7fee59229430,_tiprefvn=0x7fee59225e30,_tiltrefvn=
 0x7fee59280830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58e080e0,_jstart=0x7fee58e07340,_binindices=0x7fee5922a430,
 _binxy=2,_centroidw=0x7fee5916b8a8,_fimage=0x7fee59214e30,_fimage2=0x0,
 _imistart=0x7fee58c548c0,_imjstart=0x7fee58c54b10,_imistart2=0x7fee58c54d60,
 _imjstart2=0x7fee58c54fb0,_unittip=0x7fee58e07c60,_unittilt=0x7fee58e07110,
 _lgs_defocuses=0x7fee5916b950,_unitdefocus=0x10fbc5030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee59228630,_flat=0x7fee59284c30,_domask=1,
 _submask=0x7fee598a8c30,_kernel=0x7fee59288630,_kernels=0x10efb7030,_kerfftr=
 0x10eeeb030,_kerffti=0x10ef51030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee59286030,_x=0x7fee5a017a30,_y=0x7fee5a019c30,_centroidgain=1,_rayleigh=
 0x7fee59142988,_bckgrdcalib=0x7fee59285630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916c2c0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916b988,_ctrlden=0x7fee5916b918,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c538f0,_xlast=0x7fee58c54200,_ylast=[0x7fee59176230,0x7fee59176230,
 0x7fee59176230],_y0=0x7fee59291e30,_signus=0x7fee58c52460,_puppixoffset=[0,0],
 _nact=80,_def=0x115197030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58e06300,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916bf08,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5914c138,xposition=0x7fee5914c2f8,yposition=
 0x7fee5916c250,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b790,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=1e-05,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    88.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.507      168.9
Field Avg  1.65                     55.4   0.507      168.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873310,layerfrac=0x7fee59873288,
 layerspeed=0x7fee59873398,layeralt=0x7fee59154518,winddir=0x7fee591541e8,
 _layeralt=0x7fee59153fc8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5914bd10,lgs_prof_alt=0x7fee5914c138,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c54da0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d2e260,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=108,
 _nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f907030,_masks=0x0,_fluxpersub=0x7fee58e05f80,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58d2e950,_skyfluxpersub=0x7fee58d2d440,
 _nphotons=8824.39,_skynphotons=0,_tt=[-0.000913937,0.00122641],_lastvalidtt=
 [-0.000913937,0.00122641],_upttcommand=[0,0],_refmes=0x7fee58d2dec0,_tiprefv=
 0x7fee5a019230,_tiltrefv=0x7fee5a018a30,_tiprefvn=0x7fee5a019a30,_tiltrefvn=
 0x7fee5a018030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d2e4b0,_jstart=0x7fee58d2e700,_binindices=0x7fee5927fa30,
 _binxy=2,_centroidw=0x7fee5916bfb0,_fimage=0x7fee598a9230,_fimage2=0x0,
 _imistart=0x7fee58c54ff0,_imjstart=0x7fee58c55240,_imistart2=0x7fee58c55490,
 _imjstart2=0x7fee58c55780,_unittip=0x7fee58d20e10,_unittilt=0x7fee58d2f7f0,
 _lgs_defocuses=0x7fee5916c1e0,_unitdefocus=0x10f31b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5a802e30,_flat=0x7fee5a81d030,_domask=1,
 _submask=0x7fee5a017230,_kernel=0x7fee59285c30,_kernels=0x10f01d030,_kerfftr=
 0x10efb7030,_kerffti=0x10eeeb030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee598aec30,_x=0x7fee598ab830,_y=0x7fee598a8c30,_centroidgain=1,_rayleigh=
 0x7fee5916bfe8,_bckgrdcalib=0x7fee5a81da30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916c288)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916c448,_ctrlden=0x7fee5916be98,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c53090,_xlast=0x7fee58c54590,_ylast=[0x7fee59176230,0x7fee59176230,
 0x7fee59176230],_y0=0x7fee5927dc30,_signus=0x7fee58c54710,_puppixoffset=[0,0],
 _nact=80,_def=0x116d0f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58d2eba0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916c410,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5916b918,xposition=0x7fee5916c2f8,yposition=
 0x7fee5916c560,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b800,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    264.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.503      185.8
Field Avg  1.65                     54.4   0.503      185.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873310,layerfrac=0x7fee59873288,
 layerspeed=0x7fee59873398,layeralt=0x7fee59154518,winddir=0x7fee591541e8,
 _layeralt=0x7fee59153a78)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5914bd10,lgs_prof_alt=0x7fee5914c138,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c54dd0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d20df0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=108,
 _nsub4disp=132,_nmes=216,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1123f9030,_masks=0x0,_fluxpersub=0x7fee58d28060,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58d284a0,_skyfluxpersub=0x7fee58d286f0,
 _nphotons=264.732,_skynphotons=0,_tt=[-3.37219e-05,0.000124635],_lastvalidtt=
 [-3.37219e-05,0.000124635],_upttcommand=[0,0],_refmes=0x7fee58c53e30,_tiprefv=
 0x7fee5922ee30,_tiltrefv=0x7fee5a81e230,_tiprefvn=0x7fee59288630,_tiltrefvn=
 0x7fee5a81ea30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d2f7f0,_jstart=0x7fee58d2e240,_binindices=0x7fee5922d830,
 _binxy=2,_centroidw=0x7fee5916be60,_fimage=0x7fee59290630,_fimage2=0x0,
 _imistart=0x7fee58c59620,_imjstart=0x7fee58c511e0,_imistart2=0x7fee58c51430,
 _imjstart2=0x7fee58c54590,_unittip=0x7fee58d2ed20,_unittilt=0x7fee58d2dd60,
 _lgs_defocuses=0x7fee5916c138,_unitdefocus=0x10f21a030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee59228630,_flat=0x7fee5927c230,_domask=1,
 _submask=0x7fee598cce30,_kernel=0x7fee5928a830,_kernels=0x10ef0d030,_kerfftr=
 0x10eea7030,_kerffti=0x10f01d030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee59289e30,_x=0x7fee598ab830,_y=0x7fee598a9230,_centroidgain=1,_rayleigh=
 0x7fee5916c218,_bckgrdcalib=0x7fee59226c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916c368)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916c288,_ctrlden=0x7fee5916c448,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c52460,_xlast=0x7fee58c53090,_ylast=[0x7fee5927dc30,0x7fee5927dc30,
 0x7fee5927dc30],_y0=0x7fee5922f630,_signus=0x7fee58c56760,_puppixoffset=[0,0],
 _nact=80,_def=0x11459a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58e01360,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916c410,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5916b918,xposition=0x7fee5916b790,yposition=
 0x7fee5916bdb8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5916b800,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=3e-05,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8824.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.7   0.549      141.9
Field Avg  1.65                     54.7   0.549      141.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873288,layerfrac=0x7fee59873398,
 layerspeed=0x7fee59873310,layeralt=0x7fee598728f8,winddir=0x7fee59873200,
 _layeralt=0x7fee59153a78)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916bdb8,lgs_prof_alt=0x7fee5916b918,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58d282c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d28d30,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x115096030,_masks=0x0,_fluxpersub=0x7fee58d2a390,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58d2a5e0,_skyfluxpersub=0x7fee58d2a830,
 _nphotons=8824.39,_skynphotons=0,_tt=[-0.00040061,-0.00041062],_lastvalidtt=
 [-0.00040061,-0.00041062],_upttcommand=[0,0],_refmes=0x7fee59291e30,_tiprefv=
 0x7fee59290630,_tiltrefv=0x7fee59227630,_tiprefvn=0x7fee59289e30,_tiltrefvn=
 0x7fee59228630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d29ef0,_jstart=0x7fee58d2a140,_binindices=0x7fee5922a830,
 _binxy=2,_centroidw=0x7fee5916b870,_fimage=0x7fee598ccc30,_fimage2=0x0,
 _imistart=0x7fee58c542d0,_imjstart=0x7fee58c54520,_imistart2=0x7fee58c54770,
 _imjstart2=0x7fee58c549c0,_unittip=0x7fee58d29220,_unittilt=0x7fee58d29450,
 _lgs_defocuses=0x7fee5916c330,_unitdefocus=0x1120f7030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee598cc230,_flat=0x7fee59288630,_domask=1,
 _submask=0x7fee598caa30,_kernel=0x7fee59290e30,_kernels=0x10f11a030,_kerfftr=
 0x10eea7030,_kerffti=0x10f01d030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee598cb830,_x=0x7fee598c9830,_y=0x7fee598c9e30,_centroidgain=1,_rayleigh=
 0x7fee5916c5d0,_bckgrdcalib=0x7fee592d8c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916bed0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916b800,_ctrlden=0x7fee5916bd10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c51430,_xlast=0x7fee58c53090,_ylast=[0x7fee59176230,0x7fee59176230,
 0x7fee59176230],_y0=0x7fee5922e230,_signus=0x7fee58c56010,_puppixoffset=[0,0],
 _nact=80,_def=0x1173ed030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58f029d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916c288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5916c448,xposition=0x7fee5916c138,yposition=
 0x7fee5916be60,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5914bd10,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    88.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.531      192.6
Field Avg  1.65                     54.1   0.531      192.6
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873288,layerfrac=0x7fee59873398,
 layerspeed=0x7fee59873310,layeralt=0x7fee598728f8,winddir=0x7fee59873200,
 _layeralt=0x7fee591549e0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916bdb8,lgs_prof_alt=0x7fee5916b918,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c53090,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d28f50,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10fbc5030,_masks=0x0,_fluxpersub=0x7fee58d306d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58d28060,_skyfluxpersub=0x7fee58d291a0,
 _nphotons=88.2439,_skynphotons=0,_tt=[-0.00029809,7.27152e-05],_lastvalidtt=
 [-0.00029809,7.27152e-05],_upttcommand=[0,0],_refmes=0x7fee5a801230,_tiprefv=
 0x7fee5a017a30,_tiltrefv=0x7fee5a017230,_tiprefvn=0x7fee5a000a30,_tiltrefvn=
 0x7fee5a000030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d282b0,_jstart=0x7fee58d28500,_binindices=0x7fee59226830,
 _binxy=2,_centroidw=0x7fee5916bd80,_fimage=0x7fee5a802e30,_fimage2=0x0,
 _imistart=0x7fee58c532e0,_imjstart=0x7fee58c555f0,_imistart2=0x7fee58c55840,
 _imjstart2=0x7fee58c55a90,_unittip=0x7fee58d20df0,_unittilt=0x7fee58d28d20,
 _lgs_defocuses=0x7fee5916bdf0,_unitdefocus=0x111df4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee598c5e30,_flat=0x7fee5922ee30,_domask=1,
 _submask=0x7fee598aec30,_kernel=0x7fee5928cc30,_kernels=0x10edf7030,_kerfftr=
 0x10ef0d030,_kerffti=0x10f11a030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee5a81d030,_x=0x7fee598c8630,_y=0x7fee598a8c30,_centroidgain=1,_rayleigh=
 0x7fee5916c5d0,_bckgrdcalib=0x7fee5928da30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916c598)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916be98,_ctrlden=0x7fee5916b800,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c528a0,_xlast=0x7fee58c538f0,_ylast=[0x7fee5922e230,0x7fee5922e230,
 0x7fee5922e230],_y0=0x7fee59157830,_signus=0x7fee58c52460,_puppixoffset=[0,0],
 _nact=80,_def=0x11459a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58f03140,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916c288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5916c448,xposition=0x7fee5916c2c0,yposition=
 0x7fee5914c138,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5914bd10,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=1e-05,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    264.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       53.9   0.559      148.6
Field Avg  1.65                     53.9   0.559      148.6
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873288,layerfrac=0x7fee59873398,
 layerspeed=0x7fee59873310,layeralt=0x7fee598728f8,winddir=0x7fee59873200,
 _layeralt=0x7fee59153858)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916bdb8,lgs_prof_alt=0x7fee5916b918,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c57170,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d284c0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f21a030,_masks=0x0,_fluxpersub=0x7fee58d21df0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58c549e0,_skyfluxpersub=0x7fee58c54540,
 _nphotons=264.732,_skynphotons=0,_tt=[3.0548e-05,-3.83987e-05],_lastvalidtt=
 [3.0548e-05,-3.83987e-05],_upttcommand=[0,0],_refmes=0x7fee5a81da30,_tiprefv=
 0x7fee598ca630,_tiltrefv=0x7fee598c9e30,_tiprefvn=0x7fee598cae30,_tiltrefvn=
 0x7fee598cc030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d28710,_jstart=0x7fee58d2f040,_binindices=0x7fee59225a30,
 _binxy=2,_centroidw=0x7fee5916b950,_fimage=0x7fee592d8a30,_fimage2=0x0,
 _imistart=0x7fee58c5d4e0,_imjstart=0x7fee58c5d730,_imistart2=0x7fee58c5d980,
 _imjstart2=0x7fee58c54790,_unittip=0x7fee58d28060,_unittilt=0x7fee58d28290,
 _lgs_defocuses=0x7fee5916c138,_unitdefocus=0x114098030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee59228630,_flat=0x7fee59291430,_domask=1,
 _submask=0x7fee598c8630,_kernel=0x7fee598cc830,_kernels=0x10ee5d030,_kerfftr=
 0x10ef73030,_kerffti=0x10edf7030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee5928ee30,_x=0x7fee598a8c30,_y=0x7fee598a9230,_centroidgain=1,_rayleigh=
 0x7fee5916c5d0,_bckgrdcalib=0x7fee59229030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916c218)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916c528,_ctrlden=0x7fee5916be98,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c52720,_xlast=0x7fee58c528a0,_ylast=[0x7fee59157830,0x7fee59157830,
 0x7fee59157830],_y0=0x7fee59176230,_signus=0x7fee58c564a0,_puppixoffset=[0,0],
 _nact=80,_def=0x115875030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58c5dbd0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916c288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5916c448,xposition=0x7fee5916bed0,yposition=
 0x7fee5916b988,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5914bd10,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=3e-05,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    441.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.564      135.1
Field Avg  1.65                     54.1   0.564      135.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873288,layerfrac=0x7fee59873398,
 layerspeed=0x7fee59873310,layeralt=0x7fee598728f8,winddir=0x7fee59873200,
 _layeralt=0x7fee59153c10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916bdb8,lgs_prof_alt=0x7fee5916b918,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58c55ad0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58c51960,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x112f99030,_masks=0x0,_fluxpersub=0x7fee58f035e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58f03830,_skyfluxpersub=0x7fee58c53e30,
 _nphotons=441.219,_skynphotons=0,_tt=[-0.000561291,1.45121e-05],_lastvalidtt=
 [-0.000561291,1.45121e-05],_upttcommand=[0,0],_refmes=0x7fee598cd230,_tiprefv=
 0x7fee59971c30,_tiltrefv=0x7fee598cc830,_tiprefvn=0x7fee598ca630,_tiltrefvn=
 0x7fee598c9e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58c51bb0,_jstart=0x7fee58c54080,_binindices=0x7fee598aec30,
 _binxy=2,_centroidw=0x7fee5916c2f8,_fimage=0x7fee59223a30,_fimage2=0x0,
 _imistart=0x7fee58d31020,_imjstart=0x7fee58d31270,_imistart2=0x7fee58d314c0,
 _imjstart2=0x7fee58d31710,_unittip=0x7fee58c511e0,_unittilt=0x7fee58c538f0,
 _lgs_defocuses=0x7fee5916b8a8,_unitdefocus=0x1123f9030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee5922d830,_flat=0x7fee59288630,_domask=1,
 _submask=0x7fee5a821230,_kernel=0x7fee5a81f230,_kernels=0x10ef0d030,_kerfftr=
 0x10edf7030,_kerffti=0x10ee5d030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee592d8830,_x=0x7fee59291430,_y=0x7fee592dfc30,_centroidgain=1,_rayleigh=
 0x7fee5916c1e0,_bckgrdcalib=0x7fee5922ee30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916c528)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916c3d8,_ctrlden=0x7fee5916b988,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c52460,_xlast=0x7fee58c52720,_ylast=[0x7fee59176230,0x7fee59176230,
 0x7fee59176230],_y0=0x7fee59291e30,_signus=0x7fee58c56760,_puppixoffset=[0,0],
 _nact=80,_def=0x11459a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58d25b10,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916c288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5916c448,xposition=0x7fee5916bd10,yposition=
 0x7fee5914c138,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5914bd10,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=5e-05,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    617.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.564      135.1
Field Avg  1.65                     54.4   0.564      135.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873288,layerfrac=0x7fee59873398,
 layerspeed=0x7fee59873310,layeralt=0x7fee598728f8,winddir=0x7fee59873200,
 _layeralt=0x7fee59154738)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916bdb8,lgs_prof_alt=0x7fee5916b918,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58d29690,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d28060,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x112760030,_masks=0x0,_fluxpersub=0x7fee58c518a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58c51af0,_skyfluxpersub=0x7fee58c54b40,
 _nphotons=617.707,_skynphotons=0,_tt=[-0.000475329,-9.1892e-05],_lastvalidtt=
 [-0.000475329,-9.1892e-05],_upttcommand=[0,0],_refmes=0x7fee598b9030,_tiprefv=
 0x7fee59288630,_tiltrefv=0x7fee59223a30,_tiprefvn=0x7fee59288e30,_tiltrefvn=
 0x7fee592da830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d282b0,_jstart=0x7fee58d28500,_binindices=0x7fee59226a30,
 _binxy=2,_centroidw=0x7fee5916c0c8,_fimage=0x7fee5a823630,_fimage2=0x0,
 _imistart=0x7fee58c511e0,_imjstart=0x7fee58c542c0,_imistart2=0x7fee58c54510,
 _imjstart2=0x7fee58c54760,_unittip=0x7fee58d2dfb0,_unittilt=0x7fee58d270d0,
 _lgs_defocuses=0x7fee5916c330,_unitdefocus=0x111cf3030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee598c8c30,_flat=0x7fee598ccc30,_domask=1,
 _submask=0x7fee59228630,_kernel=0x7fee598a8c30,_kernels=0x10ef73030,_kerfftr=
 0x10efd9030,_kerffti=0x10ef0d030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee5a81d030,_x=0x7fee5989ae30,_y=0x7fee598c8630,_centroidgain=1,_rayleigh=
 0x7fee5916c1e0,_bckgrdcalib=0x7fee5997a430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916bed0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916b800,_ctrlden=0x7fee5916c3d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c549c0,_xlast=0x7fee58c52460,_ylast=[0x7fee59291e30,0x7fee59291e30,
 0x7fee59291e30],_y0=0x7fee59157830,_signus=0x7fee58c55260,_puppixoffset=[0,0],
 _nact=80,_def=0x115875030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58e06300,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916c288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5916c448,xposition=0x7fee5916c218,yposition=
 0x7fee5916c598,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5914bd10,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=7e-05,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    882.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.563      131.7
Field Avg  1.65                     54.9   0.563      131.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873288,layerfrac=0x7fee59873398,
 layerspeed=0x7fee59873310,layeralt=0x7fee598728f8,winddir=0x7fee59873200,
 _layeralt=0x7fee591548d0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916bdb8,lgs_prof_alt=0x7fee5916b918,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58d27580,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d27a10,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f21a030,_masks=0x0,_fluxpersub=0x7fee58c55d00,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58c515e0,_skyfluxpersub=0x7fee58c511e0,
 _nphotons=882.439,_skynphotons=0,_tt=[-0.00105446,-0.000446982],_lastvalidtt=
 [-0.00105446,-0.000446982],_upttcommand=[0,0],_refmes=0x7fee598b9030,_tiprefv=
 0x7fee598af430,_tiltrefv=0x7fee598aec30,_tiprefvn=0x7fee598c1c30,_tiltrefvn=
 0x7fee598c3630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d27c60,_jstart=0x7fee58d2a040,_binindices=0x7fee59226a30,
 _binxy=2,_centroidw=0x7fee5914bd48,_fimage=0x7fee598ba430,_fimage2=0x0,
 _imistart=0x7fee58c553c0,_imjstart=0x7fee58c55610,_imistart2=0x7fee58c55860,
 _imjstart2=0x7fee58c55ab0,_unittip=0x7fee58d29680,_unittilt=0x7fee58d28b50,
 _lgs_defocuses=0x7fee5916b870,_unitdefocus=0x1121f8030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee59214c30,_flat=0x7fee598c8630,_domask=1,
 _submask=0x7fee59294430,_kernel=0x7fee598c5c30,_kernels=0x10edd8030,_kerfftr=
 0x10ee5d030,_kerffti=0x10ef73030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee598cc830,_x=0x7fee598c2430,_y=0x7fee598c2a30,_centroidgain=1,_rayleigh=
 0x7fee5916c1e0,_bckgrdcalib=0x7fee598c9030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916bd80)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916bed0,_ctrlden=0x7fee5916b800,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c550c0,_xlast=0x7fee58c53350,_ylast=[0x7fee59157830,0x7fee59157830,
 0x7fee59157830],_y0=0x7fee59176230,_signus=0x7fee58c52460,_puppixoffset=[0,0],
 _nact=80,_def=0x11459a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58f029d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916c288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5916c448,xposition=0x7fee59142988,yposition=
 0x7fee5916c528,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5914bd10,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.0001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    8.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 43.3; 5000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.563      131.7
Field Avg  1.65                     54.9   0.563      131.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 5000;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fee59873288,layerfrac=0x7fee59873398,
 layerspeed=0x7fee59873310,layeralt=0x7fee598728f8,winddir=0x7fee59873200,
 _layeralt=0x7fee59154408)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fee5916bdb8,lgs_prof_alt=0x7fee5916b918,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fee58d29480,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fee58d27390,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x112a98030,_masks=0x0,_fluxpersub=0x7fee58d28060,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fee58d282b0,_skyfluxpersub=0x7fee58d28500,
 _nphotons=8.82439,_skynphotons=0,_tt=[-0.0010545,-0.000446963],_lastvalidtt=
 [-0.0010545,-0.000446963],_upttcommand=[0,0],_refmes=0x7fee5a016430,_tiprefv=
 0x7fee59222e30,_tiltrefv=0x7fee59222630,_tiprefvn=0x7fee59223630,_tiltrefvn=
 0x7fee59292a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7fee58d28750,_jstart=0x7fee58d289a0,_binindices=0x7fee5922d830,
 _binxy=2,_centroidw=0x7fee5916c058,_fimage=0x7fee598c5030,_fimage2=0x0,
 _imistart=0x7fee58c51430,_imjstart=0x7fee58c51680,_imistart2=0x7fee58c518d0,
 _imjstart2=0x7fee58c51b20,_unittip=0x7fee58d27c70,_unittilt=0x7fee58d20df0,
 _lgs_defocuses=0x7fee5916c138,_unitdefocus=0x1120f5030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fee598c5c30,_flat=0x7fee5922ee30,_domask=1,
 _submask=0x7fee598c2430,_kernel=0x7fee5928a830,_kernels=0x10efd9030,_kerfftr=
 0x10ef0d030,_kerffti=0x10edd8030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fee598ca430,_x=0x7fee59899c30,_y=0x7fee598a9230,_centroidgain=1,_rayleigh=
 0x7fee5916c1e0,_bckgrdcalib=0x7fee59226a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fee5916c170)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fee5916b988,_ctrlden=0x7fee5916bed0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7fee58c53e30,_xlast=0x7fee58c55010,_ylast=[0x7fee59176230,0x7fee59176230,
 0x7fee59176230],_y0=0x7fee59081430,_signus=0x7fee58c52720,_puppixoffset=[0,0],
 _nact=80,_def=0x115875030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7fee58c511e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fee5916c288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fee5916c448,xposition=0x7fee5916bc68,yposition=
 0x7fee5916be98,xspeed=0x0,yspeed=0x0,dispzoom=0x7fee5914bd10,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=5000,
 ittime=0.0001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 5000 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       92.0   0.079      327.7
Field Avg  1.65                     92.0   0.079      327.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51113be0,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ec8,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51113cf0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ecf0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528ade50,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5062d000,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10feb4030,_masks=0x0,_fluxpersub=0x7f7f5062e4d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5062e720,_skyfluxpersub=0x7f7f5062e970,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0780734,0.0270053],_lastvalidtt=
 [-0.0780734,0.0270053],_upttcommand=[0,0],_refmes=0x7f7f5100fc30,_tiprefv=
 0x7f7f51156030,_tiltrefv=0x7f7f51153830,_tiprefvn=0x7f7f51175e30,_tiltrefvn=
 0x7f7f51159430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5062d250,_jstart=0x7f7f5062d4a0,_binindices=0x7f7f5180e030,
 _binxy=2,_centroidw=0x7f7f5110ebd8,_fimage=0x7f7f51158030,_fimage2=0x0,
 _imistart=0x7f7f5062db90,_imjstart=0x7f7f5062dde0,_imistart2=0x7f7f5062e030,
 _imjstart2=0x7f7f5062e280,_unittip=0x7f7f50637a40,_unittilt=0x7f7f5062cdd0,
 _lgs_defocuses=0x7f7f520021e0,_unitdefocus=0x10c85b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5180b630,_flat=0x7f7f5180ac30,_domask=1,
 _submask=0x7f7f51810830,_kernel=0x7f7f5114da30,_kernels=0x10c267030,_kerfftr=
 0x10bf9c030,_kerffti=0x10c201030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f511a0830,_x=0x7f7f51820c30,_y=0x7f7f5180a030,_centroidgain=1,_rayleigh=
 0x7f7f52002170,_bckgrdcalib=0x7f7f51811a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f511048d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f520023d8,_ctrlden=0x7f7f52001fe8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f50638060,_xlast=0x7f7f506381e0,_ylast=[0x7f7f51803830,0x7f7f51803830,
 0x7f7f51803830],_y0=0x7f7f51806e30,_signus=0x7f7f50637600,_puppixoffset=[0,0],
 _nact=80,_def=0x10ffb5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5062c450,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f51104fa0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002090,xposition=0x7f7f5110ed60,yposition=
 0x7f7f5110fd60,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002218,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       92.0   0.079      327.7
Field Avg  1.65                     92.0   0.079      327.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51111f50,winddir=0x7f7f51112948,
 _layeralt=0x7f7f51113608)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110fd60,lgs_prof_alt=0x7f7f52002090,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f52937a50,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52936ba0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10e54f030,_masks=0x0,_fluxpersub=0x7f7f528b05d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528b0820,_skyfluxpersub=0x7f7f528b3090,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0780734,0.0270053],_lastvalidtt=
 [-0.0780734,0.0270053],_upttcommand=[0,0],_refmes=0x7f7f52006c30,_tiprefv=
 0x7f7f51804a30,_tiltrefv=0x7f7f5092da30,_tiprefvn=0x7f7f51805230,_tiltrefvn=
 0x7f7f50955230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52936df0,_jstart=0x7f7f52937040,_binindices=0x7f7f5114da30,
 _binxy=2,_centroidw=0x7f7f520028e0,_fimage=0x7f7f52002c30,_fimage2=0x0,
 _imistart=0x7f7f528b1a20,_imjstart=0x7f7f528b1c70,_imistart2=0x7f7f528b1ec0,
 _imjstart2=0x7f7f528b0380,_unittip=0x7f7f52931650,_unittilt=0x7f7f52936970,
 _lgs_defocuses=0x7f7f51104b40,_unitdefocus=0x10c75a030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51179e30,_flat=0x7f7f50955a30,_domask=1,
 _submask=0x7f7f5115b430,_kernel=0x7f7f5093a030,_kernels=0x10c2cd030,_kerfftr=
 0x10bf9c030,_kerffti=0x10c201030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f52004c30,_x=0x7f7f50921830,_y=0x7f7f5092ea30,_centroidgain=1,_rayleigh=
 0x7f7f5110fa88,_bckgrdcalib=0x7f7f5093ae30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002918)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002288,_ctrlden=0x7f7f52002988,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528adc00,_xlast=0x7f7f528ba800,_ylast=[0x7f7f5100fc30,0x7f7f5100fc30,
 0x7f7f5100fc30],_y0=0x7f7f5115a830,_signus=0x7f7f528af960,_puppixoffset=[0,0],
 _nact=80,_def=0x110995030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f506292d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f520023d8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52001fe8,xposition=0x7f7f5110fba0,yposition=
 0x7f7f511049b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f520021a8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       92.0   0.079      327.7
Field Avg  1.65                     92.0   0.079      327.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51113ad0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528b4a90,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52864990,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ca5c030,_masks=0x0,_fluxpersub=0x7f7f528b18a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528b0380,_skyfluxpersub=0x7f7f528b05d0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0780734,0.0270053],_lastvalidtt=
 [-0.0780734,0.0270053],_upttcommand=[0,0],_refmes=0x7f7f5117a830,_tiprefv=
 0x7f7f51156030,_tiltrefv=0x7f7f5117c030,_tiprefvn=0x7f7f51179e30,_tiltrefvn=
 0x7f7f5114f430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f528b1400,_jstart=0x7f7f528b1650,_binindices=0x7f7f5092ea30,
 _binxy=2,_centroidw=0x7f7f5110eba0,_fimage=0x7f7f51153830,_fimage2=0x0,
 _imistart=0x7f7f52933c10,_imjstart=0x7f7f52936930,_imistart2=0x7f7f52936b80,
 _imjstart2=0x7f7f52921660,_unittip=0x7f7f528b29d0,_unittilt=0x7f7f528ab700,
 _lgs_defocuses=0x7f7f5110e5f0,_unitdefocus=0x10d75a030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51151e30,_flat=0x7f7f508c1430,_domask=1,
 _submask=0x7f7f5115b430,_kernel=0x7f7f509bde30,_kernels=0x10c399030,_kerfftr=
 0x10bf9c030,_kerffti=0x10c201030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f511a0830,_x=0x7f7f51072c30,_y=0x7f7f5117b630,_centroidgain=1,_rayleigh=
 0x7f7f52002448,_bckgrdcalib=0x7f7f508f9030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52001fb0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51104e18,_ctrlden=0x7f7f51104ad0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f529352c0,_xlast=0x7f7f52922360,_ylast=[0x7f7f5088e630,0x7f7f5088e630,
 0x7f7f5088e630],_y0=0x7f7f50941c30,_signus=0x7f7f52921e80,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528b2c00,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f511055c0,yposition=
 0x7f7f52002368,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.591      111.5
Field Avg  1.65                     54.9   0.591      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51112b68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5062dba0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f50739630,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c85b030,_masks=0x0,_fluxpersub=0x7f7f52933f60,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f52931650,_skyfluxpersub=0x7f7f52921e80,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00672449,0.00502626],_lastvalidtt=
 [-0.00672449,0.00502626],_upttcommand=[0,0],_refmes=0x7f7f51805630,_tiprefv=
 0x7f7f5092da30,_tiltrefv=0x7f7f50931630,_tiprefvn=0x7f7f50932830,_tiltrefvn=
 0x7f7f5117c030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f50739880,_jstart=0x7f7f50739ad0,_binindices=0x7f7f51175e30,
 _binxy=2,_centroidw=0x7f7f52002020,_fimage=0x7f7f51156030,_fimage2=0x0,
 _imistart=0x7f7f528b2fd0,_imjstart=0x7f7f52864990,_imistart2=0x7f7f528b3220,
 _imjstart2=0x7f7f528b3470,_unittip=0x7f7f50739040,_unittilt=0x7f7f50739400,
 _lgs_defocuses=0x7f7f51104d00,_unitdefocus=0x10ce5e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51159430,_flat=0x7f7f5114da30,_domask=1,
 _submask=0x7f7f5092ea30,_kernel=0x7f7f51153630,_kernels=0x10c2cd030,_kerfftr=
 0x10c267030,_kerffti=0x10c399030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51178030,_x=0x7f7f52003230,_y=0x7f7f52005830,_centroidgain=1,_rayleigh=
 0x7f7f511101f8,_bckgrdcalib=0x7f7f511a0830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104b78)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110faf8,_ctrlden=0x7f7f5110e628,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528adc00,_xlast=0x7f7f528afd30,_ylast=[0x7f7f5115d630,0x7f7f5115d630,
 0x7f7f5115d630],_y0=0x7f7f5115a830,_signus=0x7f7f528acef0,_puppixoffset=[0,0],
 _nact=80,_def=0x111073030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528af4e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f51104ec0,yposition=
 0x7f7f52002090,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.659       98.0
Field Avg  1.65                     54.3   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51112060)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528b1310,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52931650,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c75a030,_masks=0x0,_fluxpersub=0x7f7f52936210,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f52935d70,_skyfluxpersub=0x7f7f52933f60,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00409308,-0.00128175],_lastvalidtt=
 [-0.00409308,-0.00128175],_upttcommand=[0,0],_refmes=0x7f7f51176830,_tiprefv=
 0x7f7f51179e30,_tiltrefv=0x7f7f51811c30,_tiprefvn=0x7f7f511a0830,_tiltrefvn=
 0x7f7f5180a030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52933c10,_jstart=0x7f7f52935fc0,_binindices=0x7f7f5115b430,
 _binxy=2,_centroidw=0x7f7f52002330,_fimage=0x7f7f50933230,_fimage2=0x0,
 _imistart=0x7f7f528b50c0,_imjstart=0x7f7f528b5310,_imistart2=0x7f7f528b2060,
 _imjstart2=0x7f7f52864990,_unittip=0x7f7f50739040,_unittilt=0x7f7f50739400,
 _lgs_defocuses=0x7f7f5110eba0,_unitdefocus=0x10c572030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5095a630,_flat=0x7f7f50940a30,_domask=1,
 _submask=0x7f7f50957e30,_kernel=0x7f7f51191a30,_kernels=0x10c1b8030,_kerfftr=
 0x10bf7f030,_kerffti=0x10c2cd030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50931630,_x=0x7f7f5092f030,_y=0x7f7f50959a30,_centroidgain=1,_rayleigh=
 0x7f7f52002448,_bckgrdcalib=0x7f7f50930c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ea50)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f511055c0,_ctrlden=0x7f7f51104980,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52922360,_xlast=0x7f7f52921a80,_ylast=[0x7f7f5088e630,0x7f7f5088e630,
 0x7f7f5088e630],_y0=0x7f7f50941c30,_signus=0x7f7f52921660,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f529352c0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f5110ffc8,yposition=
 0x7f7f52001fb0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      376.8   0.016      520.2
Field Avg  1.65                    376.8   0.016      520.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51112170)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5062c770,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52935fa0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10dd4a030,_masks=0x0,_fluxpersub=0x7f7f50739040,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f50739400,_skyfluxpersub=0x7f7f50739650,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00736695,0.0155285],_lastvalidtt=
 [-0.00736695,0.0155285],_upttcommand=[0,0],_refmes=0x7f7f51811830,_tiprefv=
 0x7f7f50931630,_tiltrefv=0x7f7f51179e30,_tiprefvn=0x7f7f50933030,_tiltrefvn=
 0x7f7f51156030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52936990,_jstart=0x7f7f52931650,_binindices=0x7f7f51820c30,
 _binxy=2,_centroidw=0x7f7f5110fba0,_fimage=0x7f7f50959a30,_fimage2=0x0,
 _imistart=0x7f7f5062c9c0,_imjstart=0x7f7f5062cc10,_imistart2=0x7f7f5062ce60,
 _imjstart2=0x7f7f5062d0b0,_unittip=0x7f7f52921660,_unittilt=0x7f7f52935d70,
 _lgs_defocuses=0x7f7f52002020,_unitdefocus=0x10cf5f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f52014030,_flat=0x7f7f52005630,_domask=1,
 _submask=0x7f7f52002c30,_kernel=0x7f7f5117a630,_kernels=0x10c21e030,_kerfftr=
 0x10c399030,_kerffti=0x10c1b8030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f508faa30,_x=0x7f7f509bf630,_y=0x7f7f508c1430,_centroidgain=1,_rayleigh=
 0x7f7f511101f8,_bckgrdcalib=0x7f7f52014a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110edd0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51104ec0,_ctrlden=0x7f7f52002058,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f528adc00,_ylast=[0x7f7f5119ee30,0x7f7f5119ee30,
 0x7f7f5119ee30],_y0=0x7f7f51176830,_signus=0x7f7f528ab700,_puppixoffset=[0,0],
 _nact=80,_def=0x111073030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52922360,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f51104e18,yposition=
 0x7f7f51104b78,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       92.0   0.079      327.7
Field Avg  1.65                     92.0   0.079      327.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51113828)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f52936f50,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5062c9a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10bde9030,_masks=0x0,_fluxpersub=0x7f7f5062de70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5062e0c0,_skyfluxpersub=0x7f7f5062e310,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.0780734,0.0270053],_lastvalidtt=
 [-0.0780734,0.0270053],_upttcommand=[0,0],_refmes=0x7f7f52017630,_tiprefv=
 0x7f7f51179230,_tiltrefv=0x7f7f51178a30,_tiprefvn=0x7f7f5117a630,_tiltrefvn=
 0x7f7f51179e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5062cbf0,_jstart=0x7f7f5062ce40,_binindices=0x7f7f5180ba30,
 _binxy=2,_centroidw=0x7f7f51104d00,_fimage=0x7f7f51821230,_fimage2=0x0,
 _imistart=0x7f7f5062d530,_imjstart=0x7f7f5062d780,_imistart2=0x7f7f5062d9d0,
 _imjstart2=0x7f7f5062dc20,_unittip=0x7f7f5062b3e0,_unittilt=0x7f7f5062c770,
 _lgs_defocuses=0x7f7f52002330,_unitdefocus=0x10e54f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51175e30,_flat=0x7f7f508faa30,_domask=1,
 _submask=0x7f7f5180dc30,_kernel=0x7f7f509bde30,_kernels=0x10bf7f030,_kerfftr=
 0x10c284030,_kerffti=0x10c21e030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5180c830,_x=0x7f7f51814e30,_y=0x7f7f51820c30,_centroidgain=1,_rayleigh=
 0x7f7f52002448,_bckgrdcalib=0x7f7f50940a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002138)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ffc8,_ctrlden=0x7f7f520028a8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52921a80,_xlast=0x7f7f52931650,_ylast=[0x7f7f50941c30,0x7f7f50941c30,
 0x7f7f50941c30],_y0=0x7f7f5088e630,_signus=0x7f7f52921e80,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528b1970,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f5110faf8,yposition=
 0x7f7f5110ea50,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.591      111.5
Field Avg  1.65                     54.9   0.591      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51112e98)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f52938ac0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52921e80,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d273030,_masks=0x0,_fluxpersub=0x7f7f50739040,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f50739650,_skyfluxpersub=0x7f7f507398a0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00672449,0.00502626],_lastvalidtt=
 [-0.00672449,0.00502626],_upttcommand=[0,0],_refmes=0x7f7f52017630,_tiprefv=
 0x7f7f5115bc30,_tiltrefv=0x7f7f5115b430,_tiprefvn=0x7f7f51179230,_tiltrefvn=
 0x7f7f51178a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52921660,_jstart=0x7f7f52938490,_binindices=0x7f7f50955e30,
 _binxy=2,_centroidw=0x7f7f520029c0,_fimage=0x7f7f50930230,_fimage2=0x0,
 _imistart=0x7f7f52935d70,_imjstart=0x7f7f52939070,_imistart2=0x7f7f529392c0,
 _imjstart2=0x7f7f52939510,_unittip=0x7f7f52931650,_unittilt=0x7f7f52938260,
 _lgs_defocuses=0x7f7f5110fba0,_unitdefocus=0x10d75a030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f52016c30,_flat=0x7f7f52018e30,_domask=1,
 _submask=0x7f7f52005630,_kernel=0x7f7f51820c30,_kernels=0x10c2ea030,_kerfftr=
 0x10c1b8030,_kerffti=0x10bf7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f508c1430,_x=0x7f7f50940a30,_y=0x7f7f50955230,_centroidgain=1,_rayleigh=
 0x7f7f511101f8,_bckgrdcalib=0x7f7f52002c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110e628)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51104e18,_ctrlden=0x7f7f5110ebd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52864990,_xlast=0x7f7f52864b10,_ylast=[0x7f7f5100fc30,0x7f7f5100fc30,
 0x7f7f5100fc30],_y0=0x7f7f510f4e30,_signus=0x7f7f528b9540,_puppixoffset=[0,0],
 _nact=80,_def=0x10fcb4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5062c450,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f511055c0,yposition=
 0x7f7f51104ad0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.659       98.0
Field Avg  1.65                     54.3   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51112d00)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5072f570,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52935d70,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x110894030,_masks=0x0,_fluxpersub=0x7f7f5062b3e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5062cb10,_skyfluxpersub=0x7f7f5062cd60,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00409308,-0.00128177],_lastvalidtt=
 [-0.00409308,-0.00128177],_upttcommand=[0,0],_refmes=0x7f7f51806e30,_tiprefv=
 0x7f7f5114ee30,_tiltrefv=0x7f7f50930230,_tiprefvn=0x7f7f5115bc30,_tiltrefvn=
 0x7f7f509bde30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52937120,_jstart=0x7f7f52937370,_binindices=0x7f7f5117ba30,
 _binxy=2,_centroidw=0x7f7f520029f8,_fimage=0x7f7f52002c30,_fimage2=0x0,
 _imistart=0x7f7f528b22a0,_imjstart=0x7f7f528b0050,_imistart2=0x7f7f528b02a0,
 _imjstart2=0x7f7f528b04f0,_unittip=0x7f7f52933c10,_unittilt=0x7f7f52921e80,
 _lgs_defocuses=0x7f7f51104d00,_unitdefocus=0x10d85b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51805030,_flat=0x7f7f51804630,_domask=1,
 _submask=0x7f7f51820c30,_kernel=0x7f7f50957a30,_kernels=0x10c284030,_kerfftr=
 0x10c21e030,_kerffti=0x10c2ea030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f52004c30,_x=0x7f7f50921830,_y=0x7f7f50940a30,_centroidgain=1,_rayleigh=
 0x7f7f52002448,_bckgrdcalib=0x7f7f5180c830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104980)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fb30,_ctrlden=0x7f7f52002330,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f52864990,_ylast=[0x7f7f510f4e30,0x7f7f510f4e30,
 0x7f7f510f4e30],_y0=0x7f7f51154030,_signus=0x7f7f528ab700,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528adc00,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f51104ec0,yposition=
 0x7f7f5110edd0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      346.7   0.017      520.2
Field Avg  1.65                    346.7   0.017      520.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51112390)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5073a280,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f50739b90,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10dc49030,_masks=0x0,_fluxpersub=0x7f7f528b13b0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528b0050,_skyfluxpersub=0x7f7f528b02a0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00945768,0.0169513],_lastvalidtt=
 [-0.00945768,0.0169513],_upttcommand=[0,0],_refmes=0x7f7f52012430,_tiprefv=
 0x7f7f50959a30,_tiltrefv=0x7f7f5115b430,_tiprefvn=0x7f7f5095a230,_tiltrefvn=
 0x7f7f5115bc30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f50739de0,_jstart=0x7f7f5073a030,_binindices=0x7f7f51175e30,
 _binxy=2,_centroidw=0x7f7f51104d38,_fimage=0x7f7f52014630,_fimage2=0x0,
 _imistart=0x7f7f528b04f0,_imjstart=0x7f7f528b0740,_imistart2=0x7f7f528b0990,
 _imjstart2=0x7f7f528b0be0,_unittip=0x7f7f50739040,_unittilt=0x7f7f50739960,
 _lgs_defocuses=0x7f7f520029c0,_unitdefocus=0x10d575030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f52011a30,_flat=0x7f7f5180b430,_domask=1,
 _submask=0x7f7f51151830,_kernel=0x7f7f51810e30,_kernels=0x10bf7f030,_kerfftr=
 0x10c1b8030,_kerffti=0x10c284030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f52004c30,_x=0x7f7f52005a30,_y=0x7f7f52014030,_centroidgain=1,_rayleigh=
 0x7f7f511101f8,_bckgrdcalib=0x7f7f5180dc30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002058)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002368,_ctrlden=0x7f7f51105630,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52864b10,_xlast=0x7f7f528afd30,_ylast=[0x7f7f51154030,0x7f7f51154030,
 0x7f7f51154030],_y0=0x7f7f51177430,_signus=0x7f7f528b10f0,_puppixoffset=[0,0],
 _nact=80,_def=0x10fcb4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52931650,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f5110ffc8,yposition=
 0x7f7f52002138,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       92.0   0.079      327.7
Field Avg  1.65                     92.0   0.079      327.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51111b10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f52938d20,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52933c10,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c06e030,_masks=0x0,_fluxpersub=0x7f7f528ade50,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f52937ce0,_skyfluxpersub=0x7f7f52937f30,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.0780734,0.0270053],_lastvalidtt=
 [-0.0780734,0.0270053],_upttcommand=[0,0],_refmes=0x7f7f51176830,_tiprefv=
 0x7f7f51803830,_tiltrefv=0x7f7f5180f630,_tiprefvn=0x7f7f51804030,_tiltrefvn=
 0x7f7f51820c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52921660,_jstart=0x7f7f529364b0,_binindices=0x7f7f50931c30,
 _binxy=2,_centroidw=0x7f7f52002090,_fimage=0x7f7f5092f030,_fimage2=0x0,
 _imistart=0x7f7f529373a0,_imjstart=0x7f7f529375f0,_imistart2=0x7f7f52937840,
 _imjstart2=0x7f7f52937a90,_unittip=0x7f7f52936c30,_unittilt=0x7f7f52933f60,
 _lgs_defocuses=0x7f7f520029f8,_unitdefocus=0x10cf5f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50934030,_flat=0x7f7f50933630,_domask=1,
 _submask=0x7f7f51156030,_kernel=0x7f7f5180a030,_kernels=0x10c21e030,_kerfftr=
 0x10c2ea030,_kerffti=0x10bf7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f508faa30,_x=0x7f7f5095a230,_y=0x7f7f5092ea30,_centroidgain=1,_rayleigh=
 0x7f7f52002448,_bckgrdcalib=0x7f7f51810e30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f520028a8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e9e0,_ctrlden=0x7f7f51104ad0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52921fc0,_xlast=0x7f7f52922360,_ylast=[0x7f7f509bea30,0x7f7f509bea30,
 0x7f7f509bea30],_y0=0x7f7f5095aa30,_signus=0x7f7f529361f0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f51104e18,yposition=
 0x7f7f5110e628,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.591      111.5
Field Avg  1.65                     54.9   0.591      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51113a48)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528b8f40,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528b9740,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10e04d030,_masks=0x0,_fluxpersub=0x7f7f528b2050,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f52864990,_skyfluxpersub=0x7f7f528ade50,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.00672449,0.00502628],_lastvalidtt=
 [-0.00672449,0.00502628],_upttcommand=[0,0],_refmes=0x7f7f509c0430,_tiprefv=
 0x7f7f5092f230,_tiltrefv=0x7f7f5092ea30,_tiprefvn=0x7f7f5093aa30,_tiltrefvn=
 0x7f7f5093bc30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f528b9990,_jstart=0x7f7f528b1e00,_binindices=0x7f7f52002c30,
 _binxy=2,_centroidw=0x7f7f520021e0,_fimage=0x7f7f51156e30,_fimage2=0x0,
 _imistart=0x7f7f50739b10,_imjstart=0x7f7f50739d60,_imistart2=0x7f7f50739fb0,
 _imjstart2=0x7f7f5073a200,_unittip=0x7f7f528b92e0,_unittilt=0x7f7f528b9510,
 _lgs_defocuses=0x7f7f51104d38,_unitdefocus=0x10e54f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f508c1430,_flat=0x7f7f508faa30,_domask=1,
 _submask=0x7f7f51156030,_kernel=0x7f7f51179a30,_kernels=0x10c284030,_kerfftr=
 0x10c1b8030,_kerffti=0x10c21e030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5117a830,_x=0x7f7f5115bc30,_y=0x7f7f511a0830,_centroidgain=1,_rayleigh=
 0x7f7f511101f8,_bckgrdcalib=0x7f7f50957c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002058)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f520022c0,_ctrlden=0x7f7f520029c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528ab700,_xlast=0x7f7f528b8630,_ylast=[0x7f7f51176830,0x7f7f51176830,
 0x7f7f51176830],_y0=0x7f7f5115d630,_signus=0x7f7f528b87b0,_puppixoffset=[0,0],
 _nact=80,_def=0x111073030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528adc00,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f5110fb30,yposition=
 0x7f7f5110ebd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.659       98.0
Field Avg  1.65                     54.3   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51112f20)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f52938420,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528b4260,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c471030,_masks=0x0,_fluxpersub=0x7f7f528b22a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528b1e00,_skyfluxpersub=0x7f7f528b2050,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.00409307,-0.00128173],_lastvalidtt=
 [-0.00409307,-0.00128173],_upttcommand=[0,0],_refmes=0x7f7f508cee30,_tiprefv=
 0x7f7f509bde30,_tiltrefv=0x7f7f50957c30,_tiprefvn=0x7f7f5092f230,_tiltrefvn=
 0x7f7f5092ea30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f528b4710,_jstart=0x7f7f528b4960,_binindices=0x7f7f50939a30,
 _binxy=2,_centroidw=0x7f7f52002250,_fimage=0x7f7f5093a830,_fimage2=0x0,
 _imistart=0x7f7f52936210,_imjstart=0x7f7f52936460,_imistart2=0x7f7f529366b0,
 _imjstart2=0x7f7f52936900,_unittip=0x7f7f528ade50,_unittilt=0x7f7f52864990,
 _lgs_defocuses=0x7f7f52002090,_unitdefocus=0x10d75a030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51175e30,_flat=0x7f7f51178630,_domask=1,
 _submask=0x7f7f5114fe30,_kernel=0x7f7f51820c30,_kernels=0x10c2ea030,_kerfftr=
 0x10bf7f030,_kerffti=0x10c284030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5093bc30,_x=0x7f7f51178030,_y=0x7f7f511a0830,_centroidgain=1,_rayleigh=
 0x7f7f52002448,_bckgrdcalib=0x7f7f51159c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f520028a8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fc48,_ctrlden=0x7f7f5110e5f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f528b4060,_ylast=[0x7f7f5115d630,0x7f7f5115d630,
 0x7f7f5115d630],_y0=0x7f7f510f4e30,_signus=0x7f7f528ab700,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5062c450,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f52002368,yposition=
 0x7f7f52002330,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      375.3   0.016      520.2
Field Avg  1.65                    375.3   0.016      520.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51113c68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528b1300,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52933c10,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ca5c030,_masks=0x0,_fluxpersub=0x7f7f529372c0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f52937510,_skyfluxpersub=0x7f7f52937760,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.00755639,0.0139916],_lastvalidtt=
 [-0.00755639,0.0139916],_upttcommand=[0,0],_refmes=0x7f7f508cee30,_tiprefv=
 0x7f7f509c1c30,_tiltrefv=0x7f7f51152a30,_tiprefvn=0x7f7f509bde30,_tiltrefvn=
 0x7f7f51153230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52935d70,_jstart=0x7f7f52936130,_binindices=0x7f7f5093b830,
 _binxy=2,_centroidw=0x7f7f5110ffc8,_fimage=0x7f7f51153a30,_fimage2=0x0,
 _imistart=0x7f7f52936980,_imjstart=0x7f7f52936bd0,_imistart2=0x7f7f52936e20,
 _imjstart2=0x7f7f52937070,_unittip=0x7f7f52933f60,_unittilt=0x7f7f52931650,
 _lgs_defocuses=0x7f7f520021e0,_unitdefocus=0x10d374030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50930230,_flat=0x7f7f5093aa30,_domask=1,
 _submask=0x7f7f50939c30,_kernel=0x7f7f50959a30,_kernels=0x10c1b8030,_kerfftr=
 0x10c21e030,_kerffti=0x10c2ea030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51156a30,_x=0x7f7f509c1030,_y=0x7f7f50940a30,_centroidgain=1,_rayleigh=
 0x7f7f511101f8,_bckgrdcalib=0x7f7f50930c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002058)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002138,_ctrlden=0x7f7f51104ec0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52921a80,_xlast=0x7f7f529217a0,_ylast=[0x7f7f508dde30,0x7f7f508dde30,
 0x7f7f508dde30],_y0=0x7f7f509c0430,_signus=0x7f7f52939410,_puppixoffset=[0,0],
 _nact=80,_def=0x111073030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528b0200,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f5110e9e0,yposition=
 0x7f7f51105630,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       92.0   0.079      327.7
Field Avg  1.65                     92.0   0.079      327.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f511138b0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 20,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5062c770,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f50739b20,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c85b030,_masks=0x0,_fluxpersub=0x7f7f528ab700,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528acef0,_skyfluxpersub=0x7f7f528ad140,
 _nphotons=0.00882439,_skynphotons=0,_tt=[-0.0780734,0.0270053],_lastvalidtt=
 [-0.0780734,0.0270053],_upttcommand=[0,0],_refmes=0x7f7f508cee30,_tiprefv=
 0x7f7f50938630,_tiltrefv=0x7f7f51156a30,_tiprefvn=0x7f7f509c1c30,_tiltrefvn=
 0x7f7f51152a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f50739d70,_jstart=0x7f7f50739fc0,_binindices=0x7f7f50959a30,
 _binxy=2,_centroidw=0x7f7f51104d38,_fimage=0x7f7f5093ba30,_fimage2=0x0,
 _imistart=0x7f7f529366b0,_imjstart=0x7f7f52933c10,_imistart2=0x7f7f5293d030,
 _imjstart2=0x7f7f52935d70,_unittip=0x7f7f507396c0,_unittilt=0x7f7f507398f0,
 _lgs_defocuses=0x7f7f52002250,_unitdefocus=0x10d575030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51179830,_flat=0x7f7f511a0830,_domask=1,
 _submask=0x7f7f5115b430,_kernel=0x7f7f51159c30,_kernels=0x10bf7f030,_kerfftr=
 0x10c284030,_kerffti=0x10c1b8030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509c1030,_x=0x7f7f52014830,_y=0x7f7f52014e30,_centroidgain=1,_rayleigh=
 0x7f7f52002448,_bckgrdcalib=0x7f7f5117a230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f520028a8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f511101c0,_ctrlden=0x7f7f51104fa0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52922360,_xlast=0x7f7f52921a80,_ylast=[0x7f7f509c0430,0x7f7f509c0430,
 0x7f7f509c0430],_y0=0x7f7f50927430,_signus=0x7f7f52921e80,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528adc00,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f520022c0,yposition=
 0x7f7f51104ad0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.591      111.5
Field Avg  1.65                     54.9   0.591      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51113718)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 20,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f529370d0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528ad120,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c75a030,_masks=0x0,_fluxpersub=0x7f7f528b3c70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528b3ec0,_skyfluxpersub=0x7f7f528ab700,
 _nphotons=0.00882439,_skynphotons=0,_tt=[-0.00672449,0.00502627],_lastvalidtt=
 [-0.00672449,0.00502627],_upttcommand=[0,0],_refmes=0x7f7f5115d630,_tiprefv=
 0x7f7f5117a230,_tiltrefv=0x7f7f51153c30,_tiprefvn=0x7f7f5119e230,_tiltrefvn=
 0x7f7f51156a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f528b2750,_jstart=0x7f7f528b29a0,_binindices=0x7f7f5119d030,
 _binxy=2,_centroidw=0x7f7f5110ecb8,_fimage=0x7f7f50940a30,_fimage2=0x0,
 _imistart=0x7f7f528b4450,_imjstart=0x7f7f528b3580,_imistart2=0x7f7f528b37d0,
 _imjstart2=0x7f7f528b3a20,_unittip=0x7f7f528acef0,_unittilt=0x7f7f528b2520,
 _lgs_defocuses=0x7f7f5110ffc8,_unitdefocus=0x10cf5f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5114f830,_flat=0x7f7f51159c30,_domask=1,
 _submask=0x7f7f5118e830,_kernel=0x7f7f51152630,_kernels=0x10c2ea030,_kerfftr=
 0x10c21e030,_kerffti=0x10bf7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f508c1430,_x=0x7f7f51178a30,_y=0x7f7f51072c30,_centroidgain=1,_rayleigh=
 0x7f7f511101f8,_bckgrdcalib=0x7f7f51150230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104980)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110faf8,_ctrlden=0x7f7f51110038,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52864b10,_xlast=0x7f7f528bb730,_ylast=[0x7f7f51177430,0x7f7f51177430,
 0x7f7f51177430],_y0=0x7f7f51151a30,_signus=0x7f7f528abb90,_puppixoffset=[0,0],
 _nact=80,_def=0x10fcb4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52864990,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f5110fc48,yposition=
 0x7f7f52002058,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.659       98.0
Field Avg  1.65                     54.3   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51113b58)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 20,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528ac600,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5062d300,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10dd4a030,_masks=0x0,_fluxpersub=0x7f7f528ad390,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528ad5e0,_skyfluxpersub=0x7f7f528b0050,
 _nphotons=0.00882439,_skynphotons=0,_tt=[-0.00409309,-0.00128174],_lastvalidtt=
 [-0.00409309,-0.00128174],_upttcommand=[0,0],_refmes=0x7f7f51176830,_tiprefv=
 0x7f7f5115a430,_tiltrefv=0x7f7f51159c30,_tiprefvn=0x7f7f5117a230,_tiltrefvn=
 0x7f7f51153c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5062d550,_jstart=0x7f7f5062d7a0,_binindices=0x7f7f51150e30,
 _binxy=2,_centroidw=0x7f7f5110ed60,_fimage=0x7f7f51156e30,_fimage2=0x0,
 _imistart=0x7f7f528b1e00,_imjstart=0x7f7f528b2050,_imistart2=0x7f7f528acef0,
 _imjstart2=0x7f7f528ad140,_unittip=0x7f7f5062c770,_unittilt=0x7f7f5062b3e0,
 _lgs_defocuses=0x7f7f51104d38,_unitdefocus=0x10e54f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5114e430,_flat=0x7f7f5114da30,_domask=1,
 _submask=0x7f7f5118ce30,_kernel=0x7f7f5117aa30,_kernels=0x10c284030,_kerfftr=
 0x10c1b8030,_kerffti=0x10c2ea030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51152630,_x=0x7f7f51803830,_y=0x7f7f51804430,_centroidgain=1,_rayleigh=
 0x7f7f52002448,_bckgrdcalib=0x7f7f5118dc30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f520029c0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002170,_ctrlden=0x7f7f5110eba0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52936390,_xlast=0x7f7f52936510,_ylast=[0x7f7f5093c230,0x7f7f5093c230,
 0x7f7f5093c230],_y0=0x7f7f508dde30,_signus=0x7f7f52938340,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f506292d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f52002138,yposition=
 0x7f7f520028a8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      376.5   0.016      520.2
Field Avg  1.65                    376.5   0.016      520.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51113360)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 20,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5293a360,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52936500,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10bde9030,_masks=0x0,_fluxpersub=0x7f7f52938190,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f529383e0,_skyfluxpersub=0x7f7f52938630,
 _nphotons=0.00882439,_skynphotons=0,_tt=[-0.00737815,0.0148059],_lastvalidtt=
 [-0.00737815,0.0148059],_upttcommand=[0,0],_refmes=0x7f7f51026e30,_tiprefv=
 0x7f7f51156e30,_tiltrefv=0x7f7f51151630,_tiprefvn=0x7f7f5115a430,_tiltrefvn=
 0x7f7f51159c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52936750,_jstart=0x7f7f529369a0,_binindices=0x7f7f50957230,
 _binxy=2,_centroidw=0x7f7f5110e9e0,_fimage=0x7f7f50968830,_fimage2=0x0,
 _imistart=0x7f7f52937850,_imjstart=0x7f7f52937aa0,_imistart2=0x7f7f52937cf0,
 _imjstart2=0x7f7f52937f40,_unittip=0x7f7f529360a0,_unittilt=0x7f7f529362d0,
 _lgs_defocuses=0x7f7f5110ecb8,_unitdefocus=0x10de4b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50930230,_flat=0x7f7f508c1430,_domask=1,
 _submask=0x7f7f50936230,_kernel=0x7f7f5093b430,_kernels=0x10bf7f030,_kerfftr=
 0x10c21e030,_kerffti=0x10c284030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50931630,_x=0x7f7f50921830,_y=0x7f7f50940a30,_centroidgain=1,_rayleigh=
 0x7f7f511101f8,_bckgrdcalib=0x7f7f50930c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110e5f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51104b08,_ctrlden=0x7f7f52002058,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52933f60,_xlast=0x7f7f52933c10,_ylast=[0x7f7f508dde30,0x7f7f508dde30,
 0x7f7f508dde30],_y0=0x7f7f508cee30,_signus=0x7f7f52921e80,_puppixoffset=[0,0],
 _nact=80,_def=0x10fcb4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52922360,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f511101c0,yposition=
 0x7f7f51104980,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       92.0   0.079      327.7
Field Avg  1.65                     92.0   0.079      327.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51113d78)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 25,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5062dba0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528ade50,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d273030,_masks=0x0,_fluxpersub=0x7f7f528ae2f0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528ae540,_skyfluxpersub=0x7f7f528ae790,
 _nphotons=8.82439e-05,_skynphotons=0,_tt=[-0.0780734,0.0270053],_lastvalidtt=
 [-0.0780734,0.0270053],_upttcommand=[0,0],_refmes=0x7f7f5119c030,_tiprefv=
 0x7f7f50930230,_tiltrefv=0x7f7f509bde30,_tiprefvn=0x7f7f50930a30,_tiltrefvn=
 0x7f7f50931c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f528ad430,_jstart=0x7f7f528acef0,_binindices=0x7f7f51156030,
 _binxy=2,_centroidw=0x7f7f5110ffc8,_fimage=0x7f7f51810e30,_fimage2=0x0,
 _imistart=0x7f7f528ac6e0,_imjstart=0x7f7f528b04e0,_imistart2=0x7f7f528b0730,
 _imjstart2=0x7f7f528b0980,_unittip=0x7f7f528ae9e0,_unittilt=0x7f7f528b02b0,
 _lgs_defocuses=0x7f7f5110ed60,_unitdefocus=0x10d374030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51197430,_flat=0x7f7f5115b430,_domask=1,
 _submask=0x7f7f5119e230,_kernel=0x7f7f5114da30,_kernels=0x10c1b8030,_kerfftr=
 0x10c2ea030,_kerffti=0x10bf7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51821230,_x=0x7f7f5117c230,_y=0x7f7f51150c30,_centroidgain=1,_rayleigh=
 0x7f7f52002448,_bckgrdcalib=0x7f7f5119a830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104ec0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002218,_ctrlden=0x7f7f5110fba0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935fc0,_xlast=0x7f7f52936140,_ylast=[0x7f7f508cee30,0x7f7f508cee30,
 0x7f7f508cee30],_y0=0x7f7f50941c30,_signus=0x7f7f52936800,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5062c450,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f5110faf8,yposition=
 0x7f7f520029c0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.591      111.5
Field Avg  1.65                     54.9   0.591      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f511137a0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 25,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5062dba0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52935fa0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x110894030,_masks=0x0,_fluxpersub=0x7f7f52937980,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f52937bd0,_skyfluxpersub=0x7f7f52937e20,
 _nphotons=8.82439e-05,_skynphotons=0,_tt=[-0.00672449,0.00502627],_lastvalidtt=
 [-0.00672449,0.00502627],_upttcommand=[0,0],_refmes=0x7f7f5115d630,_tiprefv=
 0x7f7f51156030,_tiltrefv=0x7f7f51153a30,_tiprefvn=0x7f7f5119b030,_tiltrefvn=
 0x7f7f5114e830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f529361f0,_jstart=0x7f7f52936440,_binindices=0x7f7f50930230,
 _binxy=2,_centroidw=0x7f7f5110eb30,_fimage=0x7f7f51810e30,_fimage2=0x0,
 _imistart=0x7f7f52937040,_imjstart=0x7f7f52937290,_imistart2=0x7f7f529374e0,
 _imjstart2=0x7f7f52937730,_unittip=0x7f7f52931650,_unittilt=0x7f7f52935d70,
 _lgs_defocuses=0x7f7f5110e9e0,_unitdefocus=0x10d575030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50932430,_flat=0x7f7f50931a30,_domask=1,
 _submask=0x7f7f50935c30,_kernel=0x7f7f50934e30,_kernels=0x10c284030,_kerfftr=
 0x10c21e030,_kerffti=0x10c1b8030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51803830,_x=0x7f7f50940a30,_y=0x7f7f5092ea30,_centroidgain=1,_rayleigh=
 0x7f7f511101f8,_bckgrdcalib=0x7f7f5095a430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51110038)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51104d00,_ctrlden=0x7f7f51105630,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f528ae800,_ylast=[0x7f7f51177430,0x7f7f51177430,
 0x7f7f51177430],_y0=0x7f7f51026e30,_signus=0x7f7f52864990,_puppixoffset=[0,0],
 _nact=80,_def=0x111073030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528adc00,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f52002170,yposition=
 0x7f7f51104fa0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.659       98.0
Field Avg  1.65                     54.3   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f51112418)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 25,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5062dba0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528abe10,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10dc49030,_masks=0x0,_fluxpersub=0x7f7f528b2be0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528b2e30,_skyfluxpersub=0x7f7f528b3080,
 _nphotons=8.82439e-05,_skynphotons=0,_tt=[-0.00409307,-0.00128175],
 _lastvalidtt=[-0.00409307,-0.00128175],_upttcommand=[0,0],_refmes=
 0x7f7f508cee30,_tiprefv=0x7f7f50932430,_tiltrefv=0x7f7f509bde30,_tiprefvn=
 0x7f7f50933830,_tiltrefvn=0x7f7f50934c30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=28,_nx4fft=28,_istart=0x7f7f528ab700,_jstart=0x7f7f52864990,
 _binindices=0x7f7f51178030,_binxy=2,_centroidw=0x7f7f52002138,_fimage=
 0x7f7f51810e30,_fimage2=0x0,_imistart=0x7f7f528b22a0,_imjstart=0x7f7f528b24f0,
 _imistart2=0x7f7f528b2740,_imjstart2=0x7f7f528b2990,_unittip=0x7f7f528acef0,
 _unittilt=0x7f7f528ad120,_lgs_defocuses=0x7f7f5110ffc8,_unitdefocus=
 0x10cf5f030,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51156a30,
 _flat=0x7f7f51156030,_domask=1,_submask=0x7f7f5119c230,_kernel=0x7f7f5119e030,
 _kernels=0x10c2ea030,_kerfftr=0x10bf7f030,_kerffti=0x10c284030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7f7f5181da30,_x=0x7f7f51159c30,_y=0x7f7f5115a230,
 _centroidgain=1,_rayleigh=0x7f7f52002448,_bckgrdcalib=0x7f7f51179830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7f7f5110eba0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002330,_ctrlden=0x7f7f511055c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52933f60,_xlast=0x7f7f52937720,_ylast=[0x7f7f50941c30,0x7f7f50941c30,
 0x7f7f50941c30],_y0=0x7f7f50930c30,_signus=0x7f7f529378a0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5062c450,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f51104b08,yposition=
 0x7f7f5110e5f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      375.3   0.016      520.2
Field Avg  1.65                    375.3   0.016      520.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f5100b450,winddir=0x7f7f511139c0,
 _layeralt=0x7f7f511130b8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 25,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f52001fe8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5072f1b0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528ade50,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c06e030,_masks=0x0,_fluxpersub=0x7f7f528ab700,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528ba870,_skyfluxpersub=0x7f7f528baac0,
 _nphotons=8.82439e-05,_skynphotons=0,_tt=[-0.00797818,0.0142609],_lastvalidtt=
 [-0.00797818,0.0142609],_upttcommand=[0,0],_refmes=0x7f7f50927430,_tiprefv=
 0x7f7f50959a30,_tiltrefv=0x7f7f51153a30,_tiprefvn=0x7f7f50932430,_tiltrefvn=
 0x7f7f5119da30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f528b3530,_jstart=0x7f7f52864990,_binindices=0x7f7f50939630,
 _binxy=2,_centroidw=0x7f7f52002020,_fimage=0x7f7f52004c30,_fimage2=0x0,
 _imistart=0x7f7f52936d60,_imjstart=0x7f7f52936fb0,_imistart2=0x7f7f52937200,
 _imjstart2=0x7f7f52937450,_unittip=0x7f7f528ad120,_unittilt=0x7f7f528b2060,
 _lgs_defocuses=0x7f7f5110eb30,_unitdefocus=0x10d777030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50940a30,_flat=0x7f7f5095a230,_domask=1,
 _submask=0x7f7f51178030,_kernel=0x7f7f50932c30,_kernels=0x10c1b8030,_kerfftr=
 0x10c21e030,_kerffti=0x10c2ea030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f52016c30,_x=0x7f7f511a1230,_y=0x7f7f5119fa30,_centroidgain=1,_rayleigh=
 0x7f7f511101f8,_bckgrdcalib=0x7f7f5092ea30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002058)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f520029c0,_ctrlden=0x7f7f5110ea50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52931650,_xlast=0x7f7f52933f60,_ylast=[0x7f7f50930c30,0x7f7f50930c30,
 0x7f7f50930c30],_y0=0x7f7f508cee30,_signus=0x7f7f52935d70,_puppixoffset=[0,0],
 _nact=80,_def=0x111073030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f50738d20,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52002288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002988,xposition=0x7f7f52002218,yposition=
 0x7f7f51104ec0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fd60,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       92.0   0.079      327.7
Field Avg  1.65                     92.0   0.079      327.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51113be0,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ec8,layeralt=0x7f7f51112948,winddir=0x7f7f51111f50,
 _layeralt=0x7f7f511132d8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51104ec0,lgs_prof_alt=0x7f7f52002988,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f52937850,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5062c9a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10e04d030,_masks=0x0,_fluxpersub=0x7f7f52921660,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f52937150,_skyfluxpersub=0x7f7f529373a0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0780734,0.0270053],_lastvalidtt=
 [-0.0780734,0.0270053],_upttcommand=[0,0],_refmes=0x7f7f52017230,_tiprefv=
 0x7f7f50930a30,_tiltrefv=0x7f7f5181d830,_tiprefvn=0x7f7f50931230,_tiltrefvn=
 0x7f7f5181e030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5062cbf0,_jstart=0x7f7f5062ce40,_binindices=0x7f7f51156a30,
 _binxy=2,_centroidw=0x7f7f52002448,_fimage=0x7f7f50940a30,_fimage2=0x0,
 _imistart=0x7f7f528b8f00,_imjstart=0x7f7f52864990,_imistart2=0x7f7f528af960,
 _imjstart2=0x7f7f528b0050,_unittip=0x7f7f5062b3e0,_unittilt=0x7f7f5062c770,
 _lgs_defocuses=0x7f7f5110bc30,_unitdefocus=0x10de4b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50935430,_flat=0x7f7f51152630,_domask=1,
 _submask=0x7f7f50934630,_kernel=0x7f7f51178030,_kernels=0x10c284030,_kerfftr=
 0x10c21e030,_kerffti=0x10c2ea030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f508c1430,_x=0x7f7f5181c630,_y=0x7f7f51803e30,_centroidgain=1,_rayleigh=
 0x7f7f51104b78,_bckgrdcalib=0x7f7f51159c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f520022f8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e5f0,_ctrlden=0x7f7f520022c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f528b0990,_ylast=[0x7f7f5111d030,0x7f7f5111d030,
 0x7f7f5111d030],_y0=0x7f7f5115d630,_signus=0x7f7f528b0b10,_puppixoffset=[0,0],
 _nact=80,_def=0x10e14e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528adc00,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f520029c0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ea50,xposition=0x7f7f5110fd98,yposition=
 0x7f7f520021a8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f511049b8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       92.0   0.079      327.7
Field Avg  1.65                     92.0   0.079      327.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51112838)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528b17a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52936e70,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c471030,_masks=0x0,_fluxpersub=0x7f7f528ade50,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f52864990,_skyfluxpersub=0x7f7f528b0050,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0780734,0.0270053],_lastvalidtt=
 [-0.0780734,0.0270053],_upttcommand=[0,0],_refmes=0x7f7f5115d630,_tiprefv=
 0x7f7f51152630,_tiltrefv=0x7f7f5181ec30,_tiprefvn=0x7f7f51156030,_tiltrefvn=
 0x7f7f5115bc30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f529373b0,_jstart=0x7f7f52937600,_binindices=0x7f7f52011a30,
 _binxy=2,_centroidw=0x7f7f52002a30,_fimage=0x7f7f51152e30,_fimage2=0x0,
 _imistart=0x7f7f52937aa0,_imjstart=0x7f7f52937cf0,_imistart2=0x7f7f52937f40,
 _imjstart2=0x7f7f52938190,_unittip=0x7f7f52933f60,_unittilt=0x7f7f52931650,
 _lgs_defocuses=0x7f7f5110e510,_unitdefocus=0x10d374030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50936630,_flat=0x7f7f50935c30,_domask=1,
 _submask=0x7f7f51156830,_kernel=0x7f7f50959a30,_kernels=0x10c1b8030,_kerfftr=
 0x10c21e030,_kerffti=0x10c2ea030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51158030,_x=0x7f7f509bf630,_y=0x7f7f508c1430,_centroidgain=1,_rayleigh=
 0x7f7f520023a0,_bckgrdcalib=0x7f7f50937030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110e660)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002218,_ctrlden=0x7f7f5110e9e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f529352c0,_xlast=0x7f7f52922360,_ylast=[0x7f7f50927430,0x7f7f50927430,
 0x7f7f50927430],_y0=0x7f7f508cee30,_signus=0x7f7f52921e80,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528adc00,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f52002090,yposition=
 0x7f7f51104d00,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.591      111.5
Field Avg  1.65                     54.9   0.591      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f511133e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528b2320,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52933f60,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d777030,_masks=0x0,_fluxpersub=0x7f7f50739040,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f50739400,_skyfluxpersub=0x7f7f50739650,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00672449,0.00502626],_lastvalidtt=
 [-0.00672449,0.00502626],_upttcommand=[0,0],_refmes=0x7f7f510f4e30,_tiprefv=
 0x7f7f51150c30,_tiltrefv=0x7f7f51152e30,_tiprefvn=0x7f7f51152630,_tiltrefvn=
 0x7f7f51150230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52931650,_jstart=0x7f7f52921e80,_binindices=0x7f7f51820c30,
 _binxy=2,_centroidw=0x7f7f51104e18,_fimage=0x7f7f50943030,_fimage2=0x0,
 _imistart=0x7f7f5062cf40,_imjstart=0x7f7f5062db20,_imistart2=0x7f7f5062dd70,
 _imjstart2=0x7f7f5062dfc0,_unittip=0x7f7f52933c10,_unittilt=0x7f7f52936830,
 _lgs_defocuses=0x7f7f52002100,_unitdefocus=0x10d575030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f52015630,_flat=0x7f7f52014c30,_domask=1,
 _submask=0x7f7f52004c30,_kernel=0x7f7f51153630,_kernels=0x10c284030,_kerfftr=
 0x10bf7f030,_kerffti=0x10c1b8030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50933830,_x=0x7f7f50931430,_y=0x7f7f50940a30,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f52016c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110eba0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110faf8,_ctrlden=0x7f7f5110fd28,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528b1790,_xlast=0x7f7f528ab700,_ylast=[0x7f7f5111d030,0x7f7f5111d030,
 0x7f7f5111d030],_y0=0x7f7f5115d630,_signus=0x7f7f52864990,_puppixoffset=[0,0],
 _nact=80,_def=0x10e14e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f5110ecf0,yposition=
 0x7f7f52002988,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.659       98.0
Field Avg  1.65                     54.3   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51112a58)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528ade50,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f50739400,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10de4b030,_masks=0x0,_fluxpersub=0x7f7f5072f620,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5072f870,_skyfluxpersub=0x7f7f5072fac0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00409308,-0.00128175],_lastvalidtt=
 [-0.00409308,-0.00128175],_upttcommand=[0,0],_refmes=0x7f7f52006c30,_tiprefv=
 0x7f7f5114e230,_tiltrefv=0x7f7f5114da30,_tiprefvn=0x7f7f51150c30,_tiltrefvn=
 0x7f7f51152e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f50739650,_jstart=0x7f7f5072e5f0,_binindices=0x7f7f52008030,
 _binxy=2,_centroidw=0x7f7f5110e628,_fimage=0x7f7f51151430,_fimage2=0x0,
 _imistart=0x7f7f5072ece0,_imjstart=0x7f7f5072ef30,_imistart2=0x7f7f5072f180,
 _imjstart2=0x7f7f5072f3d0,_unittip=0x7f7f50739cb0,_unittilt=0x7f7f50739040,
 _lgs_defocuses=0x7f7f52002a30,_unitdefocus=0x10da79030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5200b430,_flat=0x7f7f50940a30,_domask=1,
 _submask=0x7f7f52067430,_kernel=0x7f7f50933a30,_kernels=0x10c2ea030,_kerfftr=
 0x10c21e030,_kerffti=0x10c284030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51150230,_x=0x7f7f52015630,_y=0x7f7f52016c30,_centroidgain=1,_rayleigh=
 0x7f7f520023a0,_bckgrdcalib=0x7f7f508c1430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f511055c0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002058,_ctrlden=0x7f7f511048d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528ba870,_xlast=0x7f7f528b0050,_ylast=[0x7f7f5115d630,0x7f7f5115d630,
 0x7f7f5115d630],_y0=0x7f7f5114ea30,_signus=0x7f7f528b01d0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f8b2030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5062b3e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f5110e858,yposition=
 0x7f7f5110e660,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      376.8   0.016      520.2
Field Avg  1.65                    376.8   0.016      520.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51113e00)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f52938110,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5072f370,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c75a030,_masks=0x0,_fluxpersub=0x7f7f528b0050,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528b07c0,_skyfluxpersub=0x7f7f528b0a10,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00736695,0.0155285],_lastvalidtt=
 [-0.00736695,0.0155285],_upttcommand=[0,0],_refmes=0x7f7f51812030,_tiprefv=
 0x7f7f5115b430,_tiltrefv=0x7f7f5181f230,_tiprefvn=0x7f7f5114e230,_tiltrefvn=
 0x7f7f51803830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5072f5c0,_jstart=0x7f7f5072f810,_binindices=0x7f7f5181e030,
 _binxy=2,_centroidw=0x7f7f51104ad0,_fimage=0x7f7f508c1430,_fimage2=0x0,
 _imistart=0x7f7f5062c9c0,_imjstart=0x7f7f5062cc10,_imistart2=0x7f7f5062ce60,
 _imjstart2=0x7f7f5062d0b0,_unittip=0x7f7f5072ef10,_unittilt=0x7f7f5072f140,
 _lgs_defocuses=0x7f7f51104e18,_unitdefocus=0x10c06e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51156a30,_flat=0x7f7f51156030,_domask=1,
 _submask=0x7f7f511a0830,_kernel=0x7f7f51152630,_kernels=0x10bf7f030,_kerfftr=
 0x10c1b8030,_kerffti=0x10c2ea030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50940a30,_x=0x7f7f52017a30,_y=0x7f7f52018e30,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f51179830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104b40)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f520020c8,_ctrlden=0x7f7f52002170,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52921a80,_xlast=0x7f7f52936370,_ylast=[0x7f7f5092f630,0x7f7f5092f630,
 0x7f7f5092f630],_y0=0x7f7f50927430,_signus=0x7f7f529364f0,_puppixoffset=[0,0],
 _nact=80,_def=0x10e14e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528b02a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f52002218,yposition=
 0x7f7f5110eba0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       92.0   0.079      327.7
Field Avg  1.65                     92.0   0.079      327.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51113030)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5072f640,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f50737130,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10dd4a030,_masks=0x0,_fluxpersub=0x7f7f52864990,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528af960,_skyfluxpersub=0x7f7f528acef0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.0780734,0.0270053],_lastvalidtt=
 [-0.0780734,0.0270053],_upttcommand=[0,0],_refmes=0x7f7f508db030,_tiprefv=
 0x7f7f5115bc30,_tiltrefv=0x7f7f52015830,_tiprefvn=0x7f7f5115b430,_tiltrefvn=
 0x7f7f52007a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f50737380,_jstart=0x7f7f507375d0,_binindices=0x7f7f5200b030,
 _binxy=2,_centroidw=0x7f7f52002100,_fimage=0x7f7f51158030,_fimage2=0x0,
 _imistart=0x7f7f50737cc0,_imjstart=0x7f7f50737f10,_imistart2=0x7f7f50738160,
 _imjstart2=0x7f7f507383b0,_unittip=0x7f7f50739040,_unittilt=0x7f7f50736f00,
 _lgs_defocuses=0x7f7f5110e628,_unitdefocus=0x10e04d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50940a30,_flat=0x7f7f50935a30,_domask=1,
 _submask=0x7f7f51178030,_kernel=0x7f7f50937430,_kernels=0x10c21e030,_kerfftr=
 0x10c284030,_kerffti=0x10bf7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51159c30,_x=0x7f7f52004c30,_y=0x7f7f52008230,_centroidgain=1,_rayleigh=
 0x7f7f520023a0,_bckgrdcalib=0x7f7f50936430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52001fe8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e660,_ctrlden=0x7f7f5110e938,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f529352c0,_xlast=0x7f7f52922360,_ylast=[0x7f7f50927430,0x7f7f50927430,
 0x7f7f50927430],_y0=0x7f7f50941c30,_signus=0x7f7f52921e80,_puppixoffset=[0,0],
 _nact=80,_def=0x10f8b2030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528ab700,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f5110faf8,yposition=
 0x7f7f511055c0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.591      111.5
Field Avg  1.65                     54.9   0.591      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51112390)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507385b0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f529380f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10bde9030,_masks=0x0,_fluxpersub=0x7f7f529366a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f529368f0,_skyfluxpersub=0x7f7f528b05d0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00672449,0.00502626],_lastvalidtt=
 [-0.00672449,0.00502626],_upttcommand=[0,0],_refmes=0x7f7f51812030,_tiprefv=
 0x7f7f5094e230,_tiltrefv=0x7f7f50939030,_tiprefvn=0x7f7f5094ea30,_tiltrefvn=
 0x7f7f5094fc30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52938340,_jstart=0x7f7f529374d0,_binindices=0x7f7f511a0830,
 _binxy=2,_centroidw=0x7f7f5110eb68,_fimage=0x7f7f52018e30,_fimage2=0x0,
 _imistart=0x7f7f528acef0,_imjstart=0x7f7f528ad140,_imistart2=0x7f7f528ad390,
 _imjstart2=0x7f7f528b0380,_unittip=0x7f7f52931650,_unittilt=0x7f7f52921e80,
 _lgs_defocuses=0x7f7f51104ad0,_unitdefocus=0x10d374030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51178030,_flat=0x7f7f51159c30,_domask=1,
 _submask=0x7f7f50938230,_kernel=0x7f7f50957630,_kernels=0x10c2ea030,_kerfftr=
 0x10c1b8030,_kerffti=0x10c21e030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f52005230,_x=0x7f7f509bf630,_y=0x7f7f508c1430,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f51179830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110fd28)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ec48,_ctrlden=0x7f7f52002250,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935d70,_xlast=0x7f7f529352c0,_ylast=[0x7f7f50941c30,0x7f7f50941c30,
 0x7f7f50941c30],_y0=0x7f7f508dde30,_signus=0x7f7f52936e40,_puppixoffset=[0,0],
 _nact=80,_def=0x10e14e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f50738d20,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f52002058,yposition=
 0x7f7f5110e9e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.659       98.0
Field Avg  1.65                     54.3   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f511121f8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528b1ee0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528ab700,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d273030,_masks=0x0,_fluxpersub=0x7f7f528ad140,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f52864990,_skyfluxpersub=0x7f7f528ad390,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00409308,-0.00128177],_lastvalidtt=
 [-0.00409308,-0.00128177],_upttcommand=[0,0],_refmes=0x7f7f5095a430,_tiprefv=
 0x7f7f508c1430,_tiltrefv=0x7f7f5181de30,_tiprefvn=0x7f7f5094e230,_tiltrefvn=
 0x7f7f5181e630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f528af960,_jstart=0x7f7f528acef0,_binindices=0x7f7f52004c30,
 _binxy=2,_centroidw=0x7f7f52002090,_fimage=0x7f7f5114e830,_fimage2=0x0,
 _imistart=0x7f7f50737730,_imjstart=0x7f7f50737980,_imistart2=0x7f7f50737bd0,
 _imjstart2=0x7f7f50737e20,_unittip=0x7f7f5072e5f0,_unittilt=0x7f7f50736f00,
 _lgs_defocuses=0x7f7f52002100,_unitdefocus=0x10d676030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f511a0830,_flat=0x7f7f5115a230,_domask=1,
 _submask=0x7f7f51152e30,_kernel=0x7f7f5115b430,_kernels=0x10c284030,_kerfftr=
 0x10bf7f030,_kerffti=0x10c2ea030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51158030,_x=0x7f7f51116830,_y=0x7f7f5119fa30,_centroidgain=1,_rayleigh=
 0x7f7f520023a0,_bckgrdcalib=0x7f7f51179830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f511048d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fac0,_ctrlden=0x7f7f5110eaf8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52933f60,_xlast=0x7f7f52933c10,_ylast=[0x7f7f508dde30,0x7f7f508dde30,
 0x7f7f508dde30],_y0=0x7f7f508db030,_signus=0x7f7f52935d70,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f529352c0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f520020c8,yposition=
 0x7f7f51104b40,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      346.7   0.017      520.2
Field Avg  1.65                    346.7   0.017      520.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51113938)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528b2cc0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528ad760,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x110894030,_masks=0x0,_fluxpersub=0x7f7f50736f00,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f50739040,_skyfluxpersub=0x7f7f50737150,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00945768,0.0169513],_lastvalidtt=
 [-0.00945768,0.0169513],_upttcommand=[0,0],_refmes=0x7f7f5115d630,_tiprefv=
 0x7f7f51179830,_tiltrefv=0x7f7f51153030,_tiprefvn=0x7f7f51193030,_tiltrefvn=
 0x7f7f51194230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f528ad140,_jstart=0x7f7f528ab700,_binindices=0x7f7f511a0830,
 _binxy=2,_centroidw=0x7f7f52001fb0,_fimage=0x7f7f51193830,_fimage2=0x0,
 _imistart=0x7f7f528b2130,_imjstart=0x7f7f528b4630,_imistart2=0x7f7f528b4880,
 _imjstart2=0x7f7f528b4ad0,_unittip=0x7f7f528ade50,_unittilt=0x7f7f528b36d0,
 _lgs_defocuses=0x7f7f5110eb68,_unitdefocus=0x10cf5f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f52004c30,_flat=0x7f7f52015830,_domask=1,
 _submask=0x7f7f52007a30,_kernel=0x7f7f51159c30,_kernels=0x10c1b8030,_kerfftr=
 0x10c21e030,_kerffti=0x10c284030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5114da30,_x=0x7f7f51178a30,_y=0x7f7f51150030,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f52016c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002170)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51104d00,_ctrlden=0x7f7f52002918,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528b0050,_xlast=0x7f7f528afd30,_ylast=[0x7f7f51151a30,0x7f7f51151a30,
 0x7f7f51151a30],_y0=0x7f7f5114ee30,_signus=0x7f7f52864990,_puppixoffset=[0,0],
 _nact=80,_def=0x10e14e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528b2380,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f5110e660,yposition=
 0x7f7f52001fe8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       92.0   0.079      327.7
Field Avg  1.65                     92.0   0.079      327.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f511131c8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5062dba0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5293a020,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10dc49030,_masks=0x0,_fluxpersub=0x7f7f528ade50,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528ab700,_skyfluxpersub=0x7f7f52864990,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.0780734,0.0270053],_lastvalidtt=
 [-0.0780734,0.0270053],_upttcommand=[0,0],_refmes=0x7f7f50941c30,_tiprefv=
 0x7f7f5200b830,_tiltrefv=0x7f7f50937430,_tiprefvn=0x7f7f5200d230,_tiltrefvn=
 0x7f7f50937c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5293a270,_jstart=0x7f7f5293a4c0,_binindices=0x7f7f50943a30,
 _binxy=2,_centroidw=0x7f7f520028a8,_fimage=0x7f7f51159c30,_fimage2=0x0,
 _imistart=0x7f7f5293abb0,_imjstart=0x7f7f5293ae00,_imistart2=0x7f7f5293b050,
 _imjstart2=0x7f7f5293b2a0,_unittip=0x7f7f52933f60,_unittilt=0x7f7f50737150,
 _lgs_defocuses=0x7f7f52002090,_unitdefocus=0x10c06e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51156030,_flat=0x7f7f51158030,_domask=1,
 _submask=0x7f7f5115b430,_kernel=0x7f7f51178030,_kernels=0x10bf7f030,_kerfftr=
 0x10c2ea030,_kerffti=0x10c1b8030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51153030,_x=0x7f7f509bf630,_y=0x7f7f50930230,_centroidgain=1,_rayleigh=
 0x7f7f520023a0,_bckgrdcalib=0x7f7f511a0830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110e938)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110eba0,_ctrlden=0x7f7f52002410,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52933c10,_xlast=0x7f7f52939be0,_ylast=[0x7f7f508dde30,0x7f7f508dde30,
 0x7f7f508dde30],_y0=0x7f7f5095a430,_signus=0x7f7f52939d60,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528adc00,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f5110ec48,yposition=
 0x7f7f5110fd28,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.591      111.5
Field Avg  1.65                     54.9   0.591      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51112b68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5293a710,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528b0380,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ca5c030,_masks=0x0,_fluxpersub=0x7f7f528b1c70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528b1ec0,_skyfluxpersub=0x7f7f528ade50,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.00672449,0.00502628],_lastvalidtt=
 [-0.00672449,0.00502628],_upttcommand=[0,0],_refmes=0x7f7f50927430,_tiprefv=
 0x7f7f51158030,_tiltrefv=0x7f7f508c1430,_tiprefvn=0x7f7f51156030,_tiltrefvn=
 0x7f7f50937430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f528b05d0,_jstart=0x7f7f528b0820,_binindices=0x7f7f51159c30,
 _binxy=2,_centroidw=0x7f7f51104fa0,_fimage=0x7f7f50938c30,_fimage2=0x0,
 _imistart=0x7f7f528b2720,_imjstart=0x7f7f528b1580,_imistart2=0x7f7f528b17d0,
 _imjstart2=0x7f7f528b1a20,_unittip=0x7f7f52864990,_unittilt=0x7f7f528ad070,
 _lgs_defocuses=0x7f7f52001fb0,_unitdefocus=0x10e04d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51153a30,_flat=0x7f7f50959a30,_domask=1,
 _submask=0x7f7f5117a230,_kernel=0x7f7f52004c30,_kernels=0x10c284030,_kerfftr=
 0x10c21e030,_kerffti=0x10bf7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50933630,_x=0x7f7f5119fa30,_y=0x7f7f51176630,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f5093a230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002170)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f511101c0,_ctrlden=0x7f7f5110fba0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528b1400,_xlast=0x7f7f528ab700,_ylast=[0x7f7f51158830,0x7f7f51158830,
 0x7f7f51158830],_y0=0x7f7f51056a30,_signus=0x7f7f528af960,_puppixoffset=[0,0],
 _nact=80,_def=0x10e14e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f506292d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f5110fac0,yposition=
 0x7f7f52002250,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.659       98.0
Field Avg  1.65                     54.3   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51112060)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528b0050,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5293b720,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c85b030,_masks=0x0,_fluxpersub=0x7f7f5072e840,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5072ea90,_skyfluxpersub=0x7f7f5072ece0,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.00409307,-0.00128173],_lastvalidtt=
 [-0.00409307,-0.00128173],_upttcommand=[0,0],_refmes=0x7f7f50927430,_tiprefv=
 0x7f7f50957230,_tiltrefv=0x7f7f5200b030,_tiprefvn=0x7f7f50957a30,_tiltrefvn=
 0x7f7f5200b830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52935d70,_jstart=0x7f7f5293a380,_binindices=0x7f7f5181e030,
 _binxy=2,_centroidw=0x7f7f5110ecb8,_fimage=0x7f7f51158030,_fimage2=0x0,
 _imistart=0x7f7f5062c9c0,_imjstart=0x7f7f5062cc10,_imistart2=0x7f7f5062ce60,
 _imjstart2=0x7f7f5062d0b0,_unittip=0x7f7f52933f60,_unittilt=0x7f7f52931650,
 _lgs_defocuses=0x7f7f520028a8,_unitdefocus=0x10d374030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5180ba30,_flat=0x7f7f51810e30,_domask=1,
 _submask=0x7f7f5200c030,_kernel=0x7f7f5114da30,_kernels=0x10c2ea030,_kerfftr=
 0x10c1b8030,_kerffti=0x10c284030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f511a0830,_x=0x7f7f50930230,_y=0x7f7f508c1430,_centroidgain=1,_rayleigh=
 0x7f7f520023a0,_bckgrdcalib=0x7f7f5180a030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110e938)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e660,_ctrlden=0x7f7f5110fb68,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52922360,_xlast=0x7f7f52921a80,_ylast=[0x7f7f50941c30,0x7f7f50941c30,
 0x7f7f50941c30],_y0=0x7f7f508cee30,_signus=0x7f7f52939be0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f8b2030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f50739180,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f51104d00,yposition=
 0x7f7f5110eaf8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      375.3   0.016      520.2
Field Avg  1.65                    375.3   0.016      520.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51112308)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528b1e50,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5062c9a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c471030,_masks=0x0,_fluxpersub=0x7f7f52933f60,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f52933c10,_skyfluxpersub=0x7f7f52921e80,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.00755639,0.0139916],_lastvalidtt=
 [-0.00755639,0.0139916],_upttcommand=[0,0],_refmes=0x7f7f50890630,_tiprefv=
 0x7f7f5093ae30,_tiltrefv=0x7f7f5181ce30,_tiprefvn=0x7f7f50957230,_tiltrefvn=
 0x7f7f5181d630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5062ce70,_jstart=0x7f7f5062d0c0,_binindices=0x7f7f5115b430,
 _binxy=2,_centroidw=0x7f7f52002090,_fimage=0x7f7f511d2430,_fimage2=0x0,
 _imistart=0x7f7f528b04f0,_imjstart=0x7f7f528b0740,_imistart2=0x7f7f528b0990,
 _imjstart2=0x7f7f528b0be0,_unittip=0x7f7f5062b3e0,_unittilt=0x7f7f5062c770,
 _lgs_defocuses=0x7f7f51104fa0,_unitdefocus=0x10d979030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50933630,_flat=0x7f7f51804030,_domask=1,
 _submask=0x7f7f50957a30,_kernel=0x7f7f50959a30,_kernels=0x10bf7f030,_kerfftr=
 0x10c21e030,_kerffti=0x10c2ea030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51159c30,_x=0x7f7f51820c30,_y=0x7f7f5181de30,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f51804a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002170)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002250,_ctrlden=0x7f7f5110ea18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528adc00,_xlast=0x7f7f528afae0,_ylast=[0x7f7f5115d630,0x7f7f5115d630,
 0x7f7f5115d630],_y0=0x7f7f51056a30,_signus=0x7f7f528ab700,_puppixoffset=[0,0],
 _nact=80,_def=0x10e14e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f5110eba0,yposition=
 0x7f7f52002918,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       92.0   0.079      327.7
Field Avg  1.65                     92.0   0.079      327.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51113470)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528b3590,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528b0660,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d777030,_masks=0x0,_fluxpersub=0x7f7f52933c10,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f52921e80,_skyfluxpersub=0x7f7f52935d70,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.0780734,0.0270053],_lastvalidtt=
 [-0.0780734,0.0270053],_upttcommand=[0,0],_refmes=0x7f7f5095a430,_tiprefv=
 0x7f7f5181de30,_tiltrefv=0x7f7f5200a030,_tiprefvn=0x7f7f5181e630,_tiltrefvn=
 0x7f7f5200a830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f528b08b0,_jstart=0x7f7f528b0b00,_binindices=0x7f7f51156030,
 _binxy=2,_centroidw=0x7f7f5110faf8,_fimage=0x7f7f5114da30,_fimage2=0x0,
 _imistart=0x7f7f528b11f0,_imjstart=0x7f7f528b1440,_imistart2=0x7f7f528b1690,
 _imjstart2=0x7f7f528b18e0,_unittip=0x7f7f528ade50,_unittilt=0x7f7f528ab700,
 _lgs_defocuses=0x7f7f5110ecb8,_unitdefocus=0x10cf5f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51151430,_flat=0x7f7f5114e430,_domask=1,
 _submask=0x7f7f50934030,_kernel=0x7f7f511a0830,_kernels=0x10c1b8030,_kerfftr=
 0x10c284030,_kerffti=0x10bf7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51158030,_x=0x7f7f51176630,_y=0x7f7f51072c30,_centroidgain=1,_rayleigh=
 0x7f7f520023a0,_bckgrdcalib=0x7f7f51159c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110e938)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51104fa0,_ctrlden=0x7f7f5110fb30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528af960,_xlast=0x7f7f528adc00,_ylast=[0x7f7f51056a30,0x7f7f51056a30,
 0x7f7f51056a30],_y0=0x7f7f51177430,_signus=0x7f7f528b0050,_puppixoffset=[0,0],
 _nact=80,_def=0x10f8b2030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afae0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f511101c0,yposition=
 0x7f7f52002410,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.591      111.5
Field Avg  1.65                     54.9   0.591      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51112e98)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528b0c80,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528ade50,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10de4b030,_masks=0x0,_fluxpersub=0x7f7f52938190,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f52938f50,_skyfluxpersub=0x7f7f52933c10,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.00672449,0.00502627],_lastvalidtt=
 [-0.00672449,0.00502627],_upttcommand=[0,0],_refmes=0x7f7f5095a430,_tiprefv=
 0x7f7f50934230,_tiltrefv=0x7f7f50933a30,_tiprefvn=0x7f7f5095f230,_tiltrefvn=
 0x7f7f5095c830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f528ab700,_jstart=0x7f7f528b0280,_binindices=0x7f7f51820c30,
 _binxy=2,_centroidw=0x7f7f5110ebd8,_fimage=0x7f7f51150830,_fimage2=0x0,
 _imistart=0x7f7f5062c9c0,_imjstart=0x7f7f5062cc10,_imistart2=0x7f7f5062ce60,
 _imjstart2=0x7f7f5062d0b0,_unittip=0x7f7f52864990,_unittilt=0x7f7f528b0050,
 _lgs_defocuses=0x7f7f52002090,_unitdefocus=0x10c06e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50959a30,_flat=0x7f7f50933030,_domask=1,
 _submask=0x7f7f50932230,_kernel=0x7f7f5180a030,_kernels=0x10c2ea030,_kerfftr=
 0x10c21e030,_kerffti=0x10c1b8030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51158030,_x=0x7f7f511a1230,_y=0x7f7f5117c230,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f5095d030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f511048d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110eba0,_ctrlden=0x7f7f5110ed60,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52939fe0,_xlast=0x7f7f52935d70,_ylast=[0x7f7f50934a30,0x7f7f50934a30,
 0x7f7f50934a30],_y0=0x7f7f50890630,_signus=0x7f7f52937ed0,_puppixoffset=[0,0],
 _nact=80,_def=0x10e14e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52939e60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f5110e660,yposition=
 0x7f7f52002170,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.659       98.0
Field Avg  1.65                     54.3   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51112d00)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5293c380,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5293c730,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c75a030,_masks=0x0,_fluxpersub=0x7f7f5293b4d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5293b720,_skyfluxpersub=0x7f7f5293b970,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.00409308,-0.00128175],
 _lastvalidtt=[-0.00409308,-0.00128175],_upttcommand=[0,0],_refmes=
 0x7f7f50932c30,_tiprefv=0x7f7f5093ae30,_tiltrefv=0x7f7f51158030,_tiprefvn=
 0x7f7f50934230,_tiltrefvn=0x7f7f511a0830,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=28,_nx4fft=28,_istart=0x7f7f52939be0,_jstart=0x7f7f52935d70,
 _binindices=0x7f7f5094fa30,_binxy=2,_centroidw=0x7f7f5110eaf8,_fimage=
 0x7f7f5093a430,_fimage2=0x0,_imistart=0x7f7f52936810,_imjstart=0x7f7f5293ade0,
 _imistart2=0x7f7f5293b030,_imjstart2=0x7f7f5293b280,_unittip=0x7f7f52931650,
 _unittilt=0x7f7f52933f60,_lgs_defocuses=0x7f7f5110faf8,_unitdefocus=
 0x10e04d030,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50950830,
 _flat=0x7f7f5095f830,_domask=1,_submask=0x7f7f5094ea30,_kernel=0x7f7f50936430,
 _kernels=0x10c284030,_kerfftr=0x10bf7f030,_kerffti=0x10c2ea030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7f7f50959a30,_x=0x7f7f509bf630,_y=0x7f7f50921830,
 _centroidgain=1,_rayleigh=0x7f7f520023a0,_bckgrdcalib=0x7f7f50951230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7f7f5110fba0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f511101c0,_ctrlden=0x7f7f520028a8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f529352c0,_xlast=0x7f7f52922360,_ylast=[0x7f7f50890630,0x7f7f50890630,
 0x7f7f50890630],_y0=0x7f7f5095a430,_signus=0x7f7f52921e80,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f50739040,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f52002250,yposition=
 0x7f7f5110e938,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      345.3   0.017      520.2
Field Avg  1.65                    345.3   0.017      520.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51113ad0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f52931650,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528b02a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10dd4a030,_masks=0x0,_fluxpersub=0x7f7f528b0e30,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528ba710,_skyfluxpersub=0x7f7f528ba960,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.00933732,0.0167324],_lastvalidtt=
 [-0.00933732,0.0167324],_upttcommand=[0,0],_refmes=0x7f7f5100fc30,_tiprefv=
 0x7f7f5115b430,_tiltrefv=0x7f7f5114da30,_tiprefvn=0x7f7f5115bc30,_tiltrefvn=
 0x7f7f51158030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f528b04f0,_jstart=0x7f7f52864990,_binindices=0x7f7f5117a230,
 _binxy=2,_centroidw=0x7f7f52002100,_fimage=0x7f7f50959a30,_fimage2=0x0,
 _imistart=0x7f7f528ba4c0,_imjstart=0x7f7f528b0740,_imistart2=0x7f7f528b0990,
 _imjstart2=0x7f7f528b0be0,_unittip=0x7f7f528b1080,_unittilt=0x7f7f528ade50,
 _lgs_defocuses=0x7f7f5110ebd8,_unitdefocus=0x10d878030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51153030,_flat=0x7f7f51152630,_domask=1,
 _submask=0x7f7f5118ce30,_kernel=0x7f7f5114e230,_kernels=0x10c1b8030,_kerfftr=
 0x10c21e030,_kerffti=0x10c284030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50937c30,_x=0x7f7f5119fa30,_y=0x7f7f51176630,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f51153a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110fb68)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002170,_ctrlden=0x7f7f520020c8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52933c10,_xlast=0x7f7f529352c0,_ylast=[0x7f7f5095a430,0x7f7f5095a430,
 0x7f7f5095a430],_y0=0x7f7f50935430,_signus=0x7f7f52935d70,_puppixoffset=[0,0],
 _nact=80,_def=0x10e14e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5062c450,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f51104fa0,yposition=
 0x7f7f511048d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      161.9   0.044      385.1
Field Avg  1.65                    161.9   0.044      385.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51111b10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 100,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=
 1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f52935d70,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528b0050,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10bde9030,_masks=0x0,_fluxpersub=0x7f7f528b1520,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5072e5f0,_skyfluxpersub=0x7f7f5072eac0,
 _nphotons=8.82439e-35,_skynphotons=0,_tt=[0,0],_lastvalidtt=[0,0],_upttcommand=
 [0,0],_refmes=0x7f7f5100fc30,_tiprefv=0x7f7f51153a30,_tiltrefv=0x7f7f51178830,
 _tiprefvn=0x7f7f5115bc30,_tiltrefvn=0x7f7f51158030,_reordervec=0x0,_npixels=2,
 _npb=0,_sdim=32,_nx=28,_nx4fft=28,_istart=0x7f7f528b02a0,_jstart=
 0x7f7f528b04f0,_binindices=0x7f7f511a0830,_binxy=2,_centroidw=0x7f7f52002090,
 _fimage=0x7f7f50949030,_fimage2=0x0,_imistart=0x7f7f528b0be0,_imjstart=
 0x7f7f528b0e30,_imistart2=0x7f7f528b1080,_imjstart2=0x7f7f528b12d0,_unittip=
 0x7f7f528af960,_unittilt=0x7f7f52864990,_lgs_defocuses=0x7f7f5110eaf8,
 _unitdefocus=0x10d979030,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=
 0x7f7f52016c30,_flat=0x7f7f52018e30,_domask=1,_submask=0x7f7f51159c30,_kernel=
 0x7f7f5095c830,_kernels=0x10bf7f030,_kerfftr=0x10c2ea030,_kerffti=0x10c1b8030,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7f7f50935030,_x=0x7f7f5119fa30,_y=
 0x7f7f5117c230,_centroidgain=1,_rayleigh=0x7f7f520023a0,_bckgrdcalib=
 0x7f7f52017630,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7f7f5110ea18)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ecf0,_ctrlden=0x7f7f5110ecb8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528adc00,_xlast=0x7f7f528ba710,_ylast=[0x7f7f5115d630,0x7f7f5115d630,
 0x7f7f5115d630],_y0=0x7f7f51158830,_signus=0x7f7f528ab700,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f5110eba0,yposition=
 0x7f7f5110fba0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      161.9   0.044      385.1
Field Avg  1.65                    161.9   0.044      385.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f511129d0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 100,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=
 1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f52931650,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528ade50,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d273030,_masks=0x0,_fluxpersub=0x7f7f528b0990,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528b0be0,_skyfluxpersub=0x7f7f528b12d0,
 _nphotons=8.82439e-35,_skynphotons=0,_tt=[0,0],_lastvalidtt=[0,0],_upttcommand=
 [0,0],_refmes=0x7f7f50933a30,_tiprefv=0x7f7f50959a30,_tiltrefv=0x7f7f5200ba30,
 _tiprefvn=0x7f7f5115bc30,_tiltrefvn=0x7f7f51158030,_reordervec=0x0,_npixels=2,
 _npb=0,_sdim=32,_nx=28,_nx4fft=28,_istart=0x7f7f528b0050,_jstart=
 0x7f7f528ab700,_binindices=0x7f7f51153430,_binxy=2,_centroidw=0x7f7f5110fac0,
 _fimage=0x7f7f50935a30,_fimage2=0x0,_imistart=0x7f7f528b1080,_imjstart=
 0x7f7f528b02a0,_imistart2=0x7f7f528b04f0,_imjstart2=0x7f7f528b0740,_unittip=
 0x7f7f5072e5f0,_unittilt=0x7f7f50739040,_lgs_defocuses=0x7f7f52002100,
 _unitdefocus=0x10cf5f030,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=
 0x7f7f5095d030,_flat=0x7f7f50932230,_domask=1,_submask=0x7f7f51152630,_kernel=
 0x7f7f511a0830,_kernels=0x10c21e030,_kerfftr=0x10c284030,_kerffti=0x10bf7f030,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7f7f50932c30,_x=0x7f7f51178830,_y=
 0x7f7f5115b430,_centroidgain=1,_rayleigh=0x7f7f520021e0,_bckgrdcalib=
 0x7f7f50937c30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7f7f5110ed60)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51104e18,_ctrlden=0x7f7f52001fe8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52922360,_xlast=0x7f7f529396d0,_ylast=[0x7f7f508dde30,0x7f7f508dde30,
 0x7f7f508dde30],_y0=0x7f7f50890630,_signus=0x7f7f52938160,_puppixoffset=[0,0],
 _nact=80,_def=0x10e14e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528adc00,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f511101c0,yposition=
 0x7f7f5110fb30,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      161.9   0.044      385.1
Field Avg  1.65                    161.9   0.044      385.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51112f20)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 100,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=
 1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528acef0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5062cbd0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x110894030,_masks=0x0,_fluxpersub=0x7f7f52937150,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f529373a0,_skyfluxpersub=0x7f7f529375f0,
 _nphotons=8.82439e-35,_skynphotons=0,_tt=[0,0],_lastvalidtt=[0,0],_upttcommand=
 [0,0],_refmes=0x7f7f51177430,_tiprefv=0x7f7f5181ce30,_tiltrefv=0x7f7f51178830,
 _tiprefvn=0x7f7f5115bc30,_tiltrefvn=0x7f7f51158030,_reordervec=0x0,_npixels=2,
 _npb=0,_sdim=32,_nx=28,_nx4fft=28,_istart=0x7f7f5062ce20,_jstart=
 0x7f7f5062d070,_binindices=0x7f7f50959a30,_binxy=2,_centroidw=0x7f7f5110ec48,
 _fimage=0x7f7f50934630,_fimage2=0x0,_imistart=0x7f7f52936810,_imjstart=
 0x7f7f52936a60,_imistart2=0x7f7f52936cb0,_imjstart2=0x7f7f52936f00,_unittip=
 0x7f7f5062c770,_unittilt=0x7f7f5062c9a0,_lgs_defocuses=0x7f7f52002090,
 _unitdefocus=0x10c06e030,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=
 0x7f7f5119da30,_flat=0x7f7f51156030,_domask=1,_submask=0x7f7f50935030,_kernel=
 0x7f7f5114da30,_kernels=0x10c1b8030,_kerfftr=0x10c2ea030,_kerffti=0x10c21e030,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7f7f5095c830,_x=0x7f7f5181dc30,_y=
 0x7f7f5181e230,_centroidgain=1,_rayleigh=0x7f7f520023a0,_bckgrdcalib=
 0x7f7f511a0830,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7f7f520028a8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e938,_ctrlden=0x7f7f5110e660,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52941570,_xlast=0x7f7f52922360,_ylast=[0x7f7f50890630,0x7f7f50890630,
 0x7f7f50890630],_y0=0x7f7f508db030,_signus=0x7f7f529416f0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f1d4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5062c450,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f52002170,yposition=
 0x7f7f5110fb68,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      161.9   0.044      385.1
Field Avg  1.65                    161.9   0.044      385.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f511139c0,winddir=0x7f7f5100b450,
 _layeralt=0x7f7f51112b68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 100,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=
 1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520021a8,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5293cde0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5072f190,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10dc49030,_masks=0x0,_fluxpersub=0x7f7f528ade50,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528acef0,_skyfluxpersub=0x7f7f528ab700,
 _nphotons=8.82439e-35,_skynphotons=0,_tt=[0,0],_lastvalidtt=[0,0],_upttcommand=
 [0,0],_refmes=0x7f7f52006c30,_tiprefv=0x7f7f5200b630,_tiltrefv=0x7f7f5181e030,
 _tiprefvn=0x7f7f5115bc30,_tiltrefvn=0x7f7f51158030,_reordervec=0x0,_npixels=2,
 _npb=0,_sdim=32,_nx=28,_nx4fft=28,_istart=0x7f7f5072f3e0,_jstart=
 0x7f7f5072f630,_binindices=0x7f7f5093ac30,_binxy=2,_centroidw=0x7f7f52002a30,
 _fimage=0x7f7f51153030,_fimage2=0x0,_imistart=0x7f7f5293ae80,_imjstart=
 0x7f7f5293b0d0,_imistart2=0x7f7f5293b320,_imjstart2=0x7f7f5293b570,_unittip=
 0x7f7f5072e5f0,_unittilt=0x7f7f5072ef60,_lgs_defocuses=0x7f7f5110fac0,
 _unitdefocus=0x10d676030,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=
 0x7f7f51156030,_flat=0x7f7f51159c30,_domask=1,_submask=0x7f7f5119c630,_kernel=
 0x7f7f5180a030,_kernels=0x10bf7f030,_kerfftr=0x10c284030,_kerffti=0x10c1b8030,
 _kernelconv=0,_cyclecounter=1,_dispimage=0x7f7f51179830,_x=0x7f7f52015e30,_y=
 0x7f7f52004c30,_centroidgain=1,_rayleigh=0x7f7f520021e0,_bckgrdcalib=
 0x7f7f51152630,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,
 _pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,
 _LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,
 _nkernels=1,_dmnotinpath=0x7f7f520020c8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002058,_ctrlden=0x7f7f5110eba0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52921fc0,_xlast=0x7f7f52941500,_ylast=[0x7f7f508db030,0x7f7f508db030,
 0x7f7f508db030],_y0=0x7f7f50941c30,_signus=0x7f7f52939be0,_puppixoffset=[0,0],
 _nact=80,_def=0x10e14e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52922360,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e5f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520022c0,xposition=0x7f7f5110ecf0,yposition=
 0x7f7f5110ea18,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104ec0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112a58,winddir=0x7f7f51113a48,
 _layeralt=0x7f7f511128c0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f5110ebd8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506af270,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e0010,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c771030,_masks=0x0,_fluxpersub=0x7f7f507ac650,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507ac1c0,_skyfluxpersub=0x7f7f507aca60,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f51806e30,_tiprefv=
 0x7f7f50956630,_tiltrefv=0x7f7f52066e30,_tiprefvn=0x7f7f50953630,_tiltrefvn=
 0x7f7f52067630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e0260,_jstart=0x7f7f533e1840,_binindices=0x7f7f5181ce30,
 _binxy=2,_centroidw=0x7f7f5110fc48,_fimage=0x7f7f5181dc30,_fimage2=0x0,
 _imistart=0x7f7f506adb30,_imjstart=0x7f7f506add80,_imistart2=0x7f7f506adfd0,
 _imjstart2=0x7f7f506ae220,_unittip=0x7f7f533e24a0,_unittilt=0x7f7f533e26d0,
 _lgs_defocuses=0x7f7f520022f8,_unitdefocus=0x10f0c5030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f52017630,_flat=0x7f7f52016c30,_domask=1,
 _submask=0x7f7f52004c30,_kernel=0x7f7f5095be30,_kernels=0x10c559030,_kerfftr=
 0x10c1b8030,_kerffti=0x10c284030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5180a030,_x=0x7f7f5117ac30,_y=0x7f7f51176630,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f52009e30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110eac0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ffc8,_ctrlden=0x7f7f51110038,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f532852f0,_ylast=[0x7f7f50933230,0x7f7f50933230,
 0x7f7f50933230],_y0=0x7f7f50890630,_signus=0x7f7f53280340,_puppixoffset=[0,0],
 _nact=80,_def=0x11083a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f53187cc0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e858,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fcb8,xposition=0x7f7f520023d8,yposition=
 0x7f7f52002138,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112a58,winddir=0x7f7f51113a48,
 _layeralt=0x7f7f51113e00)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f5110ebd8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e4710,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e1ae0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cb1c030,_masks=0x0,_fluxpersub=0x7f7f506ad840,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f506a0290,_skyfluxpersub=0x7f7f506af640,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00746416,0.00577143],_lastvalidtt=
 [-0.00746416,0.00577143],_upttcommand=[0,0],_refmes=0x7f7f51806e30,_tiprefv=
 0x7f7f5115b430,_tiltrefv=0x7f7f51156830,_tiprefvn=0x7f7f51065a30,_tiltrefvn=
 0x7f7f51158030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e1d30,_jstart=0x7f7f533e1f80,_binindices=0x7f7f50952830,
 _binxy=2,_centroidw=0x7f7f51104d00,_fimage=0x7f7f5119a630,_fimage2=0x0,
 _imistart=0x7f7f52934b80,_imjstart=0x7f7f5327f0a0,_imistart2=0x7f7f532faec0,
 _imjstart2=0x7f7f532850a0,_unittip=0x7f7f533e0010,_unittilt=0x7f7f533e18b0,
 _lgs_defocuses=0x7f7f52002410,_unitdefocus=0x10efc4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5180aa30,_flat=0x7f7f5180a030,_domask=1,
 _submask=0x7f7f5186b230,_kernel=0x7f7f5180c430,_kernels=0x10c559030,_kerfftr=
 0x10c399030,_kerffti=0x10bf7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5114e630,_x=0x7f7f511a1230,_y=0x7f7f51116830,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f5180d230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f520021a8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e740,_ctrlden=0x7f7f51104b08,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f531022f0,_xlast=0x7f7f533df8a0,_ylast=[0x7f7f51158830,0x7f7f51158830,
 0x7f7f51158830],_y0=0x7f7f51177430,_signus=0x7f7f533e15f0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f8c8030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e858,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fcb8,xposition=0x7f7f52001db8,yposition=
 0x7f7f52002288,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112a58,winddir=0x7f7f51113a48,
 _layeralt=0x7f7f51113580)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f5110ebd8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507aeec0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5069f0d0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10bde9030,_masks=0x0,_fluxpersub=0x7f7f507ad5f0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507ad840,_skyfluxpersub=0x7f7f507ada90,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0040054,-0.000287009],_lastvalidtt=
 [-0.0040054,-0.000287009],_upttcommand=[0,0],_refmes=0x7f7f50890630,_tiprefv=
 0x7f7f50957830,_tiltrefv=0x7f7f5115b430,_tiprefvn=0x7f7f5092ea30,_tiltrefvn=
 0x7f7f51156830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5069f320,_jstart=0x7f7f506adce0,_binindices=0x7f7f52004c30,
 _binxy=2,_centroidw=0x7f7f5110ea50,_fimage=0x7f7f52067630,_fimage2=0x0,
 _imistart=0x7f7f507accb0,_imjstart=0x7f7f507acf00,_imistart2=0x7f7f507ad150,
 _imjstart2=0x7f7f507ad3a0,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f506a0290,
 _lgs_defocuses=0x7f7f5110ea18,_unitdefocus=0x10d979030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f52016c30,_flat=0x7f7f5180e430,_domask=1,
 _submask=0x7f7f52007630,_kernel=0x7f7f5181ce30,_kernels=0x10bf7f030,_kerfftr=
 0x10c1b8030,_kerffti=0x10c284030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f52006c30,_x=0x7f7f5180f830,_y=0x7f7f5180d830,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f5181dc30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f520029f8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002448,_ctrlden=0x7f7f52001db8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533e0260,_xlast=0x7f7f533ea450,_ylast=[0x7f7f51177430,0x7f7f51177430,
 0x7f7f51177430],_y0=0x7f7f51056a30,_signus=0x7f7f533ea5d0,_puppixoffset=[0,0],
 _nact=80,_def=0x1117f8030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533df8a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e858,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fcb8,xposition=0x7f7f52001ed0,yposition=
 0x7f7f5110eac0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      108.0   0.057      415.5
Field Avg  1.65                    108.0   0.057      415.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112a58,winddir=0x7f7f51113a48,
 _layeralt=0x7f7f51112bf0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f5110ebd8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e2d60,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506ad980,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d775030,_masks=0x0,_fluxpersub=0x7f7f53187cc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5327d0a0,_skyfluxpersub=0x7f7f5327d2f0,
 _nphotons=3513.05,_skynphotons=0,_tt=[0.00162858,-0.00682724],_lastvalidtt=
 [0.00162858,-0.00682724],_upttcommand=[0,0],_refmes=0x7f7f51026e30,_tiprefv=
 0x7f7f5127a830,_tiltrefv=0x7f7f51153a30,_tiprefvn=0x7f7f5127b030,_tiltrefvn=
 0x7f7f5115b430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506adbd0,_jstart=0x7f7f506ade20,_binindices=0x7f7f51812030,
 _binxy=2,_centroidw=0x7f7f51104b78,_fimage=0x7f7f52067630,_fimage2=0x0,
 _imistart=0x7f7f506ae510,_imjstart=0x7f7f506ae760,_imistart2=0x7f7f506ae9b0,
 _imjstart2=0x7f7f506aec00,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f5069f320,
 _lgs_defocuses=0x7f7f51104d00,_unitdefocus=0x10ecc2030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5095c830,_flat=0x7f7f5095be30,_domask=1,
 _submask=0x7f7f5093a230,_kernel=0x7f7f51065a30,_kernels=0x10c284030,_kerfftr=
 0x10c399030,_kerffti=0x10bf7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f52065a30,_x=0x7f7f5181f630,_y=0x7f7f5181e230,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f50935e30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52001ca0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f511055c0,_ctrlden=0x7f7f5110fc10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f531022f0,_ylast=[0x7f7f508db030,0x7f7f508db030,
 0x7f7f508db030],_y0=0x7f7f50890630,_signus=0x7f7f532850a0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f8c8030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e858,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fcb8,xposition=0x7f7f5110ffc8,yposition=
 0x7f7f520021a8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112a58,winddir=0x7f7f51113a48,
 _layeralt=0x7f7f511138b0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f5110ebd8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533edf00,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507ad450,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d876030,_masks=0x0,_fluxpersub=0x7f7f5327c890,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f532850a0,_skyfluxpersub=0x7f7f506a0290,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f5114ee30,_tiprefv=
 0x7f7f5092ea30,_tiltrefv=0x7f7f50957830,_tiprefvn=0x7f7f50937230,_tiltrefvn=
 0x7f7f52016c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ad6a0,_jstart=0x7f7f507ad8f0,_binindices=0x7f7f50935e30,
 _binxy=2,_centroidw=0x7f7f520022f8,_fimage=0x7f7f5114fa30,_fimage2=0x0,
 _imistart=0x7f7f5327f0a0,_imjstart=0x7f7f532fbd90,_imistart2=0x7f7f53280340,
 _imjstart2=0x7f7f53280590,_unittip=0x7f7f507ac1c0,_unittilt=0x7f7f507ad220,
 _lgs_defocuses=0x7f7f52001f78,_unitdefocus=0x1116f7030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5180a030,_flat=0x7f7f5181e030,_domask=1,
 _submask=0x7f7f5095be30,_kernel=0x7f7f50946c30,_kernels=0x10bf7f030,_kerfftr=
 0x10c1b8030,_kerffti=0x10c284030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51153030,_x=0x7f7f52017c30,_y=0x7f7f52004c30,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f5180aa30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104e18)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ea50,_ctrlden=0x7f7f51104b78,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53102070,_xlast=0x7f7f52935790,_ylast=[0x7f7f50890630,0x7f7f50890630,
 0x7f7f50890630],_y0=0x7f7f508dde30,_signus=0x7f7f52935ab0,_puppixoffset=[0,0],
 _nact=80,_def=0x1100c9030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f506a2f10,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e858,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fcb8,xposition=0x7f7f5110e740,yposition=
 0x7f7f520029f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112a58,winddir=0x7f7f51113a48,
 _layeralt=0x7f7f51112308)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f5110ebd8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53278070,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e15f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cf1f030,_masks=0x0,_fluxpersub=0x7f7f532850a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5327d980,_skyfluxpersub=0x7f7f532faec0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00746415,0.00577145],_lastvalidtt=
 [-0.00746415,0.00577145],_upttcommand=[0,0],_refmes=0x7f7f5180f830,_tiprefv=
 0x7f7f50938230,_tiltrefv=0x7f7f50937a30,_tiprefvn=0x7f7f5092ea30,_tiltrefvn=
 0x7f7f50957830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e1840,_jstart=0x7f7f533e1a90,_binindices=0x7f7f50944c30,
 _binxy=2,_centroidw=0x7f7f5110ea18,_fimage=0x7f7f5181e230,_fimage2=0x0,
 _imistart=0x7f7f531022f0,_imjstart=0x7f7f53287610,_imistart2=0x7f7f52935ab0,
 _imjstart2=0x7f7f52934b80,_unittip=0x7f7f507ac1c0,_unittilt=0x7f7f507ad170,
 _lgs_defocuses=0x7f7f520023d8,_unitdefocus=0x10c5d9030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5180e230,_flat=0x7f7f5181ce30,_domask=1,
 _submask=0x7f7f509ce430,_kernel=0x7f7f5180d430,_kernels=0x10c284030,_kerfftr=
 0x10c21e030,_kerffti=0x10bf7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5180a030,_x=0x7f7f51072c30,_y=0x7f7f5119ec30,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f5181d830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104b08)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002218,_ctrlden=0x7f7f5110e970,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f506adc40,_xlast=0x7f7f506addc0,_ylast=[0x7f7f51806e30,0x7f7f51806e30,
 0x7f7f51806e30],_y0=0x7f7f51820c30,_signus=0x7f7f506aeae0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f8c8030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533df8a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e858,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fcb8,xposition=0x7f7f52002448,yposition=
 0x7f7f51110038,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112a58,winddir=0x7f7f51113a48,
 _layeralt=0x7f7f51112418)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f5110ebd8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e1f40,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507ad690,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f7c7030,_masks=0x0,_fluxpersub=0x7f7f53187cc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f531022f0,_skyfluxpersub=0x7f7f53287610,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00400539,-0.000287004],_lastvalidtt=
 [-0.00400539,-0.000287004],_upttcommand=[0,0],_refmes=0x7f7f50945630,_tiprefv=
 0x7f7f51150430,_tiltrefv=0x7f7f5115b430,_tiprefvn=0x7f7f51150c30,_tiltrefvn=
 0x7f7f5118e230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ac650,_jstart=0x7f7f507aca60,_binindices=0x7f7f52065230,
 _binxy=2,_centroidw=0x7f7f52001d48,_fimage=0x7f7f51151430,_fimage2=0x0,
 _imistart=0x7f7f507ad150,_imjstart=0x7f7f507adc30,_imistart2=0x7f7f507ade80,
 _imjstart2=0x7f7f507ae0d0,_unittip=0x7f7f533e15f0,_unittilt=0x7f7f533e28e0,
 _lgs_defocuses=0x7f7f52001e98,_unitdefocus=0x10efc4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50944c30,_flat=0x7f7f50955c30,_domask=1,
 _submask=0x7f7f5095be30,_kernel=0x7f7f5117a230,_kernels=0x10bf7f030,_kerfftr=
 0x10c1b8030,_kerffti=0x10c284030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5114e630,_x=0x7f7f52064630,_y=0x7f7f52064c30,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f50945a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52001db8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110eba0,_ctrlden=0x7f7f5110e468,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f530efc20,_ylast=[0x7f7f5115d630,0x7f7f5115d630,
 0x7f7f5115d630],_y0=0x7f7f5100fc30,_signus=0x7f7f533e2620,_puppixoffset=[0,0],
 _nact=80,_def=0x1100c9030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e2b10,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e858,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fcb8,xposition=0x7f7f511055c0,yposition=
 0x7f7f52001ca0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      107.7   0.058      415.5
Field Avg  1.65                    107.7   0.058      415.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112a58,winddir=0x7f7f51113a48,
 _layeralt=0x7f7f51113d78)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f5110ebd8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e32b0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e3830,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c06e030,_masks=0x0,_fluxpersub=0x7f7f532805f0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53287610,_skyfluxpersub=0x7f7f53187cc0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00185186,-0.00656943],_lastvalidtt=
 [-0.00185186,-0.00656943],_upttcommand=[0,0],_refmes=0x7f7f52016030,_tiprefv=
 0x7f7f52005030,_tiltrefv=0x7f7f5117aa30,_tiprefvn=0x7f7f52011630,_tiltrefvn=
 0x7f7f5115b430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e3a80,_jstart=0x7f7f533e15f0,_binindices=0x7f7f51153030,
 _binxy=2,_centroidw=0x7f7f52002250,_fimage=0x7f7f5095c830,_fimage2=0x0,
 _imistart=0x7f7f533e1ce0,_imjstart=0x7f7f533e0240,_imistart2=0x7f7f533e2e10,
 _imjstart2=0x7f7f533e3060,_unittip=0x7f7f533e0010,_unittilt=0x7f7f533e2600,
 _lgs_defocuses=0x7f7f5110ea18,_unitdefocus=0x1115f6030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5118f630,_flat=0x7f7f51190030,_domask=1,
 _submask=0x7f7f50953230,_kernel=0x7f7f5118e830,_kernels=0x10c284030,_kerfftr=
 0x10c36c030,_kerffti=0x10bf7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50954e30,_x=0x7f7f51116830,_y=0x7f7f5119fa30,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f51190a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110fc10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ec10,_ctrlden=0x7f7f520022f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533e28e0,_xlast=0x7f7f5300fb60,_ylast=[0x7f7f5100fc30,0x7f7f5100fc30,
 0x7f7f5100fc30],_y0=0x7f7f51026e30,_signus=0x7f7f528b28e0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f8c8030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e3cd0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e858,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fcb8,xposition=0x7f7f5110ea50,yposition=
 0x7f7f51104e18,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112a58,winddir=0x7f7f51113a48,
 _layeralt=0x7f7f51112d88)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f5110ebd8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e2770,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507ac1c0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1116f7030,_masks=0x0,_fluxpersub=0x7f7f528b28e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e2cb0,_skyfluxpersub=0x7f7f533e2f00,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f50956c30,_tiprefv=
 0x7f7f509ce030,_tiltrefv=0x7f7f52004c30,_tiprefvn=0x7f7f5095be30,_tiltrefvn=
 0x7f7f52005430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507aca60,_jstart=0x7f7f507accb0,_binindices=0x7f7f50946a30,
 _binxy=2,_centroidw=0x7f7f52001f78,_fimage=0x7f7f51153a30,_fimage2=0x0,
 _imistart=0x7f7f53287610,_imjstart=0x7f7f531022f0,_imistart2=0x7f7f53281380,
 _imjstart2=0x7f7f5327cc20,_unittip=0x7f7f507adf20,_unittilt=0x7f7f507ac650,
 _lgs_defocuses=0x7f7f51105630,_unitdefocus=0x10ebc1030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51271230,_flat=0x7f7f50944230,_domask=1,
 _submask=0x7f7f51150830,_kernel=0x7f7f51065a30,_kernels=0x10bf7f030,_kerfftr=
 0x10c1b8030,_kerffti=0x10c284030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5127ce30,_x=0x7f7f52065a30,_y=0x7f7f52009e30,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f50943830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104b78)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002410,_ctrlden=0x7f7f52002448,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f506a0290,_xlast=0x7f7f506ad840,_ylast=[0x7f7f5180f830,0x7f7f5180f830,
 0x7f7f5180f830],_y0=0x7f7f51806e30,_signus=0x7f7f506ad9c0,_puppixoffset=[0,0],
 _nact=80,_def=0x1100c9030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533df8a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e858,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fcb8,xposition=0x7f7f52002218,yposition=
 0x7f7f51104b08,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112a58,winddir=0x7f7f51113a48,
 _layeralt=0x7f7f51112b68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f5110ebd8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f532751b0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e1a90,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10db77030,_masks=0x0,_fluxpersub=0x7f7f507acbe0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507ad620,_skyfluxpersub=0x7f7f507ad870,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.00746418,0.00577143],_lastvalidtt=
 [-0.00746418,0.00577143],_upttcommand=[0,0],_refmes=0x7f7f508dde30,_tiprefv=
 0x7f7f50943830,_tiltrefv=0x7f7f5180bc30,_tiprefvn=0x7f7f509ce030,_tiltrefvn=
 0x7f7f5180c430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e1ce0,_jstart=0x7f7f533e1f30,_binindices=0x7f7f52004c30,
 _binxy=2,_centroidw=0x7f7f52001e98,_fimage=0x7f7f509cc230,_fimage2=0x0,
 _imistart=0x7f7f506ad840,_imjstart=0x7f7f506ada90,_imistart2=0x7f7f506adce0,
 _imjstart2=0x7f7f506adf30,_unittip=0x7f7f533e15f0,_unittilt=0x7f7f533e0010,
 _lgs_defocuses=0x7f7f52001f08,_unitdefocus=0x10c8f2030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5200de30,_flat=0x7f7f5200d430,_domask=1,
 _submask=0x7f7f5200c630,_kernel=0x7f7f5181ce30,_kernels=0x10c284030,_kerfftr=
 0x10c65a030,_kerffti=0x10bf7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50956630,_x=0x7f7f5117c230,_y=0x7f7f51072c30,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f5200e830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110fc10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002090,_ctrlden=0x7f7f52001f78,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f507ac650,_xlast=0x7f7f507ac7d0,_ylast=[0x7f7f52016030,0x7f7f52016030,
 0x7f7f52016030],_y0=0x7f7f52008a30,_signus=0x7f7f507ac1c0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f8c8030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e858,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fcb8,xposition=0x7f7f5110eba0,yposition=
 0x7f7f5110e970,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112a58,winddir=0x7f7f51113a48,
 _layeralt=0x7f7f511128c0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f5110ebd8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e2910,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f532751b0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10efc4030,_masks=0x0,_fluxpersub=0x7f7f532fbb10,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5327f0a0,_skyfluxpersub=0x7f7f53273b50,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.00400541,-0.000287042],
 _lastvalidtt=[-0.00400541,-0.000287042],_upttcommand=[0,0],_refmes=
 0x7f7f508dde30,_tiprefv=0x7f7f509cc230,_tiltrefv=0x7f7f5095ca30,_tiprefvn=
 0x7f7f50943830,_tiltrefvn=0x7f7f50944830,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=28,_nx4fft=28,_istart=0x7f7f53187cc0,_jstart=0x7f7f53275400,
 _binindices=0x7f7f50935e30,_binxy=2,_centroidw=0x7f7f520028a8,_fimage=
 0x7f7f51150830,_fimage2=0x0,_imistart=0x7f7f52934b80,_imjstart=0x7f7f532fb420,
 _imistart2=0x7f7f532fb670,_imjstart2=0x7f7f532fb8c0,_unittip=0x7f7f532fb1f0,
 _unittilt=0x7f7f532850a0,_lgs_defocuses=0x7f7f5110ea50,_unitdefocus=
 0x10c771030,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50937630,
 _flat=0x7f7f509ca030,_domask=1,_submask=0x7f7f509c9230,_kernel=0x7f7f509cac30,
 _kernels=0x10bf7f030,_kerfftr=0x10c1b8030,_kerffti=0x10c284030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7f7f51153030,_x=0x7f7f5095be30,_y=0x7f7f5092ea30,
 _centroidgain=1,_rayleigh=0x7f7f520021e0,_bckgrdcalib=0x7f7f50938030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7f7f51104b78)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001f08,_ctrlden=0x7f7f5110eba0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533df8a0,_xlast=0x7f7f530efc20,_ylast=[0x7f7f51026e30,0x7f7f51026e30,
 0x7f7f51026e30],_y0=0x7f7f51151a30,_signus=0x7f7f533e20f0,_puppixoffset=[0,0],
 _nact=80,_def=0x1100c9030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f531022f0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e858,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fcb8,xposition=0x7f7f5110ec10,yposition=
 0x7f7f5110e468,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      108.0   0.057      415.5
Field Avg  1.65                    108.0   0.057      415.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112a58,winddir=0x7f7f51113a48,
 _layeralt=0x7f7f51113e00)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f511049b8,lgs_prof_alt=0x7f7f5110ebd8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5327d480,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53280340,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1115f6030,_masks=0x0,_fluxpersub=0x7f7f5327b2e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5327b530,_skyfluxpersub=0x7f7f5327b780,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[0.00189516,-0.00672833],_lastvalidtt=
 [0.00189516,-0.00672833],_upttcommand=[0,0],_refmes=0x7f7f5111d030,_tiprefv=
 0x7f7f51065a30,_tiltrefv=0x7f7f5114e630,_tiprefvn=0x7f7f51066230,_tiltrefvn=
 0x7f7f5119a230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52935ab0,_jstart=0x7f7f52934b80,_binindices=0x7f7f50939a30,
 _binxy=2,_centroidw=0x7f7f5110e5f0,_fimage=0x7f7f50956630,_fimage2=0x0,
 _imistart=0x7f7f5327f0a0,_imjstart=0x7f7f532850a0,_imistart2=0x7f7f5327d980,
 _imjstart2=0x7f7f5327b090,_unittip=0x7f7f532faec0,_unittilt=0x7f7f53287610,
 _lgs_defocuses=0x7f7f52001e98,_unitdefocus=0x10cb1c030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51153a30,_flat=0x7f7f51199830,_domask=1,
 _submask=0x7f7f509c1030,_kernel=0x7f7f50946c30,_kernels=0x10c284030,_kerfftr=
 0x10c36c030,_kerffti=0x10bf7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5093a830,_x=0x7f7f509bf630,_y=0x7f7f50943830,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f51158030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110fc10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f511055f8,_ctrlden=0x7f7f52002250,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533e3c00,_xlast=0x7f7f533df8a0,_ylast=[0x7f7f51151a30,0x7f7f51151a30,
 0x7f7f51151a30],_y0=0x7f7f51177430,_signus=0x7f7f533e49e0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f8c8030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e0010,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e858,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fcb8,xposition=0x7f7f52002410,yposition=
 0x7f7f520022f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      175.0   0.043      398.6
Field Avg  1.65                    175.0   0.043      398.6
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51113be0,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ec8,layeralt=0x7f7f51111d30,winddir=0x7f7f51113718,
 _layeralt=0x7f7f511124a0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001cd8,lgs_prof_alt=0x7f7f5110fc48,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506af5e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507aca60,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cd5e030,_masks=0x0,_fluxpersub=0x7f7f533e0d70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e0fc0,_skyfluxpersub=0x7f7f533e1d00,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0904834,0.0326776],_lastvalidtt=
 [-0.0904834,0.0326776],_upttcommand=[0,0],_refmes=0x7f7f5111d030,_tiprefv=
 0x7f7f5114fa30,_tiltrefv=0x7f7f52064630,_tiprefvn=0x7f7f5127f230,_tiltrefvn=
 0x7f7f52007c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507accb0,_jstart=0x7f7f507acf00,_binindices=0x7f7f50943830,
 _binxy=2,_centroidw=0x7f7f5110eb30,_fimage=0x7f7f5181a030,_fimage2=0x0,
 _imistart=0x7f7f506aff10,_imjstart=0x7f7f506ad840,_imistart2=0x7f7f506ada90,
 _imjstart2=0x7f7f506adce0,_unittip=0x7f7f507ac320,_unittilt=0x7f7f507ac650,
 _lgs_defocuses=0x7f7f511048d8,_unitdefocus=0x11017e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5127fa30,_flat=0x7f7f50945a30,_domask=1,
 _submask=0x7f7f5127bc30,_kernel=0x7f7f5095be30,_kernels=0x10c4c9030,_kerfftr=
 0x10bf7f030,_kerffti=0x10c36c030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5181e030,_x=0x7f7f52004c30,_y=0x7f7f52005230,_centroidgain=1,_rayleigh=
 0x7f7f52002020,_bckgrdcalib=0x7f7f50945030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002288)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51107160,_ctrlden=0x7f7f520028a8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53187cc0,_ylast=[0x7f7f50890630,0x7f7f50890630,
 0x7f7f50890630],_y0=0x7f7f50933230,_signus=0x7f7f52934b80,_puppixoffset=[0,0],
 _nact=80,_def=0x10f3c2030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e08d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f52001db8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ea50,xposition=0x7f7f5110fba0,yposition=
 0x7f7f511049b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104b78,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.595      111.5
Field Avg  1.65                     54.4   0.595      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51113cf0,winddir=0x7f7f51113608,
 _layeralt=0x7f7f511134f8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ca0,lgs_prof_alt=0x7f7f52001c68,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ae0e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e0910,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10bd47030,_masks=0x0,_fluxpersub=0x7f7f533e0010,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e0260,_skyfluxpersub=0x7f7f533e15f0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00422163,0.000468609],_lastvalidtt=
 [-0.00422163,0.000468609],_upttcommand=[0,0],_refmes=0x7f7f51819430,_tiprefv=
 0x7f7f5200c830,_tiltrefv=0x7f7f5180b230,_tiprefvn=0x7f7f5200d030,_tiltrefvn=
 0x7f7f5180ba30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e0b60,_jstart=0x7f7f533e0db0,_binindices=0x7f7f509ce030,
 _binxy=2,_centroidw=0x7f7f5110fa50,_fimage=0x7f7f50935e30,_fimage2=0x0,
 _imistart=0x7f7f532850a0,_imjstart=0x7f7f53280fa0,_imistart2=0x7f7f53188510,
 _imjstart2=0x7f7f5326d4b0,_unittip=0x7f7f53188760,_unittilt=0x7f7f53187cc0,
 _lgs_defocuses=0x7f7f51106f68,_unitdefocus=0x10fde6030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5127e830,_flat=0x7f7f50937830,_domask=1,
 _submask=0x7f7f5127da30,_kernel=0x7f7f5118ce30,_kernels=0x10c638030,_kerfftr=
 0x10c5d2030,_kerffti=0x10c14c030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50947630,_x=0x7f7f51072c30,_y=0x7f7f5119ec30,_centroidgain=1,_rayleigh=
 0x7f7f5110fbd8,_bckgrdcalib=0x7f7f50948a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ff90)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110f8c8,_ctrlden=0x7f7f511055f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53102070,_ylast=[0x7f7f509d5e30,0x7f7f509d5e30,
 0x7f7f509d5e30],_y0=0x7f7f509ca430,_signus=0x7f7f532875e0,_puppixoffset=[0,0],
 _nact=80,_def=0x10db79030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f530efc20,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e970,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52001cd8,xposition=0x7f7f52001ed0,yposition=
 0x7f7f5110f938,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51106fa0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    7026.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.576      111.5
Field Avg  1.65                     54.9   0.576      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51113cf0,winddir=0x7f7f51113608,
 _layeralt=0x7f7f5100b450)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ca0,lgs_prof_alt=0x7f7f52001c68,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507af330,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507acf00,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cb5d030,_masks=0x0,_fluxpersub=0x7f7f532850a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53187cc0,_skyfluxpersub=0x7f7f531022f0,
 _nphotons=7026.1,_skynphotons=0,_tt=[0.00618704,-0.00509032],_lastvalidtt=
 [0.00618704,-0.00509032],_upttcommand=[0,0],_refmes=0x7f7f52016030,_tiprefv=
 0x7f7f5118fc30,_tiltrefv=0x7f7f52078a30,_tiprefvn=0x7f7f51190430,_tiltrefvn=
 0x7f7f52079230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ad150,_jstart=0x7f7f507ad3a0,_binindices=0x7f7f52010e30,
 _binxy=2,_centroidw=0x7f7f5110fac0,_fimage=0x7f7f509c1030,_fimage2=0x0,
 _imistart=0x7f7f507ada90,_imjstart=0x7f7f507adce0,_imistart2=0x7f7f507adf30,
 _imjstart2=0x7f7f507ae580,_unittip=0x7f7f507ac650,_unittilt=0x7f7f507ac1c0,
 _lgs_defocuses=0x7f7f51106fd8,_unitdefocus=0x10c46d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5114da30,_flat=0x7f7f511a0830,_domask=1,
 _submask=0x7f7f50947630,_kernel=0x7f7f51179830,_kernels=0x10bf31030,_kerfftr=
 0x10beb1030,_kerffti=0x10c638030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50944e30,_x=0x7f7f52064630,_y=0x7f7f5200b630,_centroidgain=1,_rayleigh=
 0x7f7f5110fc10,_bckgrdcalib=0x7f7f5118dc30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f858)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002410,_ctrlden=0x7f7f51107080,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533e0260,_xlast=0x7f7f533e15f0,_ylast=[0x7f7f5117a630,0x7f7f5117a630,
 0x7f7f5117a630],_y0=0x7f7f5111d030,_signus=0x7f7f533e0db0,_puppixoffset=[0,0],
 _nact=80,_def=0x1109ec030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e970,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52001cd8,xposition=0x7f7f511070f0,yposition=
 0x7f7f5110fa88,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51106fa0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    17565.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       56.5   0.474      189.2
Field Avg  1.65                     56.5   0.474      189.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51113cf0,winddir=0x7f7f51113608,
 _layeralt=0x7f7f51112838)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ca0,lgs_prof_alt=0x7f7f52001c68,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f532875e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e0d90,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10da78030,_masks=0x0,_fluxpersub=0x7f7f533e3ca0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e0010,_skyfluxpersub=0x7f7f533e05e0,
 _nphotons=17565.3,_skynphotons=0,_tt=[0.00394349,-0.00455865],_lastvalidtt=
 [0.00394349,-0.00455865],_upttcommand=[0,0],_refmes=0x7f7f51108830,_tiprefv=
 0x7f7f511a0830,_tiltrefv=0x7f7f51153830,_tiprefvn=0x7f7f5118fc30,_tiltrefvn=
 0x7f7f5114da30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e1ee0,_jstart=0x7f7f533e2c70,_binindices=0x7f7f5118ea30,
 _binxy=2,_centroidw=0x7f7f5110e9e0,_fimage=0x7f7f51815830,_fimage2=0x0,
 _imistart=0x7f7f533e3360,_imjstart=0x7f7f533e35b0,_imistart2=0x7f7f533e3800,
 _imjstart2=0x7f7f533e3a50,_unittip=0x7f7f533e0260,_unittilt=0x7f7f533e0b60,
 _lgs_defocuses=0x7f7f5110fa50,_unitdefocus=0x10d733030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51263c30,_flat=0x7f7f51192a30,_domask=1,
 _submask=0x7f7f51191c30,_kernel=0x7f7f51190e30,_kernels=0x10c730030,_kerfftr=
 0x10c14b030,_kerffti=0x10c638030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51818830,_x=0x7f7f5117c230,_y=0x7f7f5114ec30,_centroidgain=1,_rayleigh=
 0x7f7f5110fbd8,_bckgrdcalib=0x7f7f51179830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51110000)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110f890,_ctrlden=0x7f7f52002918,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533df8a0,_xlast=0x7f7f533e1070,_ylast=[0x7f7f5111d030,0x7f7f5111d030,
 0x7f7f5111d030],_y0=0x7f7f51151a30,_signus=0x7f7f533e1c20,_puppixoffset=[0,0],
 _nact=80,_def=0x1111ed030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e2130,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e970,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52001cd8,xposition=0x7f7f511101c0,yposition=
 0x7f7f5110ff90,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51106fa0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.595      111.5
Field Avg  1.65                     54.4   0.595      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51113cf0,winddir=0x7f7f51113608,
 _layeralt=0x7f7f51113690)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ca0,lgs_prof_alt=0x7f7f52001c68,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f52935ab0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e15f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1101e7030,_masks=0x0,_fluxpersub=0x7f7f533e2750,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e29a0,_skyfluxpersub=0x7f7f533e0a60,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00422163,0.000468597],_lastvalidtt=
 [-0.00422163,0.000468597],_upttcommand=[0,0],_refmes=0x7f7f50927430,_tiprefv=
 0x7f7f509ccc30,_tiltrefv=0x7f7f509d4030,_tiprefvn=0x7f7f509cd430,_tiltrefvn=
 0x7f7f509cdc30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e1840,_jstart=0x7f7f533e1c10,_binindices=0x7f7f51263630,
 _binxy=2,_centroidw=0x7f7f520029c0,_fimage=0x7f7f509c8830,_fimage2=0x0,
 _imistart=0x7f7f533e4990,_imjstart=0x7f7f533e0810,_imistart2=0x7f7f533e22b0,
 _imjstart2=0x7f7f533e2500,_unittip=0x7f7f533e05e0,_unittilt=0x7f7f533e0f90,
 _lgs_defocuses=0x7f7f5110fac0,_unitdefocus=0x10ec7c030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5118f630,_flat=0x7f7f50947630,_domask=1,
 _submask=0x7f7f5118e830,_kernel=0x7f7f51262830,_kernels=0x10bf31030,_kerfftr=
 0x10beb1030,_kerffti=0x10c638030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509d4830,_x=0x7f7f51072c30,_y=0x7f7f51176630,_centroidgain=1,_rayleigh=
 0x7f7f5110fc10,_bckgrdcalib=0x7f7f509d3630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f520023d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fa50,_ctrlden=0x7f7f52002170,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53102070,_ylast=[0x7f7f509d5e30,0x7f7f509d5e30,
 0x7f7f509d5e30],_y0=0x7f7f508db030,_signus=0x7f7f53287320,_puppixoffset=[0,0],
 _nact=80,_def=0x10f27f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e30d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e970,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52001cd8,xposition=0x7f7f5110f8c8,yposition=
 0x7f7f5110f858,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51106fa0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    443.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.576      111.5
Field Avg  1.65                     54.9   0.576      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51113cf0,winddir=0x7f7f51113608,
 _layeralt=0x7f7f51113470)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ca0,lgs_prof_alt=0x7f7f52001c68,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506aeb60,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52935ab0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1106e9030,_masks=0x0,_fluxpersub=0x7f7f5327d980,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507ad900,_skyfluxpersub=0x7f7f507ac650,
 _nphotons=443.317,_skynphotons=0,_tt=[0.00618702,-0.00509027],_lastvalidtt=
 [0.00618702,-0.00509027],_upttcommand=[0,0],_refmes=0x7f7f52012430,_tiprefv=
 0x7f7f5200f230,_tiltrefv=0x7f7f509cd430,_tiprefvn=0x7f7f5200fa30,_tiltrefvn=
 0x7f7f509d4030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53188690,_jstart=0x7f7f532850a0,_binindices=0x7f7f51263630,
 _binxy=2,_centroidw=0x7f7f5110fb30,_fimage=0x7f7f51813830,_fimage2=0x0,
 _imistart=0x7f7f533e1840,_imjstart=0x7f7f533e2d70,_imistart2=0x7f7f533e3250,
 _imjstart2=0x7f7f533e05e0,_unittip=0x7f7f53187cc0,_unittilt=0x7f7f531022f0,
 _lgs_defocuses=0x7f7f5110e9e0,_unitdefocus=0x10eb7b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509cdc30,_flat=0x7f7f509ce630,_domask=1,
 _submask=0x7f7f509d2c30,_kernel=0x7f7f50944e30,_kernels=0x10c730030,_kerfftr=
 0x10c14b030,_kerffti=0x10c638030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51815830,_x=0x7f7f509d0630,_y=0x7f7f50946830,_centroidgain=1,_rayleigh=
 0x7f7f5110fbd8,_bckgrdcalib=0x7f7f50947630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f511055f8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ff90,_ctrlden=0x7f7f5110ebd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f530efc20,_xlast=0x7f7f533e34a0,_ylast=[0x7f7f51154030,0x7f7f51154030,
 0x7f7f51154030],_y0=0x7f7f5117a630,_signus=0x7f7f533e2ab0,_puppixoffset=[0,0],
 _nact=80,_def=0x1107ea030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507aca60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e970,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52001cd8,xposition=0x7f7f52002410,yposition=
 0x7f7f5110e4d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51106fa0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    1108.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       56.5   0.474      189.2
Field Avg  1.65                     56.5   0.474      189.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51113cf0,winddir=0x7f7f51113608,
 _layeralt=0x7f7f51113d78)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ca0,lgs_prof_alt=0x7f7f52001c68,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5327c420,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5327c8f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c46d030,_masks=0x0,_fluxpersub=0x7f7f533e2850,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e2aa0,_skyfluxpersub=0x7f7f533e15f0,
 _nphotons=1108.29,_skynphotons=0,_tt=[0.00394351,-0.00455866],_lastvalidtt=
 [0.00394351,-0.00455866],_upttcommand=[0,0],_refmes=0x7f7f5181f630,_tiprefv=
 0x7f7f52078c30,_tiltrefv=0x7f7f509ccc30,_tiprefvn=0x7f7f5200f230,_tiltrefvn=
 0x7f7f509cd430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5327cb40,_jstart=0x7f7f53188510,_binindices=0x7f7f51190030,
 _binxy=2,_centroidw=0x7f7f52002368,_fimage=0x7f7f509cea30,_fimage2=0x0,
 _imistart=0x7f7f533e1f10,_imjstart=0x7f7f533e2160,_imistart2=0x7f7f533e23b0,
 _imjstart2=0x7f7f533e2600,_unittip=0x7f7f53187cc0,_unittilt=0x7f7f531022f0,
 _lgs_defocuses=0x7f7f520029c0,_unitdefocus=0x10d935030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f511a0830,_flat=0x7f7f5119c230,_domask=1,
 _submask=0x7f7f51179830,_kernel=0x7f7f509cdc30,_kernels=0x10bf31030,_kerfftr=
 0x10beb1030,_kerffti=0x10c638030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50945430,_x=0x7f7f50944030,_y=0x7f7f50944e30,_centroidgain=1,_rayleigh=
 0x7f7f5110fc10,_bckgrdcalib=0x7f7f51262830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107080)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fcb8,_ctrlden=0x7f7f5110fac0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53275810,_xlast=0x7f7f53287650,_ylast=[0x7f7f509d5230,0x7f7f509d5230,
 0x7f7f509d5230],_y0=0x7f7f509d5e30,_signus=0x7f7f5327d980,_puppixoffset=[0,0],
 _nact=80,_def=0x10f27f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533df8a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e970,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52001cd8,xposition=0x7f7f5110f890,yposition=
 0x7f7f51110000,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51106fa0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.595      111.5
Field Avg  1.65                     54.4   0.595      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51113cf0,winddir=0x7f7f51113608,
 _layeralt=0x7f7f51113c68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ca0,lgs_prof_alt=0x7f7f52001c68,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f531022f0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e0fa0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d733030,_masks=0x0,_fluxpersub=0x7f7f533e51b0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e1d00,_skyfluxpersub=0x7f7f533e5c80,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.00422163,0.000468597],_lastvalidtt=
 [-0.00422163,0.000468597],_upttcommand=[0,0],_refmes=0x7f7f52008a30,_tiprefv=
 0x7f7f50945630,_tiltrefv=0x7f7f50944e30,_tiprefvn=0x7f7f509cdc30,_tiltrefvn=
 0x7f7f509ccc30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e0270,_jstart=0x7f7f533e4f60,_binindices=0x7f7f509d4830,
 _binxy=2,_centroidw=0x7f7f511071d0,_fimage=0x7f7f509c7c30,_fimage2=0x0,
 _imistart=0x7f7f532850a0,_imjstart=0x7f7f5327d980,_imistart2=0x7f7f5326d4b0,
 _imjstart2=0x7f7f5326d700,_unittip=0x7f7f533e15f0,_unittilt=0x7f7f533e0840,
 _lgs_defocuses=0x7f7f5110fb30,_unitdefocus=0x10c8f2030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50937630,_flat=0x7f7f50938030,_domask=1,
 _submask=0x7f7f5118fa30,_kernel=0x7f7f50936830,_kernels=0x10c730030,_kerfftr=
 0x10c14b030,_kerffti=0x10c638030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50935e30,_x=0x7f7f5119fa30,_y=0x7f7f5119ec30,_centroidgain=1,_rayleigh=
 0x7f7f5110fbd8,_bckgrdcalib=0x7f7f50938a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002918)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e858,_ctrlden=0x7f7f5110ec48,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f507aca60,_xlast=0x7f7f507ac650,_ylast=[0x7f7f52012430,0x7f7f52012430,
 0x7f7f52012430],_y0=0x7f7f52016030,_signus=0x7f7f507ac1c0,_puppixoffset=[0,0],
 _nact=80,_def=0x1107ea030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e970,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52001cd8,xposition=0x7f7f5110fa50,yposition=
 0x7f7f520023d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51106fa0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    28.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.576      111.5
Field Avg  1.65                     54.9   0.576      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51113cf0,winddir=0x7f7f51113608,
 _layeralt=0x7f7f511137a0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ca0,lgs_prof_alt=0x7f7f52001c68,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5327bde0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533ebca0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ec7c030,_masks=0x0,_fluxpersub=0x7f7f53187cc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f531022f0,_skyfluxpersub=0x7f7f52935ab0,
 _nphotons=27.9714,_skynphotons=0,_tt=[0.00618704,-0.00509027],_lastvalidtt=
 [0.00618704,-0.00509027],_upttcommand=[0,0],_refmes=0x7f7f51806e30,_tiprefv=
 0x7f7f511a1030,_tiltrefv=0x7f7f509cdc30,_tiprefvn=0x7f7f51179830,_tiltrefvn=
 0x7f7f50944e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e0010,_jstart=0x7f7f533e0fa0,_binindices=0x7f7f5127a830,
 _binxy=2,_centroidw=0x7f7f5110ec10,_fimage=0x7f7f50938030,_fimage2=0x0,
 _imistart=0x7f7f533ecb10,_imjstart=0x7f7f533ecd60,_imistart2=0x7f7f533ecfb0,
 _imjstart2=0x7f7f533ed200,_unittip=0x7f7f533eb840,_unittilt=0x7f7f533eba70,
 _lgs_defocuses=0x7f7f52002368,_unitdefocus=0x10ed7d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51158030,_flat=0x7f7f5127c430,_domask=1,
 _submask=0x7f7f50939630,_kernel=0x7f7f5127b630,_kernels=0x10bf31030,_kerfftr=
 0x10beb1030,_kerffti=0x10c638030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50936830,_x=0x7f7f5117c230,_y=0x7f7f5119fa30,_centroidgain=1,_rayleigh=
 0x7f7f5110fc10,_bckgrdcalib=0x7f7f5127ce30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107080)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001e60,_ctrlden=0x7f7f51106ec0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f530efc20,_ylast=[0x7f7f51151a30,0x7f7f51151a30,
 0x7f7f51151a30],_y0=0x7f7f51154030,_signus=0x7f7f533e05e0,_puppixoffset=[0,0],
 _nact=80,_def=0x110feb030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5327d980,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e970,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52001cd8,xposition=0x7f7f5110ff90,yposition=
 0x7f7f52002170,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51106fa0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    69.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       56.5   0.474      189.2
Field Avg  1.65                     56.5   0.474      189.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 //wfs(n).gspos       = [0.,0.];
 //wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.5;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51113cf0,winddir=0x7f7f51113608,
 _layeralt=0x7f7f51113250)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.5,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ca0,lgs_prof_alt=0x7f7f52001c68,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e09c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507adf30,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10eb7b030,_masks=0x0,_fluxpersub=0x7f7f533e5290,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e54e0,_skyfluxpersub=0x7f7f533e5730,
 _nphotons=69.9286,_skynphotons=0,_tt=[0.0039435,-0.00455865],_lastvalidtt=
 [0.0039435,-0.00455865],_upttcommand=[0,0],_refmes=0x7f7f508db030,_tiprefv=
 0x7f7f50937a30,_tiltrefv=0x7f7f5119c830,_tiprefvn=0x7f7f50938230,_tiltrefvn=
 0x7f7f51262830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ac650,_jstart=0x7f7f507ac1c0,_binindices=0x7f7f509d0630,
 _binxy=2,_centroidw=0x7f7f5110e9e0,_fimage=0x7f7f5118d830,_fimage2=0x0,
 _imistart=0x7f7f531022f0,_imjstart=0x7f7f5327b2e0,_imistart2=0x7f7f5327b530,
 _imjstart2=0x7f7f5327b780,_unittip=0x7f7f507ad150,_unittilt=0x7f7f507ad380,
 _lgs_defocuses=0x7f7f511071d0,_unitdefocus=0x10d834030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509cea30,_flat=0x7f7f50936830,_domask=1,
 _submask=0x7f7f511a0830,_kernel=0x7f7f509cdc30,_kernels=0x10c730030,_kerfftr=
 0x10c14b030,_kerffti=0x10c638030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5119be30,_x=0x7f7f52002c30,_y=0x7f7f52008030,_centroidgain=1,_rayleigh=
 0x7f7f5110fbd8,_bckgrdcalib=0x7f7f50947630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002918)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001d80,_ctrlden=0x7f7f520029c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53278990,_xlast=0x7f7f53272480,_ylast=[0x7f7f509d5e30,0x7f7f509d5e30,
 0x7f7f509d5e30],_y0=0x7f7f50890630,_signus=0x7f7f532850a0,_puppixoffset=[0,0],
 _nact=80,_def=0x1107ea030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f530efc20,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e970,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52001cd8,xposition=0x7f7f5110fcb8,yposition=
 0x7f7f5110ebd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51106fa0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.595      111.5
Field Avg  1.65                     54.4   0.595      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7s;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51112a58,winddir=0x7f7f51112528,
 _layeralt=0x7f7f511125b0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ebd8,lgs_prof_alt=0x7f7f52001cd8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e62b0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53187cc0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d935030,_masks=0x0,_fluxpersub=0x7f7f533e5960,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e5bb0,_skyfluxpersub=0x7f7f533e5e00,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00422163,0.000468609],_lastvalidtt=
 [-0.00422163,0.000468609],_upttcommand=[0,0],_refmes=0x7f7f52012430,_tiprefv=
 0x7f7f52078a30,_tiltrefv=0x7f7f51262830,_tiprefvn=0x7f7f52079230,_tiltrefvn=
 0x7f7f51190430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52934b80,_jstart=0x7f7f5327d980,_binindices=0x7f7f50939430,
 _binxy=2,_centroidw=0x7f7f5110fc10,_fimage=0x7f7f5127c230,_fimage2=0x0,
 _imistart=0x7f7f53271ed0,_imjstart=0x7f7f53272120,_imistart2=0x7f7f53272370,
 _imjstart2=0x7f7f53276570,_unittip=0x7f7f533e6820,_unittilt=0x7f7f533e05e0,
 _lgs_defocuses=0x7f7f51110230,_unitdefocus=0x10d333030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5118f630,_flat=0x7f7f509d1c30,_domask=1,
 _submask=0x7f7f51263a30,_kernel=0x7f7f509d0e30,_kernels=0x10bf63030,_kerfftr=
 0x10c14b030,_kerffti=0x10c638030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5127b830,_x=0x7f7f50936830,_y=0x7f7f509cdc30,_centroidgain=1,_rayleigh=
 0x7f7f51106f30,_bckgrdcalib=0x7f7f50935e30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104980)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51107160,_ctrlden=0x7f7f5110ee08,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f530efc80,_xlast=0x7f7f533e1070,_ylast=[0x7f7f51108830,0x7f7f51108830,
 0x7f7f51108830],_y0=0x7f7f51151a30,_signus=0x7f7f533e50e0,_puppixoffset=[0,0],
 _nact=80,_def=0x10ee7e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f506a2f10,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520029c0,xposition=0x7f7f5110f7b0,yposition=
 0x7f7f5110eaf8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001ca0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    7026.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.576      111.5
Field Avg  1.65                     54.9   0.576      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7s;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51112a58,winddir=0x7f7f51112528,
 _layeralt=0x7f7f51112d88)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ebd8,lgs_prof_alt=0x7f7f52001cd8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f532fb500,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e4f60,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c8f2030,_masks=0x0,_fluxpersub=0x7f7f533e5b40,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e5d90,_skyfluxpersub=0x7f7f533e5fe0,
 _nphotons=7026.1,_skynphotons=0,_tt=[0.00618704,-0.00509032],_lastvalidtt=
 [0.00618704,-0.00509032],_upttcommand=[0,0],_refmes=0x7f7f51154030,_tiprefv=
 0x7f7f5118de30,_tiltrefv=0x7f7f5117a230,_tiprefvn=0x7f7f5118e630,_tiltrefvn=
 0x7f7f51262830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e05e0,_jstart=0x7f7f533e64f0,_binindices=0x7f7f5127ec30,
 _binxy=2,_centroidw=0x7f7f52001d10,_fimage=0x7f7f50947630,_fimage2=0x0,
 _imistart=0x7f7f533e6be0,_imjstart=0x7f7f533e6e30,_imistart2=0x7f7f533e7080,
 _imjstart2=0x7f7f533e72d0,_unittip=0x7f7f533e0f00,_unittilt=0x7f7f533e0cd0,
 _lgs_defocuses=0x7f7f51107080,_unitdefocus=0x10bd47030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5127c230,_flat=0x7f7f5127b830,_domask=1,
 _submask=0x7f7f51199430,_kernel=0x7f7f5118f830,_kernels=0x10befd030,_kerfftr=
 0x10c638030,_kerffti=0x10bf63030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50944e30,_x=0x7f7f51116830,_y=0x7f7f5117c230,_centroidgain=1,_rayleigh=
 0x7f7f5110e628,_bckgrdcalib=0x7f7f5119a230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f511055f8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51110230,_ctrlden=0x7f7f52002170,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f532fbf20,_ylast=[0x7f7f509c9030,0x7f7f509c9030,
 0x7f7f509c9030],_y0=0x7f7f50932a30,_signus=0x7f7f52935ab0,_puppixoffset=[0,0],
 _nact=80,_def=0x1107ea030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f53187cc0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520029c0,xposition=0x7f7f520029f8,yposition=
 0x7f7f52001c68,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001ca0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    17565.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       56.5   0.474      189.2
Field Avg  1.65                     56.5   0.474      189.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7s;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51112a58,winddir=0x7f7f51112528,
 _layeralt=0x7f7f51112060)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ebd8,lgs_prof_alt=0x7f7f52001cd8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53287550,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506a0290,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d834030,_masks=0x0,_fluxpersub=0x7f7f53271920,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f52935ab0,_skyfluxpersub=0x7f7f5327d980,
 _nphotons=17565.3,_skynphotons=0,_tt=[0.00394349,-0.00455865],_lastvalidtt=
 [0.00394349,-0.00455865],_upttcommand=[0,0],_refmes=0x7f7f52012430,_tiprefv=
 0x7f7f5114da30,_tiltrefv=0x7f7f51190630,_tiprefvn=0x7f7f5118de30,_tiltrefvn=
 0x7f7f5117a230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506ae3c0,_jstart=0x7f7f506ae610,_binindices=0x7f7f511a0830,
 _binxy=2,_centroidw=0x7f7f5110fa50,_fimage=0x7f7f50948430,_fimage2=0x0,
 _imistart=0x7f7f533e0260,_imjstart=0x7f7f533e0cd0,_imistart2=0x7f7f533e0f20,
 _imjstart2=0x7f7f533e6740,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f506ad840,
 _lgs_defocuses=0x7f7f5110fc10,_unitdefocus=0x10cb5d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5127b830,_flat=0x7f7f5127c230,_domask=1,
 _submask=0x7f7f509d4430,_kernel=0x7f7f50935e30,_kernels=0x10c14b030,_kerfftr=
 0x10bf63030,_kerffti=0x10befd030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50944e30,_x=0x7f7f5181f630,_y=0x7f7f51813830,_centroidgain=1,_rayleigh=
 0x7f7f51106f30,_bckgrdcalib=0x7f7f5118e630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ec48)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110f7b0,_ctrlden=0x7f7f51104ad0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5326fad0,_xlast=0x7f7f52935790,_ylast=[0x7f7f50932a30,0x7f7f50932a30,
 0x7f7f50932a30],_y0=0x7f7f509d1630,_signus=0x7f7f52934b80,_puppixoffset=[0,0],
 _nact=80,_def=0x110feb030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5327dbd0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520029c0,xposition=0x7f7f5110fa18,yposition=
 0x7f7f51104980,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001ca0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.595      111.5
Field Avg  1.65                     54.4   0.595      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7s;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51112a58,winddir=0x7f7f51112528,
 _layeralt=0x7f7f51113a48)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ebd8,lgs_prof_alt=0x7f7f52001cd8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f532767c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e0f20,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10eb7b030,_masks=0x0,_fluxpersub=0x7f7f533e5fc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e05e0,_skyfluxpersub=0x7f7f533e0cd0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00422163,0.000468597],_lastvalidtt=
 [-0.00422163,0.000468597],_upttcommand=[0,0],_refmes=0x7f7f50948030,_tiprefv=
 0x7f7f5208c830,_tiltrefv=0x7f7f5118d830,_tiprefvn=0x7f7f5200be30,_tiltrefvn=
 0x7f7f51190630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e5b20,_jstart=0x7f7f533e5d70,_binindices=0x7f7f50939030,
 _binxy=2,_centroidw=0x7f7f511070b8,_fimage=0x7f7f509cea30,_fimage2=0x0,
 _imistart=0x7f7f52934b80,_imjstart=0x7f7f53188690,_imistart2=0x7f7f532850a0,
 _imjstart2=0x7f7f53276570,_unittip=0x7f7f533e58f0,_unittilt=0x7f7f533e56c0,
 _lgs_defocuses=0x7f7f52001d10,_unitdefocus=0x10d132030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5118ce30,_flat=0x7f7f5117a030,_domask=1,
 _submask=0x7f7f511a0830,_kernel=0x7f7f509cdc30,_kernels=0x10c638030,_kerfftr=
 0x10befd030,_kerffti=0x10c14b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50947630,_x=0x7f7f5117c230,_y=0x7f7f51116830,_centroidgain=1,_rayleigh=
 0x7f7f5110e628,_bckgrdcalib=0x7f7f5127ec30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51106ec0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001e60,_ctrlden=0x7f7f5110fc10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f533e62c0,_ylast=[0x7f7f51108830,0x7f7f51108830,
 0x7f7f51108830],_y0=0x7f7f51154030,_signus=0x7f7f533eef90,_puppixoffset=[0,0],
 _nact=80,_def=0x1107ea030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520029c0,xposition=0x7f7f51107160,yposition=
 0x7f7f511055f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001ca0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    443.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.576      111.5
Field Avg  1.65                     54.9   0.576      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7s;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51112a58,winddir=0x7f7f51112528,
 _layeralt=0x7f7f511129d0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ebd8,lgs_prof_alt=0x7f7f52001cd8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f532850a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506a0290,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10da78030,_masks=0x0,_fluxpersub=0x7f7f531022f0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53276570,_skyfluxpersub=0x7f7f53187cc0,
 _nphotons=443.317,_skynphotons=0,_tt=[0.00618702,-0.00509027],_lastvalidtt=
 [0.00618702,-0.00509027],_upttcommand=[0,0],_refmes=0x7f7f509d5e30,_tiprefv=
 0x7f7f509cdc30,_tiltrefv=0x7f7f50944e30,_tiprefvn=0x7f7f50937830,_tiltrefvn=
 0x7f7f50947630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506ad840,_jstart=0x7f7f506ada90,_binindices=0x7f7f5118fe30,
 _binxy=2,_centroidw=0x7f7f5110fc80,_fimage=0x7f7f509ce430,_fimage2=0x0,
 _imistart=0x7f7f533e56c0,_imjstart=0x7f7f533e5910,_imistart2=0x7f7f533e5b60,
 _imjstart2=0x7f7f533e5db0,_unittip=0x7f7f506ae180,_unittilt=0x7f7f506a2f10,
 _lgs_defocuses=0x7f7f5110fa50,_unitdefocus=0x10cf5f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5118e830,_flat=0x7f7f511a0830,_domask=1,
 _submask=0x7f7f50939030,_kernel=0x7f7f50948630,_kernels=0x10bf63030,_kerfftr=
 0x10c14b030,_kerffti=0x10c638030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50936830,_x=0x7f7f5180f830,_y=0x7f7f5180a030,_centroidgain=1,_rayleigh=
 0x7f7f51106f30,_bckgrdcalib=0x7f7f5127ec30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ee08)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110f8c8,_ctrlden=0x7f7f51107080,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5327d570,_xlast=0x7f7f53102070,_ylast=[0x7f7f508dde30,0x7f7f508dde30,
 0x7f7f508dde30],_y0=0x7f7f50932a30,_signus=0x7f7f532767c0,_puppixoffset=[0,0],
 _nact=80,_def=0x10ee7e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52934b80,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520029c0,xposition=0x7f7f51110230,yposition=
 0x7f7f52001f78,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001ca0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    1108.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       56.5   0.474      189.2
Field Avg  1.65                     56.5   0.474      189.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7s;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51112a58,winddir=0x7f7f51112528,
 _layeralt=0x7f7f51113140)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ebd8,lgs_prof_alt=0x7f7f52001cd8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ae110,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53187cc0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1101e7030,_masks=0x0,_fluxpersub=0x7f7f53270280,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f532704d0,_skyfluxpersub=0x7f7f53270720,
 _nphotons=1108.29,_skynphotons=0,_tt=[0.00394351,-0.00455866],_lastvalidtt=
 [0.00394351,-0.00455866],_upttcommand=[0,0],_refmes=0x7f7f52012430,_tiprefv=
 0x7f7f509d2230,_tiltrefv=0x7f7f5208c430,_tiprefvn=0x7f7f509cdc30,_tiltrefvn=
 0x7f7f520a0630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f531022f0,_jstart=0x7f7f5327d980,_binindices=0x7f7f50948630,
 _binxy=2,_centroidw=0x7f7f520029f8,_fimage=0x7f7f52093030,_fimage2=0x0,
 _imistart=0x7f7f5327d2f0,_imjstart=0x7f7f53276570,_imistart2=0x7f7f532767c0,
 _imjstart2=0x7f7f53270030,_unittip=0x7f7f533e5b60,_unittilt=0x7f7f533e0010,
 _lgs_defocuses=0x7f7f511070b8,_unitdefocus=0x10d333030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50938a30,_flat=0x7f7f509cfc30,_domask=1,
 _submask=0x7f7f509d1430,_kernel=0x7f7f52007c30,_kernels=0x10befd030,_kerfftr=
 0x10c638030,_kerffti=0x10bf63030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5200b430,_x=0x7f7f50944030,_y=0x7f7f5093de30,_centroidgain=1,_rayleigh=
 0x7f7f5110e628,_bckgrdcalib=0x7f7f50939430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002170)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51107160,_ctrlden=0x7f7f51105588,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f5327d570,_ylast=[0x7f7f50932a30,0x7f7f50932a30,
 0x7f7f50932a30],_y0=0x7f7f50927430,_signus=0x7f7f53280570,_puppixoffset=[0,0],
 _nact=80,_def=0x1107ea030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5069f7e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520029c0,xposition=0x7f7f5110f7b0,yposition=
 0x7f7f5110ec48,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001ca0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.595      111.5
Field Avg  1.65                     54.4   0.595      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7s;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51112a58,winddir=0x7f7f51112528,
 _layeralt=0x7f7f51111b10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=12,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ebd8,lgs_prof_alt=0x7f7f52001cd8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e6260,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f532767c0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1106e9030,_masks=0x0,_fluxpersub=0x7f7f5327d2d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53270410,_skyfluxpersub=0x7f7f53270660,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.00422163,0.000468597],_lastvalidtt=
 [-0.00422163,0.000468597],_upttcommand=[0,0],_refmes=0x7f7f508dde30,_tiprefv=
 0x7f7f50939430,_tiltrefv=0x7f7f509d1a30,_tiprefvn=0x7f7f509d2230,_tiltrefvn=
 0x7f7f509d3c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f532850a0,_jstart=0x7f7f53280340,_binindices=0x7f7f509d8e30,
 _binxy=2,_centroidw=0x7f7f5110ec10,_fimage=0x7f7f5114da30,_fimage2=0x0,
 _imistart=0x7f7f5326fd20,_imjstart=0x7f7f5326ff70,_imistart2=0x7f7f532701c0,
 _imjstart2=0x7f7f53276570,_unittip=0x7f7f5327d0a0,_unittilt=0x7f7f531022f0,
 _lgs_defocuses=0x7f7f5110fc80,_unitdefocus=0x10bd47030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509c1030,_flat=0x7f7f509d6a30,_domask=1,
 _submask=0x7f7f50948030,_kernel=0x7f7f509c3430,_kernels=0x10c14b030,_kerfftr=
 0x10bf63030,_kerffti=0x10befd030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f511a0830,_x=0x7f7f50948e30,_y=0x7f7f50944030,_centroidgain=1,_rayleigh=
 0x7f7f51106f30,_bckgrdcalib=0x7f7f509c1a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104ad0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51110230,_ctrlden=0x7f7f5110fcb8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5327dbd0,_xlast=0x7f7f52935790,_ylast=[0x7f7f50927430,0x7f7f50927430,
 0x7f7f50927430],_y0=0x7f7f50890630,_signus=0x7f7f52935ab0,_puppixoffset=[0,0],
 _nact=80,_def=0x110feb030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520029c0,xposition=0x7f7f52001e60,yposition=
 0x7f7f51106ec0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001ca0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    28.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.576      111.5
Field Avg  1.65                     54.9   0.576      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7s;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51112a58,winddir=0x7f7f51112528,
 _layeralt=0x7f7f511120e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=12,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ebd8,lgs_prof_alt=0x7f7f52001cd8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f52934b80,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5327dac0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c46d030,_masks=0x0,_fluxpersub=0x7f7f531022f0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5327bc60,_skyfluxpersub=0x7f7f533e56c0,
 _nphotons=27.9714,_skynphotons=0,_tt=[0.00618704,-0.00509027],_lastvalidtt=
 [0.00618704,-0.00509027],_upttcommand=[0,0],_refmes=0x7f7f508dde30,_tiprefv=
 0x7f7f50944e30,_tiltrefv=0x7f7f509d4e30,_tiprefvn=0x7f7f50939430,_tiltrefvn=
 0x7f7f509d1a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52935ab0,_jstart=0x7f7f53188510,_binindices=0x7f7f51813830,
 _binxy=2,_centroidw=0x7f7f5110f858,_fimage=0x7f7f509d3230,_fimage2=0x0,
 _imistart=0x7f7f506ada90,_imjstart=0x7f7f506adce0,_imistart2=0x7f7f506adf30,
 _imjstart2=0x7f7f506ae180,_unittip=0x7f7f532850a0,_unittilt=0x7f7f53187cc0,
 _lgs_defocuses=0x7f7f520029f8,_unitdefocus=0x10cb5d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51262830,_flat=0x7f7f5117a030,_domask=1,
 _submask=0x7f7f509ce430,_kernel=0x7f7f50938630,_kernels=0x10c638030,_kerfftr=
 0x10befd030,_kerffti=0x10c14b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509d3c30,_x=0x7f7f5093de30,_y=0x7f7f50921830,_centroidgain=1,_rayleigh=
 0x7f7f5110e628,_bckgrdcalib=0x7f7f51263230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002170)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ec48,_ctrlden=0x7f7f511101c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53102070,_xlast=0x7f7f5326fad0,_ylast=[0x7f7f50890630,0x7f7f50890630,
 0x7f7f50890630],_y0=0x7f7f509ca430,_signus=0x7f7f5327c890,_puppixoffset=[0,0],
 _nact=80,_def=0x1107ea030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e5910,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520029c0,xposition=0x7f7f5110f8c8,yposition=
 0x7f7f5110fc10,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001ca0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    69.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       56.5   0.474      189.2
Field Avg  1.65                     56.5   0.474      189.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7s;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51112a58,winddir=0x7f7f51112528,
 _layeralt=0x7f7f51111fd8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=0,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=12,skymag=0,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0,
 pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,pyr_denom=0x0,
 shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,spotpitch=2,
 extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,shcalibseeing=
 0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",fssize=2.4,
 fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ebd8,lgs_prof_alt=0x7f7f52001cd8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e0270,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506ad840,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d733030,_masks=0x0,_fluxpersub=0x7f7f53187cc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5327dac0,_skyfluxpersub=0x7f7f531022f0,
 _nphotons=69.9286,_skynphotons=0,_tt=[0.0039435,-0.00455865],_lastvalidtt=
 [0.0039435,-0.00455865],_upttcommand=[0,0],_refmes=0x7f7f51806e30,_tiprefv=
 0x7f7f51263030,_tiltrefv=0x7f7f51262830,_tiprefvn=0x7f7f5118dc30,_tiltrefvn=
 0x7f7f5118ee30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506ada90,_jstart=0x7f7f506adce0,_binindices=0x7f7f5118ce30,
 _binxy=2,_centroidw=0x7f7f5110ff90,_fimage=0x7f7f5114da30,_fimage2=0x0,
 _imistart=0x7f7f533eee90,_imjstart=0x7f7f533e5a90,_imistart2=0x7f7f533e5ce0,
 _imjstart2=0x7f7f533e5f30,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f506a0290,
 _lgs_defocuses=0x7f7f5110ec10,_unitdefocus=0x10d132030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50948a30,_flat=0x7f7f511a0830,_domask=1,
 _submask=0x7f7f509c1030,_kernel=0x7f7f509cfc30,_kernels=0x10bf63030,_kerfftr=
 0x10c14b030,_kerffti=0x10c638030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5117a030,_x=0x7f7f51820c30,_y=0x7f7f51813830,_centroidgain=1,_rayleigh=
 0x7f7f51106f30,_bckgrdcalib=0x7f7f5127ec30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104ad0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002410,_ctrlden=0x7f7f5110ea50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f533e0810,_ylast=[0x7f7f51263830,0x7f7f51263830,
 0x7f7f51263830],_y0=0x7f7f5100fc30,_signus=0x7f7f533eebd0,_puppixoffset=[0,0],
 _nact=80,_def=0x10ee7e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5327c4f0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520029c0,xposition=0x7f7f51107160,yposition=
 0x7f7f51107080,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001ca0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.595      111.5
Field Avg  1.65                     54.4   0.595      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51113be0,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ec8,layeralt=0x7f7f51113608,winddir=0x7f7f51113cf0,
 _layeralt=0x7f7f51112b68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107080,lgs_prof_alt=0x7f7f520029c0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ae250,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e5cd0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ec7c030,_masks=0x0,_fluxpersub=0x7f7f53287570,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53271c80,_skyfluxpersub=0x7f7f53271ed0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00422163,0.000468609],_lastvalidtt=
 [-0.00422163,0.000468609],_upttcommand=[0,0],_refmes=0x7f7f52012430,_tiprefv=
 0x7f7f5119c830,_tiltrefv=0x7f7f52064e30,_tiprefvn=0x7f7f51158030,_tiltrefvn=
 0x7f7f5200b430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e5f20,_jstart=0x7f7f533ef2c0,_binindices=0x7f7f509ce430,
 _binxy=2,_centroidw=0x7f7f5110e628,_fimage=0x7f7f5117a030,_fimage2=0x0,
 _imistart=0x7f7f52934b80,_imjstart=0x7f7f53271470,_imistart2=0x7f7f532850a0,
 _imjstart2=0x7f7f53287320,_unittip=0x7f7f533e4f60,_unittilt=0x7f7f533e5aa0,
 _lgs_defocuses=0x7f7f5110f890,_unitdefocus=0x10cf5f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50939030,_flat=0x7f7f5200bc30,_domask=1,
 _submask=0x7f7f50935e30,_kernel=0x7f7f509d1a30,_kernels=0x10c04b030,_kerfftr=
 0x10c14b030,_kerffti=0x10c638030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5114da30,_x=0x7f7f51116830,_y=0x7f7f5119fa30,_centroidgain=1,_rayleigh=
 0x7f7f52001ed0,_bckgrdcalib=0x7f7f52007c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f520021e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002288,_ctrlden=0x7f7f5110f8c8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f507ac650,_xlast=0x7f7f507ac7d0,_ylast=[0x7f7f52009e30,0x7f7f52009e30,
 0x7f7f52009e30],_y0=0x7f7f52016030,_signus=0x7f7f507ac1c0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f55c030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ea50,xposition=0x7f7f5110fac0,yposition=
 0x7f7f51106fa0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ebd8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    7026.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.576      111.5
Field Avg  1.65                     54.9   0.576      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51113be0,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ec8,layeralt=0x7f7f51113608,winddir=0x7f7f51113cf0,
 _layeralt=0x7f7f51113938)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107080,lgs_prof_alt=0x7f7f520029c0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5326e210,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5327d980,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ed7d030,_masks=0x0,_fluxpersub=0x7f7f533e0260,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e4f60,_skyfluxpersub=0x7f7f533e51b0,
 _nphotons=7026.1,_skynphotons=0,_tt=[0.00618704,-0.00509032],_lastvalidtt=
 [0.00618704,-0.00509032],_upttcommand=[0,0],_refmes=0x7f7f5111d030,_tiprefv=
 0x7f7f50937230,_tiltrefv=0x7f7f51158030,_tiprefvn=0x7f7f50935e30,_tiltrefvn=
 0x7f7f51263630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5326fad0,_jstart=0x7f7f5326fd20,_binindices=0x7f7f509d8430,
 _binxy=2,_centroidw=0x7f7f51107128,_fimage=0x7f7f50939430,_fimage2=0x0,
 _imistart=0x7f7f5327c100,_imjstart=0x7f7f5327c350,_imistart2=0x7f7f52934b80,
 _imjstart2=0x7f7f53271470,_unittip=0x7f7f53188510,_unittilt=0x7f7f53188740,
 _lgs_defocuses=0x7f7f52002170,_unitdefocus=0x10d333030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5118ce30,_flat=0x7f7f509ce430,_domask=1,
 _submask=0x7f7f511a0830,_kernel=0x7f7f51262830,_kernels=0x10bf63030,_kerfftr=
 0x10befd030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50948a30,_x=0x7f7f50944030,_y=0x7f7f50938e30,_centroidgain=1,_rayleigh=
 0x7f7f51104980,_bckgrdcalib=0x7f7f509d1a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ee08)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001e98,_ctrlden=0x7f7f5110e4d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533df8a0,_xlast=0x7f7f530efc20,_ylast=[0x7f7f51151a30,0x7f7f51151a30,
 0x7f7f51151a30],_y0=0x7f7f5100fc30,_signus=0x7f7f533e6ab0,_puppixoffset=[0,0],
 _nact=80,_def=0x1116c9030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f532716c0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ea50,xposition=0x7f7f5110e9e0,yposition=
 0x7f7f52001cd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ebd8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    17565.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       56.5   0.474      189.2
Field Avg  1.65                     56.5   0.474      189.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51113be0,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ec8,layeralt=0x7f7f51113608,winddir=0x7f7f51113cf0,
 _layeralt=0x7f7f51112fa8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107080,lgs_prof_alt=0x7f7f520029c0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506af650,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5326de30,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d132030,_masks=0x0,_fluxpersub=0x7f7f507ac1c0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e6dd0,_skyfluxpersub=0x7f7f533e7020,
 _nphotons=17565.3,_skynphotons=0,_tt=[0.00394349,-0.00455865],_lastvalidtt=
 [0.00394349,-0.00455865],_upttcommand=[0,0],_refmes=0x7f7f509ca430,_tiprefv=
 0x7f7f509d1a30,_tiltrefv=0x7f7f509d4a30,_tiprefvn=0x7f7f50937230,_tiltrefvn=
 0x7f7f509d2230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5327bc60,_jstart=0x7f7f5327d980,_binindices=0x7f7f51194030,
 _binxy=2,_centroidw=0x7f7f5110fc10,_fimage=0x7f7f5180ce30,_fimage2=0x0,
 _imistart=0x7f7f533e5b00,_imjstart=0x7f7f533e5d50,_imistart2=0x7f7f533e6930,
 _imjstart2=0x7f7f533e6b80,_unittip=0x7f7f532fbe10,_unittilt=0x7f7f53187cc0,
 _lgs_defocuses=0x7f7f5110e628,_unitdefocus=0x10bd47030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51191630,_flat=0x7f7f52078a30,_domask=1,
 _submask=0x7f7f5207be30,_kernel=0x7f7f5127ee30,_kernels=0x10c0b1030,_kerfftr=
 0x10c132030,_kerffti=0x10bf63030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5180a830,_x=0x7f7f50948030,_y=0x7f7f509d4030,_centroidgain=1,_rayleigh=
 0x7f7f52001ed0,_bckgrdcalib=0x7f7f52007c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110fcb8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51106fa0,_ctrlden=0x7f7f52002918,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53102070,_ylast=[0x7f7f508dde30,0x7f7f508dde30,
 0x7f7f508dde30],_y0=0x7f7f50890630,_signus=0x7f7f532850a0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f55c030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533df8a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ea50,xposition=0x7f7f51110000,yposition=
 0x7f7f520021e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ebd8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.595      111.5
Field Avg  1.65                     54.4   0.595      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51113be0,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ec8,layeralt=0x7f7f51113608,winddir=0x7f7f51113cf0,
 _layeralt=0x7f7f511132d8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107080,lgs_prof_alt=0x7f7f520029c0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5326e210,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e4f60,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c8f2030,_masks=0x0,_fluxpersub=0x7f7f533e5650,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e58a0,_skyfluxpersub=0x7f7f533e5af0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00422163,0.000468597],_lastvalidtt=
 [-0.00422163,0.000468597],_upttcommand=[0,0],_refmes=0x7f7f50927430,_tiprefv=
 0x7f7f50937a30,_tiltrefv=0x7f7f51814030,_tiprefvn=0x7f7f509d1a30,_tiltrefvn=
 0x7f7f51818030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e51b0,_jstart=0x7f7f533e5400,_binindices=0x7f7f50936c30,
 _binxy=2,_centroidw=0x7f7f5110fb30,_fimage=0x7f7f50944e30,_fimage2=0x0,
 _imistart=0x7f7f52935ab0,_imjstart=0x7f7f52934b80,_imistart2=0x7f7f532850a0,
 _imjstart2=0x7f7f5327d980,_unittip=0x7f7f533e0010,_unittilt=0x7f7f533e0240,
 _lgs_defocuses=0x7f7f51107128,_unitdefocus=0x10cb5d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5114da30,_flat=0x7f7f5118ce30,_domask=1,
 _submask=0x7f7f5127a830,_kernel=0x7f7f509c4430,_kernels=0x10c04b030,_kerfftr=
 0x10befd030,_kerffti=0x10c0b1030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50948830,_x=0x7f7f5119fa30,_y=0x7f7f51116830,_centroidgain=1,_rayleigh=
 0x7f7f51104980,_bckgrdcalib=0x7f7f51263630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f511101c0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002368,_ctrlden=0x7f7f5110f858,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f506afb00,_xlast=0x7f7f506a2f10,_ylast=[0x7f7f51816230,0x7f7f51816230,
 0x7f7f51816230],_y0=0x7f7f51806e30,_signus=0x7f7f506af0f0,_puppixoffset=[0,0],
 _nact=80,_def=0x1116c9030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ea50,xposition=0x7f7f52002288,yposition=
 0x7f7f5110ee08,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ebd8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    443.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.576      111.5
Field Avg  1.65                     54.9   0.576      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51113be0,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ec8,layeralt=0x7f7f51113608,winddir=0x7f7f51113cf0,
 _layeralt=0x7f7f51112f20)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107080,lgs_prof_alt=0x7f7f520029c0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e6ad0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52934b80,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d834030,_masks=0x0,_fluxpersub=0x7f7f5326ed70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5327d980,_skyfluxpersub=0x7f7f5327d2f0,
 _nphotons=443.317,_skynphotons=0,_tt=[0.00618702,-0.00509027],_lastvalidtt=
 [0.00618702,-0.00509027],_upttcommand=[0,0],_refmes=0x7f7f51026e30,_tiprefv=
 0x7f7f5127b230,_tiltrefv=0x7f7f52011430,_tiprefvn=0x7f7f5127ba30,_tiltrefvn=
 0x7f7f509d1a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53271470,_jstart=0x7f7f532850a0,_binindices=0x7f7f509c5230,
 _binxy=2,_centroidw=0x7f7f52001d10,_fimage=0x7f7f5114da30,_fimage2=0x0,
 _imistart=0x7f7f53287570,_imjstart=0x7f7f5326e680,_imistart2=0x7f7f5326e8d0,
 _imjstart2=0x7f7f5326eb20,_unittip=0x7f7f53187cc0,_unittilt=0x7f7f531022f0,
 _lgs_defocuses=0x7f7f5110fc10,_unitdefocus=0x10d733030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509d3230,_flat=0x7f7f5181a830,_domask=1,
 _submask=0x7f7f509ea630,_kernel=0x7f7f509c7430,_kernels=0x10c117030,_kerfftr=
 0x10bf63030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5117a030,_x=0x7f7f50937c30,_y=0x7f7f50921830,_centroidgain=1,_rayleigh=
 0x7f7f52001ed0,_bckgrdcalib=0x7f7f51815830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f8c8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001e60,_ctrlden=0x7f7f51107128,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f533df8a0,_ylast=[0x7f7f5127c230,0x7f7f5127c230,
 0x7f7f5127c230],_y0=0x7f7f51154030,_signus=0x7f7f533e5400,_puppixoffset=[0,0],
 _nact=80,_def=0x10f55c030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5069f7e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ea50,xposition=0x7f7f52001e98,yposition=
 0x7f7f511071d0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ebd8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    1108.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       56.5   0.474      189.2
Field Avg  1.65                     56.5   0.474      189.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51113be0,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ec8,layeralt=0x7f7f51113608,winddir=0x7f7f51113cf0,
 _layeralt=0x7f7f51112280)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107080,lgs_prof_alt=0x7f7f520029c0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f531022f0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5326f6d0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10eb7b030,_masks=0x0,_fluxpersub=0x7f7f507ac650,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507ac1c0,_skyfluxpersub=0x7f7f507aca60,
 _nphotons=1108.29,_skynphotons=0,_tt=[0.00394351,-0.00455866],_lastvalidtt=
 [0.00394351,-0.00455866],_upttcommand=[0,0],_refmes=0x7f7f50890630,_tiprefv=
 0x7f7f5180cc30,_tiltrefv=0x7f7f50947630,_tiprefvn=0x7f7f5180d430,_tiltrefvn=
 0x7f7f50947e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53271470,_jstart=0x7f7f5327d980,_binindices=0x7f7f50938c30,
 _binxy=2,_centroidw=0x7f7f52001cd8,_fimage=0x7f7f51263830,_fimage2=0x0,
 _imistart=0x7f7f5326ff70,_imjstart=0x7f7f53287320,_imistart2=0x7f7f53287570,
 _imjstart2=0x7f7f53278070,_unittip=0x7f7f52935ab0,_unittilt=0x7f7f52934b80,
 _lgs_defocuses=0x7f7f5110fb30,_unitdefocus=0x10cf5f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5208a230,_flat=0x7f7f52007c30,_domask=1,
 _submask=0x7f7f52089430,_kernel=0x7f7f511a0830,_kernels=0x10c0b1030,_kerfftr=
 0x10befd030,_kerffti=0x10c117030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5117a030,_x=0x7f7f50921830,_y=0x7f7f50935e30,_centroidgain=1,_rayleigh=
 0x7f7f51104980,_bckgrdcalib=0x7f7f5208ac30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110e4d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e628,_ctrlden=0x7f7f5110f820,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533e6640,_xlast=0x7f7f5300fb60,_ylast=[0x7f7f51154030,0x7f7f51154030,
 0x7f7f51154030],_y0=0x7f7f51026e30,_signus=0x7f7f533e74f0,_puppixoffset=[0,0],
 _nact=80,_def=0x1116c9030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f506a2f10,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ea50,xposition=0x7f7f51106fa0,yposition=
 0x7f7f5110fcb8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ebd8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.595      111.5
Field Avg  1.65                     54.4   0.595      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51113be0,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ec8,layeralt=0x7f7f51113608,winddir=0x7f7f51113cf0,
 _layeralt=0x7f7f51112e98)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107080,lgs_prof_alt=0x7f7f520029c0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e77a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52935ab0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10da78030,_masks=0x0,_fluxpersub=0x7f7f533e73d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e53a0,_skyfluxpersub=0x7f7f533e55f0,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.00422162,0.000468589],
 _lastvalidtt=[-0.00422162,0.000468589],_upttcommand=[0,0],_refmes=
 0x7f7f509d5230,_tiprefv=0x7f7f51158030,_tiltrefv=0x7f7f509d8830,_tiprefvn=
 0x7f7f511a0830,_tiltrefvn=0x7f7f50947630,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=28,_nx4fft=28,_istart=0x7f7f52934b80,_jstart=0x7f7f532850a0,
 _binindices=0x7f7f509ce430,_binxy=2,_centroidw=0x7f7f52001df0,_fimage=
 0x7f7f51195830,_fimage2=0x0,_imistart=0x7f7f53270650,_imjstart=0x7f7f532708a0,
 _imistart2=0x7f7f53270af0,_imjstart2=0x7f7f5326de30,_unittip=0x7f7f53187cc0,
 _unittilt=0x7f7f5326e680,_lgs_defocuses=0x7f7f52001d10,_unitdefocus=
 0x10d333030,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509ebe30,
 _flat=0x7f7f509ec830,_domask=1,_submask=0x7f7f51262830,_kernel=0x7f7f50938430,
 _kernels=0x10c04b030,_kerfftr=0x10bf63030,_kerffti=0x10c0b1030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7f7f5114da30,_x=0x7f7f50944030,_y=0x7f7f509c8630,
 _centroidgain=1,_rayleigh=0x7f7f52001ed0,_bckgrdcalib=0x7f7f509ed230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7f7f52002918)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fa50,_ctrlden=0x7f7f51106fd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533efb50,_xlast=0x7f7f533e4f60,_ylast=[0x7f7f51026e30,0x7f7f51026e30,
 0x7f7f51026e30],_y0=0x7f7f5111d030,_signus=0x7f7f533e50e0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f55c030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ea50,xposition=0x7f7f52002368,yposition=
 0x7f7f511101c0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ebd8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.576      111.5
Field Avg  1.65                     54.9   0.576      111.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51113be0,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ec8,layeralt=0x7f7f51113608,winddir=0x7f7f51113cf0,
 _layeralt=0x7f7f51112390)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107080,lgs_prof_alt=0x7f7f520029c0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ae5b0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5326fad0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1101e7030,_masks=0x0,_fluxpersub=0x7f7f533e4f60,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e51b0,_skyfluxpersub=0x7f7f533e5400,
 _nphotons=1.76488e-14,_skynphotons=0,_tt=[0.00618705,-0.00509025],_lastvalidtt=
 [0.00618705,-0.00509025],_upttcommand=[0,0],_refmes=0x7f7f51154030,_tiprefv=
 0x7f7f52079230,_tiltrefv=0x7f7f5118de30,_tiprefvn=0x7f7f52079a30,_tiltrefvn=
 0x7f7f5118e630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52934b80,_jstart=0x7f7f53270400,_binindices=0x7f7f50939030,
 _binxy=2,_centroidw=0x7f7f52002288,_fimage=0x7f7f52007c30,_fimage2=0x0,
 _imistart=0x7f7f5327b090,_imjstart=0x7f7f5327b2e0,_imistart2=0x7f7f5327b530,
 _imjstart2=0x7f7f5327b780,_unittip=0x7f7f53271470,_unittilt=0x7f7f532700e0,
 _lgs_defocuses=0x7f7f52001cd8,_unitdefocus=0x10bd47030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509c3e30,_flat=0x7f7f509ce430,_domask=1,
 _submask=0x7f7f51196230,_kernel=0x7f7f509c5230,_kernels=0x10c117030,_kerfftr=
 0x10befd030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f52089430,_x=0x7f7f50944030,_y=0x7f7f50944e30,_centroidgain=1,_rayleigh=
 0x7f7f51104980,_bckgrdcalib=0x7f7f509c6030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110e4d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fc10,_ctrlden=0x7f7f5110f7b0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533df8a0,_xlast=0x7f7f530efc20,_ylast=[0x7f7f5111d030,0x7f7f5111d030,
 0x7f7f5111d030],_y0=0x7f7f51158830,_signus=0x7f7f533e0010,_puppixoffset=[0,0],
 _nact=80,_def=0x1116c9030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e02d0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ea50,xposition=0x7f7f52001e60,yposition=
 0x7f7f5110f858,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ebd8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 40.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       56.5   0.474      189.2
Field Avg  1.65                     56.5   0.474      189.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2; //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12; //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2; //Focal plane: Final # of pixels per subaperture
 wfs.npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=40,screen=0x7f7f51113be0,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ec8,layeralt=0x7f7f51113608,winddir=0x7f7f51113cf0,
 _layeralt=0x7f7f51112bf0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107080,lgs_prof_alt=0x7f7f520029c0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5326ff80,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53270b10,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1106e9030,_masks=0x0,_fluxpersub=0x7f7f532785e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53278830,_skyfluxpersub=0x7f7f5326fad0,
 _nphotons=4.41219e-14,_skynphotons=0,_tt=[0.00394351,-0.00455865],_lastvalidtt=
 [0.00394351,-0.00455865],_upttcommand=[0,0],_refmes=0x7f7f50927430,_tiprefv=
 0x7f7f52086230,_tiltrefv=0x7f7f5118f830,_tiprefvn=0x7f7f52079230,_tiltrefvn=
 0x7f7f5118de30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52934b80,_jstart=0x7f7f5327d980,_binindices=0x7f7f509c3430,
 _binxy=2,_centroidw=0x7f7f51106e88,_fimage=0x7f7f50935e30,_fimage2=0x0,
 _imistart=0x7f7f532765d0,_imjstart=0x7f7f53276820,_imistart2=0x7f7f53281930,
 _imjstart2=0x7f7f53281b80,_unittip=0x7f7f532715b0,_unittilt=0x7f7f531022f0,
 _lgs_defocuses=0x7f7f52001df0,_unitdefocus=0x10cb5d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509c1a30,_flat=0x7f7f509c1030,_domask=1,
 _submask=0x7f7f509d6a30,_kernel=0x7f7f50938c30,_kernels=0x10c0b1030,_kerfftr=
 0x10bf63030,_kerffti=0x10c117030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50936e30,_x=0x7f7f509c5a30,_y=0x7f7f50944030,_centroidgain=1,_rayleigh=
 0x7f7f52001ed0,_bckgrdcalib=0x7f7f509c2430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002918)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51106ec0,_ctrlden=0x7f7f52002368,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f533df8a0,_ylast=[0x7f7f51158830,0x7f7f51158830,
 0x7f7f51158830],_y0=0x7f7f51151a30,_signus=0x7f7f533e51b0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f55c030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f530efc20,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ea50,xposition=0x7f7f5110e628,yposition=
 0x7f7f51107128,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ebd8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112528,winddir=0x7f7f51112a58,
 _layeralt=0x7f7f51112170)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107128,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506ae5a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507adb00,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c46d030,_masks=0x0,_fluxpersub=0x7f7f533e0260,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e0010,_skyfluxpersub=0x7f7f528b1560,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f508dde30,_tiprefv=
 0x7f7f50935e30,_tiltrefv=0x7f7f51263a30,_tiprefvn=0x7f7f509c5a30,_tiltrefvn=
 0x7f7f5118ce30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ad1e0,_jstart=0x7f7f507ad430,_binindices=0x7f7f52010e30,
 _binxy=2,_centroidw=0x7f7f51104980,_fimage=0x7f7f5180c830,_fimage2=0x0,
 _imistart=0x7f7f507ae900,_imjstart=0x7f7f507add50,_imistart2=0x7f7f507adfa0,
 _imjstart2=0x7f7f507ae1f0,_unittip=0x7f7f507ac1c0,_unittilt=0x7f7f507ad8d0,
 _lgs_defocuses=0x7f7f5110fac0,_unitdefocus=0x10d733030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5118f430,_flat=0x7f7f51152630,_domask=1,
 _submask=0x7f7f51262830,_kernel=0x7f7f52078a30,_kernels=0x10c17d030,_kerfftr=
 0x10bf63030,_kerffti=0x10c117030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5180d230,_x=0x7f7f5208ca30,_y=0x7f7f5208c230,_centroidgain=1,_rayleigh=
 0x7f7f511070f0,_bckgrdcalib=0x7f7f5119d030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51105588)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fb68,_ctrlden=0x7f7f520029f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f528afd30,_ylast=[0x7f7f51158830,0x7f7f51158830,
 0x7f7f51158830],_y0=0x7f7f51151a30,_signus=0x7f7f533e5290,_puppixoffset=[0,0],
 _nact=80,_def=0x1107ea030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f530efc20,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002368,xposition=0x7f7f52001ca0,yposition=
 0x7f7f51104e18,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51107080,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112528,winddir=0x7f7f51112a58,
 _layeralt=0x7f7f51113e88)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107128,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506af9c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f532850a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d935030,_masks=0x0,_fluxpersub=0x7f7f533e0010,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528b1560,_skyfluxpersub=0x7f7f533e0260,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00746418,0.00577143],_lastvalidtt=
 [-0.00746418,0.00577143],_upttcommand=[0,0],_refmes=0x7f7f51154030,_tiprefv=
 0x7f7f51152630,_tiltrefv=0x7f7f51263230,_tiprefvn=0x7f7f5127b630,_tiltrefvn=
 0x7f7f51263a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5327c890,_jstart=0x7f7f5326d7e0,_binindices=0x7f7f50938830,
 _binxy=2,_centroidw=0x7f7f5110fc10,_fimage=0x7f7f52089430,_fimage2=0x0,
 _imistart=0x7f7f532fb810,_imjstart=0x7f7f532fba60,_imistart2=0x7f7f532fbcb0,
 _imjstart2=0x7f7f5326da30,_unittip=0x7f7f52935ab0,_unittilt=0x7f7f5326e200,
 _lgs_defocuses=0x7f7f5110fa50,_unitdefocus=0x10cf5f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5117a030,_flat=0x7f7f51262830,_domask=1,
 _submask=0x7f7f5118e430,_kernel=0x7f7f5127a830,_kernels=0x10c04b030,_kerfftr=
 0x10c0b1030,_kerffti=0x10c17d030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5208b030,_x=0x7f7f50944030,_y=0x7f7f50946830,_centroidgain=1,_rayleigh=
 0x7f7f52002170,_bckgrdcalib=0x7f7f5127be30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f8c8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f511070b8,_ctrlden=0x7f7f5110ec10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533df8a0,_xlast=0x7f7f5300fb60,_ylast=[0x7f7f51151a30,0x7f7f51151a30,
 0x7f7f51151a30],_y0=0x7f7f51026e30,_signus=0x7f7f528b28e0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f55c030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5326e430,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002368,xposition=0x7f7f5110e628,yposition=
 0x7f7f520029c0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51107080,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112528,winddir=0x7f7f51112a58,
 _layeralt=0x7f7f51112ae0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107128,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507b0480,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507ada50,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cb5d030,_masks=0x0,_fluxpersub=0x7f7f532850a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f506a0290,_skyfluxpersub=0x7f7f506ae340,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00400541,-0.00028702],_lastvalidtt=
 [-0.00400541,-0.00028702],_upttcommand=[0,0],_refmes=0x7f7f5181b230,_tiprefv=
 0x7f7f5119d030,_tiltrefv=0x7f7f5118ce30,_tiprefvn=0x7f7f51152630,_tiltrefvn=
 0x7f7f51263230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ae2a0,_jstart=0x7f7f507ae4f0,_binindices=0x7f7f5200d230,
 _binxy=2,_centroidw=0x7f7f5110ee08,_fimage=0x7f7f5208b030,_fimage2=0x0,
 _imistart=0x7f7f507aed40,_imjstart=0x7f7f507aef90,_imistart2=0x7f7f507af1e0,
 _imjstart2=0x7f7f507af430,_unittip=0x7f7f507ac340,_unittilt=0x7f7f507ad580,
 _lgs_defocuses=0x7f7f51104980,_unitdefocus=0x10d333030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5180a830,_flat=0x7f7f51818c30,_domask=1,
 _submask=0x7f7f509ce430,_kernel=0x7f7f50936e30,_kernels=0x10c117030,_kerfftr=
 0x10bf49030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5200e030,_x=0x7f7f52089430,_y=0x7f7f52089a30,_centroidgain=1,_rayleigh=
 0x7f7f511070f0,_bckgrdcalib=0x7f7f5180b230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51106fd8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001e60,_ctrlden=0x7f7f51104e18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f532852f0,_xlast=0x7f7f53274c40,_ylast=[0x7f7f509d5e30,0x7f7f509d5e30,
 0x7f7f509d5e30],_y0=0x7f7f508dde30,_signus=0x7f7f53280340,_puppixoffset=[0,0],
 _nact=80,_def=0x110ec8030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002368,xposition=0x7f7f52001d10,yposition=
 0x7f7f51105588,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51107080,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      108.0   0.057      415.5
Field Avg  1.65                    108.0   0.057      415.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112528,winddir=0x7f7f51112a58,
 _layeralt=0x7f7f51111f50)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107128,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e6d30,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5327ede0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ed7d030,_masks=0x0,_fluxpersub=0x7f7f533e5aa0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e5cf0,_skyfluxpersub=0x7f7f533e5f40,
 _nphotons=3513.05,_skynphotons=0,_tt=[0.00139218,-0.00678357],_lastvalidtt=
 [0.00139218,-0.00678357],_upttcommand=[0,0],_refmes=0x7f7f5119d830,_tiprefv=
 0x7f7f50947630,_tiltrefv=0x7f7f50939030,_tiprefvn=0x7f7f50947e30,_tiltrefvn=
 0x7f7f509c1030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52935ab0,_jstart=0x7f7f532fb180,_binindices=0x7f7f51262830,
 _binxy=2,_centroidw=0x7f7f520028a8,_fimage=0x7f7f5127f230,_fimage2=0x0,
 _imistart=0x7f7f533eeb20,_imjstart=0x7f7f533e4f60,_imistart2=0x7f7f533e5600,
 _imjstart2=0x7f7f533e5850,_unittip=0x7f7f53280340,_unittilt=0x7f7f531022f0,
 _lgs_defocuses=0x7f7f5110fc10,_unitdefocus=0x10bd47030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5127b230,_flat=0x7f7f5127a830,_domask=1,
 _submask=0x7f7f51263630,_kernel=0x7f7f509c7030,_kernels=0x10c0b1030,_kerfftr=
 0x10c17d030,_kerffti=0x10c117030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51152630,_x=0x7f7f50946830,_y=0x7f7f509bf630,_centroidgain=1,_rayleigh=
 0x7f7f52002170,_bckgrdcalib=0x7f7f5127bc30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f7b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002138,_ctrlden=0x7f7f52001d80,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53102070,_xlast=0x7f7f532852f0,_ylast=[0x7f7f508dde30,0x7f7f508dde30,
 0x7f7f508dde30],_y0=0x7f7f50927430,_signus=0x7f7f532faec0,_puppixoffset=[0,0],
 _nact=80,_def=0x10ee7e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002368,xposition=0x7f7f5110fb68,yposition=
 0x7f7f5110f8c8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51107080,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112528,winddir=0x7f7f51112a58,
 _layeralt=0x7f7f511132d8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107128,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53280fa0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528b1560,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d132030,_masks=0x0,_fluxpersub=0x7f7f533e58a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e5af0,_skyfluxpersub=0x7f7f533e5d40,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f50890630,_tiprefv=
 0x7f7f509c3430,_tiltrefv=0x7f7f5119d030,_tiprefvn=0x7f7f50947630,_tiltrefvn=
 0x7f7f51263630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e0010,_jstart=0x7f7f533ee950,_binindices=0x7f7f51190030,
 _binxy=2,_centroidw=0x7f7f5110fa50,_fimage=0x7f7f509c3c30,_fimage2=0x0,
 _imistart=0x7f7f533e4f60,_imjstart=0x7f7f533e51b0,_imistart2=0x7f7f533e5400,
 _imjstart2=0x7f7f533e5650,_unittip=0x7f7f507ad1e0,_unittilt=0x7f7f507adb50,
 _lgs_defocuses=0x7f7f5110ee08,_unitdefocus=0x10c8f2030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5127b230,_flat=0x7f7f5127a830,_domask=1,
 _submask=0x7f7f51262830,_kernel=0x7f7f509ce430,_kernels=0x10c04b030,_kerfftr=
 0x10bf49030,_kerffti=0x10c0b1030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509d3230,_x=0x7f7f5119ec30,_y=0x7f7f51116830,_centroidgain=1,_rayleigh=
 0x7f7f511070f0,_bckgrdcalib=0x7f7f5127c430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110e970)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fc80,_ctrlden=0x7f7f52001d10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53102070,_ylast=[0x7f7f50927430,0x7f7f50927430,
 0x7f7f50927430],_y0=0x7f7f509c8230,_signus=0x7f7f5327ede0,_puppixoffset=[0,0],
 _nact=80,_def=0x1106e9030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f53187cc0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002368,xposition=0x7f7f511070b8,yposition=
 0x7f7f51106fd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51107080,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112528,winddir=0x7f7f51112a58,
 _layeralt=0x7f7f51113690)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107128,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507aee10,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f532fb040,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ce5e030,_masks=0x0,_fluxpersub=0x7f7f53281b80,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5326d4b0,_skyfluxpersub=0x7f7f5326d700,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00746417,0.00577142],_lastvalidtt=
 [-0.00746417,0.00577142],_upttcommand=[0,0],_refmes=0x7f7f5117a630,_tiprefv=
 0x7f7f509ce430,_tiltrefv=0x7f7f509d3230,_tiprefvn=0x7f7f509c3430,_tiltrefvn=
 0x7f7f509cec30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53280340,_jstart=0x7f7f532785e0,_binindices=0x7f7f509c3c30,
 _binxy=2,_centroidw=0x7f7f52001ca0,_fimage=0x7f7f509c2a30,_fimage2=0x0,
 _imistart=0x7f7f532fb880,_imjstart=0x7f7f532fbad0,_imistart2=0x7f7f532fbd20,
 _imjstart2=0x7f7f53281930,_unittip=0x7f7f5327ede0,_unittilt=0x7f7f52935ab0,
 _lgs_defocuses=0x7f7f520028a8,_unitdefocus=0x10d834030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509c8230,_flat=0x7f7f509c7830,_domask=1,
 _submask=0x7f7f509c1030,_kernel=0x7f7f5180b030,_kernels=0x10c117030,_kerfftr=
 0x10c17d030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50944e30,_x=0x7f7f50944030,_y=0x7f7f509bf630,_centroidgain=1,_rayleigh=
 0x7f7f52002170,_bckgrdcalib=0x7f7f50947630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ec10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f511101c0,_ctrlden=0x7f7f5110fb68,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f507ac1c0,_xlast=0x7f7f507ac340,_ylast=[0x7f7f52016030,0x7f7f52016030,
 0x7f7f52016030],_y0=0x7f7f52012430,_signus=0x7f7f507ad1e0,_puppixoffset=[0,0],
 _nact=80,_def=0x10ee7e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5069f7e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002368,xposition=0x7f7f52001e60,yposition=
 0x7f7f520029f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51107080,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112528,winddir=0x7f7f51112a58,
 _layeralt=0x7f7f51113a48)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107128,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506af770,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507af010,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d333030,_masks=0x0,_fluxpersub=0x7f7f528b1560,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e8e90,_skyfluxpersub=0x7f7f533e90e0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00400542,-0.000287041],_lastvalidtt=
 [-0.00400542,-0.000287041],_upttcommand=[0,0],_refmes=0x7f7f51026e30,_tiprefv=
 0x7f7f509c6430,_tiltrefv=0x7f7f50939630,_tiprefvn=0x7f7f509ce430,_tiltrefvn=
 0x7f7f509d3230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507af260,_jstart=0x7f7f507af4b0,_binindices=0x7f7f5208c230,
 _binxy=2,_centroidw=0x7f7f51107160,_fimage=0x7f7f5119d030,_fimage2=0x0,
 _imistart=0x7f7f507ad430,_imjstart=0x7f7f507afe70,_imistart2=0x7f7f507b00c0,
 _imjstart2=0x7f7f507b0310,_unittip=0x7f7f507aede0,_unittilt=0x7f7f507afc40,
 _lgs_defocuses=0x7f7f5110fa50,_unitdefocus=0x10cf5f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5127c030,_flat=0x7f7f509d3a30,_domask=1,
 _submask=0x7f7f5119b630,_kernel=0x7f7f51262830,_kernels=0x10bd47030,_kerfftr=
 0x10bf49030,_kerffti=0x10c117030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5118f630,_x=0x7f7f52011630,_y=0x7f7f5208b630,_centroidgain=1,_rayleigh=
 0x7f7f511070f0,_bckgrdcalib=0x7f7f50944e30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104e18)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51106fd8,_ctrlden=0x7f7f5110eaf8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53285300,_ylast=[0x7f7f509ca430,0x7f7f509ca430,
 0x7f7f509ca430],_y0=0x7f7f50890630,_signus=0x7f7f5327ede0,_puppixoffset=[0,0],
 _nact=80,_def=0x1106e9030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e55c0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002368,xposition=0x7f7f52002138,yposition=
 0x7f7f5110f7b0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51107080,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      106.4   0.059      415.5
Field Avg  1.65                    106.4   0.059      415.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112528,winddir=0x7f7f51112a58,
 _layeralt=0x7f7f511120e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107128,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506b10f0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e5970,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10eb7b030,_masks=0x0,_fluxpersub=0x7f7f506b09f0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f506a0290,_skyfluxpersub=0x7f7f506af7d0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00367961,-0.00770482],_lastvalidtt=
 [-0.00367961,-0.00770482],_upttcommand=[0,0],_refmes=0x7f7f508dde30,_tiprefv=
 0x7f7f509cec30,_tiltrefv=0x7f7f509c1a30,_tiprefvn=0x7f7f509c6430,_tiltrefvn=
 0x7f7f50939630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e6510,_jstart=0x7f7f533e6760,_binindices=0x7f7f511a0830,
 _binxy=2,_centroidw=0x7f7f52001e98,_fimage=0x7f7f52089430,_fimage2=0x0,
 _imistart=0x7f7f533e69b0,_imjstart=0x7f7f533e6c00,_imistart2=0x7f7f533e6e50,
 _imjstart2=0x7f7f533e70a0,_unittip=0x7f7f533e5740,_unittilt=0x7f7f533e62e0,
 _lgs_defocuses=0x7f7f52001ca0,_unitdefocus=0x10da78030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51816230,_flat=0x7f7f51815830,_domask=1,
 _submask=0x7f7f5180ba30,_kernel=0x7f7f51262830,_kernels=0x10bdad030,_kerfftr=
 0x10c04b030,_kerffti=0x10bd47030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5200bc30,_x=0x7f7f51072c30,_y=0x7f7f51116830,_centroidgain=1,_rayleigh=
 0x7f7f52002170,_bckgrdcalib=0x7f7f5180c830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52001d80)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fba0,_ctrlden=0x7f7f520029f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f530efc20,_ylast=[0x7f7f51026e30,0x7f7f51026e30,
 0x7f7f51026e30],_y0=0x7f7f5127c630,_signus=0x7f7f528b1560,_puppixoffset=[0,0],
 _nact=80,_def=0x10ee7e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002368,xposition=0x7f7f5110fc80,yposition=
 0x7f7f5110e970,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51107080,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112528,winddir=0x7f7f51112a58,
 _layeralt=0x7f7f51113140)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107128,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53281d10,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f531022f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c8f2030,_masks=0x0,_fluxpersub=0x7f7f528b1560,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e6480,_skyfluxpersub=0x7f7f533e66d0,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f51263230,_tiprefv=
 0x7f7f509d1830,_tiltrefv=0x7f7f509d1030,_tiprefvn=0x7f7f509cec30,_tiltrefvn=
 0x7f7f509c1a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53280fa0,_jstart=0x7f7f53271c80,_binindices=0x7f7f509cfc30,
 _binxy=2,_centroidw=0x7f7f52001c68,_fimage=0x7f7f50944e30,_fimage2=0x0,
 _imistart=0x7f7f53272370,_imjstart=0x7f7f53280340,_imistart2=0x7f7f53273b50,
 _imjstart2=0x7f7f53273da0,_unittip=0x7f7f532850a0,_unittilt=0x7f7f53187cc0,
 _lgs_defocuses=0x7f7f51107160,_unitdefocus=0x10d434030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5119d030,_flat=0x7f7f5117a030,_domask=1,
 _submask=0x7f7f511a0830,_kernel=0x7f7f509d3230,_kernels=0x10c0b1030,_kerfftr=
 0x10bf49030,_kerffti=0x10bdad030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509c1030,_x=0x7f7f50944030,_y=0x7f7f50946830,_centroidgain=1,_rayleigh=
 0x7f7f511070f0,_bckgrdcalib=0x7f7f5118f630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52001d10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f511071d0,_ctrlden=0x7f7f5110fc10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528b2a60,_xlast=0x7f7f528afd30,_ylast=[0x7f7f5127c630,0x7f7f5127c630,
 0x7f7f5127c630],_y0=0x7f7f5127ea30,_signus=0x7f7f533e0010,_puppixoffset=[0,0],
 _nact=80,_def=0x1102e8030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e51c0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002368,xposition=0x7f7f511101c0,yposition=
 0x7f7f5110ec10,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51107080,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112528,winddir=0x7f7f51112a58,
 _layeralt=0x7f7f511133e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107128,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e7170,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528b28e0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1101e7030,_masks=0x0,_fluxpersub=0x7f7f53273b50,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53280340,_skyfluxpersub=0x7f7f53280fa0,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.00746418,0.00577142],_lastvalidtt=
 [-0.00746418,0.00577142],_upttcommand=[0,0],_refmes=0x7f7f50927430,_tiprefv=
 0x7f7f5208c630,_tiltrefv=0x7f7f5127ee30,_tiprefvn=0x7f7f5200d030,_tiltrefvn=
 0x7f7f51263030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e0010,_jstart=0x7f7f533e0260,_binindices=0x7f7f511a0830,
 _binxy=2,_centroidw=0x7f7f5110ec48,_fimage=0x7f7f51152630,_fimage2=0x0,
 _imistart=0x7f7f533e57e0,_imjstart=0x7f7f533e5a30,_imistart2=0x7f7f533e5c80,
 _imjstart2=0x7f7f533e5ed0,_unittip=0x7f7f533e4f60,_unittilt=0x7f7f528b1560,
 _lgs_defocuses=0x7f7f52001e98,_unitdefocus=0x10ec7c030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5118f630,_flat=0x7f7f51190030,_domask=1,
 _submask=0x7f7f50948630,_kernel=0x7f7f5127da30,_kernels=0x10bd47030,_kerfftr=
 0x10c04b030,_kerffti=0x10c0b1030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5117a030,_x=0x7f7f5119fa30,_y=0x7f7f51072c30,_centroidgain=1,_rayleigh=
 0x7f7f52002170,_bckgrdcalib=0x7f7f51192030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52001d80)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001e28,_ctrlden=0x7f7f520029c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f532811f0,_xlast=0x7f7f53280590,_ylast=[0x7f7f50890630,0x7f7f50890630,
 0x7f7f50890630],_y0=0x7f7f509ca430,_signus=0x7f7f5327ede0,_puppixoffset=[0,0],
 _nact=80,_def=0x10ee7e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5069f7e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002368,xposition=0x7f7f51106fd8,yposition=
 0x7f7f5110fb68,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51107080,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112528,winddir=0x7f7f51112a58,
 _layeralt=0x7f7f511124a0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107128,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5327ede0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507ad410,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cf5f030,_masks=0x0,_fluxpersub=0x7f7f528b28e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e81b0,_skyfluxpersub=0x7f7f533e7540,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.00400541,-0.000287038],_lastvalidtt=
 [-0.00400541,-0.000287038],_upttcommand=[0,0],_refmes=0x7f7f51151a30,_tiprefv=
 0x7f7f5118f630,_tiltrefv=0x7f7f509c1030,_tiprefvn=0x7f7f5118fe30,_tiltrefvn=
 0x7f7f509c1830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ad660,_jstart=0x7f7f507ad8b0,_binindices=0x7f7f5200c830,
 _binxy=2,_centroidw=0x7f7f5110e628,_fimage=0x7f7f5129b230,_fimage2=0x0,
 _imistart=0x7f7f507adfa0,_imjstart=0x7f7f507ae1f0,_imistart2=0x7f7f507ae440,
 _imjstart2=0x7f7f507ae690,_unittip=0x7f7f507ac1c0,_unittilt=0x7f7f507ad1e0,
 _lgs_defocuses=0x7f7f52001c68,_unitdefocus=0x10d834030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5127a830,_flat=0x7f7f51818e30,_domask=1,
 _submask=0x7f7f5127e830,_kernel=0x7f7f5118ce30,_kernels=0x10bf49030,_kerfftr=
 0x10bdad030,_kerffti=0x10bd47030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5127b230,_x=0x7f7f52089430,_y=0x7f7f5200bc30,_centroidgain=1,_rayleigh=
 0x7f7f511070f0,_bckgrdcalib=0x7f7f51815830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52001d10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f511101c0,_ctrlden=0x7f7f511070b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f533e8030,_ylast=[0x7f7f51026e30,0x7f7f51026e30,
 0x7f7f51026e30],_y0=0x7f7f51177430,_signus=0x7f7f528b1560,_puppixoffset=[0,0],
 _nact=80,_def=0x1102e8030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002368,xposition=0x7f7f5110fba0,yposition=
 0x7f7f5110eaf8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51107080,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      108.0   0.057      415.5
Field Avg  1.65                    108.0   0.057      415.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51112528,winddir=0x7f7f51112a58,
 _layeralt=0x7f7f51113d78)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51107128,lgs_prof_alt=0x7f7f5110ea50,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ad9a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506ae7a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c46d030,_masks=0x0,_fluxpersub=0x7f7f528b1560,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e7530,_skyfluxpersub=0x7f7f533e7780,
 _nphotons=13.9857,_skynphotons=0,_tt=[0.00207961,-0.00676317],_lastvalidtt=
 [0.00207961,-0.00676317],_upttcommand=[0,0],_refmes=0x7f7f52016030,_tiprefv=
 0x7f7f5200bc30,_tiltrefv=0x7f7f509d0630,_tiprefvn=0x7f7f5200c430,_tiltrefvn=
 0x7f7f509c1030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506b0190,_jstart=0x7f7f506b03e0,_binindices=0x7f7f5181a830,
 _binxy=2,_centroidw=0x7f7f5110e970,_fimage=0x7f7f509c1830,_fimage2=0x0,
 _imistart=0x7f7f506b0ad0,_imjstart=0x7f7f506af600,_imistart2=0x7f7f506af850,
 _imjstart2=0x7f7f506afaa0,_unittip=0x7f7f506ae340,_unittilt=0x7f7f506ae570,
 _lgs_defocuses=0x7f7f5110ec48,_unitdefocus=0x10d935030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51152630,_flat=0x7f7f5117a030,_domask=1,
 _submask=0x7f7f5118f630,_kernel=0x7f7f5127e230,_kernels=0x10c04b030,_kerfftr=
 0x10c0b1030,_kerffti=0x10bf49030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509c8230,_x=0x7f7f51817c30,_y=0x7f7f5181f630,_centroidgain=1,_rayleigh=
 0x7f7f52002170,_bckgrdcalib=0x7f7f5119d030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52001d80)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001e60,_ctrlden=0x7f7f5110f890,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f507ac1c0,_xlast=0x7f7f507ac340,_ylast=[0x7f7f52002c30,0x7f7f52002c30,
 0x7f7f52002c30],_y0=0x7f7f52012430,_signus=0x7f7f507add30,_puppixoffset=[0,0],
 _nact=80,_def=0x10ee7e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507ae170,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002368,xposition=0x7f7f511071d0,yposition=
 0x7f7f520029f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51107080,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,ittime=
 0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,jumps2swapscreen=
 0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51113be0,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113cf0,winddir=0x7f7f51113608,
 _layeralt=0x7f7f51112390)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520029f8,lgs_prof_alt=0x7f7f52002368,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506b0560,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52934b80,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d434030,_masks=0x0,_fluxpersub=0x7f7f5069f0d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5069f320,_skyfluxpersub=0x7f7f506ae340,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f52012430,_tiprefv=
 0x7f7f509c1030,_tiltrefv=0x7f7f5208b030,_tiprefvn=0x7f7f509c1830,_tiltrefvn=
 0x7f7f52079430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53281c60,_jstart=0x7f7f53278830,_binindices=0x7f7f5118dc30,
 _binxy=2,_centroidw=0x7f7f511070f0,_fimage=0x7f7f51815830,_fimage2=0x0,
 _imistart=0x7f7f528b1cd0,_imjstart=0x7f7f528b1f20,_imistart2=0x7f7f528b2170,
 _imjstart2=0x7f7f533e4f60,_unittip=0x7f7f531022f0,_unittilt=0x7f7f52935ab0,
 _lgs_defocuses=0x7f7f52002288,_unitdefocus=0x10db79030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51190430,_flat=0x7f7f5119d030,_domask=1,
 _submask=0x7f7f5181a830,_kernel=0x7f7f51818a30,_kernels=0x10bdf6030,_kerfftr=
 0x10c0b1030,_kerffti=0x10bf49030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51869430,_x=0x7f7f50944030,_y=0x7f7f509bf630,_centroidgain=1,_rayleigh=
 0x7f7f5110f8c8,_bckgrdcalib=0x7f7f511a0830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51106f30)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51107160,_ctrlden=0x7f7f52001f78,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53275840,_xlast=0x7f7f53187cc0,_ylast=[0x7f7f508db030,0x7f7f508db030,
 0x7f7f508db030],_y0=0x7f7f509d4230,_signus=0x7f7f5327ede0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f532785e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f890,xposition=0x7f7f5110f820,yposition=
 0x7f7f5110ebd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51107128,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51113be0,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ec8,layeralt=0x7f7f51112a58,winddir=0x7f7f51112528,
 _layeralt=0x7f7f51112280)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ebd8,lgs_prof_alt=0x7f7f5110f890,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507af420,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507ac1c0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cb5d030,_masks=0x0,_fluxpersub=0x7f7f507ad680,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507ad8d0,_skyfluxpersub=0x7f7f507adb20,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f50938c30,_tiprefv=
 0x7f7f509d3230,_tiltrefv=0x7f7f5200ce30,_tiprefvn=0x7f7f509d3a30,_tiltrefvn=
 0x7f7f52089e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ad1e0,_jstart=0x7f7f507ad430,_binindices=0x7f7f51868030,
 _binxy=2,_centroidw=0x7f7f511055f8,_fimage=0x7f7f51152630,_fimage2=0x0,
 _imistart=0x7f7f528b2150,_imjstart=0x7f7f533e5920,_imistart2=0x7f7f533e5b70,
 _imjstart2=0x7f7f533e5dc0,_unittip=0x7f7f5069f0d0,_unittilt=0x7f7f506a0290,
 _lgs_defocuses=0x7f7f5110f7b0,_unitdefocus=0x10ed7d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5200e030,_flat=0x7f7f5181b230,_domask=1,
 _submask=0x7f7f52010830,_kernel=0x7f7f5200fa30,_kernels=0x10c117030,_kerfftr=
 0x10c0b1030,_kerffti=0x10bf49030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51263630,_x=0x7f7f5208a630,_y=0x7f7f5208ac30,_centroidgain=1,_rayleigh=
 0x7f7f52001ca0,_bckgrdcalib=0x7f7f5181a830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104b78)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51106ef8,_ctrlden=0x7f7f511071d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f528afd30,_ylast=[0x7f7f51026e30,0x7f7f51026e30,
 0x7f7f51026e30],_y0=0x7f7f51177430,_signus=0x7f7f533e4f60,_puppixoffset=[0,0],
 _nact=80,_def=0x1102e8030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f53102070,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52001f78,xposition=0x7f7f52002020,yposition=
 0x7f7f5110f9a8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f520029f8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51113be0,layeralt=0x7f7f51113608,winddir=0x7f7f51113cf0,
 _layeralt=0x7f7f511134f8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110f9a8,lgs_prof_alt=0x7f7f52001f78,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53280340,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528b28e0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d935030,_masks=0x0,_fluxpersub=0x7f7f507acb70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507ad1e0,_skyfluxpersub=0x7f7f507ad430,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f51177430,_tiprefv=
 0x7f7f5208b630,_tiltrefv=0x7f7f5200c630,_tiprefvn=0x7f7f5200e030,_tiltrefvn=
 0x7f7f5200e830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e4f60,_jstart=0x7f7f533e51b0,_binindices=0x7f7f509c1030,
 _binxy=2,_centroidw=0x7f7f51104e18,_fimage=0x7f7f50947630,_fimage2=0x0,
 _imistart=0x7f7f53271c80,_imjstart=0x7f7f53271ed0,_imistart2=0x7f7f53272120,
 _imjstart2=0x7f7f53272370,_unittip=0x7f7f528b1a80,_unittilt=0x7f7f528b1560,
 _lgs_defocuses=0x7f7f5110fb68,_unitdefocus=0x10ec7c030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5200fa30,_flat=0x7f7f5200f030,_domask=1,
 _submask=0x7f7f52010e30,_kernel=0x7f7f5180b030,_kernels=0x10c04b030,_kerfftr=
 0x10c0b1030,_kerffti=0x10bf49030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50936e30,_x=0x7f7f5114ec30,_y=0x7f7f5119ec30,_centroidgain=1,_rayleigh=
 0x7f7f51104980,_bckgrdcalib=0x7f7f52089430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52001d10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001d80,_ctrlden=0x7f7f5110e468,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53280590,_ylast=[0x7f7f508db030,0x7f7f508db030,
 0x7f7f508db030],_y0=0x7f7f509d5230,_signus=0x7f7f532850a0,_puppixoffset=[0,0],
 _nact=80,_def=0x10ee7e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110fbd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f511071d0,xposition=0x7f7f5110fb30,yposition=
 0x7f7f51106e88,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ebd8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51112fa8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f511134f8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002250,lgs_prof_alt=0x7f7f5110f9e0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5327ede0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e5ab0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c443030,_masks=0x0,_fluxpersub=0x7f7f533e61a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e63f0,_skyfluxpersub=0x7f7f533e6640,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f51177430,_tiprefv=
 0x7f7f5181b030,_tiltrefv=0x7f7f509cc430,_tiprefvn=0x7f7f51888430,_tiltrefvn=
 0x7f7f509c8430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e5d00,_jstart=0x7f7f533e5f50,_binindices=0x7f7f50938830,
 _binxy=2,_centroidw=0x7f7f511070b8,_fimage=0x7f7f509fc430,_fimage2=0x0,
 _imistart=0x7f7f52934b80,_imjstart=0x7f7f5327f030,_imistart2=0x7f7f53280340,
 _imjstart2=0x7f7f532850a0,_unittip=0x7f7f533e02a0,_unittilt=0x7f7f533e5880,
 _lgs_defocuses=0x7f7f5110f820,_unitdefocus=0x10f35a030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50944e30,_flat=0x7f7f509d3230,_domask=1,
 _submask=0x7f7f51262830,_kernel=0x7f7f509fd430,_kernels=0x10c25f030,_kerfftr=
 0x10c0b1030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509c1030,_x=0x7f7f5117c230,_y=0x7f7f51176630,_centroidgain=1,_rayleigh=
 0x7f7f51107080,_bckgrdcalib=0x7f7f509fba30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ec48)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ea50,_ctrlden=0x7f7f5110f938,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f528afd30,_ylast=[0x7f7f51151a30,0x7f7f51151a30,
 0x7f7f51151a30],_y0=0x7f7f51154030,_signus=0x7f7f533e55c0,_puppixoffset=[0,0],
 _nact=80,_def=0x10eb7b030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533df8a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eaf8,xposition=0x7f7f51107198,yposition=
 0x7f7f520023a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51112fa8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f5100b450)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002250,lgs_prof_alt=0x7f7f5110f9e0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ac1c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e5590,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c8f2030,_masks=0x0,_fluxpersub=0x7f7f533e5a30,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e5c80,_skyfluxpersub=0x7f7f533e5ed0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00746418,0.00577143],_lastvalidtt=
 [-0.00746418,0.00577143],_upttcommand=[0,0],_refmes=0x7f7f5200d430,_tiprefv=
 0x7f7f51152630,_tiltrefv=0x7f7f5181b030,_tiprefvn=0x7f7f5127bc30,_tiltrefvn=
 0x7f7f5117a030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e5190,_jstart=0x7f7f533e57e0,_binindices=0x7f7f50947630,
 _binxy=2,_centroidw=0x7f7f5110ff90,_fimage=0x7f7f5200bc30,_fimage2=0x0,
 _imistart=0x7f7f52934b80,_imjstart=0x7f7f53280fa0,_imistart2=0x7f7f53280340,
 _imjstart2=0x7f7f5327d0a0,_unittip=0x7f7f533e61c0,_unittilt=0x7f7f533e4f60,
 _lgs_defocuses=0x7f7f52001f08,_unitdefocus=0x10f259030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5118f630,_flat=0x7f7f5127a830,_domask=1,
 _submask=0x7f7f5118ce30,_kernel=0x7f7f509d3230,_kernels=0x10cddf030,_kerfftr=
 0x10beb1030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5200c630,_x=0x7f7f5114ec30,_y=0x7f7f51176630,_centroidgain=1,_rayleigh=
 0x7f7f52001df0,_bckgrdcalib=0x7f7f51262830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ecf0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fcb8,_ctrlden=0x7f7f51106e88,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f530efc20,_xlast=0x7f7f5300fb60,_ylast=[0x7f7f51154030,0x7f7f51154030,
 0x7f7f51154030],_y0=0x7f7f51177430,_signus=0x7f7f528b1db0,_puppixoffset=[0,0],
 _nact=80,_def=0x10d132030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5327d590,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eaf8,xposition=0x7f7f5110fbd8,yposition=
 0x7f7f5110ec10,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51112fa8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f511129d0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002250,lgs_prof_alt=0x7f7f5110f9e0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506af770,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507addd0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cb5d030,_masks=0x0,_fluxpersub=0x7f7f507ae960,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507af4f0,_skyfluxpersub=0x7f7f507af740,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00400541,-0.00028702],_lastvalidtt=
 [-0.00400541,-0.00028702],_upttcommand=[0,0],_refmes=0x7f7f51151a30,_tiprefv=
 0x7f7f51191630,_tiltrefv=0x7f7f5118d830,_tiprefvn=0x7f7f51152630,_tiltrefvn=
 0x7f7f5127b230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ae020,_jstart=0x7f7f507aebb0,_binindices=0x7f7f5207ca30,
 _binxy=2,_centroidw=0x7f7f52001e98,_fimage=0x7f7f5127a830,_fimage2=0x0,
 _imistart=0x7f7f507af2a0,_imjstart=0x7f7f507ae270,_imistart2=0x7f7f507ae4c0,
 _imjstart2=0x7f7f507ae710,_unittip=0x7f7f507ad440,_unittilt=0x7f7f507ac1c0,
 _lgs_defocuses=0x7f7f511070b8,_unitdefocus=0x10cc5e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f52086c30,_flat=0x7f7f52086230,_domask=1,
 _submask=0x7f7f52084e30,_kernel=0x7f7f5200ca30,_kernels=0x10c117030,_kerfftr=
 0x10c0b1030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5127f230,_x=0x7f7f52002c30,_y=0x7f7f52089a30,_centroidgain=1,_rayleigh=
 0x7f7f51107080,_bckgrdcalib=0x7f7f5207e830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ec48)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110f820,_ctrlden=0x7f7f52002368,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53102070,_ylast=[0x7f7f50949030,0x7f7f50949030,
 0x7f7f50949030],_y0=0x7f7f509ca430,_signus=0x7f7f53280fa0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f9c4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5069f7e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eaf8,xposition=0x7f7f5110f7b0,yposition=
 0x7f7f5110f970,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       71.9   0.167      324.3
Field Avg  1.65                     71.9   0.167      324.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51112fa8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51112ae0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002250,lgs_prof_alt=0x7f7f5110f9e0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506b0980,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e5860,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1102a3030,_masks=0x0,_fluxpersub=0x7f7f506a0290,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f506ae340,_skyfluxpersub=0x7f7f506ae590,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00771322,0.0118873],_lastvalidtt=
 [-0.00771322,0.0118873],_upttcommand=[0,0],_refmes=0x7f7f51108830,_tiprefv=
 0x7f7f509d3c30,_tiltrefv=0x7f7f509c1a30,_tiprefvn=0x7f7f509cc430,_tiltrefvn=
 0x7f7f509d1030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e0010,_jstart=0x7f7f533e0260,_binindices=0x7f7f50938830,
 _binxy=2,_centroidw=0x7f7f5110f900,_fimage=0x7f7f509d3230,_fimage2=0x0,
 _imistart=0x7f7f53276b90,_imjstart=0x7f7f53276de0,_imistart2=0x7f7f53277030,
 _imjstart2=0x7f7f5327b090,_unittip=0x7f7f533e5400,_unittilt=0x7f7f533e5630,
 _lgs_defocuses=0x7f7f5110ff90,_unitdefocus=0x10e038030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51868a30,_flat=0x7f7f51868030,_domask=1,
 _submask=0x7f7f5180b030,_kernel=0x7f7f51818a30,_kernels=0x10c198030,_kerfftr=
 0x10beb1030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509d4c30,_x=0x7f7f5127ce30,_y=0x7f7f51190830,_centroidgain=1,_rayleigh=
 0x7f7f52001df0,_bckgrdcalib=0x7f7f51869430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ecf0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fd98,_ctrlden=0x7f7f52002410,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53280590,_xlast=0x7f7f52935790,_ylast=[0x7f7f509ca430,0x7f7f509ca430,
 0x7f7f509ca430],_y0=0x7f7f50941c30,_signus=0x7f7f53270170,_puppixoffset=[0,0],
 _nact=80,_def=0x10d132030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f53271210,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eaf8,xposition=0x7f7f5110ea50,yposition=
 0x7f7f51110000,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51112fa8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51113360)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002250,lgs_prof_alt=0x7f7f5110f9e0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53280340,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e0240,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1108a6030,_masks=0x0,_fluxpersub=0x7f7f533e4f60,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e51b0,_skyfluxpersub=0x7f7f533e5400,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f509d5e30,_tiprefv=
 0x7f7f509c1030,_tiltrefv=0x7f7f50938e30,_tiprefvn=0x7f7f509d3c30,_tiltrefvn=
 0x7f7f509c1a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f528b2020,_jstart=0x7f7f528b2270,_binindices=0x7f7f511a0830,
 _binxy=2,_centroidw=0x7f7f52001f08,_fimage=0x7f7f509d4c30,_fimage2=0x0,
 _imistart=0x7f7f506b02f0,_imjstart=0x7f7f506b0540,_imistart2=0x7f7f506b0790,
 _imjstart2=0x7f7f506b09e0,_unittip=0x7f7f528b1a80,_unittilt=0x7f7f533e0010,
 _lgs_defocuses=0x7f7f52001e98,_unitdefocus=0x10df37030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509d3230,_flat=0x7f7f50944e30,_domask=1,
 _submask=0x7f7f5119b630,_kernel=0x7f7f50947630,_kernels=0x10c117030,_kerfftr=
 0x10c0b1030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50937830,_x=0x7f7f5119fa30,_y=0x7f7f5117c230,_centroidgain=1,_rayleigh=
 0x7f7f51107080,_bckgrdcalib=0x7f7f50936e30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ec48)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f520023d8,_ctrlden=0x7f7f51106fd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f532852f0,_xlast=0x7f7f53280590,_ylast=[0x7f7f50941c30,0x7f7f50941c30,
 0x7f7f50941c30],_y0=0x7f7f50949030,_signus=0x7f7f52934b80,_puppixoffset=[0,0],
 _nact=80,_def=0x10eb7b030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eaf8,xposition=0x7f7f5110fcb8,yposition=
 0x7f7f52002170,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51112fa8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51113140)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002250,lgs_prof_alt=0x7f7f5110f9e0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506af2c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528b21a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cf60030,_masks=0x0,_fluxpersub=0x7f7f532751b0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53287650,_skyfluxpersub=0x7f7f531022f0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00746417,0.00577142],_lastvalidtt=
 [-0.00746417,0.00577142],_upttcommand=[0,0],_refmes=0x7f7f508db030,_tiprefv=
 0x7f7f50939630,_tiltrefv=0x7f7f509cc430,_tiprefvn=0x7f7f509c1030,_tiltrefvn=
 0x7f7f50938e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e0010,_jstart=0x7f7f533e0260,_binindices=0x7f7f5127c230,
 _binxy=2,_centroidw=0x7f7f5110f628,_fimage=0x7f7f51152630,_fimage2=0x0,
 _imistart=0x7f7f533e5400,_imjstart=0x7f7f533e5650,_imistart2=0x7f7f533e58a0,
 _imjstart2=0x7f7f533e5af0,_unittip=0x7f7f528b1d40,_unittilt=0x7f7f528b1f70,
 _lgs_defocuses=0x7f7f5110f900,_unitdefocus=0x10c5d2030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51818a30,_flat=0x7f7f52089430,_domask=1,
 _submask=0x7f7f5200c630,_kernel=0x7f7f51262830,_kernels=0x10c198030,_kerfftr=
 0x10beb1030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5127a830,_x=0x7f7f51176630,_y=0x7f7f5114ec30,_centroidgain=1,_rayleigh=
 0x7f7f52001df0,_bckgrdcalib=0x7f7f509c2a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ecf0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fbd8,_ctrlden=0x7f7f5110ea50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f533df8a0,_ylast=[0x7f7f5119d830,0x7f7f5119d830,
 0x7f7f5119d830],_y0=0x7f7f51108830,_signus=0x7f7f528b1a80,_puppixoffset=[0,0],
 _nact=80,_def=0x10d132030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eaf8,xposition=0x7f7f5110f820,yposition=
 0x7f7f51106e88,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51112fa8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51113f98)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002250,lgs_prof_alt=0x7f7f5110f9e0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e51b0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507ad410,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10de36030,_masks=0x0,_fluxpersub=0x7f7f533e5980,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e5bd0,_skyfluxpersub=0x7f7f533e6b00,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00400542,-0.000287041],_lastvalidtt=
 [-0.00400542,-0.000287041],_upttcommand=[0,0],_refmes=0x7f7f5127cc30,_tiprefv=
 0x7f7f5118d830,_tiltrefv=0x7f7f5127c230,_tiprefvn=0x7f7f5118e030,_tiltrefvn=
 0x7f7f5118fe30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ad660,_jstart=0x7f7f507ad8b0,_binindices=0x7f7f51280430,
 _binxy=2,_centroidw=0x7f7f52001d10,_fimage=0x7f7f5118ce30,_fimage2=0x0,
 _imistart=0x7f7f528b1cd0,_imjstart=0x7f7f528b1f20,_imistart2=0x7f7f533e54e0,
 _imjstart2=0x7f7f533e5730,_unittip=0x7f7f507acb70,_unittilt=0x7f7f507ad1e0,
 _lgs_defocuses=0x7f7f52001f08,_unitdefocus=0x10f259030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509d4c30,_flat=0x7f7f509d0630,_domask=1,
 _submask=0x7f7f51196030,_kernel=0x7f7f509c1030,_kernels=0x10c117030,_kerfftr=
 0x10c0b1030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51192030,_x=0x7f7f5208a630,_y=0x7f7f5208ac30,_centroidgain=1,_rayleigh=
 0x7f7f51107080,_bckgrdcalib=0x7f7f509d1030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ec48)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e9e0,_ctrlden=0x7f7f52001e98,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53102070,_ylast=[0x7f7f50949030,0x7f7f50949030,
 0x7f7f50949030],_y0=0x7f7f508db030,_signus=0x7f7f53280fa0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f9c4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e5e20,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eaf8,xposition=0x7f7f5110fd98,yposition=
 0x7f7f52002368,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       71.9   0.167      324.3
Field Avg  1.65                     71.9   0.167      324.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51112fa8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f511124a0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002250,lgs_prof_alt=0x7f7f5110f9e0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e5400,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e4f60,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c730030,_masks=0x0,_fluxpersub=0x7f7f507acb70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507ae620,_skyfluxpersub=0x7f7f507ad1e0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00770307,0.0118941],_lastvalidtt=
 [-0.00770307,0.0118941],_upttcommand=[0,0],_refmes=0x7f7f5208ae30,_tiprefv=
 0x7f7f509d0630,_tiltrefv=0x7f7f509d3c30,_tiprefvn=0x7f7f509d0e30,_tiltrefvn=
 0x7f7f50939430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e51b0,_jstart=0x7f7f533e5fa0,_binindices=0x7f7f51262830,
 _binxy=2,_centroidw=0x7f7f511048d8,_fimage=0x7f7f511a0830,_fimage2=0x0,
 _imistart=0x7f7f533e6690,_imjstart=0x7f7f533e5910,_imistart2=0x7f7f528b1cb0,
 _imjstart2=0x7f7f533e5b60,_unittip=0x7f7f533e02d0,_unittilt=0x7f7f528b1a80,
 _lgs_defocuses=0x7f7f5110f628,_unitdefocus=0x10cc5e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5200ea30,_flat=0x7f7f5200e030,_domask=1,
 _submask=0x7f7f5200c630,_kernel=0x7f7f52089e30,_kernels=0x10c198030,_kerfftr=
 0x10beb1030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51152630,_x=0x7f7f51176630,_y=0x7f7f5119ec30,_centroidgain=1,_rayleigh=
 0x7f7f52001df0,_bckgrdcalib=0x7f7f5200fe30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ecf0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e6d0,_ctrlden=0x7f7f52002170,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f530efc20,_ylast=[0x7f7f5119d830,0x7f7f5119d830,
 0x7f7f5119d830],_y0=0x7f7f5127cc30,_signus=0x7f7f533e0010,_puppixoffset=[0,0],
 _nact=80,_def=0x10d132030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f532852f0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eaf8,xposition=0x7f7f520023d8,yposition=
 0x7f7f52002410,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51112fa8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51112280)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002250,lgs_prof_alt=0x7f7f5110f9e0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53276570,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f532850a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f55a030,_masks=0x0,_fluxpersub=0x7f7f5327de20,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53271470,_skyfluxpersub=0x7f7f532716c0,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f5111d030,_tiprefv=
 0x7f7f5119bc30,_tiltrefv=0x7f7f50947630,_tiprefvn=0x7f7f511c9030,_tiltrefvn=
 0x7f7f509d3c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f531022f0,_jstart=0x7f7f53280340,_binindices=0x7f7f509c6c30,
 _binxy=2,_centroidw=0x7f7f5110f900,_fimage=0x7f7f509d4c30,_fimage2=0x0,
 _imistart=0x7f7f5327d980,_imjstart=0x7f7f53273b50,_imistart2=0x7f7f53273da0,
 _imjstart2=0x7f7f5327dbd0,_unittip=0x7f7f507acb70,_unittilt=0x7f7f507ac1c0,
 _lgs_defocuses=0x7f7f52001d10,_unitdefocus=0x10e038030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509d0630,_flat=0x7f7f51152630,_domask=1,
 _submask=0x7f7f509c7a30,_kernel=0x7f7f5208ae30,_kernels=0x10c117030,_kerfftr=
 0x10c0b1030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509d3230,_x=0x7f7f509c3030,_y=0x7f7f509c1030,_centroidgain=1,_rayleigh=
 0x7f7f51107080,_bckgrdcalib=0x7f7f5127b230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ec48)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001f08,_ctrlden=0x7f7f5110fcb8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528b20e0,_xlast=0x7f7f5300fb60,_ylast=[0x7f7f5127cc30,0x7f7f5127cc30,
 0x7f7f5127cc30],_y0=0x7f7f5100fc30,_signus=0x7f7f533e5220,_puppixoffset=[0,0],
 _nact=80,_def=0x10eb7b030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eaf8,xposition=0x7f7f5110fbd8,yposition=
 0x7f7f51106fd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51112fa8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51111fd8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002250,lgs_prof_alt=0x7f7f5110f9e0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5327b090,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f532767c0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10dd35030,_masks=0x0,_fluxpersub=0x7f7f506ae770,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f506af0e0,_skyfluxpersub=0x7f7f506af330,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.00746418,0.00577142],_lastvalidtt=
 [-0.00746418,0.00577142],_upttcommand=[0,0],_refmes=0x7f7f50949030,_tiprefv=
 0x7f7f509c1a30,_tiltrefv=0x7f7f509d1a30,_tiprefvn=0x7f7f509c3030,_tiltrefvn=
 0x7f7f50947630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52934b80,_jstart=0x7f7f53280340,_binindices=0x7f7f50939030,
 _binxy=2,_centroidw=0x7f7f5110faf8,_fimage=0x7f7f50944e30,_fimage2=0x0,
 _imistart=0x7f7f5327b2e0,_imjstart=0x7f7f5327b530,_imistart2=0x7f7f5327b780,
 _imjstart2=0x7f7f5327d980,_unittip=0x7f7f52922690,_unittilt=0x7f7f531022f0,
 _lgs_defocuses=0x7f7f511048d8,_unitdefocus=0x10df37030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5181a830,_flat=0x7f7f51816030,_domask=1,
 _submask=0x7f7f51262830,_kernel=0x7f7f5127a830,_kernels=0x10c198030,_kerfftr=
 0x10beb1030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50938630,_x=0x7f7f50946830,_y=0x7f7f509bf630,_centroidgain=1,_rayleigh=
 0x7f7f52001df0,_bckgrdcalib=0x7f7f5181b230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ecf0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001f78,_ctrlden=0x7f7f51106f68,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f528b20e0,_ylast=[0x7f7f5100fc30,0x7f7f5100fc30,
 0x7f7f5100fc30],_y0=0x7f7f5111d030,_signus=0x7f7f533e4f60,_puppixoffset=[0,0],
 _nact=80,_def=0x10d132030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eaf8,xposition=0x7f7f5110e9e0,yposition=
 0x7f7f5110f938,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51112fa8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51112528)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002250,lgs_prof_alt=0x7f7f5110f9e0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53280fa0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e5be0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d933030,_masks=0x0,_fluxpersub=0x7f7f533e62d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e6520,_skyfluxpersub=0x7f7f533e6770,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.00400541,-0.000287038],_lastvalidtt=
 [-0.00400541,-0.000287038],_upttcommand=[0,0],_refmes=0x7f7f508db030,_tiprefv=
 0x7f7f509cfc30,_tiltrefv=0x7f7f50944e30,_tiprefvn=0x7f7f509c1a30,_tiltrefvn=
 0x7f7f509d1a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e5e30,_jstart=0x7f7f533e6080,_binindices=0x7f7f509c4430,
 _binxy=2,_centroidw=0x7f7f5110ff90,_fimage=0x7f7f509c1030,_fimage2=0x0,
 _imistart=0x7f7f532767c0,_imjstart=0x7f7f53280340,_imistart2=0x7f7f5327b2e0,
 _imjstart2=0x7f7f532850a0,_unittip=0x7f7f528b1a80,_unittilt=0x7f7f533e4f60,
 _lgs_defocuses=0x7f7f5110f900,_unitdefocus=0x10f35a030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f511a0830,_flat=0x7f7f51152630,_domask=1,
 _submask=0x7f7f5127a830,_kernel=0x7f7f51262830,_kernels=0x10c117030,_kerfftr=
 0x10c0b1030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509d3230,_x=0x7f7f5117c230,_y=0x7f7f51176630,_centroidgain=1,_rayleigh=
 0x7f7f51107080,_bckgrdcalib=0x7f7f5118f630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ec48)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51105630,_ctrlden=0x7f7f52001d10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528b1f30,_xlast=0x7f7f528afd30,_ylast=[0x7f7f5111d030,0x7f7f5111d030,
 0x7f7f5111d030],_y0=0x7f7f5119d830,_signus=0x7f7f533e5220,_puppixoffset=[0,0],
 _nact=80,_def=0x10f9c4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528b20b0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eaf8,xposition=0x7f7f5110e6d0,yposition=
 0x7f7f5110ea50,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    14.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       71.9   0.167      324.3
Field Avg  1.65                     71.9   0.167      324.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ec8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51112fa8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51111b10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 12,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002250,lgs_prof_alt=0x7f7f5110f9e0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ae610,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f531022f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c443030,_masks=0x0,_fluxpersub=0x7f7f5327b780,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53287320,_skyfluxpersub=0x7f7f53287570,
 _nphotons=13.9857,_skynphotons=0,_tt=[-0.00771064,0.0118829],_lastvalidtt=
 [-0.00771064,0.0118829],_upttcommand=[0,0],_refmes=0x7f7f51806e30,_tiprefv=
 0x7f7f509d3c30,_tiltrefv=0x7f7f509c8430,_tiprefvn=0x7f7f509cfc30,_tiltrefvn=
 0x7f7f50944e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5327d980,_jstart=0x7f7f53280340,_binindices=0x7f7f50937630,
 _binxy=2,_centroidw=0x7f7f511055f8,_fimage=0x7f7f52089430,_fimage2=0x0,
 _imistart=0x7f7f53188510,_imjstart=0x7f7f5327b090,_imistart2=0x7f7f5327b2e0,
 _imjstart2=0x7f7f5327b530,_unittip=0x7f7f532850a0,_unittilt=0x7f7f52922690,
 _lgs_defocuses=0x7f7f5110faf8,_unitdefocus=0x10f259030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509ffa30,_flat=0x7f7f509d0430,_domask=1,
 _submask=0x7f7f50a02230,_kernel=0x7f7f50a01430,_kernels=0x10c198030,_kerfftr=
 0x10beb1030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f52089e30,_x=0x7f7f50946830,_y=0x7f7f509d1a30,_centroidgain=1,_rayleigh=
 0x7f7f52001df0,_bckgrdcalib=0x7f7f50a00430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ecf0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f511070b8,_ctrlden=0x7f7f5110f890,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f530efc20,_xlast=0x7f7f528b1f20,_ylast=[0x7f7f5119d830,0x7f7f5119d830,
 0x7f7f5119d830],_y0=0x7f7f51154030,_signus=0x7f7f533e5810,_puppixoffset=[0,0],
 _nact=80,_def=0x10d132030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507acb70,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eaf8,xposition=0x7f7f52001f08,yposition=
 0x7f7f52001e98,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110fe08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113580,winddir=0x7f7f51113be0,
 _layeralt=0x7f7f511138b0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e98,lgs_prof_alt=0x7f7f5110eaf8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e5bd0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506ae340,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c8f2030,_masks=0x0,_fluxpersub=0x7f7f53287650,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53187cc0,_skyfluxpersub=0x7f7f531022f0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f5208b030,_tiprefv=
 0x7f7f5127a830,_tiltrefv=0x7f7f5118e230,_tiprefvn=0x7f7f5127b030,_tiltrefvn=
 0x7f7f5127c230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506ae770,_jstart=0x7f7f506ae9c0,_binindices=0x7f7f5119b630,
 _binxy=2,_centroidw=0x7f7f51107080,_fimage=0x7f7f509d4c30,_fimage2=0x0,
 _imistart=0x7f7f533e6390,_imjstart=0x7f7f533e65e0,_imistart2=0x7f7f533e6830,
 _imjstart2=0x7f7f533e6a80,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f506a0290,
 _lgs_defocuses=0x7f7f5110ec10,_unitdefocus=0x10cc5e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50938030,_flat=0x7f7f51194c30,_domask=1,
 _submask=0x7f7f50939030,_kernel=0x7f7f51193e30,_kernels=0x10bfc9030,_kerfftr=
 0x10beb1030,_kerffti=0x10c04b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50948630,_x=0x7f7f5180f830,_y=0x7f7f5181f630,_centroidgain=1,_rayleigh=
 0x7f7f51104ad0,_bckgrdcalib=0x7f7f511c7e30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ee08)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51107198,_ctrlden=0x7f7f51110038,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f5300fb60,_ylast=[0x7f7f51154030,0x7f7f51154030,
 0x7f7f51154030],_y0=0x7f7f51263230,_signus=0x7f7f533e51c0,_puppixoffset=[0,0],
 _nact=80,_def=0x10eb7b030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f890,xposition=0x7f7f52001df0,yposition=
 0x7f7f51106ec0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002250,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113580,winddir=0x7f7f51113be0,
 _layeralt=0x7f7f51112418)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e98,lgs_prof_alt=0x7f7f5110eaf8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e51c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506ae590,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cb5d030,_masks=0x0,_fluxpersub=0x7f7f5326d700,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5326d950,_skyfluxpersub=0x7f7f5326dba0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00746418,0.00577143],_lastvalidtt=
 [-0.00746418,0.00577143],_upttcommand=[0,0],_refmes=0x7f7f5208cc30,_tiprefv=
 0x7f7f50939030,_tiltrefv=0x7f7f52089430,_tiprefvn=0x7f7f50948630,_tiltrefvn=
 0x7f7f52089c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506a0290,_jstart=0x7f7f506ae340,_binindices=0x7f7f509c4430,
 _binxy=2,_centroidw=0x7f7f5110e938,_fimage=0x7f7f51261630,_fimage2=0x0,
 _imistart=0x7f7f53287580,_imjstart=0x7f7f53276570,_imistart2=0x7f7f53280fa0,
 _imjstart2=0x7f7f5326d4b0,_unittip=0x7f7f53187cc0,_unittilt=0x7f7f5327b2f0,
 _lgs_defocuses=0x7f7f5110ec48,_unitdefocus=0x10e038030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509fba30,_flat=0x7f7f50937630,_domask=1,
 _submask=0x7f7f509fd430,_kernel=0x7f7f511a0830,_kernels=0x10c198030,_kerfftr=
 0x10bf17030,_kerffti=0x10bfc9030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51152630,_x=0x7f7f5181f630,_y=0x7f7f5180f830,_centroidgain=1,_rayleigh=
 0x7f7f5110e9e0,_bckgrdcalib=0x7f7f509fc430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f9e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002368,_ctrlden=0x7f7f52001f08,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533e5480,_xlast=0x7f7f528afd30,_ylast=[0x7f7f51263230,0x7f7f51263230,
 0x7f7f51263230],_y0=0x7f7f51151a30,_signus=0x7f7f533ee2f0,_puppixoffset=[0,0],
 _nact=80,_def=0x10d132030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f53285300,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f890,xposition=0x7f7f52001f40,yposition=
 0x7f7f5110fcb8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002250,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113580,winddir=0x7f7f51113be0,
 _layeralt=0x7f7f51113c68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e98,lgs_prof_alt=0x7f7f5110eaf8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e80d0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506ae340,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f259030,_masks=0x0,_fluxpersub=0x7f7f532850a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53187cc0,_skyfluxpersub=0x7f7f533e4f60,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00400541,-0.00028702],_lastvalidtt=
 [-0.00400541,-0.00028702],_upttcommand=[0,0],_refmes=0x7f7f51806e30,_tiprefv=
 0x7f7f50938030,_tiltrefv=0x7f7f509c1a30,_tiprefvn=0x7f7f50939030,_tiltrefvn=
 0x7f7f509d4c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506ae590,_jstart=0x7f7f506ae7e0,_binindices=0x7f7f5127e230,
 _binxy=2,_centroidw=0x7f7f5110fd98,_fimage=0x7f7f51192630,_fimage2=0x0,
 _imistart=0x7f7f533e58a0,_imjstart=0x7f7f533e5af0,_imistart2=0x7f7f533e5d40,
 _imjstart2=0x7f7f533e5f90,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f506a0290,
 _lgs_defocuses=0x7f7f51107080,_unitdefocus=0x10cd5f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5118f630,_flat=0x7f7f511a0830,_domask=1,
 _submask=0x7f7f509c2a30,_kernel=0x7f7f509cfc30,_kernels=0x10c0b1030,_kerfftr=
 0x10beb1030,_kerffti=0x10bfc9030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51262830,_x=0x7f7f51820c30,_y=0x7f7f5180da30,_centroidgain=1,_rayleigh=
 0x7f7f51104ad0,_bckgrdcalib=0x7f7f51193030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ee08)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002448,_ctrlden=0x7f7f5110fbd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f530efc20,_xlast=0x7f7f533ef780,_ylast=[0x7f7f51151a30,0x7f7f51151a30,
 0x7f7f51151a30],_y0=0x7f7f51154030,_signus=0x7f7f528b28e0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f532805a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f890,xposition=0x7f7f5110f628,yposition=
 0x7f7f51106f68,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002250,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       71.9   0.167      324.3
Field Avg  1.65                     71.9   0.167      324.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113580,winddir=0x7f7f51113be0,
 _layeralt=0x7f7f511131c8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e98,lgs_prof_alt=0x7f7f5110eaf8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ae3c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506a0290,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1108a6030,_masks=0x0,_fluxpersub=0x7f7f506ae570,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f506ae7c0,_skyfluxpersub=0x7f7f506aea10,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00771322,0.0118873],_lastvalidtt=
 [-0.00771322,0.0118873],_upttcommand=[0,0],_refmes=0x7f7f509c1630,_tiprefv=
 0x7f7f511a1030,_tiltrefv=0x7f7f511a0830,_tiprefvn=0x7f7f5118f630,_tiltrefvn=
 0x7f7f51262830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506b7870,_jstart=0x7f7f506b7ac0,_binindices=0x7f7f5119b830,
 _binxy=2,_centroidw=0x7f7f511048d8,_fimage=0x7f7f51868a30,_fimage2=0x0,
 _imistart=0x7f7f533e5d40,_imjstart=0x7f7f533e5f90,_imistart2=0x7f7f533e4f60,
 _imjstart2=0x7f7f533e51b0,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f506ae340,
 _lgs_defocuses=0x7f7f5110e938,_unitdefocus=0x10f35a030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51816230,_flat=0x7f7f51815830,_domask=1,
 _submask=0x7f7f5180be30,_kernel=0x7f7f5180b030,_kernels=0x10c198030,_kerfftr=
 0x10bf17030,_kerffti=0x10bfc9030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51869430,_x=0x7f7f5181b830,_y=0x7f7f5181f630,_centroidgain=1,_rayleigh=
 0x7f7f5110e9e0,_bckgrdcalib=0x7f7f51868030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f9e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001f78,_ctrlden=0x7f7f52002330,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f532811f0,_ylast=[0x7f7f50890630,0x7f7f50890630,
 0x7f7f50890630],_y0=0x7f7f50949030,_signus=0x7f7f53271470,_puppixoffset=[0,0],
 _nact=80,_def=0x10d132030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f890,xposition=0x7f7f51107198,yposition=
 0x7f7f52001d10,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002250,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113580,winddir=0x7f7f51113be0,
 _layeralt=0x7f7f51112170)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e98,lgs_prof_alt=0x7f7f5110eaf8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e66b0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507ac1c0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cf60030,_masks=0x0,_fluxpersub=0x7f7f53276570,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f531022f0,_skyfluxpersub=0x7f7f532767c0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f50941c30,_tiprefv=
 0x7f7f509c1630,_tiltrefv=0x7f7f5200e030,_tiprefvn=0x7f7f509d3230,_tiltrefvn=
 0x7f7f5200e830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ad1e0,_jstart=0x7f7f507ad430,_binindices=0x7f7f509c7630,
 _binxy=2,_centroidw=0x7f7f5110ec48,_fimage=0x7f7f5118ce30,_fimage2=0x0,
 _imistart=0x7f7f532850a0,_imjstart=0x7f7f53280340,_imistart2=0x7f7f53287320,
 _imjstart2=0x7f7f53287570,_unittip=0x7f7f507ae3b0,_unittilt=0x7f7f507acb70,
 _lgs_defocuses=0x7f7f5110fd98,_unitdefocus=0x10c443030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51152630,_flat=0x7f7f5127e230,_domask=1,
 _submask=0x7f7f509d8430,_kernel=0x7f7f51262830,_kernels=0x10c0b1030,_kerfftr=
 0x10beb1030,_kerffti=0x10bfc9030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5118dc30,_x=0x7f7f5208b030,_y=0x7f7f5208bc30,_centroidgain=1,_rayleigh=
 0x7f7f51104ad0,_bckgrdcalib=0x7f7f511a0830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ee08)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f511071d0,_ctrlden=0x7f7f5110e938,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53102070,_xlast=0x7f7f52935790,_ylast=[0x7f7f50949030,0x7f7f50949030,
 0x7f7f50949030],_y0=0x7f7f50927430,_signus=0x7f7f52934b80,_puppixoffset=[0,0],
 _nact=80,_def=0x10eb7b030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f890,xposition=0x7f7f52002368,yposition=
 0x7f7f5110ffc8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002250,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113580,winddir=0x7f7f51113be0,
 _layeralt=0x7f7f51113e00)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e98,lgs_prof_alt=0x7f7f5110eaf8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ae3c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f531022f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10de36030,_masks=0x0,_fluxpersub=0x7f7f5326da90,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5326dce0,_skyfluxpersub=0x7f7f53276570,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00746417,0.00577142],_lastvalidtt=
 [-0.00746417,0.00577142],_upttcommand=[0,0],_refmes=0x7f7f50941c30,_tiprefv=
 0x7f7f5186ce30,_tiltrefv=0x7f7f51869430,_tiprefvn=0x7f7f5186d630,_tiltrefvn=
 0x7f7f5186a630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52934b80,_jstart=0x7f7f5326d840,_binindices=0x7f7f51868030,
 _binxy=2,_centroidw=0x7f7f52001f40,_fimage=0x7f7f52089430,_fimage2=0x0,
 _imistart=0x7f7f506aea40,_imjstart=0x7f7f506aec90,_imistart2=0x7f7f506aeee0,
 _imjstart2=0x7f7f506af130,_unittip=0x7f7f53281150,_unittilt=0x7f7f53187cc0,
 _lgs_defocuses=0x7f7f511048d8,_unitdefocus=0x10cc5e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509c1030,_flat=0x7f7f509d3830,_domask=1,
 _submask=0x7f7f50948630,_kernel=0x7f7f50939030,_kernels=0x10c198030,_kerfftr=
 0x10bf17030,_kerffti=0x10bfc9030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5208b030,_x=0x7f7f50946830,_y=0x7f7f50937630,_centroidgain=1,_rayleigh=
 0x7f7f5110e9e0,_bckgrdcalib=0x7f7f509c6a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f9e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f520020c8,_ctrlden=0x7f7f51107198,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53280590,_xlast=0x7f7f53102070,_ylast=[0x7f7f50927430,0x7f7f50927430,
 0x7f7f50927430],_y0=0x7f7f50938430,_signus=0x7f7f532850a0,_puppixoffset=[0,0],
 _nact=80,_def=0x10d132030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f890,xposition=0x7f7f52002448,yposition=
 0x7f7f52001f08,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002250,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113580,winddir=0x7f7f51113be0,
 _layeralt=0x7f7f51113470)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e98,lgs_prof_alt=0x7f7f5110eaf8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f52934b80,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506a0290,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c730030,_masks=0x0,_fluxpersub=0x7f7f53187cc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528b28e0,_skyfluxpersub=0x7f7f533e4f60,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00400542,-0.000287041],_lastvalidtt=
 [-0.00400542,-0.000287041],_upttcommand=[0,0],_refmes=0x7f7f5119d830,_tiprefv=
 0x7f7f5200e030,_tiltrefv=0x7f7f5127ea30,_tiprefvn=0x7f7f5200e830,_tiltrefvn=
 0x7f7f511a0830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506ae340,_jstart=0x7f7f506ae590,_binindices=0x7f7f5127a830,
 _binxy=2,_centroidw=0x7f7f52002410,_fimage=0x7f7f5127d030,_fimage2=0x0,
 _imistart=0x7f7f533f0020,_imjstart=0x7f7f533f0270,_imistart2=0x7f7f533e6010,
 _imjstart2=0x7f7f533e6260,_unittip=0x7f7f507acb70,_unittilt=0x7f7f507ac1c0,
 _lgs_defocuses=0x7f7f5110ec48,_unitdefocus=0x10f75c030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5118f630,_flat=0x7f7f5200c430,_domask=1,
 _submask=0x7f7f50948630,_kernel=0x7f7f50939030,_kernels=0x10c0b1030,_kerfftr=
 0x10beb1030,_kerffti=0x10bfc9030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51262830,_x=0x7f7f5181f630,_y=0x7f7f5186a630,_centroidgain=1,_rayleigh=
 0x7f7f51104ad0,_bckgrdcalib=0x7f7f52089430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ee08)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002368,_ctrlden=0x7f7f5110e468,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f5300fb60,_ylast=[0x7f7f51154030,0x7f7f51154030,
 0x7f7f51154030],_y0=0x7f7f51151a30,_signus=0x7f7f533e5650,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533df8a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f890,xposition=0x7f7f52001f78,yposition=
 0x7f7f5110fbd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002250,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       71.9   0.167      324.3
Field Avg  1.65                     71.9   0.167      324.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113580,winddir=0x7f7f51113be0,
 _layeralt=0x7f7f511120e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e98,lgs_prof_alt=0x7f7f5110eaf8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506b15e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506aea40,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f55a030,_masks=0x0,_fluxpersub=0x7f7f533e5a90,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e5ce0,_skyfluxpersub=0x7f7f533e4f60,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00770307,0.0118941],_lastvalidtt=
 [-0.00770307,0.0118941],_upttcommand=[0,0],_refmes=0x7f7f5180ba30,_tiprefv=
 0x7f7f51152630,_tiltrefv=0x7f7f5127a830,_tiprefvn=0x7f7f5127bc30,_tiltrefvn=
 0x7f7f5127ea30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506a0290,_jstart=0x7f7f506af3d0,_binindices=0x7f7f5187ec30,
 _binxy=2,_centroidw=0x7f7f52001d10,_fimage=0x7f7f5180b030,_fimage2=0x0,
 _imistart=0x7f7f506afac0,_imjstart=0x7f7f506afd10,_imistart2=0x7f7f506aff60,
 _imjstart2=0x7f7f506b01b0,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f506ae590,
 _lgs_defocuses=0x7f7f52001f40,_unitdefocus=0x10cd5f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f52089430,_flat=0x7f7f5200c430,_domask=1,
 _submask=0x7f7f51262830,_kernel=0x7f7f50948630,_kernels=0x10c198030,_kerfftr=
 0x10bf17030,_kerffti=0x10bfc9030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5180be30,_x=0x7f7f5181b830,_y=0x7f7f51816230,_centroidgain=1,_rayleigh=
 0x7f7f5110e9e0,_bckgrdcalib=0x7f7f5200ce30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f9e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001df0,_ctrlden=0x7f7f5110fd98,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f532852f0,_ylast=[0x7f7f508db030,0x7f7f508db030,
 0x7f7f508db030],_y0=0x7f7f50941c30,_signus=0x7f7f52934b80,_puppixoffset=[0,0],
 _nact=80,_def=0x10d132030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f890,xposition=0x7f7f511071d0,yposition=
 0x7f7f52002330,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002250,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113580,winddir=0x7f7f51113be0,
 _layeralt=0x7f7f51112a58)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e98,lgs_prof_alt=0x7f7f5110eaf8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507af7e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e7c10,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10dd35030,_masks=0x0,_fluxpersub=0x7f7f507ad900,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507adb50,_skyfluxpersub=0x7f7f507adda0,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f509d5e30,_tiprefv=
 0x7f7f5127cc30,_tiltrefv=0x7f7f5127c430,_tiprefvn=0x7f7f51152630,_tiltrefvn=
 0x7f7f5127a830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e7e60,_jstart=0x7f7f533e5bc0,_binindices=0x7f7f5119ba30,
 _binxy=2,_centroidw=0x7f7f511048d8,_fimage=0x7f7f52087c30,_fimage2=0x0,
 _imistart=0x7f7f533e62b0,_imjstart=0x7f7f533e8210,_imistart2=0x7f7f533e8460,
 _imjstart2=0x7f7f533e86b0,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f506a0290,
 _lgs_defocuses=0x7f7f52002410,_unitdefocus=0x10f35a030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5208b030,_flat=0x7f7f52011030,_domask=1,
 _submask=0x7f7f5200c430,_kernel=0x7f7f511c7030,_kernels=0x10c0b1030,_kerfftr=
 0x10beb1030,_kerffti=0x10bfc9030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f52078a30,_x=0x7f7f51176630,_y=0x7f7f5127ea30,_centroidgain=1,_rayleigh=
 0x7f7f51104ad0,_bckgrdcalib=0x7f7f5208ba30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ee08)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110f970,_ctrlden=0x7f7f51106f30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f532850a0,_xlast=0x7f7f52935790,_ylast=[0x7f7f50941c30,0x7f7f50941c30,
 0x7f7f50941c30],_y0=0x7f7f508dde30,_signus=0x7f7f5327b420,_puppixoffset=[0,0],
 _nact=80,_def=0x10eb7b030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507ac340,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f890,xposition=0x7f7f520020c8,yposition=
 0x7f7f5110e938,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002250,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113580,winddir=0x7f7f51113be0,
 _layeralt=0x7f7f51112390)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e98,lgs_prof_alt=0x7f7f5110eaf8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ac1c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e53e0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d933030,_masks=0x0,_fluxpersub=0x7f7f506a0290,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f506ae340,_skyfluxpersub=0x7f7f506ae590,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.00746418,0.00577143],_lastvalidtt=
 [-0.00746418,0.00577143],_upttcommand=[0,0],_refmes=0x7f7f51177430,_tiprefv=
 0x7f7f5127ea30,_tiltrefv=0x7f7f50938030,_tiprefvn=0x7f7f5127cc30,_tiltrefvn=
 0x7f7f509d1830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e5630,_jstart=0x7f7f533e5880,_binindices=0x7f7f51191630,
 _binxy=2,_centroidw=0x7f7f5110f9a8,_fimage=0x7f7f509d0630,_fimage2=0x0,
 _imistart=0x7f7f533e5f70,_imjstart=0x7f7f533e7570,_imistart2=0x7f7f533e4f60,
 _imjstart2=0x7f7f533e77c0,_unittip=0x7f7f533e6990,_unittilt=0x7f7f533e51b0,
 _lgs_defocuses=0x7f7f52001d10,_unitdefocus=0x10c443030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5186ce30,_flat=0x7f7f51868e30,_domask=1,
 _submask=0x7f7f5186a630,_kernel=0x7f7f511a0830,_kernels=0x10c198030,_kerfftr=
 0x10bf17030,_kerffti=0x10bfc9030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50937630,_x=0x7f7f5117c230,_y=0x7f7f5114ec30,_centroidgain=1,_rayleigh=
 0x7f7f5110e9e0,_bckgrdcalib=0x7f7f5186d830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f9e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f511071d0,_ctrlden=0x7f7f52002090,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f528afd30,_ylast=[0x7f7f51151a30,0x7f7f51151a30,
 0x7f7f51151a30],_y0=0x7f7f5119d830,_signus=0x7f7f533efe70,_puppixoffset=[0,0],
 _nact=80,_def=0x10d132030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5069f7e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f890,xposition=0x7f7f52002368,yposition=
 0x7f7f51110038,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002250,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113580,winddir=0x7f7f51113be0,
 _layeralt=0x7f7f51113cf0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e98,lgs_prof_alt=0x7f7f5110eaf8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507aeac0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f531022f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1102a3030,_masks=0x0,_fluxpersub=0x7f7f533e60b0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f506b9180,_skyfluxpersub=0x7f7f506b93d0,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.00400541,-0.000287042],
 _lastvalidtt=[-0.00400541,-0.000287042],_upttcommand=[0,0],_refmes=
 0x7f7f50939a30,_tiprefv=0x7f7f509d0630,_tiltrefv=0x7f7f52089430,_tiprefvn=
 0x7f7f509c7630,_tiltrefvn=0x7f7f5127ea30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=28,_nx4fft=28,_istart=0x7f7f53280fa0,_jstart=0x7f7f53281930,
 _binindices=0x7f7f51191630,_binxy=2,_centroidw=0x7f7f5110e858,_fimage=
 0x7f7f509d1830,_fimage2=0x0,_imistart=0x7f7f533e5400,_imjstart=0x7f7f533e5650,
 _imistart2=0x7f7f533e58a0,_imjstart2=0x7f7f533e5af0,_unittip=0x7f7f507ad1e0,
 _unittilt=0x7f7f507acb70,_lgs_defocuses=0x7f7f511048d8,_unitdefocus=
 0x10e038030,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5186b030,
 _flat=0x7f7f51815830,_domask=1,_submask=0x7f7f51195a30,_kernel=0x7f7f51192430,
 _kernels=0x10c0b1030,_kerfftr=0x10beb1030,_kerffti=0x10bfc9030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7f7f509c7e30,_x=0x7f7f50946830,_y=0x7f7f509c4830,
 _centroidgain=1,_rayleigh=0x7f7f51104ad0,_bckgrdcalib=0x7f7f51868030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7f7f5110ee08)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51106ec0,_ctrlden=0x7f7f51105630,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53275860,_xlast=0x7f7f52934b80,_ylast=[0x7f7f509d5e30,0x7f7f509d5e30,
 0x7f7f509d5e30],_y0=0x7f7f50949030,_signus=0x7f7f5327bc60,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507ac1c0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f890,xposition=0x7f7f52001df0,yposition=
 0x7f7f51107198,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002250,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       71.9   0.167      324.3
Field Avg  1.65                     71.9   0.167      324.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1;// 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ec8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113580,winddir=0x7f7f51113be0,
 _layeralt=0x7f7f51112c78)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e98,lgs_prof_alt=0x7f7f5110eaf8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533f0a10,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507ad1e0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c8f2030,_masks=0x0,_fluxpersub=0x7f7f506a0290,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533f0320,_skyfluxpersub=0x7f7f533f0570,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.00770266,0.0118937],_lastvalidtt=
 [-0.00770266,0.0118937],_upttcommand=[0,0],_refmes=0x7f7f50948c30,_tiprefv=
 0x7f7f50937c30,_tiltrefv=0x7f7f509c6e30,_tiprefvn=0x7f7f509d0630,_tiltrefvn=
 0x7f7f509cfc30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ad430,_jstart=0x7f7f507ad680,_binindices=0x7f7f51262830,
 _binxy=2,_centroidw=0x7f7f51107080,_fimage=0x7f7f51152630,_fimage2=0x0,
 _imistart=0x7f7f533ef9e0,_imjstart=0x7f7f533efc30,_imistart2=0x7f7f533efe80,
 _imjstart2=0x7f7f533f00d0,_unittip=0x7f7f507af0b0,_unittilt=0x7f7f507acb70,
 _lgs_defocuses=0x7f7f5110f9a8,_unitdefocus=0x10f75c030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5118d830,_flat=0x7f7f5118ce30,_domask=1,
 _submask=0x7f7f5187f030,_kernel=0x7f7f511a0830,_kernels=0x10c198030,_kerfftr=
 0x10bf17030,_kerffti=0x10bfc9030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5118f630,_x=0x7f7f52078a30,_y=0x7f7f52079030,_centroidgain=1,_rayleigh=
 0x7f7f5110e9e0,_bckgrdcalib=0x7f7f5118e230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f9e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002368,_ctrlden=0x7f7f5110fbd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f5069f7e0,_ylast=[0x7f7f51819230,0x7f7f51819230,
 0x7f7f51819230],_y0=0x7f7f51806e30,_signus=0x7f7f506ae340,_puppixoffset=[0,0],
 _nact=80,_def=0x10d132030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52934b80,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f511070f0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f890,xposition=0x7f7f5110f970,yposition=
 0x7f7f5110e468,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002250,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 108 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51111ec8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51112e98)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ec80,lgs_prof_alt=0x7f7f52002138,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506afa80,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53187cc0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c931030,_masks=0x0,_fluxpersub=0x7f7f533e6210,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e6460,_skyfluxpersub=0x7f7f533e66b0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f52016030,_tiprefv=
 0x7f7f51293030,_tiltrefv=0x7f7f5127ea30,_tiprefvn=0x7f7f51293830,_tiltrefvn=
 0x7f7f51294030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5327bec0,_jstart=0x7f7f5327d980,_binindices=0x7f7f5127a830,
 _binxy=2,_centroidw=0x7f7f52001db8,_fimage=0x7f7f50a32430,_fimage2=0x0,
 _imistart=0x7f7f533e51b0,_imjstart=0x7f7f533e5400,_imistart2=0x7f7f533e5d70,
 _imjstart2=0x7f7f533e5fc0,_unittip=0x7f7f507ad1e0,_unittilt=0x7f7f507ad410,
 _lgs_defocuses=0x7f7f51105588,_unitdefocus=0x10f1c2030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50939030,_flat=0x7f7f50a31030,_domask=1,
 _submask=0x7f7f5118f630,_kernel=0x7f7f51297c30,_kernels=0x10c58b030,_kerfftr=
 0x10c25f030,_kerffti=0x10bf17030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509c2a30,_x=0x7f7f50a2fe30,_y=0x7f7f50a30430,_centroidgain=1,_rayleigh=
 0x7f7f51106f68,_bckgrdcalib=0x7f7f50a31a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51106fd8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ee78,_ctrlden=0x7f7f52002288,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53281200,_ylast=[0x7f7f50939a30,0x7f7f50939a30,
 0x7f7f50939a30],_y0=0x7f7f50949030,_signus=0x7f7f52935ab0,_puppixoffset=[0,0],
 _nact=80,_def=0x10d132030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f51107080,xposition=0x7f7f5110e9e0,yposition=
 0x7f7f52001d48,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110f970,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51111ec8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51111f50)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ec80,lgs_prof_alt=0x7f7f52002138,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507accb0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5327c360,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f85e030,_masks=0x0,_fluxpersub=0x7f7f506a0290,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f506ae340,_skyfluxpersub=0x7f7f506ae590,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00746418,0.00577143],_lastvalidtt=
 [-0.00746418,0.00577143],_upttcommand=[0,0],_refmes=0x7f7f508dde30,_tiprefv=
 0x7f7f50939030,_tiltrefv=0x7f7f50938030,_tiprefvn=0x7f7f50a2fe30,_tiltrefvn=
 0x7f7f509c5830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52935ab0,_jstart=0x7f7f53187cc0,_binindices=0x7f7f5119ba30,
 _binxy=2,_centroidw=0x7f7f5110fc80,_fimage=0x7f7f509c8030,_fimage2=0x0,
 _imistart=0x7f7f533e60d0,_imjstart=0x7f7f533e6320,_imistart2=0x7f7f533e6570,
 _imjstart2=0x7f7f533e67c0,_unittip=0x7f7f53281930,_unittilt=0x7f7f532804c0,
 _lgs_defocuses=0x7f7f52002218,_unitdefocus=0x10f45b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5181a830,_flat=0x7f7f51815830,_domask=1,
 _submask=0x7f7f51868030,_kernel=0x7f7f51294a30,_kernels=0x10c02f030,_kerfftr=
 0x10c0ae030,_kerffti=0x10bfc9030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509c3430,_x=0x7f7f50946830,_y=0x7f7f509c6030,_centroidgain=1,_rayleigh=
 0x7f7f5110ecb8,_bckgrdcalib=0x7f7f5200c430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002448)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110eac0,_ctrlden=0x7f7f5110fba0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f530efc20,_ylast=[0x7f7f51177430,0x7f7f51177430,
 0x7f7f51177430],_y0=0x7f7f5119d830,_signus=0x7f7f528b28e0,_puppixoffset=[0,0],
 _nact=80,_def=0x11023e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e5c30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f51107080,xposition=0x7f7f5110ecf0,yposition=
 0x7f7f511055f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110f970,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51111ec8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51112418)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ec80,lgs_prof_alt=0x7f7f52002138,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506ae340,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533ee990,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f2c3030,_masks=0x0,_fluxpersub=0x7f7f5327c360,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53281930,_skyfluxpersub=0x7f7f532850a0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00400541,-0.00028702],_lastvalidtt=
 [-0.00400541,-0.00028702],_upttcommand=[0,0],_refmes=0x7f7f51295430,_tiprefv=
 0x7f7f509c2a30,_tiltrefv=0x7f7f5118ce30,_tiprefvn=0x7f7f50939030,_tiltrefvn=
 0x7f7f5118d630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533eebe0,_jstart=0x7f7f533ef630,_binindices=0x7f7f509c6a30,
 _binxy=2,_centroidw=0x7f7f5110f580,_fimage=0x7f7f51152630,_fimage2=0x0,
 _imistart=0x7f7f5327bec0,_imjstart=0x7f7f52935ab0,_imistart2=0x7f7f52934b80,
 _imjstart2=0x7f7f5327c110,_unittip=0x7f7f528b28e0,_unittilt=0x7f7f533ee760,
 _lgs_defocuses=0x7f7f52001db8,_unitdefocus=0x10eec0030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51295830,_flat=0x7f7f5095be30,_domask=1,
 _submask=0x7f7f509ed230,_kernel=0x7f7f509ec430,_kernels=0x10bfc9030,_kerfftr=
 0x10bf17030,_kerffti=0x10c02f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51262830,_x=0x7f7f51176630,_y=0x7f7f5119ec30,_centroidgain=1,_rayleigh=
 0x7f7f51106f68,_bckgrdcalib=0x7f7f509c3230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51106fd8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001d48,_ctrlden=0x7f7f5110f070,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f528afd30,_ylast=[0x7f7f5119d830,0x7f7f5119d830,
 0x7f7f5119d830],_y0=0x7f7f51154030,_signus=0x7f7f533ee4a0,_puppixoffset=[0,0],
 _nact=80,_def=0x10db34030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f532852f0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f51107080,xposition=0x7f7f52001e28,yposition=
 0x7f7f511071d0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110f970,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       71.9   0.167      324.3
Field Avg  1.65                     71.9   0.167      324.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51111ec8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51112fa8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ec80,lgs_prof_alt=0x7f7f52002138,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5327c890,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53187cc0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ce1f030,_masks=0x0,_fluxpersub=0x7f7f5326e960,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5326ebb0,_skyfluxpersub=0x7f7f5326ee00,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00771322,0.0118873],_lastvalidtt=
 [-0.00771322,0.0118873],_upttcommand=[0,0],_refmes=0x7f7f51806e30,_tiprefv=
 0x7f7f5127b230,_tiltrefv=0x7f7f5127ea30,_tiprefvn=0x7f7f5127ba30,_tiltrefvn=
 0x7f7f5118ce30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f531022f0,_jstart=0x7f7f53280340,_binindices=0x7f7f50948630,
 _binxy=2,_centroidw=0x7f7f5110f0a8,_fimage=0x7f7f509cfc30,_fimage2=0x0,
 _imistart=0x7f7f5327dbd0,_imjstart=0x7f7f5327de20,_imistart2=0x7f7f53287320,
 _imjstart2=0x7f7f53287570,_unittip=0x7f7f532850a0,_unittilt=0x7f7f5326e680,
 _lgs_defocuses=0x7f7f5110fc80,_unitdefocus=0x10e212030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509c8030,_flat=0x7f7f509c6c30,_domask=1,
 _submask=0x7f7f509c5e30,_kernel=0x7f7f509d6a30,_kernels=0x10c02f030,_kerfftr=
 0x10c0ae030,_kerffti=0x10bfc9030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5095be30,_x=0x7f7f50944030,_y=0x7f7f50939030,_centroidgain=1,_rayleigh=
 0x7f7f5110ecb8,_bckgrdcalib=0x7f7f509c2a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002448)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ecf0,_ctrlden=0x7f7f5110fb30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53102070,_ylast=[0x7f7f50a47430,0x7f7f50a47430,
 0x7f7f50a47430],_y0=0x7f7f50941c30,_signus=0x7f7f52934b80,_puppixoffset=[0,0],
 _nact=80,_def=0x11023e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f51107080,xposition=0x7f7f5110ee78,yposition=
 0x7f7f5110f778,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110f970,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51111ec8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51113608)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ec80,lgs_prof_alt=0x7f7f52002138,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e7e10,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5327d3d0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f1c2030,_masks=0x0,_fluxpersub=0x7f7f5327dcb0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53280340,_skyfluxpersub=0x7f7f5326e8d0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f509d5e30,_tiprefv=
 0x7f7f51280430,_tiltrefv=0x7f7f509c2a30,_tiprefvn=0x7f7f5127b230,_tiltrefvn=
 0x7f7f509c5c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5326e680,_jstart=0x7f7f53187cc0,_binindices=0x7f7f50937630,
 _binxy=2,_centroidw=0x7f7f5110e708,_fimage=0x7f7f52089430,_fimage2=0x0,
 _imistart=0x7f7f5326ebb0,_imjstart=0x7f7f5326ee00,_imistart2=0x7f7f5326f050,
 _imjstart2=0x7f7f5326f2a0,_unittip=0x7f7f532785e0,_unittilt=0x7f7f52934b80,
 _lgs_defocuses=0x7f7f5110f580,_unitdefocus=0x10cf60030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509c3230,_flat=0x7f7f509c8030,_domask=1,
 _submask=0x7f7f50948630,_kernel=0x7f7f509c6430,_kernels=0x10c02f030,_kerfftr=
 0x10bfc9030,_kerffti=0x10bf17030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5208b030,_x=0x7f7f50921830,_y=0x7f7f50944030,_centroidgain=1,_rayleigh=
 0x7f7f51106f68,_bckgrdcalib=0x7f7f509c3c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51106fd8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002218,_ctrlden=0x7f7f5110f0e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5327cd60,_xlast=0x7f7f52935790,_ylast=[0x7f7f50941c30,0x7f7f50941c30,
 0x7f7f50941c30],_y0=0x7f7f508dde30,_signus=0x7f7f528b28e0,_puppixoffset=[0,0],
 _nact=80,_def=0x10db34030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5326f4f0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f51107080,xposition=0x7f7f5110eac0,yposition=
 0x7f7f51104a28,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110f970,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51111ec8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51112838)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ec80,lgs_prof_alt=0x7f7f52002138,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e6ea0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52935ab0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f45b030,_masks=0x0,_fluxpersub=0x7f7f5327d980,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53187cc0,_skyfluxpersub=0x7f7f52934b80,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00746417,0.00577142],_lastvalidtt=
 [-0.00746417,0.00577142],_upttcommand=[0,0],_refmes=0x7f7f5127c830,_tiprefv=
 0x7f7f51889c30,_tiltrefv=0x7f7f509c5030,_tiprefvn=0x7f7f5188a430,_tiltrefvn=
 0x7f7f509c2a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5327d0a0,_jstart=0x7f7f5327de20,_binindices=0x7f7f5127cc30,
 _binxy=2,_centroidw=0x7f7f52002330,_fimage=0x7f7f5127b230,_fimage2=0x0,
 _imistart=0x7f7f533e70f0,_imjstart=0x7f7f533e7340,_imistart2=0x7f7f533e7590,
 _imjstart2=0x7f7f533e77e0,_unittip=0x7f7f5327c890,_unittilt=0x7f7f531022f0,
 _lgs_defocuses=0x7f7f5110f0a8,_unitdefocus=0x10d533030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509c6230,_flat=0x7f7f509c5830,_domask=1,
 _submask=0x7f7f50937630,_kernel=0x7f7f509c4230,_kernels=0x10c02f030,_kerfftr=
 0x10bf17030,_kerffti=0x10c0ae030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5118f630,_x=0x7f7f5093de30,_y=0x7f7f50946830,_centroidgain=1,_rayleigh=
 0x7f7f5110ecb8,_bckgrdcalib=0x7f7f509c3230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002448)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ee40,_ctrlden=0x7f7f51110038,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f5300fb60,_ylast=[0x7f7f5111d030,0x7f7f5111d030,
 0x7f7f5111d030],_y0=0x7f7f51263230,_signus=0x7f7f533e6be0,_puppixoffset=[0,0],
 _nact=80,_def=0x11023e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533df8a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f51107080,xposition=0x7f7f52001d48,yposition=
 0x7f7f5110fba0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110f970,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51111ec8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51112390)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ec80,lgs_prof_alt=0x7f7f52002138,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f532785e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e77e0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f55c030,_masks=0x0,_fluxpersub=0x7f7f533e6890,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e6ae0,_skyfluxpersub=0x7f7f533e6d30,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00400542,-0.000287041],_lastvalidtt=
 [-0.00400542,-0.000287041],_upttcommand=[0,0],_refmes=0x7f7f50927430,_tiprefv=
 0x7f7f5095c830,_tiltrefv=0x7f7f5118f630,_tiprefvn=0x7f7f509c3c30,_tiltrefvn=
 0x7f7f51280430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e7a30,_jstart=0x7f7f533e7c80,_binindices=0x7f7f5127c630,
 _binxy=2,_centroidw=0x7f7f520023d8,_fimage=0x7f7f50a46e30,_fimage2=0x0,
 _imistart=0x7f7f533e5f50,_imjstart=0x7f7f533e61a0,_imistart2=0x7f7f533e63f0,
 _imjstart2=0x7f7f533e6640,_unittip=0x7f7f506afac0,_unittilt=0x7f7f506afcf0,
 _lgs_defocuses=0x7f7f5110e708,_unitdefocus=0x10d735030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51282630,_flat=0x7f7f51281c30,_domask=1,
 _submask=0x7f7f50948630,_kernel=0x7f7f5207a830,_kernels=0x10c02f030,_kerfftr=
 0x10c0ae030,_kerffti=0x10bfc9030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5095be30,_x=0x7f7f51280c30,_y=0x7f7f51152630,_centroidgain=1,_rayleigh=
 0x7f7f51106f68,_bckgrdcalib=0x7f7f51193a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51106fd8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51105588,_ctrlden=0x7f7f52001e28,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53102070,_xlast=0x7f7f506aea70,_ylast=[0x7f7f51869830,0x7f7f51869830,
 0x7f7f51869830],_y0=0x7f7f51806e30,_signus=0x7f7f506aebf0,_puppixoffset=[0,0],
 _nact=80,_def=0x10db34030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f51107080,xposition=0x7f7f5110ecf0,yposition=
 0x7f7f5110f070,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110f970,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       71.9   0.167      324.3
Field Avg  1.65                     71.9   0.167      324.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51111ec8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51113be0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ec80,lgs_prof_alt=0x7f7f52002138,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f532785e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52935ab0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cb1c030,_masks=0x0,_fluxpersub=0x7f7f533e5ab0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e5d00,_skyfluxpersub=0x7f7f533e5f50,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00770307,0.0118941],_lastvalidtt=
 [-0.00770307,0.0118941],_upttcommand=[0,0],_refmes=0x7f7f5111d030,_tiprefv=
 0x7f7f5127c630,_tiltrefv=0x7f7f509eaa30,_tiprefvn=0x7f7f5127ce30,_tiltrefvn=
 0x7f7f509eb230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52934b80,_jstart=0x7f7f53287320,_binindices=0x7f7f50939030,
 _binxy=2,_centroidw=0x7f7f5110fa18,_fimage=0x7f7f509c7830,_fimage2=0x0,
 _imistart=0x7f7f53276570,_imjstart=0x7f7f53270ee0,_imistart2=0x7f7f53276b90,
 _imjstart2=0x7f7f53272270,_unittip=0x7f7f531022f0,_unittilt=0x7f7f5327d980,
 _lgs_defocuses=0x7f7f52002330,_unitdefocus=0x10eec0030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51152630,_flat=0x7f7f50a46230,_domask=1,
 _submask=0x7f7f51262830,_kernel=0x7f7f5181a830,_kernels=0x10c02f030,_kerfftr=
 0x10c25f030,_kerffti=0x10bf17030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5095c830,_x=0x7f7f50944030,_y=0x7f7f509cfc30,_centroidgain=1,_rayleigh=
 0x7f7f5110ecb8,_bckgrdcalib=0x7f7f509c8230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002448)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fba0,_ctrlden=0x7f7f5110ee78,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f532805a0,_xlast=0x7f7f53285300,_ylast=[0x7f7f509d5e30,0x7f7f509d5e30,
 0x7f7f509d5e30],_y0=0x7f7f50927430,_signus=0x7f7f53271c80,_puppixoffset=[0,0],
 _nact=80,_def=0x11023e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533df8a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f51107080,xposition=0x7f7f52002218,yposition=
 0x7f7f5110fb30,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110f970,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51111ec8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51112060)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ec80,lgs_prof_alt=0x7f7f52002138,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f52935ab0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e6c60,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cd1e030,_masks=0x0,_fluxpersub=0x7f7f533e8130,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e8380,_skyfluxpersub=0x7f7f533e85d0,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.0819465,0.029431],_lastvalidtt=
 [-0.0819465,0.029431],_upttcommand=[0,0],_refmes=0x7f7f5208cc30,_tiprefv=
 0x7f7f52011030,_tiltrefv=0x7f7f509c2a30,_tiprefvn=0x7f7f52078a30,_tiltrefvn=
 0x7f7f509eaa30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e6eb0,_jstart=0x7f7f533e7100,_binindices=0x7f7f5208b030,
 _binxy=2,_centroidw=0x7f7f5110f0a8,_fimage=0x7f7f5095be30,_fimage2=0x0,
 _imistart=0x7f7f533e77f0,_imjstart=0x7f7f533e7a40,_imistart2=0x7f7f533e7c90,
 _imjstart2=0x7f7f533e7ee0,_unittip=0x7f7f533e6800,_unittilt=0x7f7f533e6a30,
 _lgs_defocuses=0x7f7f520023d8,_unitdefocus=0x10c5ad030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51152630,_flat=0x7f7f5127a830,_domask=1,
 _submask=0x7f7f51280430,_kernel=0x7f7f51262830,_kernels=0x10c02f030,_kerfftr=
 0x10bf17030,_kerffti=0x10c0ae030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50937630,_x=0x7f7f5119ec30,_y=0x7f7f51072c30,_centroidgain=1,_rayleigh=
 0x7f7f51106f68,_bckgrdcalib=0x7f7f5127bc30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51106fd8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ef20,_ctrlden=0x7f7f520029c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f533f1200,_ylast=[0x7f7f5100fc30,0x7f7f5100fc30,
 0x7f7f5100fc30],_y0=0x7f7f5111d030,_signus=0x7f7f533f1380,_puppixoffset=[0,0],
 _nact=80,_def=0x10db34030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f53102070,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f51107080,xposition=0x7f7f5110ee40,yposition=
 0x7f7f5110f0e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110f970,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51111ec8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51113470)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ec80,lgs_prof_alt=0x7f7f52002138,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e5f50,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e61a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cc1d030,_masks=0x0,_fluxpersub=0x7f7f507adca0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507ae390,_skyfluxpersub=0x7f7f507ae5e0,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.00746418,0.00577143],_lastvalidtt=
 [-0.00746418,0.00577143],_upttcommand=[0,0],_refmes=0x7f7f51263230,_tiprefv=
 0x7f7f5208b030,_tiltrefv=0x7f7f5127c430,_tiprefvn=0x7f7f52011030,_tiltrefvn=
 0x7f7f5127cc30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e5ab0,_jstart=0x7f7f533e5d00,_binindices=0x7f7f52086430,
 _binxy=2,_centroidw=0x7f7f5110eeb0,_fimage=0x7f7f5127b830,_fimage2=0x0,
 _imistart=0x7f7f507ae140,_imjstart=0x7f7f507ad1e0,_imistart2=0x7f7f507ad430,
 _imjstart2=0x7f7f507ad680,_unittip=0x7f7f533f0d70,_unittilt=0x7f7f533e68a0,
 _lgs_defocuses=0x7f7f5110fa18,_unitdefocus=0x10cf60030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5207c430,_flat=0x7f7f51815830,_domask=1,
 _submask=0x7f7f52078a30,_kernel=0x7f7f51280430,_kernels=0x10c02f030,_kerfftr=
 0x10bfc6030,_kerffti=0x10c25f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51262830,_x=0x7f7f51176630,_y=0x7f7f5119ec30,_centroidgain=1,_rayleigh=
 0x7f7f5110ecb8,_bckgrdcalib=0x7f7f5181a830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002448)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e9e0,_ctrlden=0x7f7f5110fb30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53281200,_xlast=0x7f7f52935790,_ylast=[0x7f7f50939a30,0x7f7f50939a30,
 0x7f7f50939a30],_y0=0x7f7f50949030,_signus=0x7f7f53277030,_puppixoffset=[0,0],
 _nact=80,_def=0x11023e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507adef0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f51107080,xposition=0x7f7f51105588,yposition=
 0x7f7f52002288,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110f970,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51111ec8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51112a58)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ec80,lgs_prof_alt=0x7f7f52002138,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e8200,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f532850a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x110d1d030,_masks=0x0,_fluxpersub=0x7f7f533e7260,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e74b0,_skyfluxpersub=0x7f7f533e7700,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.00400541,-0.000287042],
 _lastvalidtt=[-0.00400541,-0.000287042],_upttcommand=[0,0],_refmes=
 0x7f7f51108830,_tiprefv=0x7f7f509cfc30,_tiltrefv=0x7f7f509c8230,_tiprefvn=
 0x7f7f50937630,_tiltrefvn=0x7f7f50a45030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=28,_nx4fft=28,_istart=0x7f7f53276b90,_jstart=0x7f7f53276de0,
 _binindices=0x7f7f5127cc30,_binxy=2,_centroidw=0x7f7f5110f890,_fimage=
 0x7f7f51280430,_fimage2=0x0,_imistart=0x7f7f533e6dc0,_imjstart=0x7f7f533e7010,
 _imistart2=0x7f7f533e5ab0,_imjstart2=0x7f7f533e5d00,_unittip=0x7f7f531022f0,
 _unittilt=0x7f7f52935ab0,_lgs_defocuses=0x7f7f5110f0a8,_unitdefocus=
 0x10d533030,_fimnx=24,_fimny=24,_fimny2=0x0,_yoffset=0x0,_bias=0x7f7f52011030,
 _flat=0x7f7f52089430,_domask=1,_submask=0x7f7f5118ce30,_kernel=0x7f7f509c3830,
 _kernels=0x10c02f030,_kerfftr=0x10c25f030,_kerffti=0x10bf17030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7f7f51262830,_x=0x7f7f509c7c30,_y=0x7f7f50946830,
 _centroidgain=1,_rayleigh=0x7f7f51106f68,_bckgrdcalib=0x7f7f5208b030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7f7f51106fd8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110faf8,_ctrlden=0x7f7f5110ef58,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f530efc20,_xlast=0x7f7f533e65b0,_ylast=[0x7f7f5111d030,0x7f7f5111d030,
 0x7f7f5111d030],_y0=0x7f7f51263230,_signus=0x7f7f533efa10,_puppixoffset=[0,0],
 _nact=80,_def=0x10db34030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507acb70,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f51107080,xposition=0x7f7f5110fba0,yposition=
 0x7f7f51110038,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110f970,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       71.9   0.167      324.3
Field Avg  1.65                     71.9   0.167      324.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 5;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51111ec8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51113d78)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=5,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110ec80,lgs_prof_alt=0x7f7f52002138,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e78e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53287320,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c931030,_masks=0x0,_fluxpersub=0x7f7f53281930,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f531022f0,_skyfluxpersub=0x7f7f52935ab0,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.00770266,0.0118937],_lastvalidtt=
 [-0.00770266,0.0118937],_upttcommand=[0,0],_refmes=0x7f7f5118d830,_tiprefv=
 0x7f7f51191630,_tiltrefv=0x7f7f51280430,_tiprefvn=0x7f7f51191e30,_tiltrefvn=
 0x7f7f5119a630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53287570,_jstart=0x7f7f53276b90,_binindices=0x7f7f50a45630,
 _binxy=2,_centroidw=0x7f7f5110fbd8,_fimage=0x7f7f51152630,_fimage2=0x0,
 _imistart=0x7f7f532785e0,_imjstart=0x7f7f53278830,_imistart2=0x7f7f53276de0,
 _imjstart2=0x7f7f53277030,_unittip=0x7f7f53280340,_unittilt=0x7f7f5327c890,
 _lgs_defocuses=0x7f7f5110eeb0,_unitdefocus=0x10d735030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5181a830,_flat=0x7f7f51868030,_domask=1,
 _submask=0x7f7f50939030,_kernel=0x7f7f50a31830,_kernels=0x10c02f030,_kerfftr=
 0x10c0ae030,_kerffti=0x10bfc6030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5118dc30,_x=0x7f7f50921830,_y=0x7f7f50944030,_centroidgain=1,_rayleigh=
 0x7f7f5110ecb8,_bckgrdcalib=0x7f7f51815830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002448)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f520020c8,_ctrlden=0x7f7f5110f5f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f5300fb60,_ylast=[0x7f7f51263230,0x7f7f51263230,
 0x7f7f51263230],_y0=0x7f7f51108830,_signus=0x7f7f533e8130,_puppixoffset=[0,0],
 _nact=80,_def=0x11023e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5069f7e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f51107080,xposition=0x7f7f5110ef20,yposition=
 0x7f7f52001e28,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110f970,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ca8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f511134f8,winddir=0x7f7f51113ad0,
 _layeralt=0x7f7f51113f98)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e28,lgs_prof_alt=0x7f7f51107080,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53281b80,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506a0290,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f85e030,_masks=0x0,_fluxpersub=0x7f7f53287320,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53287570,_skyfluxpersub=0x7f7f53281930,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0820657,0.0297328],_lastvalidtt=
 [-0.0820657,0.0297328],_upttcommand=[0,0],_refmes=0x7f7f508db030,_tiprefv=
 0x7f7f509c3e30,_tiltrefv=0x7f7f509cfc30,_tiprefvn=0x7f7f509c4630,_tiltrefvn=
 0x7f7f509c5830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506aeed0,_jstart=0x7f7f506af120,_binindices=0x7f7f50948630,
 _binxy=2,_centroidw=0x7f7f51106f68,_fimage=0x7f7f509d7230,_fimage2=0x0,
 _imistart=0x7f7f53280340,_imjstart=0x7f7f53271470,_imistart2=0x7f7f532716c0,
 _imjstart2=0x7f7f53271910,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f506ae340,
 _lgs_defocuses=0x7f7f5110ef90,_unitdefocus=0x10d836030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50a2fe30,_flat=0x7f7f509c7c30,_domask=1,
 _submask=0x7f7f50937630,_kernel=0x7f7f50939030,_kernels=0x10bf0a030,_kerfftr=
 0x10c0ae030,_kerffti=0x10bfc6030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509c4e30,_x=0x7f7f5181b030,_y=0x7f7f51819230,_centroidgain=1,_rayleigh=
 0x7f7f5110efc8,_bckgrdcalib=0x7f7f50a30830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107198)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e708,_ctrlden=0x7f7f52002288,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53102070,_ylast=[0x7f7f50938430,0x7f7f50938430,
 0x7f7f50938430],_y0=0x7f7f50a47430,_signus=0x7f7f53280fa0,_puppixoffset=[0,0],
 _nact=80,_def=0x10da38030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f5f0,xposition=0x7f7f5110ecb8,yposition=
 0x7f7f52001e98,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ec80,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ca8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f511134f8,winddir=0x7f7f51113ad0,
 _layeralt=0x7f7f51112ae0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e28,lgs_prof_alt=0x7f7f51107080,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53271850,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e66b0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f2c3030,_masks=0x0,_fluxpersub=0x7f7f507acb70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507ac1c0,_skyfluxpersub=0x7f7f507ad1e0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00739392,0.00582689],_lastvalidtt=
 [-0.00739392,0.00582689],_upttcommand=[0,0],_refmes=0x7f7f50938030,_tiprefv=
 0x7f7f509c6a30,_tiltrefv=0x7f7f50a30830,_tiprefvn=0x7f7f509c3e30,_tiltrefvn=
 0x7f7f509cfc30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e6900,_jstart=0x7f7f533e6b50,_binindices=0x7f7f5127ca30,
 _binxy=2,_centroidw=0x7f7f51104a28,_fimage=0x7f7f50a2fe30,_fimage2=0x0,
 _imistart=0x7f7f533e7240,_imjstart=0x7f7f533e7490,_imistart2=0x7f7f533e76e0,
 _imjstart2=0x7f7f533e7930,_unittip=0x7f7f533e5ae0,_unittilt=0x7f7f533e55a0,
 _lgs_defocuses=0x7f7f51106fd8,_unitdefocus=0x10c5ad030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f52011030,_flat=0x7f7f52089430,_domask=1,
 _submask=0x7f7f5200f630,_kernel=0x7f7f51192430,_kernels=0x10c02c030,_kerfftr=
 0x10c25f030,_kerffti=0x10bf0a030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50948630,_x=0x7f7f51280e30,_y=0x7f7f5119ec30,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f5208b030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002138)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f511055f8,_ctrlden=0x7f7f52002330,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5327b090,_xlast=0x7f7f52935790,_ylast=[0x7f7f50a47430,0x7f7f50a47430,
 0x7f7f50a47430],_y0=0x7f7f508db030,_signus=0x7f7f532850a0,_puppixoffset=[0,0],
 _nact=80,_def=0x110e1e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533df8a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f5f0,xposition=0x7f7f520029f8,yposition=
 0x7f7f520029c0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ec80,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ca8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f511134f8,winddir=0x7f7f51113ad0,
 _layeralt=0x7f7f51111db8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e28,lgs_prof_alt=0x7f7f51107080,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506ae340,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506af0e0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d735030,_masks=0x0,_fluxpersub=0x7f7f533e7080,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f506b0020,_skyfluxpersub=0x7f7f506b0270,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0033037,-0.000827655],_lastvalidtt=
 [-0.0033037,-0.000827655],_upttcommand=[0,0],_refmes=0x7f7f51108830,_tiprefv=
 0x7f7f5200f630,_tiltrefv=0x7f7f5118ce30,_tiprefvn=0x7f7f5200fe30,_tiltrefvn=
 0x7f7f5118d630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ac1c0,_jstart=0x7f7f507ad1e0,_binindices=0x7f7f5208b030,
 _binxy=2,_centroidw=0x7f7f5110fa50,_fimage=0x7f7f51152630,_fimage2=0x0,
 _imistart=0x7f7f53187cc0,_imjstart=0x7f7f506af930,_imistart2=0x7f7f506afb80,
 _imjstart2=0x7f7f506afdd0,_unittip=0x7f7f507acb70,_unittilt=0x7f7f506a2f10,
 _lgs_defocuses=0x7f7f51106f68,_unitdefocus=0x10cf60030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5186ce30,_flat=0x7f7f51868030,_domask=1,
 _submask=0x7f7f51280430,_kernel=0x7f7f50948630,_kernels=0x10c092030,_kerfftr=
 0x10bfc6030,_kerffti=0x10c02c030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51262830,_x=0x7f7f51820c30,_y=0x7f7f5180da30,_centroidgain=1,_rayleigh=
 0x7f7f5110efc8,_bckgrdcalib=0x7f7f5186d830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107198)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110f000,_ctrlden=0x7f7f5110eee8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f506ae9a0,_xlast=0x7f7f506aeb20,_ylast=[0x7f7f5181e830,0x7f7f5181e830,
 0x7f7f5181e830],_y0=0x7f7f51806e30,_signus=0x7f7f506aeca0,_puppixoffset=[0,0],
 _nact=80,_def=0x10da38030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f506af330,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f5f0,xposition=0x7f7f5110eac0,yposition=
 0x7f7f5110fb30,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ec80,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       79.9   0.145      320.9
Field Avg  1.65                     79.9   0.145      320.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ca8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f511134f8,winddir=0x7f7f51113ad0,
 _layeralt=0x7f7f51112f20)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e28,lgs_prof_alt=0x7f7f51107080,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e6490,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52935ab0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f1c2030,_masks=0x0,_fluxpersub=0x7f7f533e7090,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e72e0,_skyfluxpersub=0x7f7f533e5a90,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00260127,0.0116687],_lastvalidtt=
 [-0.00260127,0.0116687],_upttcommand=[0,0],_refmes=0x7f7f50939a30,_tiprefv=
 0x7f7f52082830,_tiltrefv=0x7f7f5208ba30,_tiprefvn=0x7f7f5200f630,_tiltrefvn=
 0x7f7f52083030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52934b80,_jstart=0x7f7f53280fa0,_binindices=0x7f7f50a45830,
 _binxy=2,_centroidw=0x7f7f5110e938,_fimage=0x7f7f509c6a30,_fimage2=0x0,
 _imistart=0x7f7f53281930,_imjstart=0x7f7f53281b80,_imistart2=0x7f7f5327d0a0,
 _imjstart2=0x7f7f5327d2f0,_unittip=0x7f7f53187cc0,_unittilt=0x7f7f531022f0,
 _lgs_defocuses=0x7f7f51104a28,_unitdefocus=0x10d533030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509c4c30,_flat=0x7f7f509c5630,_domask=1,
 _submask=0x7f7f51262830,_kernel=0x7f7f5181a830,_kernels=0x10bf0a030,_kerfftr=
 0x10c25f030,_kerffti=0x10c092030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50948630,_x=0x7f7f50946830,_y=0x7f7f5093de30,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f509c6030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002138)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001d48,_ctrlden=0x7f7f51106f68,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f530efc20,_ylast=[0x7f7f51154030,0x7f7f51154030,
 0x7f7f51154030],_y0=0x7f7f51108830,_signus=0x7f7f533e57d0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e50a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f5f0,xposition=0x7f7f5110e708,yposition=
 0x7f7f5110ef58,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ec80,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      115.0   0.070      334.4
Field Avg  1.65                    115.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ca8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f511134f8,winddir=0x7f7f51113ad0,
 _layeralt=0x7f7f5100b450)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e28,lgs_prof_alt=0x7f7f51107080,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e5c50,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f531022f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f45b030,_masks=0x0,_fluxpersub=0x7f7f5327f030,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f532785e0,_skyfluxpersub=0x7f7f53278830,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.0860478,0.0257224],_lastvalidtt=
 [-0.0860478,0.0257224],_upttcommand=[0,0],_refmes=0x7f7f5119d830,_tiprefv=
 0x7f7f5127ba30,_tiltrefv=0x7f7f5127a830,_tiprefvn=0x7f7f51193430,_tiltrefvn=
 0x7f7f51194630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52935ab0,_jstart=0x7f7f52934b80,_binindices=0x7f7f509c6430,
 _binxy=2,_centroidw=0x7f7f5110ec10,_fimage=0x7f7f51262830,_fimage2=0x0,
 _imistart=0x7f7f532850a0,_imjstart=0x7f7f53287320,_imistart2=0x7f7f53287570,
 _imjstart2=0x7f7f5327ede0,_unittip=0x7f7f53187cc0,_unittilt=0x7f7f5327c320,
 _lgs_defocuses=0x7f7f5110fa50,_unitdefocus=0x10d937030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5095c830,_flat=0x7f7f509c3830,_domask=1,
 _submask=0x7f7f509d7230,_kernel=0x7f7f50948630,_kernels=0x10c02c030,_kerfftr=
 0x10bfc6030,_kerffti=0x10bf0a030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51193c30,_x=0x7f7f5093de30,_y=0x7f7f50944030,_centroidgain=1,_rayleigh=
 0x7f7f5110efc8,_bckgrdcalib=0x7f7f50a42030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107198)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fb30,_ctrlden=0x7f7f5110ecf0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f5300fb60,_ylast=[0x7f7f51108830,0x7f7f51108830,
 0x7f7f51108830],_y0=0x7f7f51263230,_signus=0x7f7f533e7a00,_puppixoffset=[0,0],
 _nact=80,_def=0x110e1e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f5f0,xposition=0x7f7f511055f8,yposition=
 0x7f7f52002058,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ec80,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.568      114.9
Field Avg  1.65                     55.4   0.568      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ca8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f511134f8,winddir=0x7f7f51113ad0,
 _layeralt=0x7f7f51112280)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e28,lgs_prof_alt=0x7f7f51107080,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f531022f0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506af130,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f55c030,_masks=0x0,_fluxpersub=0x7f7f506af820,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f506aea60,_skyfluxpersub=0x7f7f506aecb0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00967875,0.00607969],_lastvalidtt=
 [-0.00967875,0.00607969],_upttcommand=[0,0],_refmes=0x7f7f511ca230,_tiprefv=
 0x7f7f509d7230,_tiltrefv=0x7f7f5095c630,_tiprefvn=0x7f7f50948630,_tiltrefvn=
 0x7f7f50937630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506af380,_jstart=0x7f7f506af5d0,_binindices=0x7f7f51280430,
 _binxy=2,_centroidw=0x7f7f5110e9e0,_fimage=0x7f7f50937e30,_fimage2=0x0,
 _imistart=0x7f7f533e5970,_imjstart=0x7f7f533f0480,_imistart2=0x7f7f533f06d0,
 _imjstart2=0x7f7f533f0920,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f506aef00,
 _lgs_defocuses=0x7f7f5110e938,_unitdefocus=0x10cb1c030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5180c430,_flat=0x7f7f5180b030,_domask=1,
 _submask=0x7f7f51868030,_kernel=0x7f7f51297630,_kernels=0x10c092030,_kerfftr=
 0x10c25f030,_kerffti=0x10c02c030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50939030,_x=0x7f7f5180f830,_y=0x7f7f51819230,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f5186ce30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002138)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ef58,_ctrlden=0x7f7f51106fd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f532852f0,_xlast=0x7f7f532811d0,_ylast=[0x7f7f50a47430,0x7f7f50a47430,
 0x7f7f50a47430],_y0=0x7f7f508db030,_signus=0x7f7f52934b80,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f5f0,xposition=0x7f7f5110f000,yposition=
 0x7f7f52002330,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ec80,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.646      101.3
Field Avg  1.65                     54.4   0.646      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ca8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f511134f8,winddir=0x7f7f51113ad0,
 _layeralt=0x7f7f51113c68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e28,lgs_prof_alt=0x7f7f51107080,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ad440,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e4f60,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cf60030,_masks=0x0,_fluxpersub=0x7f7f533f0e20,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533ea670,_skyfluxpersub=0x7f7f533ea8c0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00372119,0.00209804],_lastvalidtt=
 [-0.00372119,0.00209804],_upttcommand=[0,0],_refmes=0x7f7f50927430,_tiprefv=
 0x7f7f5208ba30,_tiltrefv=0x7f7f5127ba30,_tiprefvn=0x7f7f52078a30,_tiltrefvn=
 0x7f7f511c7a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533f0980,_jstart=0x7f7f533f0bd0,_binindices=0x7f7f509c4a30,
 _binxy=2,_centroidw=0x7f7f5110f0e0,_fimage=0x7f7f509c5830,_fimage2=0x0,
 _imistart=0x7f7f53280fa0,_imjstart=0x7f7f532785e0,_imistart2=0x7f7f53280340,
 _imjstart2=0x7f7f532850a0,_unittip=0x7f7f531022f0,_unittilt=0x7f7f52935ab0,
 _lgs_defocuses=0x7f7f5110ec10,_unitdefocus=0x10c5ad030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51152630,_flat=0x7f7f50939030,_domask=1,
 _submask=0x7f7f5127ca30,_kernel=0x7f7f50a30830,_kernels=0x10bfc6030,_kerfftr=
 0x10bf0a030,_kerffti=0x10c092030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50948630,_x=0x7f7f51072c30,_y=0x7f7f51116830,_centroidgain=1,_rayleigh=
 0x7f7f5110efc8,_bckgrdcalib=0x7f7f50a31630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107198)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fa50,_ctrlden=0x7f7f5110ea18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f533df8a0,_ylast=[0x7f7f5119d830,0x7f7f5119d830,
 0x7f7f5119d830],_y0=0x7f7f51151a30,_signus=0x7f7f533e55a0,_puppixoffset=[0,0],
 _nact=80,_def=0x11043e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507acb70,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f5f0,xposition=0x7f7f52001d48,yposition=
 0x7f7f5110eee8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ec80,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       69.8   0.163      331.1
Field Avg  1.65                     69.8   0.163      331.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ca8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f511134f8,winddir=0x7f7f51113ad0,
 _layeralt=0x7f7f511133e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e28,lgs_prof_alt=0x7f7f51107080,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507accb0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f52934b80,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cd1e030,_masks=0x0,_fluxpersub=0x7f7f533e6f00,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e55a0,_skyfluxpersub=0x7f7f533e57f0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.0128666,-0.00880724],_lastvalidtt=
 [-0.0128666,-0.00880724],_upttcommand=[0,0],_refmes=0x7f7f5208cc30,_tiprefv=
 0x7f7f5127d230,_tiltrefv=0x7f7f5186e030,_tiprefvn=0x7f7f5127a830,_tiltrefvn=
 0x7f7f5186f030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53272310,_jstart=0x7f7f53271c80,_binindices=0x7f7f509c3230,
 _binxy=2,_centroidw=0x7f7f5110e708,_fimage=0x7f7f5118de30,_fimage2=0x0,
 _imistart=0x7f7f532785e0,_imjstart=0x7f7f53278830,_imistart2=0x7f7f5327d0a0,
 _imjstart2=0x7f7f5327d2f0,_unittip=0x7f7f53187cc0,_unittilt=0x7f7f531022f0,
 _lgs_defocuses=0x7f7f5110e9e0,_unitdefocus=0x10cc1d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5208ba30,_flat=0x7f7f52078a30,_domask=1,
 _submask=0x7f7f51280430,_kernel=0x7f7f50a32c30,_kernels=0x10c25f030,_kerfftr=
 0x10c02c030,_kerffti=0x10bfc6030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51293430,_x=0x7f7f509bf630,_y=0x7f7f50946830,_centroidgain=1,_rayleigh=
 0x7f7f520021e0,_bckgrdcalib=0x7f7f52079430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002138)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110f778,_ctrlden=0x7f7f5110fc10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53281e00,_xlast=0x7f7f532850a0,_ylast=[0x7f7f509d0c30,0x7f7f509d0c30,
 0x7f7f509d0c30],_y0=0x7f7f50927430,_signus=0x7f7f52935ab0,_puppixoffset=[0,0],
 _nact=80,_def=0x110e1e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f5f0,xposition=0x7f7f5110fb30,yposition=
 0x7f7f51106f68,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ec80,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      166.2   0.044      388.5
Field Avg  1.65                    166.2   0.044      388.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ca8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f511134f8,winddir=0x7f7f51113ad0,
 _layeralt=0x7f7f51111b10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001e28,lgs_prof_alt=0x7f7f51107080,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5326f090,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e5a90,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d937030,_masks=0x0,_fluxpersub=0x7f7f5327d0a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f52935ab0,_skyfluxpersub=0x7f7f52934b80,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[0.00557649,0.0124979],_lastvalidtt=
 [0.00557649,0.0124979],_upttcommand=[0,0],_refmes=0x7f7f51154030,_tiprefv=
 0x7f7f509c8430,_tiltrefv=0x7f7f50938030,_tiprefvn=0x7f7f50a33a30,_tiltrefvn=
 0x7f7f50a34c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e5ce0,_jstart=0x7f7f533e5f30,_binindices=0x7f7f50948630,
 _binxy=2,_centroidw=0x7f7f5110eac0,_fimage=0x7f7f50939030,_fimage2=0x0,
 _imistart=0x7f7f532723e0,_imjstart=0x7f7f53187cc0,_imistart2=0x7f7f532785e0,
 _imjstart2=0x7f7f531022f0,_unittip=0x7f7f533e6590,_unittilt=0x7f7f533e5860,
 _lgs_defocuses=0x7f7f5110f0e0,_unitdefocus=0x10c931030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50a33030,_flat=0x7f7f50a32630,_domask=1,
 _submask=0x7f7f509c4a30,_kernel=0x7f7f5118ce30,_kernels=0x10c092030,_kerfftr=
 0x10bf0a030,_kerffti=0x10c25f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50a34230,_x=0x7f7f5114ec30,_y=0x7f7f5119ec30,_centroidgain=1,_rayleigh=
 0x7f7f5110efc8,_bckgrdcalib=0x7f7f50a37c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107198)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002058,_ctrlden=0x7f7f5110ee40,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f530efc20,_xlast=0x7f7f533e4f60,_ylast=[0x7f7f51263230,0x7f7f51263230,
 0x7f7f51263230],_y0=0x7f7f5100fc30,_signus=0x7f7f533e55a0,_puppixoffset=[0,0],
 _nact=80,_def=0x11043e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f5f0,xposition=0x7f7f5110ef58,yposition=
 0x7f7f5110ecf0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110ec80,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ca8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113938,winddir=0x7f7f51111ec8,
 _layeralt=0x7f7f5100b450)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002288,lgs_prof_alt=0x7f7f5110f5f0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e7010,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506a0290,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c5ad030,_masks=0x0,_fluxpersub=0x7f7f528b28e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e4f60,_skyfluxpersub=0x7f7f533e51b0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0813821,0.028705],_lastvalidtt=
 [-0.0813821,0.028705],_upttcommand=[0,0],_refmes=0x7f7f509d0c30,_tiprefv=
 0x7f7f50939030,_tiltrefv=0x7f7f5186e030,_tiprefvn=0x7f7f50948630,_tiltrefvn=
 0x7f7f5180b030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506aefa0,_jstart=0x7f7f5069f0d0,_binindices=0x7f7f5188a630,
 _binxy=2,_centroidw=0x7f7f5110efc8,_fimage=0x7f7f5118e230,_fimage2=0x0,
 _imistart=0x7f7f506b0480,_imjstart=0x7f7f506ae7c0,_imistart2=0x7f7f506aea10,
 _imjstart2=0x7f7f506af1f0,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f506ae590,
 _lgs_defocuses=0x7f7f5110e9e0,_unitdefocus=0x10f85e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5118ce30,_flat=0x7f7f5127b230,_domask=1,
 _submask=0x7f7f51280430,_kernel=0x7f7f509c6430,_kernels=0x10c183030,_kerfftr=
 0x10c02c030,_kerffti=0x10c092030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51191630,_x=0x7f7f51869830,_y=0x7f7f5186b630,_centroidgain=1,_rayleigh=
 0x7f7f5110f038,_bckgrdcalib=0x7f7f5118d830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f8c8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fbd8,_ctrlden=0x7f7f5110ef90,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f52922690,_ylast=[0x7f7f509d5e30,0x7f7f509d5e30,
 0x7f7f509d5e30],_y0=0x7f7f508dde30,_signus=0x7f7f52935ab0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fb30,xposition=0x7f7f520021e0,yposition=
 0x7f7f51104b78,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001e28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ca8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113938,winddir=0x7f7f51111ec8,
 _layeralt=0x7f7f511125b0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002288,lgs_prof_alt=0x7f7f5110f5f0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f528b1560,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507ad640,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cb1c030,_masks=0x0,_fluxpersub=0x7f7f507add30,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f506ae6f0,_skyfluxpersub=0x7f7f506ae940,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00743236,0.00540108],_lastvalidtt=
 [-0.00743236,0.00540108],_upttcommand=[0,0],_refmes=0x7f7f50938430,_tiprefv=
 0x7f7f5127d230,_tiltrefv=0x7f7f5127ca30,_tiprefvn=0x7f7f51280430,_tiltrefvn=
 0x7f7f51191630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ad890,_jstart=0x7f7f507adae0,_binindices=0x7f7f52079030,
 _binxy=2,_centroidw=0x7f7f5110ee78,_fimage=0x7f7f5127b830,_fimage2=0x0,
 _imistart=0x7f7f52935ab0,_imjstart=0x7f7f53271910,_imistart2=0x7f7f532785e0,
 _imjstart2=0x7f7f53272370,_unittip=0x7f7f507ad1e0,_unittilt=0x7f7f507ad410,
 _lgs_defocuses=0x7f7f520020c8,_unitdefocus=0x10f2c3030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51868030,_flat=0x7f7f51815830,_domask=1,
 _submask=0x7f7f5208b030,_kernel=0x7f7f50a2fe30,_kernels=0x10bfc6030,_kerfftr=
 0x10bf15030,_kerffti=0x10c183030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51152630,_x=0x7f7f52011030,_y=0x7f7f52089430,_centroidgain=1,_rayleigh=
 0x7f7f51107198,_bckgrdcalib=0x7f7f5186ce30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107080)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fe40,_ctrlden=0x7f7f5110f778,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f506a2f10,_xlast=0x7f7f506a0290,_ylast=[0x7f7f51881c30,0x7f7f51881c30,
 0x7f7f51881c30],_y0=0x7f7f51806e30,_signus=0x7f7f5069f0d0,_puppixoffset=[0,0],
 _nact=80,_def=0x110e1e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f53271210,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fb30,xposition=0x7f7f5110fb68,yposition=
 0x7f7f51106fd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001e28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ca8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113938,winddir=0x7f7f51111ec8,
 _layeralt=0x7f7f51112390)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002288,lgs_prof_alt=0x7f7f5110f5f0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506afb40,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f531022f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ce1f030,_masks=0x0,_fluxpersub=0x7f7f53271c80,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f532785e0,_skyfluxpersub=0x7f7f52935ab0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00341943,0.000420866],_lastvalidtt=
 [-0.00341943,0.000420866],_upttcommand=[0,0],_refmes=0x7f7f5100fc30,_tiprefv=
 0x7f7f5186d630,_tiltrefv=0x7f7f50938030,_tiprefvn=0x7f7f5186de30,_tiltrefvn=
 0x7f7f509cb030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52934b80,_jstart=0x7f7f53278830,_binindices=0x7f7f51193030,
 _binxy=2,_centroidw=0x7f7f5110f708,_fimage=0x7f7f50948630,_fimage2=0x0,
 _imistart=0x7f7f528b28e0,_imjstart=0x7f7f533e5400,_imistart2=0x7f7f533e5650,
 _imjstart2=0x7f7f533e58a0,_unittip=0x7f7f52922690,_unittilt=0x7f7f53187cc0,
 _lgs_defocuses=0x7f7f5110efc8,_unitdefocus=0x10d332030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51293e30,_flat=0x7f7f51294830,_domask=1,
 _submask=0x7f7f50939030,_kernel=0x7f7f51295830,_kernels=0x10c183030,_kerfftr=
 0x10c02c030,_kerffti=0x10bfc6030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50926030,_x=0x7f7f509c8630,_y=0x7f7f5093de30,_centroidgain=1,_rayleigh=
 0x7f7f5110f038,_bckgrdcalib=0x7f7f51296630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f8c8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110f070,_ctrlden=0x7f7f5110ea18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53271ed0,_xlast=0x7f7f53287650,_ylast=[0x7f7f509d0c30,0x7f7f509d0c30,
 0x7f7f509d0c30],_y0=0x7f7f509cb830,_signus=0x7f7f53280340,_puppixoffset=[0,0],
 _nact=80,_def=0x11003d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fb30,xposition=0x7f7f52001ca0,yposition=
 0x7f7f5110fc10,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001e28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       78.0   0.150      324.3
Field Avg  1.65                     78.0   0.150      324.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ca8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113938,winddir=0x7f7f51111ec8,
 _layeralt=0x7f7f51113690)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002288,lgs_prof_alt=0x7f7f5110f5f0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f531022f0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5069f0d0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d735030,_masks=0x0,_fluxpersub=0x7f7f533e4f60,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e51b0,_skyfluxpersub=0x7f7f533e5400,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0233996,0.00793642],_lastvalidtt=
 [-0.0233996,0.00793642],_upttcommand=[0,0],_refmes=0x7f7f52016030,_tiprefv=
 0x7f7f509d3230,_tiltrefv=0x7f7f51868830,_tiprefvn=0x7f7f509d3a30,_tiltrefvn=
 0x7f7f5180ba30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506ae590,_jstart=0x7f7f506aefa0,_binindices=0x7f7f5207a430,
 _binxy=2,_centroidw=0x7f7f52002218,_fimage=0x7f7f50926030,_fimage2=0x0,
 _imistart=0x7f7f507ad940,_imjstart=0x7f7f507adb90,_imistart2=0x7f7f507adde0,
 _imjstart2=0x7f7f507ae030,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f506a0290,
 _lgs_defocuses=0x7f7f5110ee78,_unitdefocus=0x10f1c2030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51191630,_flat=0x7f7f5127ca30,_domask=1,
 _submask=0x7f7f51262830,_kernel=0x7f7f5118ce30,_kernels=0x10bfc6030,_kerfftr=
 0x10c092030,_kerffti=0x10c183030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509cb030,_x=0x7f7f51819230,_y=0x7f7f51820c30,_centroidgain=1,_rayleigh=
 0x7f7f51107198,_bckgrdcalib=0x7f7f51193030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107080)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110eba0,_ctrlden=0x7f7f5110eac0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f507acd20,_xlast=0x7f7f507ac1c0,_ylast=[0x7f7f5208cc30,0x7f7f5208cc30,
 0x7f7f5208cc30],_y0=0x7f7f52012430,_signus=0x7f7f507ad1e0,_puppixoffset=[0,0],
 _nact=80,_def=0x110e1e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f53280fa0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fb30,xposition=0x7f7f5110fbd8,yposition=
 0x7f7f5110ee40,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001e28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      118.0   0.070      334.4
Field Avg  1.65                    118.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ca8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113938,winddir=0x7f7f51111ec8,
 _layeralt=0x7f7f51112bf0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002288,lgs_prof_alt=0x7f7f5110f5f0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53271c80,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533ef830,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f85e030,_masks=0x0,_fluxpersub=0x7f7f533f0590,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533f07e0,_skyfluxpersub=0x7f7f533f0a30,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.0823836,0.0306464],_lastvalidtt=
 [-0.0823836,0.0306464],_upttcommand=[0,0],_refmes=0x7f7f50941c30,_tiprefv=
 0x7f7f52080430,_tiltrefv=0x7f7f50948630,_tiprefvn=0x7f7f52081830,_tiltrefvn=
 0x7f7f509d3230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533f00f0,_jstart=0x7f7f533f0340,_binindices=0x7f7f50939030,
 _binxy=2,_centroidw=0x7f7f52001f40,_fimage=0x7f7f509d3a30,_fimage2=0x0,
 _imistart=0x7f7f531022f0,_imjstart=0x7f7f532875e0,_imistart2=0x7f7f52934b80,
 _imjstart2=0x7f7f53280340,_unittip=0x7f7f533ef3d0,_unittilt=0x7f7f533ef600,
 _lgs_defocuses=0x7f7f5110f708,_unitdefocus=0x10cc1d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5127ca30,_flat=0x7f7f51152630,_domask=1,
 _submask=0x7f7f51262830,_kernel=0x7f7f509c7c30,_kernels=0x10c183030,_kerfftr=
 0x10c02c030,_kerffti=0x10bfc6030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50926030,_x=0x7f7f5129aa30,_y=0x7f7f5117c230,_centroidgain=1,_rayleigh=
 0x7f7f5110f038,_bckgrdcalib=0x7f7f5127a830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f8c8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002058,_ctrlden=0x7f7f51104b78,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f530efc20,_ylast=[0x7f7f51151a30,0x7f7f51151a30,
 0x7f7f51151a30],_y0=0x7f7f5100fc30,_signus=0x7f7f528b1560,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507ae4e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fb30,xposition=0x7f7f5110fe40,yposition=
 0x7f7f52001ed0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001e28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.566      114.9
Field Avg  1.65                     55.4   0.566      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ca8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113938,winddir=0x7f7f51111ec8,
 _layeralt=0x7f7f51113f98)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002288,lgs_prof_alt=0x7f7f5110f5f0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53276570,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53271130,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f45b030,_masks=0x0,_fluxpersub=0x7f7f528b28e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e6540,_skyfluxpersub=0x7f7f533e6790,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.006917,0.00773077],_lastvalidtt=
 [-0.006917,0.00773077],_upttcommand=[0,0],_refmes=0x7f7f51263230,_tiprefv=
 0x7f7f51299830,_tiltrefv=0x7f7f509c4a30,_tiprefvn=0x7f7f5127a830,_tiltrefvn=
 0x7f7f50948630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53187cc0,_jstart=0x7f7f52935ab0,_binindices=0x7f7f50a31830,
 _binxy=2,_centroidw=0x7f7f5110f0e0,_fimage=0x7f7f50926030,_fimage2=0x0,
 _imistart=0x7f7f53276b90,_imjstart=0x7f7f532767c0,_imistart2=0x7f7f531022f0,
 _imjstart2=0x7f7f532875e0,_unittip=0x7f7f528b1560,_unittilt=0x7f7f533e6310,
 _lgs_defocuses=0x7f7f52002218,_unitdefocus=0x110d1d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51193630,_flat=0x7f7f509cb030,_domask=1,
 _submask=0x7f7f5127ca30,_kernel=0x7f7f50a33030,_kernels=0x10bfc6030,_kerfftr=
 0x10bf15030,_kerffti=0x10c183030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50a32630,_x=0x7f7f50921830,_y=0x7f7f509d3230,_centroidgain=1,_rayleigh=
 0x7f7f51107198,_bckgrdcalib=0x7f7f50a44030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107080)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110efc8,_ctrlden=0x7f7f51110118,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53102070,_ylast=[0x7f7f5095ce30,0x7f7f5095ce30,
 0x7f7f5095ce30],_y0=0x7f7f50941c30,_signus=0x7f7f53287320,_puppixoffset=[0,0],
 _nact=80,_def=0x110e1e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fb30,xposition=0x7f7f5110f070,yposition=
 0x7f7f5110f778,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001e28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.644      101.3
Field Avg  1.65                     54.4   0.644      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ca8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113938,winddir=0x7f7f51111ec8,
 _layeralt=0x7f7f51112308)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002288,lgs_prof_alt=0x7f7f5110f5f0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f531022f0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e7a10,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f55c030,_masks=0x0,_fluxpersub=0x7f7f528b1560,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e6e80,_skyfluxpersub=0x7f7f528b28e0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00317775,0.00130838],_lastvalidtt=
 [-0.00317775,0.00130838],_upttcommand=[0,0],_refmes=0x7f7f51263230,_tiprefv=
 0x7f7f5127ba30,_tiltrefv=0x7f7f5186ce30,_tiprefvn=0x7f7f51299830,_tiltrefvn=
 0x7f7f5186d630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e5fb0,_jstart=0x7f7f533e53f0,_binindices=0x7f7f50a2fe30,
 _binxy=2,_centroidw=0x7f7f5110ef58,_fimage=0x7f7f51298230,_fimage2=0x0,
 _imistart=0x7f7f53287320,_imjstart=0x7f7f53280fa0,_imistart2=0x7f7f532850a0,
 _imjstart2=0x7f7f53280340,_unittip=0x7f7f533e4f60,_unittilt=0x7f7f533e5d80,
 _lgs_defocuses=0x7f7f52001f40,_unitdefocus=0x10d132030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5118dc30,_flat=0x7f7f51152630,_domask=1,
 _submask=0x7f7f5118ce30,_kernel=0x7f7f50a36430,_kernels=0x10c183030,_kerfftr=
 0x10c02c030,_kerffti=0x10bfc6030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51298c30,_x=0x7f7f5127d430,_y=0x7f7f5129aa30,_centroidgain=1,_rayleigh=
 0x7f7f5110f038,_bckgrdcalib=0x7f7f51192030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f8c8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110eb68,_ctrlden=0x7f7f52001ed0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52922690,_xlast=0x7f7f52935790,_ylast=[0x7f7f50941c30,0x7f7f50941c30,
 0x7f7f50941c30],_y0=0x7f7f509d5e30,_signus=0x7f7f532875e0,_puppixoffset=[0,0],
 _nact=80,_def=0x11003d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f532811f0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fb30,xposition=0x7f7f5110eba0,yposition=
 0x7f7f5110ea18,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001e28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       71.4   0.156      331.1
Field Avg  1.65                     71.4   0.156      331.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ca8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113938,winddir=0x7f7f51111ec8,
 _layeralt=0x7f7f51112838)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002288,lgs_prof_alt=0x7f7f5110f5f0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5327b090,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e6290,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cf60030,_masks=0x0,_fluxpersub=0x7f7f506a0290,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5069f0d0,_skyfluxpersub=0x7f7f506ae590,
 _nphotons=221.659,_skynphotons=0,_tt=[0.0141202,-0.00296909],_lastvalidtt=
 [0.0141202,-0.00296909],_upttcommand=[0,0],_refmes=0x7f7f509d0c30,_tiprefv=
 0x7f7f51280430,_tiltrefv=0x7f7f5207ea30,_tiprefvn=0x7f7f5127ba30,_tiltrefvn=
 0x7f7f5207f230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e64e0,_jstart=0x7f7f533e5610,_binindices=0x7f7f5207fa30,
 _binxy=2,_centroidw=0x7f7f5110ffc8,_fimage=0x7f7f509cb030,_fimage2=0x0,
 _imistart=0x7f7f52935ab0,_imjstart=0x7f7f52934b80,_imistart2=0x7f7f53276570,
 _imjstart2=0x7f7f53280fa0,_unittip=0x7f7f533e6060,_unittilt=0x7f7f533e5190,
 _lgs_defocuses=0x7f7f5110f0e0,_unitdefocus=0x10d332030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51883c30,_flat=0x7f7f51883230,_domask=1,
 _submask=0x7f7f51815830,_kernel=0x7f7f5127ca30,_kernels=0x10bfc6030,_kerfftr=
 0x10bf15030,_kerffti=0x10c183030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50948630,_x=0x7f7f5114ec30,_y=0x7f7f5129aa30,_centroidgain=1,_rayleigh=
 0x7f7f51107198,_bckgrdcalib=0x7f7f51884630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107080)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002448,_ctrlden=0x7f7f51104e18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f530efc20,_ylast=[0x7f7f5119d830,0x7f7f5119d830,
 0x7f7f5119d830],_y0=0x7f7f51263230,_signus=0x7f7f533e5da0,_puppixoffset=[0,0],
 _nact=80,_def=0x110e1e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e4f60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fb30,xposition=0x7f7f52002058,yposition=
 0x7f7f5110eac0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001e28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      154.6   0.047      388.5
Field Avg  1.65                    154.6   0.047      388.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ca8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113938,winddir=0x7f7f51111ec8,
 _layeralt=0x7f7f51112d88)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002288,lgs_prof_alt=0x7f7f5110f5f0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53282bb0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e5f80,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cd1e030,_masks=0x0,_fluxpersub=0x7f7f52934b80,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53280fa0,_skyfluxpersub=0x7f7f52935ab0,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[0.0123657,-0.0122971],_lastvalidtt=
 [0.0123657,-0.0122971],_upttcommand=[0,0],_refmes=0x7f7f51108830,_tiprefv=
 0x7f7f51193830,_tiltrefv=0x7f7f5127b230,_tiprefvn=0x7f7f51280430,_tiltrefvn=
 0x7f7f51192030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e50e0,_jstart=0x7f7f533e61d0,_binindices=0x7f7f51262830,
 _binxy=2,_centroidw=0x7f7f5110eeb0,_fimage=0x7f7f509c5a30,_fimage2=0x0,
 _imistart=0x7f7f533e57b0,_imjstart=0x7f7f533e6730,_imistart2=0x7f7f533e6980,
 _imjstart2=0x7f7f533e6bd0,_unittip=0x7f7f533e5d50,_unittilt=0x7f7f533e5330,
 _lgs_defocuses=0x7f7f5110ef58,_unitdefocus=0x10f1c2030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509c7c30,_flat=0x7f7f509d3a30,_domask=1,
 _submask=0x7f7f50948630,_kernel=0x7f7f50a2fe30,_kernels=0x10c183030,_kerfftr=
 0x10c02c030,_kerffti=0x10bfc6030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50926030,_x=0x7f7f51116830,_y=0x7f7f51072c30,_centroidgain=1,_rayleigh=
 0x7f7f5110f038,_bckgrdcalib=0x7f7f50937630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f8c8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001f40,_ctrlden=0x7f7f5110fe40,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52922690,_xlast=0x7f7f53187cc0,_ylast=[0x7f7f50941c30,0x7f7f50941c30,
 0x7f7f50941c30],_y0=0x7f7f509d0c30,_signus=0x7f7f5327f110,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f53280590,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fb30,xposition=0x7f7f5110efc8,yposition=
 0x7f7f51104b78,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001e28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      187.8   0.017      682.4
Field Avg  1.65                    187.8   0.017      682.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ca8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113938,winddir=0x7f7f51111ec8,
 _layeralt=0x7f7f51111f50)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002288,lgs_prof_alt=0x7f7f5110f5f0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5327d480,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533efbd0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d937030,_masks=0x0,_fluxpersub=0x7f7f5327f030,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53282df0,_skyfluxpersub=0x7f7f52934b80,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.024977,-0.0499592],_lastvalidtt=
 [-0.024977,-0.0499592],_upttcommand=[0,0],_refmes=0x7f7f51108830,_tiprefv=
 0x7f7f50926030,_tiltrefv=0x7f7f509c5830,_tiprefvn=0x7f7f50a32630,_tiltrefvn=
 0x7f7f509cb030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533efe20,_jstart=0x7f7f533e5be0,_binindices=0x7f7f50a31630,
 _binxy=2,_centroidw=0x7f7f5110e970,_fimage=0x7f7f50a36a30,_fimage2=0x0,
 _imistart=0x7f7f531022f0,_imjstart=0x7f7f52935ab0,_imistart2=0x7f7f532850a0,
 _imjstart2=0x7f7f5327ede0,_unittip=0x7f7f528b1560,_unittilt=0x7f7f533ef9a0,
 _lgs_defocuses=0x7f7f5110ffc8,_unitdefocus=0x10cc1d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50a37c30,_flat=0x7f7f50a36030,_domask=1,
 _submask=0x7f7f509c4a30,_kernel=0x7f7f50a3b030,_kernels=0x10bfc6030,_kerfftr=
 0x10c092030,_kerffti=0x10c183030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50937630,_x=0x7f7f51072c30,_y=0x7f7f5119ec30,_centroidgain=1,_rayleigh=
 0x7f7f51107198,_bckgrdcalib=0x7f7f50a38630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107080)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f520021e0,_ctrlden=0x7f7f520023d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f5300fb60,_ylast=[0x7f7f5100fc30,0x7f7f5100fc30,
 0x7f7f5100fc30],_y0=0x7f7f51263230,_signus=0x7f7f533e5220,_puppixoffset=[0,0],
 _nact=80,_def=0x110e1e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507acb70,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fb30,xposition=0x7f7f5110eb68,yposition=
 0x7f7f5110ef90,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001e28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      375.0   0.002     2347.8
Field Avg  1.65                    375.0   0.002     2347.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ca8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113938,winddir=0x7f7f51111ec8,
 _layeralt=0x7f7f51112a58)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002288,lgs_prof_alt=0x7f7f5110f5f0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53273f30,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53187cc0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c931030,_masks=0x0,_fluxpersub=0x7f7f53277030,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5327ede0,_skyfluxpersub=0x7f7f532850a0,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.0151375,0.00613517],_lastvalidtt=
 [-0.0151375,0.00613517],_upttcommand=[0,0],_refmes=0x7f7f5208cc30,_tiprefv=
 0x7f7f51193430,_tiltrefv=0x7f7f5127ba30,_tiprefvn=0x7f7f5118ce30,_tiltrefvn=
 0x7f7f5118d630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f531022f0,_jstart=0x7f7f5327f030,_binindices=0x7f7f50948630,
 _binxy=2,_centroidw=0x7f7f5110e5b8,_fimage=0x7f7f509d3a30,_fimage2=0x0,
 _imistart=0x7f7f53270ee0,_imjstart=0x7f7f53271130,_imistart2=0x7f7f53276b90,
 _imjstart2=0x7f7f53276de0,_unittip=0x7f7f52922690,_unittilt=0x7f7f53287650,
 _lgs_defocuses=0x7f7f5110eeb0,_unitdefocus=0x110d1d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509c7c30,_flat=0x7f7f50926030,_domask=1,
 _submask=0x7f7f50939030,_kernel=0x7f7f50a36430,_kernels=0x10c183030,_kerfftr=
 0x10bf15030,_kerffti=0x10bfc6030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50937630,_x=0x7f7f50944030,_y=0x7f7f5093de30,_centroidgain=1,_rayleigh=
 0x7f7f5110f038,_bckgrdcalib=0x7f7f509cb030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f8c8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002218,_ctrlden=0x7f7f520020c8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f532768a0,_ylast=[0x7f7f50941c30,0x7f7f50941c30,
 0x7f7f50941c30],_y0=0x7f7f509d0c30,_signus=0x7f7f52934b80,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507accf0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fb30,xposition=0x7f7f52002448,yposition=
 0x7f7f51110118,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001e28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      932.3   0.001     3455.8
Field Avg  1.65                    932.3   0.001     3455.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ca8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51113938,winddir=0x7f7f51111ec8,
 _layeralt=0x7f7f51111fd8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002288,lgs_prof_alt=0x7f7f5110f5f0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e7bc0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528b28e0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c5ad030,_masks=0x0,_fluxpersub=0x7f7f53187cc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f531022f0,_skyfluxpersub=0x7f7f52934b80,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[-0.00118692,-0.02634],_lastvalidtt=
 [-0.00118692,-0.02634],_upttcommand=[0,0],_refmes=0x7f7f51192030,_tiprefv=
 0x7f7f51280430,_tiltrefv=0x7f7f50926030,_tiprefvn=0x7f7f51193430,_tiltrefvn=
 0x7f7f50939030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e4f60,_jstart=0x7f7f533e51b0,_binindices=0x7f7f52078a30,
 _binxy=2,_centroidw=0x7f7f5110fba0,_fimage=0x7f7f51191630,_fimage2=0x0,
 _imistart=0x7f7f507ae160,_imjstart=0x7f7f507ae3b0,_imistart2=0x7f7f507ae600,
 _imjstart2=0x7f7f507ae850,_unittip=0x7f7f533e5af0,_unittilt=0x7f7f528b1560,
 _lgs_defocuses=0x7f7f5110e970,_unitdefocus=0x10d132030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509cb030,_flat=0x7f7f50937630,_domask=1,
 _submask=0x7f7f50948630,_kernel=0x7f7f5127ca30,_kernels=0x10bfc6030,_kerfftr=
 0x10c02c030,_kerffti=0x10c183030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51262830,_x=0x7f7f5129aa30,_y=0x7f7f51072c30,_centroidgain=1,_rayleigh=
 0x7f7f51107198,_bckgrdcalib=0x7f7f50a2fe30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107080)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51110070,_ctrlden=0x7f7f5110f970,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53102070,_xlast=0x7f7f52935790,_ylast=[0x7f7f509d0c30,0x7f7f509d0c30,
 0x7f7f509d0c30],_y0=0x7f7f509d5e30,_signus=0x7f7f52935ab0,_puppixoffset=[0,0],
 _nact=80,_def=0x110e1e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f53276940,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110fb30,xposition=0x7f7f52001f40,yposition=
 0x7f7f52001ed0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001e28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51113ad0,winddir=0x7f7f511134f8,
 _layeralt=0x7f7f51113608)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ed0,lgs_prof_alt=0x7f7f5110fb30,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5327bc60,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e62d0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cb1c030,_masks=0x0,_fluxpersub=0x7f7f533e5400,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e5650,_skyfluxpersub=0x7f7f533e5a10,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0823407,0.0292221],_lastvalidtt=
 [-0.0823407,0.0292221],_upttcommand=[0,0],_refmes=0x7f7f5186e230,_tiprefv=
 0x7f7f50a32830,_tiltrefv=0x7f7f5208b030,_tiprefvn=0x7f7f50a33c30,_tiltrefvn=
 0x7f7f5208b830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e4f60,_jstart=0x7f7f533e51b0,_binindices=0x7f7f50a36030,
 _binxy=2,_centroidw=0x7f7f5110f038,_fimage=0x7f7f50a55830,_fimage2=0x0,
 _imistart=0x7f7f52934b80,_imjstart=0x7f7f53271470,_imistart2=0x7f7f53276570,
 _imjstart2=0x7f7f532767c0,_unittip=0x7f7f533e7e10,_unittilt=0x7f7f533e60a0,
 _lgs_defocuses=0x7f7f5110f000,_unitdefocus=0x10d332030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51262830,_flat=0x7f7f51152630,_domask=1,
 _submask=0x7f7f51191630,_kernel=0x7f7f52078a30,_kernels=0x10c25f030,_kerfftr=
 0x10c02c030,_kerffti=0x10c183030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50937630,_x=0x7f7f5129aa30,_y=0x7f7f5117c230,_centroidgain=1,_rayleigh=
 0x7f7f52002058,_bckgrdcalib=0x7f7f51192c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104980)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ef90,_ctrlden=0x7f7f5110fa50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f530efc20,_xlast=0x7f7f533e5c60,_ylast=[0x7f7f51154030,0x7f7f51154030,
 0x7f7f51154030],_y0=0x7f7f51193c30,_signus=0x7f7f533e5de0,_puppixoffset=[0,0],
 _nact=80,_def=0x10dc39030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f532805a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f970,xposition=0x7f7f51107198,yposition=
 0x7f7f5110ec80,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002288,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51113ad0,winddir=0x7f7f511134f8,
 _layeralt=0x7f7f51112948)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ed0,lgs_prof_alt=0x7f7f5110fb30,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506affe0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f531022f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ce1f030,_masks=0x0,_fluxpersub=0x7f7f53274190,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f532743e0,_skyfluxpersub=0x7f7f53280fa0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00761668,0.00529781],_lastvalidtt=
 [-0.00761668,0.00529781],_upttcommand=[0,0],_refmes=0x7f7f51263230,_tiprefv=
 0x7f7f51884430,_tiltrefv=0x7f7f50926030,_tiprefvn=0x7f7f51884c30,_tiltrefvn=
 0x7f7f509cb030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f52935ab0,_jstart=0x7f7f52934b80,_binindices=0x7f7f509c5430,
 _binxy=2,_centroidw=0x7f7f5110f070,_fimage=0x7f7f509d3a30,_fimage2=0x0,
 _imistart=0x7f7f53287320,_imjstart=0x7f7f53287570,_imistart2=0x7f7f53273cf0,
 _imjstart2=0x7f7f53273f40,_unittip=0x7f7f53280340,_unittilt=0x7f7f53187cc0,
 _lgs_defocuses=0x7f7f5110f8c8,_unitdefocus=0x10f1c2030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50a49a30,_flat=0x7f7f51191630,_domask=1,
 _submask=0x7f7f50948630,_kernel=0x7f7f50a36230,_kernels=0x10bf15030,_kerfftr=
 0x10bfc6030,_kerffti=0x10c25f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509c4a30,_x=0x7f7f50a30830,_y=0x7f7f50944030,_centroidgain=1,_rayleigh=
 0x7f7f52001d48,_bckgrdcalib=0x7f7f51262830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f5f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f520029f8,_ctrlden=0x7f7f5110ee40,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f528afd30,_ylast=[0x7f7f51193c30,0x7f7f51193c30,
 0x7f7f51193c30],_y0=0x7f7f5119d830,_signus=0x7f7f533e7040,_puppixoffset=[0,0],
 _nact=80,_def=0x110e1e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f532811f0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f970,xposition=0x7f7f5110e708,yposition=
 0x7f7f520023d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002288,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.658       98.0
Field Avg  1.65                     54.3   0.658       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51113ad0,winddir=0x7f7f511134f8,
 _layeralt=0x7f7f51111b10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ed0,lgs_prof_alt=0x7f7f5110fb30,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f532850a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e53c0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d132030,_masks=0x0,_fluxpersub=0x7f7f53187cc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f531022f0,_skyfluxpersub=0x7f7f52935ab0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00404317,-0.000616345],_lastvalidtt=
 [-0.00404317,-0.000616345],_upttcommand=[0,0],_refmes=0x7f7f5186e230,_tiprefv=
 0x7f7f509c4a30,_tiltrefv=0x7f7f50a45e30,_tiprefvn=0x7f7f509c5230,_tiltrefvn=
 0x7f7f50926030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e5610,_jstart=0x7f7f533e5860,_binindices=0x7f7f51262830,
 _binxy=2,_centroidw=0x7f7f51106fd8,_fimage=0x7f7f51152630,_fimage2=0x0,
 _imistart=0x7f7f533e61c0,_imjstart=0x7f7f533e6410,_imistart2=0x7f7f533e6660,
 _imjstart2=0x7f7f533e68b0,_unittip=0x7f7f533e5190,_unittilt=0x7f7f533e4f60,
 _lgs_defocuses=0x7f7f5110f038,_unitdefocus=0x10cc1d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509c7c30,_flat=0x7f7f509d3a30,_domask=1,
 _submask=0x7f7f509c3230,_kernel=0x7f7f51883c30,_kernels=0x10c183030,_kerfftr=
 0x10c02c030,_kerffti=0x10bf15030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5127a830,_x=0x7f7f5117c230,_y=0x7f7f5129aa30,_centroidgain=1,_rayleigh=
 0x7f7f52002058,_bckgrdcalib=0x7f7f50a48030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104980)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ef58,_ctrlden=0x7f7f51104b78,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533df8a0,_xlast=0x7f7f5300fb60,_ylast=[0x7f7f5119d830,0x7f7f5119d830,
 0x7f7f5119d830],_y0=0x7f7f51108830,_signus=0x7f7f533e7630,_puppixoffset=[0,0],
 _nact=80,_def=0x11003d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f970,xposition=0x7f7f5110f708,yposition=
 0x7f7f520020c8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002288,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       81.0   0.137      320.9
Field Avg  1.65                     81.0   0.137      320.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51113ad0,winddir=0x7f7f511134f8,
 _layeralt=0x7f7f51113be0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ed0,lgs_prof_alt=0x7f7f5110fb30,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53281d10,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507ad1e0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f85e030,_masks=0x0,_fluxpersub=0x7f7f533e5f40,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e4f60,_skyfluxpersub=0x7f7f533e6190,
 _nphotons=3513.05,_skynphotons=0,_tt=[0.0142393,-0.0291447],_lastvalidtt=
 [0.0142393,-0.0291447],_upttcommand=[0,0],_refmes=0x7f7f51154030,_tiprefv=
 0x7f7f511d1830,_tiltrefv=0x7f7f50939030,_tiprefvn=0x7f7f511d2030,_tiltrefvn=
 0x7f7f50a45e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ad430,_jstart=0x7f7f507adfc0,_binindices=0x7f7f50948630,
 _binxy=2,_centroidw=0x7f7f5110fc10,_fimage=0x7f7f50937630,_fimage2=0x0,
 _imistart=0x7f7f52934b80,_imjstart=0x7f7f53280fa0,_imistart2=0x7f7f532850a0,
 _imjstart2=0x7f7f53280340,_unittip=0x7f7f507accd0,_unittilt=0x7f7f507ac1c0,
 _lgs_defocuses=0x7f7f5110f070,_unitdefocus=0x110d1d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f509c3230,_flat=0x7f7f50a33030,_domask=1,
 _submask=0x7f7f51262830,_kernel=0x7f7f509c7c30,_kernels=0x10bfc6030,_kerfftr=
 0x10c25f030,_kerffti=0x10c183030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509cb030,_x=0x7f7f52002c30,_y=0x7f7f5208b030,_centroidgain=1,_rayleigh=
 0x7f7f52001d48,_bckgrdcalib=0x7f7f50a33a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f5f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110eba0,_ctrlden=0x7f7f5110e5b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528b2a60,_xlast=0x7f7f533df8a0,_ylast=[0x7f7f51108830,0x7f7f51108830,
 0x7f7f51108830],_y0=0x7f7f5111d030,_signus=0x7f7f533e6400,_puppixoffset=[0,0],
 _nact=80,_def=0x110e1e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f506a2f10,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f970,xposition=0x7f7f5110ef90,yposition=
 0x7f7f5110ebd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002288,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.071      334.4
Field Avg  1.65                    117.0   0.071      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51113ad0,winddir=0x7f7f511134f8,
 _layeralt=0x7f7f51113140)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ed0,lgs_prof_alt=0x7f7f5110fb30,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ae680,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e5d00,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f45b030,_masks=0x0,_fluxpersub=0x7f7f532850a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53280fa0,_skyfluxpersub=0x7f7f53276b90,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.084837,0.0304886],_lastvalidtt=
 [-0.084837,0.0304886],_upttcommand=[0,0],_refmes=0x7f7f5208cc30,_tiprefv=
 0x7f7f509cb030,_tiltrefv=0x7f7f50a33a30,_tiprefvn=0x7f7f50948630,_tiltrefvn=
 0x7f7f50939030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e53e0,_jstart=0x7f7f533e5630,_binindices=0x7f7f50a45c30,
 _binxy=2,_centroidw=0x7f7f52001f40,_fimage=0x7f7f52084030,_fimage2=0x0,
 _imistart=0x7f7f532741b0,_imjstart=0x7f7f53274400,_imistart2=0x7f7f53274650,
 _imjstart2=0x7f7f52934b80,_unittip=0x7f7f528b28e0,_unittilt=0x7f7f533e51b0,
 _lgs_defocuses=0x7f7f51106fd8,_unitdefocus=0x10f55c030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50a43630,_flat=0x7f7f50937630,_domask=1,
 _submask=0x7f7f50a44e30,_kernel=0x7f7f51192030,_kernels=0x10c02c030,_kerfftr=
 0x10bf15030,_kerffti=0x10bfc6030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5208b030,_x=0x7f7f5114ec30,_y=0x7f7f5119ec30,_centroidgain=1,_rayleigh=
 0x7f7f52002058,_bckgrdcalib=0x7f7f50a44030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104980)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51110118,_ctrlden=0x7f7f5110f0e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53287650,_xlast=0x7f7f52935790,_ylast=[0x7f7f509cb830,0x7f7f509cb830,
 0x7f7f509cb830],_y0=0x7f7f50941c30,_signus=0x7f7f52935ab0,_puppixoffset=[0,0],
 _nact=80,_def=0x10fd60030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f532852f0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f970,xposition=0x7f7f520029f8,yposition=
 0x7f7f5110fa50,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002288,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.568      114.9
Field Avg  1.65                     55.4   0.568      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51113ad0,winddir=0x7f7f511134f8,
 _layeralt=0x7f7f51113470)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ed0,lgs_prof_alt=0x7f7f5110fb30,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53287320,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5069f300,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d836030,_masks=0x0,_fluxpersub=0x7f7f506aede0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53281b80,_skyfluxpersub=0x7f7f53276b90,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00745236,0.0059137],_lastvalidtt=
 [-0.00745236,0.0059137],_upttcommand=[0,0],_refmes=0x7f7f508dde30,_tiprefv=
 0x7f7f50a34230,_tiltrefv=0x7f7f5186e030,_tiprefvn=0x7f7f509cb030,_tiltrefvn=
 0x7f7f51883230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506ae7e0,_jstart=0x7f7f506aea30,_binindices=0x7f7f509c4a30,
 _binxy=2,_centroidw=0x7f7f5110ed60,_fimage=0x7f7f509c5830,_fimage2=0x0,
 _imistart=0x7f7f53287570,_imjstart=0x7f7f5327d0a0,_imistart2=0x7f7f5327d2f0,
 _imjstart2=0x7f7f53281930,_unittip=0x7f7f506a0290,_unittilt=0x7f7f5069f0d0,
 _lgs_defocuses=0x7f7f5110fc10,_unitdefocus=0x10cf60030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50948630,_flat=0x7f7f51883a30,_domask=1,
 _submask=0x7f7f51815830,_kernel=0x7f7f50939030,_kernels=0x10c183030,_kerfftr=
 0x10c25f030,_kerffti=0x10c02c030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50937630,_x=0x7f7f5181b030,_y=0x7f7f5186b630,_centroidgain=1,_rayleigh=
 0x7f7f52001d48,_bckgrdcalib=0x7f7f5186ce30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f5f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ebd8,_ctrlden=0x7f7f5110eeb0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53102070,_xlast=0x7f7f532850a0,_ylast=[0x7f7f50941c30,0x7f7f50941c30,
 0x7f7f50941c30],_y0=0x7f7f509d5e30,_signus=0x7f7f53280340,_puppixoffset=[0,0],
 _nact=80,_def=0x10dc39030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507acb70,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f970,xposition=0x7f7f5110ef58,yposition=
 0x7f7f5110ee40,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002288,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.647      101.3
Field Avg  1.65                     54.3   0.647      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51113ad0,winddir=0x7f7f511134f8,
 _layeralt=0x7f7f511138b0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ed0,lgs_prof_alt=0x7f7f5110fb30,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ad9a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507b6bb0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cc1d030,_masks=0x0,_fluxpersub=0x7f7f533e51b0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e5650,_skyfluxpersub=0x7f7f533e58a0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00881655,-0.00199376],_lastvalidtt=
 [-0.00881655,-0.00199376],_upttcommand=[0,0],_refmes=0x7f7f5208cc30,_tiprefv=
 0x7f7f5127ba30,_tiltrefv=0x7f7f5127b230,_tiprefvn=0x7f7f51195c30,_tiltrefvn=
 0x7f7f51196430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507b6e00,_jstart=0x7f7f507b7050,_binindices=0x7f7f50948630,
 _binxy=2,_centroidw=0x7f7f5110ffc8,_fimage=0x7f7f52085e30,_fimage2=0x0,
 _imistart=0x7f7f52934b80,_imjstart=0x7f7f53280fa0,_imistart2=0x7f7f53285200,
 _imjstart2=0x7f7f53280340,_unittip=0x7f7f507b6750,_unittilt=0x7f7f507b6980,
 _lgs_defocuses=0x7f7f52001f40,_unitdefocus=0x10f1c2030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50937630,_flat=0x7f7f509cb030,_domask=1,
 _submask=0x7f7f51191630,_kernel=0x7f7f5118de30,_kernels=0x10bfc6030,_kerfftr=
 0x10bf15030,_kerffti=0x10c183030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5208b030,_x=0x7f7f52009e30,_y=0x7f7f52087030,_centroidgain=1,_rayleigh=
 0x7f7f52002058,_bckgrdcalib=0x7f7f50926030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104980)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51106f68,_ctrlden=0x7f7f51105588,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53271210,_xlast=0x7f7f53102070,_ylast=[0x7f7f509d5e30,0x7f7f509d5e30,
 0x7f7f509d5e30],_y0=0x7f7f508dde30,_signus=0x7f7f52935ab0,_puppixoffset=[0,0],
 _nact=80,_def=0x110161030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f970,xposition=0x7f7f5110eba0,yposition=
 0x7f7f51104b78,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002288,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       67.3   0.166      331.1
Field Avg  1.65                     67.3   0.166      331.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51113ad0,winddir=0x7f7f511134f8,
 _layeralt=0x7f7f51113030)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ed0,lgs_prof_alt=0x7f7f5110fb30,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e8630,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e5630,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cd1e030,_masks=0x0,_fluxpersub=0x7f7f53187cc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f52935ab0,_skyfluxpersub=0x7f7f53281c60,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.0127137,0.0155488],_lastvalidtt=
 [-0.0127137,0.0155488],_upttcommand=[0,0],_refmes=0x7f7f5208cc30,_tiprefv=
 0x7f7f50948630,_tiltrefv=0x7f7f509cb030,_tiprefvn=0x7f7f509c3230,_tiltrefvn=
 0x7f7f509c3a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e5880,_jstart=0x7f7f533e5ad0,_binindices=0x7f7f5119ba30,
 _binxy=2,_centroidw=0x7f7f5110ec80,_fimage=0x7f7f5119b030,_fimage2=0x0,
 _imistart=0x7f7f533e61c0,_imjstart=0x7f7f533e6410,_imistart2=0x7f7f533e6660,
 _imjstart2=0x7f7f533e68b0,_unittip=0x7f7f533e4f60,_unittilt=0x7f7f533e5400,
 _lgs_defocuses=0x7f7f5110ed60,_unitdefocus=0x10d937030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51191e30,_flat=0x7f7f51293e30,_domask=1,
 _submask=0x7f7f509c7c30,_kernel=0x7f7f51295830,_kernels=0x10c02c030,_kerfftr=
 0x10c25f030,_kerffti=0x10bfc6030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51193630,_x=0x7f7f51116830,_y=0x7f7f5114ec30,_centroidgain=1,_rayleigh=
 0x7f7f52001d48,_bckgrdcalib=0x7f7f51294830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f5f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e548,_ctrlden=0x7f7f52002250,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53280590,_ylast=[0x7f7f508dde30,0x7f7f508dde30,
 0x7f7f508dde30],_y0=0x7f7f509d0c30,_signus=0x7f7f52934b80,_puppixoffset=[0,0],
 _nact=80,_def=0x10dc39030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f53102070,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f970,xposition=0x7f7f51110118,yposition=
 0x7f7f5110e5b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002288,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      159.8   0.044      391.9
Field Avg  1.65                    159.8   0.044      391.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51113ad0,winddir=0x7f7f511134f8,
 _layeralt=0x7f7f51112060)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ed0,lgs_prof_alt=0x7f7f5110fb30,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506b0320,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53287570,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f55c030,_masks=0x0,_fluxpersub=0x7f7f5327ede0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53287320,_skyfluxpersub=0x7f7f53187cc0,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[0.0523929,0.0403727],_lastvalidtt=
 [0.0523929,0.0403727],_upttcommand=[0,0],_refmes=0x7f7f509d5e30,_tiprefv=
 0x7f7f51885030,_tiltrefv=0x7f7f5127ca30,_tiprefvn=0x7f7f51885830,_tiltrefvn=
 0x7f7f5127d230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53280fa0,_jstart=0x7f7f53280340,_binindices=0x7f7f511e2230,
 _binxy=2,_centroidw=0x7f7f520020c8,_fimage=0x7f7f51883c30,_fimage2=0x0,
 _imistart=0x7f7f533e5650,_imjstart=0x7f7f533e58a0,_imistart2=0x7f7f533e65c0,
 _imjstart2=0x7f7f533e60f0,_unittip=0x7f7f531022f0,_unittilt=0x7f7f52934b80,
 _lgs_defocuses=0x7f7f5110ffc8,_unitdefocus=0x10c5ad030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51192a30,_flat=0x7f7f51193430,_domask=1,
 _submask=0x7f7f509c7c30,_kernel=0x7f7f50939030,_kernels=0x10c183030,_kerfftr=
 0x10bf15030,_kerffti=0x10c02c030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5186ce30,_x=0x7f7f50a32a30,_y=0x7f7f5093de30,_centroidgain=1,_rayleigh=
 0x7f7f52002058,_bckgrdcalib=0x7f7f51294830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104980)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51104da8,_ctrlden=0x7f7f5110eba0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f5300fb60,_ylast=[0x7f7f5111d030,0x7f7f5111d030,
 0x7f7f5111d030],_y0=0x7f7f51108830,_signus=0x7f7f528b28e0,_puppixoffset=[0,0],
 _nact=80,_def=0x110161030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f970,xposition=0x7f7f5110ebd8,yposition=
 0x7f7f5110f0e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002288,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      155.3   0.021      621.6
Field Avg  1.65                    155.3   0.021      621.6
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51113ad0,winddir=0x7f7f511134f8,
 _layeralt=0x7f7f51113c68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ed0,lgs_prof_alt=0x7f7f5110fb30,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53276f70,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506ae590,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c931030,_masks=0x0,_fluxpersub=0x7f7f533e5400,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e4f60,_skyfluxpersub=0x7f7f533e51b0,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[0.0382209,-0.00449411],_lastvalidtt=
 [0.0382209,-0.00449411],_upttcommand=[0,0],_refmes=0x7f7f5119d830,_tiprefv=
 0x7f7f51194830,_tiltrefv=0x7f7f51192a30,_tiprefvn=0x7f7f51195030,_tiltrefvn=
 0x7f7f5127ca30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5069f0d0,_jstart=0x7f7f5069f320,_binindices=0x7f7f51883230,
 _binxy=2,_centroidw=0x7f7f5110f7e8,_fimage=0x7f7f51262830,_fimage2=0x0,
 _imistart=0x7f7f506aede0,_imjstart=0x7f7f506af030,_imistart2=0x7f7f506af280,
 _imjstart2=0x7f7f506af4d0,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f506a0290,
 _lgs_defocuses=0x7f7f5110ec80,_unitdefocus=0x10d735030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51196230,_flat=0x7f7f50937630,_domask=1,
 _submask=0x7f7f5118de30,_kernel=0x7f7f51193230,_kernels=0x10bfc6030,_kerfftr=
 0x10c25f030,_kerffti=0x10c183030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51195830,_x=0x7f7f5180da30,_y=0x7f7f5181e830,_centroidgain=1,_rayleigh=
 0x7f7f52001d48,_bckgrdcalib=0x7f7f509cb030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f5f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110f038,_ctrlden=0x7f7f5110f000,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53102070,_xlast=0x7f7f53187cc0,_ylast=[0x7f7f5095ce30,0x7f7f5095ce30,
 0x7f7f5095ce30],_y0=0x7f7f509d5e30,_signus=0x7f7f52934b80,_puppixoffset=[0,0],
 _nact=80,_def=0x10dc39030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f531022f0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f970,xposition=0x7f7f51106f68,yposition=
 0x7f7f5110eeb0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002288,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      666.2   0.001     2388.3
Field Avg  1.65                    666.2   0.001     2388.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51113ad0,winddir=0x7f7f511134f8,
 _layeralt=0x7f7f51113cf0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ed0,lgs_prof_alt=0x7f7f5110fb30,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5327d480,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e7880,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f1c2030,_masks=0x0,_fluxpersub=0x7f7f533e6490,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e66e0,_skyfluxpersub=0x7f7f533e7f70,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[0.0229403,0.028719],_lastvalidtt=
 [0.0229403,0.028719],_upttcommand=[0,0],_refmes=0x7f7f50949030,_tiprefv=
 0x7f7f52087430,_tiltrefv=0x7f7f5180ba30,_tiprefvn=0x7f7f52079e30,_tiltrefvn=
 0x7f7f5180c230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e7ad0,_jstart=0x7f7f533e7d20,_binindices=0x7f7f509c5430,
 _binxy=2,_centroidw=0x7f7f5110fb68,_fimage=0x7f7f51191630,_fimage2=0x0,
 _imistart=0x7f7f52934b80,_imjstart=0x7f7f53280340,_imistart2=0x7f7f53280fa0,
 _imjstart2=0x7f7f532850a0,_unittip=0x7f7f533e6bf0,_unittilt=0x7f7f533e7650,
 _lgs_defocuses=0x7f7f520020c8,_unitdefocus=0x10cf60030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50a44430,_flat=0x7f7f50a44e30,_domask=1,
 _submask=0x7f7f51281c30,_kernel=0x7f7f50a43630,_kernels=0x10bf15030,_kerfftr=
 0x10c02c030,_kerffti=0x10bfc6030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51262830,_x=0x7f7f5119fa30,_y=0x7f7f5114ec30,_centroidgain=1,_rayleigh=
 0x7f7f52002058,_bckgrdcalib=0x7f7f50a45830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51104980)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110eee8,_ctrlden=0x7f7f5110ebd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533e5b00,_xlast=0x7f7f528b28e0,_ylast=[0x7f7f51154030,0x7f7f51154030,
 0x7f7f51154030],_y0=0x7f7f5119d830,_signus=0x7f7f533e6930,_puppixoffset=[0,0],
 _nact=80,_def=0x110161030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f532852f0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f970,xposition=0x7f7f5110e548,yposition=
 0x7f7f51105588,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002288,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1494.1   0.000     3455.8
Field Avg  1.65                   1494.1   0.000     3455.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51111ca8,layeralt=0x7f7f51113ad0,winddir=0x7f7f511134f8,
 _layeralt=0x7f7f51112f20)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001ed0,lgs_prof_alt=0x7f7f5110fb30,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53281930,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506a0290,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cb1c030,_masks=0x0,_fluxpersub=0x7f7f533e5ed0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e54e0,_skyfluxpersub=0x7f7f533e5c60,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[0.000195503,0.0136593],_lastvalidtt=
 [0.000195503,0.0136593],_upttcommand=[0,0],_refmes=0x7f7f5095ce30,_tiprefv=
 0x7f7f50a34230,_tiltrefv=0x7f7f51815830,_tiprefvn=0x7f7f50a34a30,_tiltrefvn=
 0x7f7f5180ba30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5069f0d0,_jstart=0x7f7f5069f320,_binindices=0x7f7f51886630,
 _binxy=2,_centroidw=0x7f7f5110ea18,_fimage=0x7f7f509c4a30,_fimage2=0x0,
 _imistart=0x7f7f506afa60,_imjstart=0x7f7f506aeb90,_imistart2=0x7f7f506aede0,
 _imjstart2=0x7f7f506af030,_unittip=0x7f7f506ae960,_unittilt=0x7f7f506a2f10,
 _lgs_defocuses=0x7f7f5110f7e8,_unitdefocus=0x10ce1f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5127a830,_flat=0x7f7f51152630,_domask=1,
 _submask=0x7f7f51262830,_kernel=0x7f7f5118de30,_kernels=0x10c183030,_kerfftr=
 0x10c25f030,_kerffti=0x10bf15030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50937630,_x=0x7f7f5180f830,_y=0x7f7f5186b630,_centroidgain=1,_rayleigh=
 0x7f7f52001d48,_bckgrdcalib=0x7f7f51191630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110f5f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f520020c8,_ctrlden=0x7f7f5110ec80,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533df8a0,_xlast=0x7f7f528b2a60,_ylast=[0x7f7f5119d830,0x7f7f5119d830,
 0x7f7f5119d830],_y0=0x7f7f5100fc30,_signus=0x7f7f533e5220,_puppixoffset=[0,0],
 _nact=80,_def=0x10dc39030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528b28e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f970,xposition=0x7f7f51104da8,yposition=
 0x7f7f52002250,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002288,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.659       98.0
Field Avg  1.65                     54.3   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51111ca8,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51111ec8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f5100b450)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002250,lgs_prof_alt=0x7f7f5110f970,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506afee0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507ae610,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d937030,_masks=0x0,_fluxpersub=0x7f7f53187cc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f531022f0,_skyfluxpersub=0x7f7f52935ab0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00383695,-0.00154368],_lastvalidtt=
 [-0.00383695,-0.00154368],_upttcommand=[0,0],_refmes=0x7f7f5208cc30,_tiprefv=
 0x7f7f51196a30,_tiltrefv=0x7f7f51196230,_tiprefvn=0x7f7f51197230,_tiltrefvn=
 0x7f7f51197a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ad1e0,_jstart=0x7f7f507ad430,_binindices=0x7f7f52086e30,
 _binxy=2,_centroidw=0x7f7f52002058,_fimage=0x7f7f50a32030,_fimage2=0x0,
 _imistart=0x7f7f507aeab0,_imjstart=0x7f7f507aed00,_imistart2=0x7f7f507aef50,
 _imjstart2=0x7f7f507af1a0,_unittip=0x7f7f507ae3e0,_unittilt=0x7f7f507acb70,
 _lgs_defocuses=0x7f7f5110fbd8,_unitdefocus=0x10c730030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50a2fe30,_flat=0x7f7f50926030,_domask=1,
 _submask=0x7f7f509c3230,_kernel=0x7f7f509c5430,_kernels=0x10c32b030,_kerfftr=
 0x10c25f030,_kerffti=0x10bf15030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50a43630,_x=0x7f7f52085630,_y=0x7f7f52009e30,_centroidgain=1,_rayleigh=
 0x7f7f5110feb0,_bckgrdcalib=0x7f7f50a31630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110eba0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fb68,_ctrlden=0x7f7f520021e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f507ac1c0,_xlast=0x7f7f507ac340,_ylast=[0x7f7f52011830,0x7f7f52011830,
 0x7f7f52011830],_y0=0x7f7f52012430,_signus=0x7f7f507adfa0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ec80,xposition=0x7f7f5110fba0,yposition=
 0x7f7f5110e970,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001ed0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111ca8,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f511134f8,winddir=0x7f7f51113ad0,
 _layeralt=0x7f7f51112280)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f5110e970,lgs_prof_alt=0x7f7f5110ec80,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507aec60,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53281930,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d132030,_masks=0x0,_fluxpersub=0x7f7f507acb70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507ac1c0,_skyfluxpersub=0x7f7f507ad1e0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00384323,0.000395844],_lastvalidtt=
 [-0.00384323,0.000395844],_upttcommand=[0,0],_refmes=0x7f7f51263230,_tiprefv=
 0x7f7f50937630,_tiltrefv=0x7f7f51195030,_tiprefvn=0x7f7f509c7c30,_tiltrefvn=
 0x7f7f51191630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5326f3e0,_jstart=0x7f7f53278830,_binindices=0x7f7f51297230,
 _binxy=2,_centroidw=0x7f7f52002448,_fimage=0x7f7f52078a30,_fimage2=0x0,
 _imistart=0x7f7f533e5c90,_imjstart=0x7f7f533e5220,_imistart2=0x7f7f533e5470,
 _imjstart2=0x7f7f533e6400,_unittip=0x7f7f52922690,_unittilt=0x7f7f53287320,
 _lgs_defocuses=0x7f7f51107128,_unitdefocus=0x10d233030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f52084a30,_flat=0x7f7f52084030,_domask=1,
 _submask=0x7f7f5208b030,_kernel=0x7f7f5118dc30,_kernels=0x10c183030,_kerfftr=
 0x10c25f030,_kerffti=0x10bf15030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f52079430,_x=0x7f7f50a30830,_y=0x7f7f509bf630,_centroidgain=1,_rayleigh=
 0x7f7f5110eb68,_bckgrdcalib=0x7f7f52085430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110eee8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51110118,_ctrlden=0x7f7f520023d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f533df8a0,_ylast=[0x7f7f51177430,0x7f7f51177430,
 0x7f7f51177430],_y0=0x7f7f5119d830,_signus=0x7f7f533e6140,_puppixoffset=[0,0],
 _nact=80,_def=0x110160030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507ad430,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110e628,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f520021e0,xposition=0x7f7f5110e548,yposition=
 0x7f7f52002138,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002250,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.658       98.0
Field Avg  1.65                     54.3   0.658       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f511134f8,winddir=0x7f7f51111f50,
 _layeralt=0x7f7f51112f20)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002918,lgs_prof_alt=0x7f7f51107128,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ae3c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e5d80,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ce1f030,_masks=0x0,_fluxpersub=0x7f7f53187cc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528b28e0,_skyfluxpersub=0x7f7f533e59f0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0032419,-0.00100006],_lastvalidtt=
 [-0.0032419,-0.00100006],_upttcommand=[0,0],_refmes=0x7f7f51263230,_tiprefv=
 0x7f7f511ee630,_tiltrefv=0x7f7f51299830,_tiprefvn=0x7f7f511eee30,_tiltrefvn=
 0x7f7f51193430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e5fd0,_jstart=0x7f7f533e6220,_binindices=0x7f7f5118ce30,
 _binxy=2,_centroidw=0x7f7f52001ca0,_fimage=0x7f7f5208b030,_fimage2=0x0,
 _imistart=0x7f7f533e6910,_imjstart=0x7f7f533e6b60,_imistart2=0x7f7f533e6db0,
 _imjstart2=0x7f7f533e7000,_unittip=0x7f7f533e5470,_unittilt=0x7f7f528b1560,
 _lgs_defocuses=0x7f7f5110ee78,_unitdefocus=0x10c5ad030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51298830,_flat=0x7f7f51191630,_domask=1,
 _submask=0x7f7f50948630,_kernel=0x7f7f51297a30,_kernels=0x10c32b030,_kerfftr=
 0x10c25f030,_kerffti=0x10bf15030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5208ba30,_x=0x7f7f51176630,_y=0x7f7f5117c230,_centroidgain=1,_rayleigh=
 0x7f7f5110ed60,_bckgrdcalib=0x7f7f5118dc30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51110070)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fc10,_ctrlden=0x7f7f5110fc48,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53102070,_ylast=[0x7f7f50a47430,0x7f7f50a47430,
 0x7f7f50a47430],_y0=0x7f7f5095ce30,_signus=0x7f7f53280fa0,_puppixoffset=[0,0],
 _nact=80,_def=0x10db39030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110e548,xposition=0x7f7f52002288,yposition=
 0x7f7f520021e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110eba0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    7026.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.641      101.3
Field Avg  1.65                     54.4   0.641      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f511134f8,winddir=0x7f7f51111f50,
 _layeralt=0x7f7f51111b10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002918,lgs_prof_alt=0x7f7f51107128,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506b0330,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e53a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c730030,_masks=0x0,_fluxpersub=0x7f7f533e7370,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e75c0,_skyfluxpersub=0x7f7f533e7810,
 _nphotons=7026.1,_skynphotons=0,_tt=[0.0045571,-0.00380944],_lastvalidtt=
 [0.0045571,-0.00380944],_upttcommand=[0,0],_refmes=0x7f7f51806e30,_tiprefv=
 0x7f7f5186e030,_tiltrefv=0x7f7f52078a30,_tiprefvn=0x7f7f51884630,_tiltrefvn=
 0x7f7f52079230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f528b1560,_jstart=0x7f7f533e5c20,_binindices=0x7f7f51194830,
 _binxy=2,_centroidw=0x7f7f52001d80,_fimage=0x7f7f51883230,_fimage2=0x0,
 _imistart=0x7f7f533e6a30,_imjstart=0x7f7f533e6c80,_imistart2=0x7f7f533e6ed0,
 _imjstart2=0x7f7f533e7120,_unittip=0x7f7f533e6470,_unittilt=0x7f7f533e59f0,
 _lgs_defocuses=0x7f7f5110ef58,_unitdefocus=0x10d735030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51196c30,_flat=0x7f7f51196230,_domask=1,
 _submask=0x7f7f51281c30,_kernel=0x7f7f51192a30,_kernels=0x10bd47030,_kerfftr=
 0x10c183030,_kerffti=0x10c32b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5180b030,_x=0x7f7f5114ec30,_y=0x7f7f51116830,_centroidgain=1,_rayleigh=
 0x7f7f52002058,_bckgrdcalib=0x7f7f51197630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110e970)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51106f68,_ctrlden=0x7f7f51104b78,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533f1970,_xlast=0x7f7f533e5220,_ylast=[0x7f7f5118e230,0x7f7f5118e230,
 0x7f7f5118e230],_y0=0x7f7f5127ae30,_signus=0x7f7f533f12e0,_puppixoffset=[0,0],
 _nact=80,_def=0x11083e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5069f7e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110e548,xposition=0x7f7f5110f7e8,yposition=
 0x7f7f5110f038,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110eba0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    17565.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.560      114.9
Field Avg  1.65                     54.9   0.560      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f511134f8,winddir=0x7f7f51111f50,
 _layeralt=0x7f7f51111d30)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002918,lgs_prof_alt=0x7f7f51107128,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507accb0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e5190,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d233030,_masks=0x0,_fluxpersub=0x7f7f507ad340,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507ad590,_skyfluxpersub=0x7f7f506b07e0,
 _nphotons=17565.3,_skynphotons=0,_tt=[0.00481688,-0.00359333],_lastvalidtt=
 [0.00481688,-0.00359333],_upttcommand=[0,0],_refmes=0x7f7f5180c430,_tiprefv=
 0x7f7f509c8430,_tiltrefv=0x7f7f50948c30,_tiprefvn=0x7f7f50a44a30,_tiltrefvn=
 0x7f7f50a33830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e53e0,_jstart=0x7f7f533e59f0,_binindices=0x7f7f51193030,
 _binxy=2,_centroidw=0x7f7f51104980,_fimage=0x7f7f50926030,_fimage2=0x0,
 _imistart=0x7f7f533e60e0,_imjstart=0x7f7f533e6330,_imistart2=0x7f7f533e6580,
 _imjstart2=0x7f7f533e67d0,_unittip=0x7f7f528b28e0,_unittilt=0x7f7f533e4f60,
 _lgs_defocuses=0x7f7f52001ca0,_unitdefocus=0x10da38030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51884630,_flat=0x7f7f5180b030,_domask=1,
 _submask=0x7f7f52085a30,_kernel=0x7f7f51198430,_kernels=0x10c00f030,_kerfftr=
 0x10bf15030,_kerffti=0x10bd47030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f509c4a30,_x=0x7f7f51072c30,_y=0x7f7f5119ec30,_centroidgain=1,_rayleigh=
 0x7f7f5110ed60,_bckgrdcalib=0x7f7f51885030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51110070)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002288,_ctrlden=0x7f7f51107048,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f528afd30,_ylast=[0x7f7f5127ae30,0x7f7f5127ae30,
 0x7f7f5127ae30],_y0=0x7f7f51177430,_signus=0x7f7f528b1560,_puppixoffset=[0,0],
 _nact=80,_def=0x10db39030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f506a2f10,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110e548,xposition=0x7f7f5110ebd8,yposition=
 0x7f7f5110eac0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110eba0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    28104.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       57.0   0.397      239.8
Field Avg  1.65                     57.0   0.397      239.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f511134f8,winddir=0x7f7f51111f50,
 _layeralt=0x7f7f51113608)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002918,lgs_prof_alt=0x7f7f51107128,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53270a50,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f531022f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cc1d030,_masks=0x0,_fluxpersub=0x7f7f5327d980,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53187cc0,_skyfluxpersub=0x7f7f5327ede0,
 _nphotons=28104.4,_skynphotons=0,_tt=[-0.0138957,0.0196885],_lastvalidtt=
 [-0.0138957,0.0196885],_upttcommand=[0,0],_refmes=0x7f7f51263230,_tiprefv=
 0x7f7f51883230,_tiltrefv=0x7f7f5186e030,_tiprefvn=0x7f7f51883a30,_tiltrefvn=
 0x7f7f51884230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f532751b0,_jstart=0x7f7f507ad1e0,_binindices=0x7f7f52085a30,
 _binxy=2,_centroidw=0x7f7f5110faf8,_fimage=0x7f7f5127b630,_fimage2=0x0,
 _imistart=0x7f7f507ad8d0,_imjstart=0x7f7f507adb20,_imistart2=0x7f7f507add70,
 _imjstart2=0x7f7f507adfc0,_unittip=0x7f7f507acb70,_unittilt=0x7f7f507ac1c0,
 _lgs_defocuses=0x7f7f52001d80,_unitdefocus=0x10d937030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5207a430,_flat=0x7f7f509c3230,_domask=1,
 _submask=0x7f7f51199630,_kernel=0x7f7f5127a830,_kernels=0x10c25f030,_kerfftr=
 0x10c183030,_kerffti=0x10c00f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51193430,_x=0x7f7f50926030,_y=0x7f7f50a45c30,_centroidgain=1,_rayleigh=
 0x7f7f52002058,_bckgrdcalib=0x7f7f50948630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110e970)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f520020c8,_ctrlden=0x7f7f5110f038,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53280590,_xlast=0x7f7f53275840,_ylast=[0x7f7f5095ce30,0x7f7f5095ce30,
 0x7f7f5095ce30],_y0=0x7f7f50a47430,_signus=0x7f7f53276570,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507ac3f0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110e548,xposition=0x7f7f5110fc10,yposition=
 0x7f7f52001e28,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110eba0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.008,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.646      101.3
Field Avg  1.65                     54.4   0.646      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f511134f8,winddir=0x7f7f51111f50,
 _layeralt=0x7f7f51113cf0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002918,lgs_prof_alt=0x7f7f51107128,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53283110,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5069f0d0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cd1e030,_masks=0x0,_fluxpersub=0x7f7f53270b20,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53280340,_skyfluxpersub=0x7f7f5326fad0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00282116,-0.00509015],_lastvalidtt=
 [-0.00282116,-0.00509015],_upttcommand=[0,0],_refmes=0x7f7f5119d830,_tiprefv=
 0x7f7f509c3a30,_tiltrefv=0x7f7f509c3230,_tiprefvn=0x7f7f50a43630,_tiltrefvn=
 0x7f7f50a34230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506ae590,_jstart=0x7f7f506ae7e0,_binindices=0x7f7f50a41830,
 _binxy=2,_centroidw=0x7f7f52001db8,_fimage=0x7f7f50926030,_fimage2=0x0,
 _imistart=0x7f7f53275730,_imjstart=0x7f7f531022f0,_imistart2=0x7f7f5327ede0,
 _imjstart2=0x7f7f53276570,_unittip=0x7f7f506aec80,_unittilt=0x7f7f506aeeb0,
 _lgs_defocuses=0x7f7f51104980,_unitdefocus=0x10d634030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50a45430,_flat=0x7f7f509c4a30,_domask=1,
 _submask=0x7f7f50a35c30,_kernel=0x7f7f51192a30,_kernels=0x10bf15030,_kerfftr=
 0x10bd47030,_kerffti=0x10c25f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50a43e30,_x=0x7f7f5186b630,_y=0x7f7f5180f830,_centroidgain=1,_rayleigh=
 0x7f7f5110ed60,_bckgrdcalib=0x7f7f50a3b230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51110070)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110f660,_ctrlden=0x7f7f5110f7e8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f528b1560,_ylast=[0x7f7f5127b230,0x7f7f5127b230,
 0x7f7f5127b230],_y0=0x7f7f51263230,_signus=0x7f7f533f10c0,_puppixoffset=[0,0],
 _nact=80,_def=0x11083e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f53280590,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110e548,xposition=0x7f7f51106f68,yposition=
 0x7f7f5110fc48,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f5110eba0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    443.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.659       98.0
Field Avg  1.65                     54.3   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51113ad0,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51113938,winddir=0x7f7f51111ca8,
 _layeralt=0x7f7f51112e98)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51104b78,lgs_prof_alt=0x7f7f5110e548,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e8250,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533f9e90,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10da38030,_masks=0x0,_fluxpersub=0x7f7f533e59f0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e5c40,_skyfluxpersub=0x7f7f533e5e90,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00327527,-0.00143905],_lastvalidtt=
 [-0.00327527,-0.00143905],_upttcommand=[0,0],_refmes=0x7f7f51806e30,_tiprefv=
 0x7f7f52079230,_tiltrefv=0x7f7f51871030,_tiprefvn=0x7f7f52079a30,_tiltrefvn=
 0x7f7f51872430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533fa0e0,_jstart=0x7f7f533fa330,_binindices=0x7f7f509c5430,
 _binxy=2,_centroidw=0x7f7f5110ed60,_fimage=0x7f7f5119b630,_fimage2=0x0,
 _imistart=0x7f7f53276df0,_imjstart=0x7f7f53277040,_imistart2=0x7f7f532785e0,
 _imjstart2=0x7f7f53278830,_unittip=0x7f7f528b1560,_unittilt=0x7f7f528b28e0,
 _lgs_defocuses=0x7f7f51104da8,_unitdefocus=0x10f1c2030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51194830,_flat=0x7f7f50a39430,_domask=1,
 _submask=0x7f7f5118ce30,_kernel=0x7f7f50a38630,_kernels=0x10c25f030,_kerfftr=
 0x10c00f030,_kerffti=0x10bf15030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51195230,_x=0x7f7f5127b030,_y=0x7f7f5129aa30,_centroidgain=1,_rayleigh=
 0x7f7f5110fc80,_bckgrdcalib=0x7f7f50926030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ecf0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51106de0,_ctrlden=0x7f7f51106f68,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5069f320,_xlast=0x7f7f506b08c0,_ylast=[0x7f7f5186b630,0x7f7f5186b630,
 0x7f7f5186b630],_y0=0x7f7f5180f830,_signus=0x7f7f506b0a40,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eac0,xposition=0x7f7f5110f660,yposition=
 0x7f7f52002058,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002918,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    7026.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.641      101.3
Field Avg  1.65                     54.4   0.641      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51113ad0,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51113938,winddir=0x7f7f51111ca8,
 _layeralt=0x7f7f51113250)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51104b78,lgs_prof_alt=0x7f7f5110e548,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e8f80,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e6180,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d937030,_masks=0x0,_fluxpersub=0x7f7f53276570,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53187cc0,_skyfluxpersub=0x7f7f531022f0,
 _nphotons=7026.1,_skynphotons=0,_tt=[0.00425671,-0.00316522],_lastvalidtt=
 [0.00425671,-0.00316522],_upttcommand=[0,0],_refmes=0x7f7f51177430,_tiprefv=
 0x7f7f50a31e30,_tiltrefv=0x7f7f50a31630,_tiprefvn=0x7f7f50a2fe30,_tiltrefvn=
 0x7f7f50a45630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e6a40,_jstart=0x7f7f533e6c90,_binindices=0x7f7f51196230,
 _binxy=2,_centroidw=0x7f7f5110f890,_fimage=0x7f7f51197030,_fimage2=0x0,
 _imistart=0x7f7f533e7840,_imjstart=0x7f7f533e7a90,_imistart2=0x7f7f533e7ce0,
 _imjstart2=0x7f7f533e7f30,_unittip=0x7f7f533e5d20,_unittilt=0x7f7f533e5f50,
 _lgs_defocuses=0x7f7f5110f150,_unitdefocus=0x10f85e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51199230,_flat=0x7f7f51199c30,_domask=1,
 _submask=0x7f7f50948630,_kernel=0x7f7f51198430,_kernels=0x10bf15030,_kerfftr=
 0x10c0db030,_kerffti=0x10c25f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5119be30,_x=0x7f7f5118d630,_y=0x7f7f5127b030,_centroidgain=1,_rayleigh=
 0x7f7f5110f0a8,_bckgrdcalib=0x7f7f5119a630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107128)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ee78,_ctrlden=0x7f7f5110ff58,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f52922690,_ylast=[0x7f7f509d5e30,0x7f7f509d5e30,
 0x7f7f509d5e30],_y0=0x7f7f50a45e30,_signus=0x7f7f53280340,_puppixoffset=[0,0],
 _nact=80,_def=0x110160030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e6ee0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eac0,xposition=0x7f7f5110ea18,yposition=
 0x7f7f5110f038,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002918,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    17565.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.560      114.9
Field Avg  1.65                     54.9   0.560      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51113ad0,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51113938,winddir=0x7f7f51111ca8,
 _layeralt=0x7f7f51113e88)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51104b78,lgs_prof_alt=0x7f7f5110e548,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506af600,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507b2e60,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c931030,_masks=0x0,_fluxpersub=0x7f7f528b28e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e5b70,_skyfluxpersub=0x7f7f533e5dc0,
 _nphotons=17565.3,_skynphotons=0,_tt=[0.00475738,-0.00354799],_lastvalidtt=
 [0.00475738,-0.00354799],_upttcommand=[0,0],_refmes=0x7f7f52016030,_tiprefv=
 0x7f7f50a35a30,_tiltrefv=0x7f7f51870230,_tiprefvn=0x7f7f50a31e30,_tiltrefvn=
 0x7f7f51888e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507b30b0,_jstart=0x7f7f507b3300,_binindices=0x7f7f52082a30,
 _binxy=2,_centroidw=0x7f7f5110fc48,_fimage=0x7f7f5186ce30,_fimage2=0x0,
 _imistart=0x7f7f507b39f0,_imjstart=0x7f7f507b3c40,_imistart2=0x7f7f507b3e90,
 _imjstart2=0x7f7f507b40e0,_unittip=0x7f7f507acb70,_unittilt=0x7f7f507ac1c0,
 _lgs_defocuses=0x7f7f5110ed60,_unitdefocus=0x10f45b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50926030,_flat=0x7f7f50a2fe30,_domask=1,
 _submask=0x7f7f511c8430,_kernel=0x7f7f50948630,_kernels=0x10c25f030,_kerfftr=
 0x10c00f030,_kerffti=0x10bf15030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5180b030,_x=0x7f7f52009e30,_y=0x7f7f52087630,_centroidgain=1,_rayleigh=
 0x7f7f5110fc80,_bckgrdcalib=0x7f7f50a33830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ecf0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51104da8,_ctrlden=0x7f7f5110e938,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533e4f60,_xlast=0x7f7f533e59f0,_ylast=[0x7f7f51177430,0x7f7f51177430,
 0x7f7f51177430],_y0=0x7f7f5119d830,_signus=0x7f7f528b1560,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5069f7e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eac0,xposition=0x7f7f5110e660,yposition=
 0x7f7f5110f7e8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002918,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    28104.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       57.0   0.397      239.8
Field Avg  1.65                     57.0   0.397      239.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51113ad0,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51113938,winddir=0x7f7f51111ca8,
 _layeralt=0x7f7f51112418)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51104b78,lgs_prof_alt=0x7f7f5110e548,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e6a10,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506a0290,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d132030,_masks=0x0,_fluxpersub=0x7f7f53187cc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f531022f0,_skyfluxpersub=0x7f7f53280340,
 _nphotons=28104.4,_skynphotons=0,_tt=[-0.0139582,0.0196424],_lastvalidtt=
 [-0.0139582,0.0196424],_upttcommand=[0,0],_refmes=0x7f7f511c8e30,_tiprefv=
 0x7f7f51889e30,_tiltrefv=0x7f7f51192030,_tiprefvn=0x7f7f5188a630,_tiltrefvn=
 0x7f7f51192830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506b05f0,_jstart=0x7f7f506af9d0,_binindices=0x7f7f51815830,
 _binxy=2,_centroidw=0x7f7f52001ed0,_fimage=0x7f7f511c8430,_fimage2=0x0,
 _imistart=0x7f7f506b00c0,_imjstart=0x7f7f506b09a0,_imistart2=0x7f7f506b0bf0,
 _imjstart2=0x7f7f506b0e40,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f506af5d0,
 _lgs_defocuses=0x7f7f5110f890,_unitdefocus=0x10d836030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50a33830,_flat=0x7f7f50926030,_domask=1,
 _submask=0x7f7f50948630,_kernel=0x7f7f51285030,_kernels=0x10bf15030,_kerfftr=
 0x10c0db030,_kerffti=0x10c25f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51191630,_x=0x7f7f5181f630,_y=0x7f7f51819230,_centroidgain=1,_rayleigh=
 0x7f7f5110f0a8,_bckgrdcalib=0x7f7f509c3230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107128)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002218,_ctrlden=0x7f7f5110ebd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f5300fb60,_ylast=[0x7f7f5119d830,0x7f7f5119d830,
 0x7f7f5119d830],_y0=0x7f7f51108830,_signus=0x7f7f533e6290,_puppixoffset=[0,0],
 _nact=80,_def=0x110160030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eac0,xposition=0x7f7f51106de0,yposition=
 0x7f7f5110f5f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002918,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.008,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.649      101.3
Field Avg  1.65                     54.4   0.649      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51113ad0,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51113938,winddir=0x7f7f51111ca8,
 _layeralt=0x7f7f51112308)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51104b78,lgs_prof_alt=0x7f7f5110e548,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53276b90,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e5ee0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f1c2030,_masks=0x0,_fluxpersub=0x7f7f533e77c0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e7a10,_skyfluxpersub=0x7f7f533e7f70,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00916916,-0.00111608],_lastvalidtt=
 [-0.00916916,-0.00111608],_upttcommand=[0,0],_refmes=0x7f7f51283030,_tiprefv=
 0x7f7f5208ba30,_tiltrefv=0x7f7f52086630,_tiprefvn=0x7f7f52084030,_tiltrefvn=
 0x7f7f52085230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e9c30,_jstart=0x7f7f533e9e80,_binindices=0x7f7f51192030,
 _binxy=2,_centroidw=0x7f7f520029c0,_fimage=0x7f7f50926030,_fimage2=0x0,
 _imistart=0x7f7f533e6e80,_imjstart=0x7f7f533e70d0,_imistart2=0x7f7f533e7320,
 _imjstart2=0x7f7f533e7570,_unittip=0x7f7f533e5cb0,_unittilt=0x7f7f533e67b0,
 _lgs_defocuses=0x7f7f5110fc48,_unitdefocus=0x10f55c030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50a35030,_flat=0x7f7f50a31630,_domask=1,
 _submask=0x7f7f51198e30,_kernel=0x7f7f5180b030,_kernels=0x10c25f030,_kerfftr=
 0x10c00f030,_kerffti=0x10bf15030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50a35a30,_x=0x7f7f5119fa30,_y=0x7f7f5117c230,_centroidgain=1,_rayleigh=
 0x7f7f5110fc80,_bckgrdcalib=0x7f7f509c3230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ecf0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110f580,_ctrlden=0x7f7f5110ecb8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528b1560,_xlast=0x7f7f528afd30,_ylast=[0x7f7f51108830,0x7f7f51108830,
 0x7f7f51108830],_y0=0x7f7f511c8e30,_signus=0x7f7f533e59f0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eac0,xposition=0x7f7f5110ee78,yposition=
 0x7f7f51106f68,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002918,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    443.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.636      101.3
Field Avg  1.65                     54.4   0.636      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51113ad0,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51113938,winddir=0x7f7f51111ca8,
 _layeralt=0x7f7f51113f98)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51104b78,lgs_prof_alt=0x7f7f5110e548,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506af2c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53187cc0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ce1f030,_masks=0x0,_fluxpersub=0x7f7f5326f460,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5326f6b0,_skyfluxpersub=0x7f7f5327d0a0,
 _nphotons=443.317,_skynphotons=0,_tt=[0.00355251,-0.00393999],_lastvalidtt=
 [0.00355251,-0.00393999],_upttcommand=[0,0],_refmes=0x7f7f51199830,_tiprefv=
 0x7f7f511c8430,_tiltrefv=0x7f7f5180b830,_tiprefvn=0x7f7f51193430,_tiltrefvn=
 0x7f7f5180c030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53270b50,_jstart=0x7f7f53280340,_binindices=0x7f7f50948630,
 _binxy=2,_centroidw=0x7f7f5110ea18,_fimage=0x7f7f509c3830,_fimage2=0x0,
 _imistart=0x7f7f5326eb20,_imjstart=0x7f7f5326ed70,_imistart2=0x7f7f5326efc0,
 _imjstart2=0x7f7f5326f210,_unittip=0x7f7f52922690,_unittilt=0x7f7f531022f0,
 _lgs_defocuses=0x7f7f52001ed0,_unitdefocus=0x10cf20030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51198430,_flat=0x7f7f51289e30,_domask=1,
 _submask=0x7f7f50a33830,_kernel=0x7f7f5119a430,_kernels=0x10bf15030,_kerfftr=
 0x10c0db030,_kerffti=0x10c25f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50926030,_x=0x7f7f50921830,_y=0x7f7f509c3230,_centroidgain=1,_rayleigh=
 0x7f7f5110f0a8,_bckgrdcalib=0x7f7f5128a830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107128)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ed60,_ctrlden=0x7f7f5110fa18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f53102070,_ylast=[0x7f7f50939a30,0x7f7f50939a30,
 0x7f7f50939a30],_y0=0x7f7f509d0c30,_signus=0x7f7f53280fa0,_puppixoffset=[0,0],
 _nact=80,_def=0x110160030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f53280590,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eac0,xposition=0x7f7f51104da8,yposition=
 0x7f7f5110ff58,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002918,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    1108.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.559      114.9
Field Avg  1.65                     54.9   0.559      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51113ad0,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51113938,winddir=0x7f7f51111ca8,
 _layeralt=0x7f7f51112390)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51104b78,lgs_prof_alt=0x7f7f5110e548,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e70a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53270ee0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c730030,_masks=0x0,_fluxpersub=0x7f7f507ad440,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507ac300,_skyfluxpersub=0x7f7f507ae240,
 _nphotons=1108.29,_skynphotons=0,_tt=[0.00335363,-0.0026135],_lastvalidtt=
 [0.00335363,-0.0026135],_upttcommand=[0,0],_refmes=0x7f7f51806e30,_tiprefv=
 0x7f7f51192830,_tiltrefv=0x7f7f509c5230,_tiprefvn=0x7f7f511c8430,_tiltrefvn=
 0x7f7f509c5a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53271130,_jstart=0x7f7f5327b510,_binindices=0x7f7f50a41e30,
 _binxy=2,_centroidw=0x7f7f5110f890,_fimage=0x7f7f51194830,_fimage2=0x0,
 _imistart=0x7f7f5326e680,_imjstart=0x7f7f5326e8d0,_imistart2=0x7f7f5326eb20,
 _imjstart2=0x7f7f5326ed70,_unittip=0x7f7f531022f0,_unittilt=0x7f7f53280fa0,
 _lgs_defocuses=0x7f7f520029c0,_unitdefocus=0x10f85e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f52084a30,_flat=0x7f7f52084030,_domask=1,
 _submask=0x7f7f5207a830,_kernel=0x7f7f52082830,_kernels=0x10c25f030,_kerfftr=
 0x10c00f030,_kerffti=0x10bf15030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f511c7a30,_x=0x7f7f509c3c30,_y=0x7f7f509bf630,_centroidgain=1,_rayleigh=
 0x7f7f5110fc80,_bckgrdcalib=0x7f7f52085430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ecf0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ee78,_ctrlden=0x7f7f51106f68,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53187cc0,_xlast=0x7f7f52935790,_ylast=[0x7f7f509d0c30,0x7f7f509d0c30,
 0x7f7f509d0c30],_y0=0x7f7f50941c30,_signus=0x7f7f5327b250,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eac0,xposition=0x7f7f52002218,yposition=
 0x7f7f5110e938,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002918,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    1773.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       57.0   0.396      239.8
Field Avg  1.65                     57.0   0.396      239.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51113ad0,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51113938,winddir=0x7f7f51111ca8,
 _layeralt=0x7f7f51112bf0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51104b78,lgs_prof_alt=0x7f7f5110e548,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506b0ba0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506a0290,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d233030,_masks=0x0,_fluxpersub=0x7f7f53187cc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53276570,_skyfluxpersub=0x7f7f532767c0,
 _nphotons=1773.27,_skynphotons=0,_tt=[-0.0136697,0.020426],_lastvalidtt=
 [-0.0136697,0.020426],_upttcommand=[0,0],_refmes=0x7f7f51108830,_tiprefv=
 0x7f7f509c3a30,_tiltrefv=0x7f7f509c3230,_tiprefvn=0x7f7f50a2fe30,_tiltrefvn=
 0x7f7f509c5230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506ae340,_jstart=0x7f7f506ae590,_binindices=0x7f7f51815830,
 _binxy=2,_centroidw=0x7f7f5110f7b0,_fimage=0x7f7f509c5a30,_fimage2=0x0,
 _imistart=0x7f7f506aec80,_imjstart=0x7f7f506aeed0,_imistart2=0x7f7f506af120,
 _imjstart2=0x7f7f506af370,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f5069f0d0,
 _lgs_defocuses=0x7f7f5110ea18,_unitdefocus=0x10f45b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51198430,_flat=0x7f7f51192030,_domask=1,
 _submask=0x7f7f50948630,_kernel=0x7f7f50a35030,_kernels=0x10bf15030,_kerfftr=
 0x10c0db030,_kerffti=0x10c25f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50926030,_x=0x7f7f51819230,_y=0x7f7f5181e830,_centroidgain=1,_rayleigh=
 0x7f7f5110f0a8,_bckgrdcalib=0x7f7f51192a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107128)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51110038,_ctrlden=0x7f7f52001db8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53102070,_xlast=0x7f7f5327b090,_ylast=[0x7f7f50941c30,0x7f7f50941c30,
 0x7f7f50941c30],_y0=0x7f7f50a36630,_signus=0x7f7f53280340,_puppixoffset=[0,0],
 _nact=80,_def=0x110160030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eac0,xposition=0x7f7f5110f580,yposition=
 0x7f7f5110ebd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002918,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.008,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      531.0   0.001     2445.8
Field Avg  1.65                    531.0   0.001     2445.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51113ad0,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51113938,winddir=0x7f7f51111ca8,
 _layeralt=0x7f7f51113c68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51104b78,lgs_prof_alt=0x7f7f5110e548,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f5327d0a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507ac1c0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cc1d030,_masks=0x0,_fluxpersub=0x7f7f531022f0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5326e2a0,_skyfluxpersub=0x7f7f53187cc0,
 _nphotons=8.82439e-15,_skynphotons=0,_tt=[0.0117291,0.0164644],_lastvalidtt=
 [0.0117291,0.0164644],_upttcommand=[0,0],_refmes=0x7f7f509d0c30,_tiprefv=
 0x7f7f50a31e30,_tiltrefv=0x7f7f50a45a30,_tiprefvn=0x7f7f509c3a30,_tiltrefvn=
 0x7f7f509c3230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ad1e0,_jstart=0x7f7f507ad430,_binindices=0x7f7f52085630,
 _binxy=2,_centroidw=0x7f7f5110fc48,_fimage=0x7f7f50a44430,_fimage2=0x0,
 _imistart=0x7f7f507adfa0,_imjstart=0x7f7f507ae1f0,_imistart2=0x7f7f507ae440,
 _imjstart2=0x7f7f507ae690,_unittip=0x7f7f507adb20,_unittilt=0x7f7f507acb70,
 _lgs_defocuses=0x7f7f5110f890,_unitdefocus=0x10d836030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5119a430,_flat=0x7f7f50a45030,_domask=1,
 _submask=0x7f7f50a43630,_kernel=0x7f7f50a33830,_kernels=0x10c25f030,_kerfftr=
 0x10c00f030,_kerffti=0x10bf15030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50926030,_x=0x7f7f52009e30,_y=0x7f7f52084a30,_centroidgain=1,_rayleigh=
 0x7f7f5110fc80,_bckgrdcalib=0x7f7f50948630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ecf0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110f0e0,_ctrlden=0x7f7f511071d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52922690,_xlast=0x7f7f53102070,_ylast=[0x7f7f50a36630,0x7f7f50a36630,
 0x7f7f50a36630],_y0=0x7f7f50949030,_signus=0x7f7f53280fa0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e64b0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eac0,xposition=0x7f7f5110ed60,yposition=
 0x7f7f5110ecb8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002918,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      643.6   0.001     2476.2
Field Avg  1.65                    643.6   0.001     2476.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51113ad0,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51113938,winddir=0x7f7f51111ca8,
 _layeralt=0x7f7f51112948)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51104b78,lgs_prof_alt=0x7f7f5110e548,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506afe10,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5327d470,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cd1e030,_masks=0x0,_fluxpersub=0x7f7f507acb70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507ac1c0,_skyfluxpersub=0x7f7f507ad1e0,
 _nphotons=1.76488e-14,_skynphotons=0,_tt=[0.0145505,0.0365339],_lastvalidtt=
 [0.0145505,0.0365339],_upttcommand=[0,0],_refmes=0x7f7f509d0c30,_tiprefv=
 0x7f7f50a39430,_tiltrefv=0x7f7f50948630,_tiprefvn=0x7f7f50a31e30,_tiltrefvn=
 0x7f7f50a45a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f531022f0,_jstart=0x7f7f53280fa0,_binindices=0x7f7f51198c30,
 _binxy=2,_centroidw=0x7f7f52002448,_fimage=0x7f7f509d8030,_fimage2=0x0,
 _imistart=0x7f7f533e7820,_imjstart=0x7f7f533e6630,_imistart2=0x7f7f533e6880,
 _imjstart2=0x7f7f533e6ad0,_unittip=0x7f7f52922690,_unittilt=0x7f7f53187cc0,
 _lgs_defocuses=0x7f7f5110f7b0,_unitdefocus=0x10f55c030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5208ba30,_flat=0x7f7f5208b030,_domask=1,
 _submask=0x7f7f52078a30,_kernel=0x7f7f52085a30,_kernels=0x10bf15030,_kerfftr=
 0x10c183030,_kerffti=0x10c25f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50a38630,_x=0x7f7f509c3c30,_y=0x7f7f50921830,_centroidgain=1,_rayleigh=
 0x7f7f5110f0a8,_bckgrdcalib=0x7f7f52084030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107128)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ebd8,_ctrlden=0x7f7f511101c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533e59f0,_xlast=0x7f7f528b1560,_ylast=[0x7f7f5119d830,0x7f7f5119d830,
 0x7f7f5119d830],_y0=0x7f7f51177430,_signus=0x7f7f533e5f20,_puppixoffset=[0,0],
 _nact=80,_def=0x110160030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eac0,xposition=0x7f7f5110ee78,yposition=
 0x7f7f5110fa18,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002918,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      920.9   0.001     2314.0
Field Avg  1.65                    920.9   0.001     2314.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51113ad0,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51113938,winddir=0x7f7f51111ca8,
 _layeralt=0x7f7f51112f20)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51104b78,lgs_prof_alt=0x7f7f5110e548,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e6f80,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e7a70,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d634030,_masks=0x0,_fluxpersub=0x7f7f507acb70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507ad720,_skyfluxpersub=0x7f7f507ad970,
 _nphotons=4.41219e-14,_skynphotons=0,_tt=[0.019405,0.00699772],_lastvalidtt=
 [0.019405,0.00699772],_upttcommand=[0,0],_refmes=0x7f7f51154030,_tiprefv=
 0x7f7f509c5a30,_tiltrefv=0x7f7f509c5230,_tiprefvn=0x7f7f50a39430,_tiltrefvn=
 0x7f7f50948630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e7cc0,_jstart=0x7f7f533e7f10,_binindices=0x7f7f50a2fe30,
 _binxy=2,_centroidw=0x7f7f52001fb0,_fimage=0x7f7f50a39c30,_fimage2=0x0,
 _imistart=0x7f7f53272310,_imjstart=0x7f7f53271c80,_imistart2=0x7f7f5327d980,
 _imjstart2=0x7f7f5327d220,_unittip=0x7f7f528b1560,_unittilt=0x7f7f528b28e0,
 _lgs_defocuses=0x7f7f5110fc48,_unitdefocus=0x10cf20030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50a38630,_flat=0x7f7f5119ac30,_domask=1,
 _submask=0x7f7f5207a430,_kernel=0x7f7f5207c830,_kernels=0x10c25f030,_kerfftr=
 0x10c0db030,_kerffti=0x10bf15030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50a33830,_x=0x7f7f5118d630,_y=0x7f7f5114ec30,_centroidgain=1,_rayleigh=
 0x7f7f5110fc80,_bckgrdcalib=0x7f7f51193030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ecf0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52002218,_ctrlden=0x7f7f5110efc8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52922690,_xlast=0x7f7f5327d0a0,_ylast=[0x7f7f50a36630,0x7f7f50a36630,
 0x7f7f50a36630],_y0=0x7f7f509d0c30,_signus=0x7f7f53280fa0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5069f7e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eac0,xposition=0x7f7f51110038,yposition=
 0x7f7f51106f68,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002918,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      837.6   0.001     2520.1
Field Avg  1.65                    837.6   0.001     2520.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51113ad0,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f51113938,winddir=0x7f7f51111ca8,
 _layeralt=0x7f7f51112280)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 50,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f51104b78,lgs_prof_alt=0x7f7f5110e548,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ae5e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528b1560,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10da38030,_masks=0x0,_fluxpersub=0x7f7f5327d980,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f531022f0,_skyfluxpersub=0x7f7f5327d3a0,
 _nphotons=7.05951e-14,_skynphotons=0,_tt=[-0.0366328,0.0032586],_lastvalidtt=
 [-0.0366328,0.0032586],_upttcommand=[0,0],_refmes=0x7f7f509d5e30,_tiprefv=
 0x7f7f51872030,_tiltrefv=0x7f7f5119ac30,_tiprefvn=0x7f7f51872830,_tiltrefvn=
 0x7f7f5119b430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53187cc0,_jstart=0x7f7f53280fa0,_binindices=0x7f7f51191630,
 _binxy=2,_centroidw=0x7f7f51106fd8,_fimage=0x7f7f52084e30,_fimage2=0x0,
 _imistart=0x7f7f533e6b70,_imjstart=0x7f7f533e6dc0,_imistart2=0x7f7f533e7010,
 _imjstart2=0x7f7f533e7260,_unittip=0x7f7f533e6940,_unittilt=0x7f7f533e64c0,
 _lgs_defocuses=0x7f7f52002448,_unitdefocus=0x10f85e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5208b630,_flat=0x7f7f5186f030,_domask=1,
 _submask=0x7f7f50a33830,_kernel=0x7f7f50948630,_kernels=0x10bf15030,_kerfftr=
 0x10bfc6030,_kerffti=0x10c25f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f52084030,_x=0x7f7f52009e30,_y=0x7f7f5200e830,_centroidgain=1,_rayleigh=
 0x7f7f5110f0a8,_bckgrdcalib=0x7f7f5180be30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f51107128)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fc48,_ctrlden=0x7f7f52002058,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5327d220,_xlast=0x7f7f52922690,_ylast=[0x7f7f509d0c30,0x7f7f509d0c30,
 0x7f7f509d0c30],_y0=0x7f7f50a39030,_signus=0x7f7f5327dbd0,_puppixoffset=[0,0],
 _nact=80,_def=0x110160030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5327d0a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110eac0,xposition=0x7f7f5110f0e0,yposition=
 0x7f7f52001db8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52002918,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.008,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51113ad0,layerfrac=0x7f7f51112b68,
 layerspeed=0x7f7f51111e40,layeralt=0x7f7f51111f50,winddir=0x7f7f511134f8,
 _layeralt=0x7f7f51113608)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52001db8,lgs_prof_alt=0x7f7f5110eac0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507aec00,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53272370,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d937030,_masks=0x0,_fluxpersub=0x7f7f507ae9b0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507acb70,_skyfluxpersub=0x7f7f507ac1c0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0040391,-0.000724498],_lastvalidtt=
 [-0.0040391,-0.000724498],_upttcommand=[0,0],_refmes=0x7f7f51263230,_tiprefv=
 0x7f7f50926030,_tiltrefv=0x7f7f5207b630,_tiprefvn=0x7f7f50a33830,_tiltrefvn=
 0x7f7f5207be30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53271c80,_jstart=0x7f7f53271ed0,_binindices=0x7f7f511db830,
 _binxy=2,_centroidw=0x7f7f5110fc80,_fimage=0x7f7f52084e30,_fimage2=0x0,
 _imistart=0x7f7f5327cc20,_imjstart=0x7f7f5327c890,_imistart2=0x7f7f53280340,
 _imjstart2=0x7f7f53281b60,_unittip=0x7f7f52922690,_unittilt=0x7f7f53281930,
 _lgs_defocuses=0x7f7f5110ee40,_unitdefocus=0x10d735030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50a39030,_flat=0x7f7f50a39a30,_domask=1,
 _submask=0x7f7f52084030,_kernel=0x7f7f5119ba30,_kernels=0x10c183030,_kerfftr=
 0x10bfc6030,_kerffti=0x10c25f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f52085830,_x=0x7f7f50a35830,_y=0x7f7f50946830,_centroidgain=1,_rayleigh=
 0x7f7f51104da8,_bckgrdcalib=0x7f7f50a3a430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f511049b8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51110038,_ctrlden=0x7f7f5110ecf0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f530efc20,_ylast=[0x7f7f51193c30,0x7f7f51193c30,
 0x7f7f51193c30],_y0=0x7f7f51177430,_signus=0x7f7f528b1560,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e4f60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f52002058,xposition=0x7f7f5110faf8,yposition=
 0x7f7f520020c8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f51104b78,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.658       98.0
Field Avg  1.65                     54.1   0.658       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f51111ca8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51113d78)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520020c8,lgs_prof_alt=0x7f7f52002058,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506af280,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53187cc0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c931030,_masks=0x0,_fluxpersub=0x7f7f5327ede0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f507acb70,_skyfluxpersub=0x7f7f507ac1c0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00433304,0.00109228],_lastvalidtt=
 [-0.00433304,0.00109228],_upttcommand=[0,0],_refmes=0x7f7f50949030,_tiprefv=
 0x7f7f51283030,_tiltrefv=0x7f7f509c3230,_tiprefvn=0x7f7f51283830,_tiltrefvn=
 0x7f7f51192a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53280fa0,_jstart=0x7f7f53280340,_binindices=0x7f7f5127b030,
 _binxy=2,_centroidw=0x7f7f52002100,_fimage=0x7f7f50948630,_fimage2=0x0,
 _imistart=0x7f7f533e8130,_imjstart=0x7f7f533e8380,_imistart2=0x7f7f533e85d0,
 _imjstart2=0x7f7f533e5f70,_unittip=0x7f7f52922690,_unittilt=0x7f7f5327c490,
 _lgs_defocuses=0x7f7f5110ef20,_unitdefocus=0x10f45b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5208ba30,_flat=0x7f7f5208b030,_domask=1,
 _submask=0x7f7f51195a30,_kernel=0x7f7f51191630,_kernels=0x10c32b030,_kerfftr=
 0x10bfc6030,_kerffti=0x10c25f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5207ae30,_x=0x7f7f50946830,_y=0x7f7f5093de30,_centroidgain=1,_rayleigh=
 0x7f7f51104a60,_bckgrdcalib=0x7f7f52084030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002138)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e708,_ctrlden=0x7f7f51107048,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f530efc20,_xlast=0x7f7f528b1560,_ylast=[0x7f7f5118ea30,0x7f7f5118ea30,
 0x7f7f5118ea30],_y0=0x7f7f51263230,_signus=0x7f7f533e5cb0,_puppixoffset=[0,0],
 _nact=80,_def=0x10db39030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507ad1e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ecf0,xposition=0x7f7f5110fb30,yposition=
 0x7f7f51104da8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001db8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    7026.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.641      101.3
Field Avg  1.65                     54.4   0.641      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f51111ca8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51113690)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520020c8,lgs_prof_alt=0x7f7f52002058,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507accb0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f5327cac0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f85e030,_masks=0x0,_fluxpersub=0x7f7f533e6410,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f533e68b0,_skyfluxpersub=0x7f7f528b1560,
 _nphotons=7026.1,_skynphotons=0,_tt=[0.00435015,-0.00432315],_lastvalidtt=
 [0.00435015,-0.00432315],_upttcommand=[0,0],_refmes=0x7f7f51177430,_tiprefv=
 0x7f7f5119ac30,_tiltrefv=0x7f7f5118d630,_tiprefvn=0x7f7f51283030,_tiltrefvn=
 0x7f7f5119be30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5327bc60,_jstart=0x7f7f53187cc0,_binindices=0x7f7f50948630,
 _binxy=2,_centroidw=0x7f7f511071d0,_fimage=0x7f7f5208b030,_fimage2=0x0,
 _imistart=0x7f7f5327c100,_imjstart=0x7f7f5327c350,_imistart2=0x7f7f53276b90,
 _imjstart2=0x7f7f53276de0,_unittip=0x7f7f53270ee0,_unittilt=0x7f7f5327c890,
 _lgs_defocuses=0x7f7f5110fc48,_unitdefocus=0x10d836030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5118de30,_flat=0x7f7f51191630,_domask=1,
 _submask=0x7f7f5127b030,_kernel=0x7f7f509c3230,_kernels=0x10bd47030,_kerfftr=
 0x10c183030,_kerffti=0x10c32b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5208ba30,_x=0x7f7f50926630,_y=0x7f7f5093de30,_centroidgain=1,_rayleigh=
 0x7f7f511101c0,_bckgrdcalib=0x7f7f51195a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110eac0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f511055f8,_ctrlden=0x7f7f5110ecb8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52922690,_xlast=0x7f7f53280fa0,_ylast=[0x7f7f509d0c30,0x7f7f509d0c30,
 0x7f7f509d0c30],_y0=0x7f7f509d5e30,_signus=0x7f7f53280340,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533e7090,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ecf0,xposition=0x7f7f52002250,yposition=
 0x7f7f5110efc8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001db8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    17565.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.560      114.9
Field Avg  1.65                     54.9   0.560      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f51111ca8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51113580)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520020c8,lgs_prof_alt=0x7f7f52002058,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507accb0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507adc30,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d735030,_masks=0x0,_fluxpersub=0x7f7f53187cc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53280fa0,_skyfluxpersub=0x7f7f5327d0a0,
 _nphotons=17565.3,_skynphotons=0,_tt=[0.00442777,-0.00290434],_lastvalidtt=
 [0.00442777,-0.00290434],_upttcommand=[0,0],_refmes=0x7f7f51154030,_tiprefv=
 0x7f7f5207b630,_tiltrefv=0x7f7f5127ba30,_tiprefvn=0x7f7f5207be30,_tiltrefvn=
 0x7f7f5118d630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ade80,_jstart=0x7f7f507ae0d0,_binindices=0x7f7f51815830,
 _binxy=2,_centroidw=0x7f7f51106fd8,_fimage=0x7f7f52091830,_fimage2=0x0,
 _imistart=0x7f7f506aea50,_imjstart=0x7f7f506aeca0,_imistart2=0x7f7f506aeef0,
 _imjstart2=0x7f7f506af140,_unittip=0x7f7f507ac1c0,_unittilt=0x7f7f507ad1e0,
 _lgs_defocuses=0x7f7f52002100,_unitdefocus=0x10f55c030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50a43630,_flat=0x7f7f51875e30,_domask=1,
 _submask=0x7f7f50a2fe30,_kernel=0x7f7f5208b630,_kernels=0x10c0db030,_kerfftr=
 0x10bfc6030,_kerffti=0x10bd47030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f52084030,_x=0x7f7f52002c30,_y=0x7f7f52085c30,_centroidgain=1,_rayleigh=
 0x7f7f51104a60,_bckgrdcalib=0x7f7f51875430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002138)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110f150,_ctrlden=0x7f7f5110f0e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f533e5390,_xlast=0x7f7f533e5510,_ylast=[0x7f7f51108830,0x7f7f51108830,
 0x7f7f51108830],_y0=0x7f7f51177430,_signus=0x7f7f533e7890,_puppixoffset=[0,0],
 _nact=80,_def=0x110f1c030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ecf0,xposition=0x7f7f5110ebd8,yposition=
 0x7f7f520029f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001db8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    28104.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       57.0   0.397      239.8
Field Avg  1.65                     57.0   0.397      239.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f51111ca8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51112390)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520020c8,lgs_prof_alt=0x7f7f52002058,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e8680,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528b28e0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ce1f030,_masks=0x0,_fluxpersub=0x7f7f506af120,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f506af5f0,_skyfluxpersub=0x7f7f506af840,
 _nphotons=28104.4,_skynphotons=0,_tt=[-0.0136971,0.0196816],_lastvalidtt=
 [-0.0136971,0.0196816],_upttcommand=[0,0],_refmes=0x7f7f5100fc30,_tiprefv=
 0x7f7f50a44a30,_tiltrefv=0x7f7f5180b830,_tiprefvn=0x7f7f50a45230,_tiltrefvn=
 0x7f7f5180c030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e5390,_jstart=0x7f7f533e7560,_binindices=0x7f7f5186f030,
 _binxy=2,_centroidw=0x7f7f5110fa18,_fimage=0x7f7f51262830,_fimage2=0x0,
 _imistart=0x7f7f506ae7e0,_imjstart=0x7f7f506aea30,_imistart2=0x7f7f506aec80,
 _imjstart2=0x7f7f506aeed0,_unittip=0x7f7f533e8ac0,_unittilt=0x7f7f528b1560,
 _lgs_defocuses=0x7f7f511071d0,_unitdefocus=0x10c5ad030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51874430,_flat=0x7f7f51873a30,_domask=1,
 _submask=0x7f7f51877830,_kernel=0x7f7f50948630,_kernels=0x10c25f030,_kerfftr=
 0x10c183030,_kerffti=0x10c0db030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5119ac30,_x=0x7f7f5129aa30,_y=0x7f7f51176630,_centroidgain=1,_rayleigh=
 0x7f7f511101c0,_bckgrdcalib=0x7f7f51878630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110eac0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110fb30,_ctrlden=0x7f7f5110f118,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52922690,_xlast=0x7f7f53187cc0,_ylast=[0x7f7f509d0c30,0x7f7f509d0c30,
 0x7f7f509d0c30],_y0=0x7f7f5095ce30,_signus=0x7f7f53280340,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ecf0,xposition=0x7f7f5110e708,yposition=
 0x7f7f5110e628,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001db8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.008,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.647      101.3
Field Avg  1.65                     54.4   0.647      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f51111ca8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51111fd8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520020c8,lgs_prof_alt=0x7f7f52002058,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ae3c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e85d0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c730030,_masks=0x0,_fluxpersub=0x7f7f53187cc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53280340,_skyfluxpersub=0x7f7f5327ede0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00328782,0.000898791],_lastvalidtt=
 [-0.00328782,0.000898791],_upttcommand=[0,0],_refmes=0x7f7f52011830,_tiprefv=
 0x7f7f52092230,_tiltrefv=0x7f7f5119b630,_tiprefvn=0x7f7f5208f830,_tiltrefvn=
 0x7f7f5119be30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e8de0,_jstart=0x7f7f533e9030,_binindices=0x7f7f51262830,
 _binxy=2,_centroidw=0x7f7f52002918,_fimage=0x7f7f52082e30,_fimage2=0x0,
 _imistart=0x7f7f533e9720,_imjstart=0x7f7f528b1560,_imistart2=0x7f7f528b28e0,
 _imjstart2=0x7f7f533e8820,_unittip=0x7f7f533e5390,_unittilt=0x7f7f533e83a0,
 _lgs_defocuses=0x7f7f51106fd8,_unitdefocus=0x10d233030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51284e30,_flat=0x7f7f51285830,_domask=1,
 _submask=0x7f7f50a2fe30,_kernel=0x7f7f51284030,_kernels=0x10bfc6030,_kerfftr=
 0x10bd47030,_kerffti=0x10c25f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f52078a30,_x=0x7f7f51176630,_y=0x7f7f51072c30,_centroidgain=1,_rayleigh=
 0x7f7f51104a60,_bckgrdcalib=0x7f7f51286230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002138)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e938,_ctrlden=0x7f7f5110ff58,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53280fa0,_xlast=0x7f7f52922690,_ylast=[0x7f7f5095ce30,0x7f7f5095ce30,
 0x7f7f5095ce30],_y0=0x7f7f50a36630,_signus=0x7f7f5327d980,_puppixoffset=[0,0],
 _nact=80,_def=0x110160030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f53280590,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ecf0,xposition=0x7f7f511055f8,yposition=
 0x7f7f51107048,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001db8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    443.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.7   0.636      101.3
Field Avg  1.65                     54.7   0.636      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f51111ca8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51111d30)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520020c8,lgs_prof_alt=0x7f7f52002058,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ae3c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53280fa0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d836030,_masks=0x0,_fluxpersub=0x7f7f5327ede0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5327f030,_skyfluxpersub=0x7f7f5327d980,
 _nphotons=443.317,_skynphotons=0,_tt=[0.00384075,-0.00146159],_lastvalidtt=
 [0.00384075,-0.00146159],_upttcommand=[0,0],_refmes=0x7f7f51806e30,_tiprefv=
 0x7f7f51197630,_tiltrefv=0x7f7f5127ba30,_tiprefvn=0x7f7f5118d630,_tiltrefvn=
 0x7f7f5119b630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5327c890,_jstart=0x7f7f5327cae0,_binindices=0x7f7f51292630,
 _binxy=2,_centroidw=0x7f7f51106f30,_fimage=0x7f7f5208b030,_fimage2=0x0,
 _imistart=0x7f7f533e6270,_imjstart=0x7f7f533e64c0,_imistart2=0x7f7f533e6710,
 _imjstart2=0x7f7f533e6960,_unittip=0x7f7f52922690,_unittilt=0x7f7f53187cc0,
 _lgs_defocuses=0x7f7f5110fa18,_unitdefocus=0x10cc1d030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5119be30,_flat=0x7f7f51294230,_domask=1,
 _submask=0x7f7f50a33830,_kernel=0x7f7f51293430,_kernels=0x10c183030,_kerfftr=
 0x10c0db030,_kerffti=0x10bfc6030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5208ba30,_x=0x7f7f509bf630,_y=0x7f7f5093de30,_centroidgain=1,_rayleigh=
 0x7f7f511101c0,_bckgrdcalib=0x7f7f51294c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110eac0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e970,_ctrlden=0x7f7f5110e708,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f5300fb60,_xlast=0x7f7f528afd30,_ylast=[0x7f7f51263230,0x7f7f51263230,
 0x7f7f51263230],_y0=0x7f7f51193c30,_signus=0x7f7f533e5d60,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5327cd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ecf0,xposition=0x7f7f5110f150,yposition=
 0x7f7f5110ecb8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001db8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    1108.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.558      114.9
Field Avg  1.65                     54.9   0.558      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f51111ca8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51112528)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520020c8,lgs_prof_alt=0x7f7f52002058,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f532718f0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506aea50,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f55c030,_masks=0x0,_fluxpersub=0x7f7f5327f030,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53187cc0,_skyfluxpersub=0x7f7f5327ede0,
 _nphotons=1108.29,_skynphotons=0,_tt=[0.00447387,-0.00341165],_lastvalidtt=
 [0.00447387,-0.00341165],_upttcommand=[0,0],_refmes=0x7f7f51108830,_tiprefv=
 0x7f7f5119be30,_tiltrefv=0x7f7f51262830,_tiprefvn=0x7f7f51197630,_tiltrefvn=
 0x7f7f5127ba30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506aeca0,_jstart=0x7f7f506aeef0,_binindices=0x7f7f5186f030,
 _binxy=2,_centroidw=0x7f7f5110e660,_fimage=0x7f7f50a41e30,_fimage2=0x0,
 _imistart=0x7f7f533e5390,_imjstart=0x7f7f533e7560,_imistart2=0x7f7f533e59f0,
 _imjstart2=0x7f7f533e5c40,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f5069f0d0,
 _lgs_defocuses=0x7f7f52002918,_unitdefocus=0x10cd1e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51199030,_flat=0x7f7f5118d630,_domask=1,
 _submask=0x7f7f50a4b230,_kernel=0x7f7f50a37c30,_kernels=0x10bd47030,_kerfftr=
 0x10c25f030,_kerffti=0x10c183030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50948630,_x=0x7f7f51820c30,_y=0x7f7f5181b030,_centroidgain=1,_rayleigh=
 0x7f7f51104a60,_bckgrdcalib=0x7f7f51191630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002138)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51107048,_ctrlden=0x7f7f5110ea18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f532771f0,_xlast=0x7f7f52922690,_ylast=[0x7f7f50a3aa30,0x7f7f50a3aa30,
 0x7f7f50a3aa30],_y0=0x7f7f5095ce30,_signus=0x7f7f53280fa0,_puppixoffset=[0,0],
 _nact=80,_def=0x110160030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ecf0,xposition=0x7f7f5110fb30,yposition=
 0x7f7f5110f0e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001db8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    1773.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       57.0   0.396      239.8
Field Avg  1.65                     57.0   0.396      239.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f51111ca8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51113cf0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520020c8,lgs_prof_alt=0x7f7f52002058,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ae980,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53280fa0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c5ad030,_masks=0x0,_fluxpersub=0x7f7f528b28e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f5326efc0,_skyfluxpersub=0x7f7f5326f210,
 _nphotons=1773.27,_skynphotons=0,_tt=[-0.0144057,0.0188916],_lastvalidtt=
 [-0.0144057,0.0188916],_upttcommand=[0,0],_refmes=0x7f7f509d5e30,_tiprefv=
 0x7f7f509ee630,_tiltrefv=0x7f7f52078a30,_tiprefvn=0x7f7f509eee30,_tiltrefvn=
 0x7f7f52079230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f5327d980,_jstart=0x7f7f5326e680,_binindices=0x7f7f50a2fe30,
 _binxy=2,_centroidw=0x7f7f51107128,_fimage=0x7f7f52084030,_fimage2=0x0,
 _imistart=0x7f7f5327c890,_imjstart=0x7f7f5326e8d0,_imistart2=0x7f7f5326eb20,
 _imjstart2=0x7f7f5326ed70,_unittip=0x7f7f52922690,_unittilt=0x7f7f53277120,
 _lgs_defocuses=0x7f7f51106f30,_unitdefocus=0x10d634030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50a33830,_flat=0x7f7f50948630,_domask=1,
 _submask=0x7f7f5118d630,_kernel=0x7f7f51262830,_kernels=0x10c0db030,_kerfftr=
 0x10bfc6030,_kerffti=0x10bd47030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5208b030,_x=0x7f7f50a38430,_y=0x7f7f50a44430,_centroidgain=1,_rayleigh=
 0x7f7f511101c0,_bckgrdcalib=0x7f7f509c3230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110eac0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f52001fb0,_ctrlden=0x7f7f52002918,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f507ad1e0,_xlast=0x7f7f507ad360,_ylast=[0x7f7f52012430,0x7f7f52012430,
 0x7f7f52012430],_y0=0x7f7f52011830,_signus=0x7f7f507ad4e0,_puppixoffset=[0,0],
 _nact=80,_def=0x10f95f030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f528afd30,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ecf0,xposition=0x7f7f5110e938,yposition=
 0x7f7f5110f118,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001db8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.008,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      371.6   0.007      952.6
Field Avg  1.65                    371.6   0.007      952.6
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f51111ca8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f5100b450)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520020c8,lgs_prof_alt=0x7f7f52002058,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f507ae3c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f53280340,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f2c3030,_masks=0x0,_fluxpersub=0x7f7f5069f0d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f506ae800,_skyfluxpersub=0x7f7f506aea50,
 _nphotons=0.882439,_skynphotons=0,_tt=[0.0325473,0.00316128],_lastvalidtt=
 [0.0325473,0.00316128],_upttcommand=[0,0],_refmes=0x7f7f5127be30,_tiprefv=
 0x7f7f51198630,_tiltrefv=0x7f7f51197e30,_tiprefvn=0x7f7f511d3a30,_tiltrefvn=
 0x7f7f511d4c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f53276b90,_jstart=0x7f7f53276de0,_binindices=0x7f7f511c9230,
 _binxy=2,_centroidw=0x7f7f5110f7b0,_fimage=0x7f7f511d4230,_fimage2=0x0,
 _imistart=0x7f7f533e7a30,_imjstart=0x7f7f533e99a0,_imistart2=0x7f7f533e9bf0,
 _imjstart2=0x7f7f533e9e40,_unittip=0x7f7f52922690,_unittilt=0x7f7f53187cc0,
 _lgs_defocuses=0x7f7f5110e660,_unitdefocus=0x10d132030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51886630,_flat=0x7f7f5186f030,_domask=1,
 _submask=0x7f7f51815830,_kernel=0x7f7f50a2fe30,_kernels=0x10c25f030,_kerfftr=
 0x10c183030,_kerffti=0x10c0db030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5118e430,_x=0x7f7f50944030,_y=0x7f7f50a35830,_centroidgain=1,_rayleigh=
 0x7f7f51104a60,_bckgrdcalib=0x7f7f51887030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002138)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ed60,_ctrlden=0x7f7f5110fa18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528b16e0,_xlast=0x7f7f530efc20,_ylast=[0x7f7f51154030,0x7f7f51154030,
 0x7f7f51154030],_y0=0x7f7f5118e030,_signus=0x7f7f533f0d00,_puppixoffset=[0,0],
 _nact=80,_def=0x110160030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f52935790,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ecf0,xposition=0x7f7f5110e970,yposition=
 0x7f7f5110ff58,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001db8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    1.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      338.6   0.013      662.1
Field Avg  1.65                    338.6   0.013      662.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f51111ca8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51113250)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520020c8,lgs_prof_alt=0x7f7f52002058,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f53280340,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f528b28e0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10cc1d030,_masks=0x0,_fluxpersub=0x7f7f53282570,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53187cc0,_skyfluxpersub=0x7f7f532745b0,
 _nphotons=1.76488,_skynphotons=0,_tt=[0.0280709,0.0267611],_lastvalidtt=
 [0.0280709,0.0267611],_upttcommand=[0,0],_refmes=0x7f7f52086230,_tiprefv=
 0x7f7f50a38e30,_tiltrefv=0x7f7f52079a30,_tiprefvn=0x7f7f50a39630,_tiltrefvn=
 0x7f7f5207a230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e5390,_jstart=0x7f7f533e8340,_binindices=0x7f7f51198e30,
 _binxy=2,_centroidw=0x7f7f5110ecb8,_fimage=0x7f7f50a48e30,_fimage2=0x0,
 _imistart=0x7f7f533e8a30,_imjstart=0x7f7f533e7560,_imistart2=0x7f7f533e77b0,
 _imjstart2=0x7f7f533e8c80,_unittip=0x7f7f533e7ea0,_unittilt=0x7f7f528b1560,
 _lgs_defocuses=0x7f7f51107128,_unitdefocus=0x10d233030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50948630,_flat=0x7f7f50926030,_domask=1,
 _submask=0x7f7f50a48030,_kernel=0x7f7f51815830,_kernels=0x10bd47030,_kerfftr=
 0x10bfc6030,_kerffti=0x10c25f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f50a39e30,_x=0x7f7f5117c230,_y=0x7f7f5129aa30,_centroidgain=1,_rayleigh=
 0x7f7f511101c0,_bckgrdcalib=0x7f7f50a2fe30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110eac0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f51106de0,_ctrlden=0x7f7f51106f30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53280590,_xlast=0x7f7f53102070,_ylast=[0x7f7f509d5e30,0x7f7f509d5e30,
 0x7f7f509d5e30],_y0=0x7f7f509d0c30,_signus=0x7f7f53280fa0,_puppixoffset=[0,0],
 _nact=80,_def=0x110961030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ecf0,xposition=0x7f7f51107048,yposition=
 0x7f7f5110e708,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001db8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    4.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.042      479.7
Field Avg  1.65                    117.0   0.042      479.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;//just whether this could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f51111ca8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51113c68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520020c8,lgs_prof_alt=0x7f7f52002058,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e9610,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f507ad1e0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10f1c2030,_masks=0x0,_fluxpersub=0x7f7f533e9cd0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f528b1560,_skyfluxpersub=0x7f7f528b28e0,
 _nphotons=4.41219,_skynphotons=0,_tt=[-0.00523035,0.0347795],_lastvalidtt=
 [-0.00523035,0.0347795],_upttcommand=[0,0],_refmes=0x7f7f50a48a30,_tiprefv=
 0x7f7f50a37c30,_tiltrefv=0x7f7f5127ba30,_tiprefvn=0x7f7f50a38e30,_tiltrefvn=
 0x7f7f511c7a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f507ad430,_jstart=0x7f7f507ad680,_binindices=0x7f7f52078a30,
 _binxy=2,_centroidw=0x7f7f5110eb30,_fimage=0x7f7f5118e430,_fimage2=0x0,
 _imistart=0x7f7f507add70,_imjstart=0x7f7f507adfc0,_imistart2=0x7f7f507ae210,
 _imjstart2=0x7f7f507ae460,_unittip=0x7f7f507acb70,_unittilt=0x7f7f507ac1c0,
 _lgs_defocuses=0x7f7f5110f7b0,_unitdefocus=0x10c931030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f5119be30,_flat=0x7f7f50a38430,_domask=1,
 _submask=0x7f7f5118d630,_kernel=0x7f7f5180b030,_kernels=0x10c0db030,_kerfftr=
 0x10c183030,_kerffti=0x10bd47030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f511c7030,_x=0x7f7f52087630,_y=0x7f7f5208b030,_centroidgain=1,_rayleigh=
 0x7f7f51104a60,_bckgrdcalib=0x7f7f50a48030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f52002138)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110ff58,_ctrlden=0x7f7f5110e9e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f53187cc0,_xlast=0x7f7f53280590,_ylast=[0x7f7f509d0c30,0x7f7f509d0c30,
 0x7f7f509d0c30],_y0=0x7f7f50a36630,_signus=0x7f7f53273b50,_puppixoffset=[0,0],
 _nact=80,_def=0x10fd60030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f533df8a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ecf0,xposition=0x7f7f52001fb0,yposition=
 0x7f7f5110ea18,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001db8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    7.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      109.8   0.057      429.0
Field Avg  1.65                    109.8   0.057      429.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;//just whether this could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51112b68,layerfrac=0x7f7f51111e40,
 layerspeed=0x7f7f51113ad0,layeralt=0x7f7f51111ca8,winddir=0x7f7f51113938,
 _layeralt=0x7f7f51112838)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f520020c8,lgs_prof_alt=0x7f7f52002058,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f533e94f0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f506a0290,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d634030,_masks=0x0,_fluxpersub=0x7f7f53187cc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53274b60,_skyfluxpersub=0x7f7f53273b50,
 _nphotons=7.05951,_skynphotons=0,_tt=[-0.00256391,0.0290155],_lastvalidtt=
 [-0.00256391,0.0290155],_upttcommand=[0,0],_refmes=0x7f7f51806e30,_tiprefv=
 0x7f7f5118de30,_tiltrefv=0x7f7f5207ce30,_tiprefvn=0x7f7f5118e630,_tiltrefvn=
 0x7f7f5207d630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f506aea30,_jstart=0x7f7f506aec80,_binindices=0x7f7f5180b030,
 _binxy=2,_centroidw=0x7f7f51104da8,_fimage=0x7f7f51197430,_fimage2=0x0,
 _imistart=0x7f7f506af370,_imjstart=0x7f7f5069f300,_imistart2=0x7f7f506ae340,
 _imjstart2=0x7f7f506ae590,_unittip=0x7f7f506a2f10,_unittilt=0x7f7f5069f0d0,
 _lgs_defocuses=0x7f7f5110ecb8,_unitdefocus=0x10f85e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f51198830,_flat=0x7f7f51199230,_domask=1,
 _submask=0x7f7f509c3230,_kernel=0x7f7f51298630,_kernels=0x10bfc6030,_kerfftr=
 0x10c25f030,_kerffti=0x10c0db030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f51262830,_x=0x7f7f5181b030,_y=0x7f7f5180da30,_centroidgain=1,_rayleigh=
 0x7f7f511101c0,_bckgrdcalib=0x7f7f51295230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110eac0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110f150,_ctrlden=0x7f7f5110f0e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f52935790,_xlast=0x7f7f52922690,_ylast=[0x7f7f50a36630,0x7f7f50a36630,
 0x7f7f50a36630],_y0=0x7f7f50939a30,_signus=0x7f7f53280fa0,_puppixoffset=[0,0],
 _nact=80,_def=0x110961030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f507acb70,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110ecf0,xposition=0x7f7f5110ed60,yposition=
 0x7f7f52002918,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f52001db8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.008,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub     = 11;
 wfs(n).noise       = 1;//just whether this could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7f51111e40,layerfrac=0x7f7f51113ad0,
 layerspeed=0x7f7f51112b68,layeralt=0x7f7f511134f8,winddir=0x7f7f51111f50,
 _layeralt=0x7f7f511130b8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7f52002918,lgs_prof_alt=0x7f7f5110ecf0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7f506af2c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7f533e68d0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d132030,_masks=0x0,_fluxpersub=0x7f7f53280fa0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7f53281370,_skyfluxpersub=0x7f7f5327bc60,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.081735,0.0290939],_lastvalidtt=
 [-0.081735,0.0290939],_upttcommand=[0,0],_refmes=0x7f7f52011830,_tiprefv=
 0x7f7f50a43630,_tiltrefv=0x7f7f5119b430,_tiprefvn=0x7f7f50a43e30,_tiltrefvn=
 0x7f7f5118d630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7f533e8d70,_jstart=0x7f7f533e8fc0,_binindices=0x7f7f52079e30,
 _binxy=2,_centroidw=0x7f7f51107048,_fimage=0x7f7f5180b030,_fimage2=0x0,
 _imistart=0x7f7f507ad1e0,_imjstart=0x7f7f507ad430,_imistart2=0x7f7f507adfb0,
 _imjstart2=0x7f7f507ae200,_unittip=0x7f7f533e6470,_unittilt=0x7f7f533e66a0,
 _lgs_defocuses=0x7f7f5110f118,_unitdefocus=0x10cd1e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7f50a48a30,_flat=0x7f7f50a48030,_domask=1,
 _submask=0x7f7f509c3230,_kernel=0x7f7f52082230,_kernels=0x10c075030,_kerfftr=
 0x10c25f030,_kerffti=0x10c0db030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7f5186f030,_x=0x7f7f51176630,_y=0x7f7f5119fa30,_centroidgain=1,_rayleigh=
 0x7f7f511055f8,_bckgrdcalib=0x7f7f50a37c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7f5110ee40)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7f5110e938,_ctrlden=0x7f7f5110f708,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7f528afd30,_xlast=0x7f7f528ab700,_ylast=[0x7f7f51154030,0x7f7f51154030,
 0x7f7f51154030],_y0=0x7f7f5100fc30,_signus=0x7f7f533e61b0,_puppixoffset=[0,0],
 _nact=80,_def=0x111f1e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7f5300fb60,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7f5110eee8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7f5110f0e0,xposition=0x7f7f52001d48,yposition=
 0x7f7f520023d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7f520020c8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305ccc8,layerfrac=0x7f7fa305cc40,
 layerspeed=0x7f7fa305cd50,layeralt=0x7f7fa305cdd8,winddir=0x7f7fa305ce60,
 _layeralt=0x7f7fa305cff8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3032440,lgs_prof_alt=0x7f7fa30324b0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1d3cd70,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1e220d0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10557d030,_masks=0x0,_fluxpersub=0x7f7fa1e227c0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1d2aa40,_skyfluxpersub=0x7f7fa1d2ac90,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0813936,0.0302052],_lastvalidtt=
 [-0.0813936,0.0302052],_upttcommand=[0,0],_refmes=0x7f7fa3073a30,_tiprefv=
 0x7f7fa2820830,_tiltrefv=0x7f7fa3071c30,_tiprefvn=0x7f7fa2839c30,_tiltrefvn=
 0x7f7fa3084a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1e22320,_jstart=0x7f7fa1e22570,_binindices=0x7f7fa20e6a30,
 _binxy=2,_centroidw=0x7f7fa303f5a8,_fimage=0x7f7fa20df630,_fimage2=0x0,
 _imistart=0x7f7fa1d31190,_imjstart=0x7f7fa1d313e0,_imistart2=0x7f7fa1d31630,
 _imjstart2=0x7f7fa1d2a7f0,_unittip=0x7f7fa1e20930,_unittilt=0x7f7fa1e21ea0,
 _lgs_defocuses=0x7f7fa303f420,_unitdefocus=0x1083a3030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa20ddc30,_flat=0x7f7fa20dd230,_domask=1,
 _submask=0x7f7fa384a830,_kernel=0x7f7fa3082830,_kernels=0x108c0b030,_kerfftr=
 0x106ae7030,_kerffti=0x106a81030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa20b9030,_x=0x7f7fa283a430,_y=0x7f7fa283b030,_centroidgain=1,_rayleigh=
 0x7f7fa303f618,_bckgrdcalib=0x7f7fa20e0630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032558)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f7a0,_ctrlden=0x7f7fa303f5e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1e03920,_xlast=0x7f7fa1e207b0,_ylast=[0x7f7fa28d4030,0x7f7fa28d4030,
 0x7f7fa28d4030],_y0=0x7f7fa2839830,_signus=0x7f7fa1e21be0,_puppixoffset=[0,0],
 _nact=80,_def=0x106eb5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1f0fab0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3032360,xposition=0x7f7fa3032248,yposition=
 0x7f7fa303fd88,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032328,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305ccc8,layerfrac=0x7f7fa305cc40,
 layerspeed=0x7f7fa305cd50,layeralt=0x7f7fa305cdd8,winddir=0x7f7fa305ce60,
 _layeralt=0x7f7fa305d190)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3032440,lgs_prof_alt=0x7f7fa30324b0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1e3da40,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1c12ad0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10547c030,_masks=0x0,_fluxpersub=0x7f7fa1e31e90,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1e320e0,_skyfluxpersub=0x7f7fa1e32330,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00675735,0.00590705],_lastvalidtt=
 [-0.00675735,0.00590705],_upttcommand=[0,0],_refmes=0x7f7fa28d6a30,_tiprefv=
 0x7f7fa3846e30,_tiltrefv=0x7f7fa283a630,_tiprefvn=0x7f7fa384a830,_tiltrefvn=
 0x7f7fa28daa30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1c15530,_jstart=0x7f7fa1c15780,_binindices=0x7f7fa2839830,
 _binxy=2,_centroidw=0x7f7fa3032718,_fimage=0x7f7fa284b630,_fimage2=0x0,
 _imistart=0x7f7fa1e2ff60,_imjstart=0x7f7fa1e207b0,_imistart2=0x7f7fa1e225a0,
 _imjstart2=0x7f7fa1e31c40,_unittip=0x7f7fa1c14970,_unittilt=0x7f7fa1c15300,
 _lgs_defocuses=0x7f7fa303f148,_unitdefocus=0x1085a3030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa284c030,_flat=0x7f7fa20b9030,_domask=1,
 _submask=0x7f7fa28dbc30,_kernel=0x7f7fa283b830,_kernels=0x108ba5030,_kerfftr=
 0x109379030,_kerffti=0x108c0b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2820830,_x=0x7f7fa3071c30,_y=0x7f7fa3085e30,_centroidgain=1,_rayleigh=
 0x7f7fa303f180,_bckgrdcalib=0x7f7fa20b8630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa30322f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f068,_ctrlden=0x7f7fa3030b48,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1d3cb20,_xlast=0x7f7fa1d31e20,_ylast=[0x7f7fa2099830,0x7f7fa2099830,
 0x7f7fa2099830],_y0=0x7f7fa20de230,_signus=0x7f7fa1d35f00,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1c14370,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3032360,xposition=0x7f7fa3032478,yposition=
 0x7f7fa303f378,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032328,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.658       98.0
Field Avg  1.65                     54.3   0.658       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305ccc8,layerfrac=0x7f7fa305cc40,
 layerspeed=0x7f7fa305cd50,layeralt=0x7f7fa305cdd8,winddir=0x7f7fa305ce60,
 _layeralt=0x7f7fa3055f40)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3032440,lgs_prof_alt=0x7f7fa30324b0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1f217c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1d35f00,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x104f79030,_masks=0x0,_fluxpersub=0x7f7fa1d4cd40,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1d4b410,_skyfluxpersub=0x7f7fa1d4cf90,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00374977,0.000133157],_lastvalidtt=
 [-0.00374977,0.000133157],_upttcommand=[0,0],_refmes=0x7f7fa28dc630,_tiprefv=
 0x7f7fa20b9030,_tiltrefv=0x7f7fa3076c30,_tiprefvn=0x7f7fa2105c30,_tiltrefvn=
 0x7f7fa3077430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1d47fe0,_jstart=0x7f7fa1d491a0,_binindices=0x7f7fa20e1230,
 _binxy=2,_centroidw=0x7f7fa3030e20,_fimage=0x7f7fa3885630,_fimage2=0x0,
 _imistart=0x7f7fa1d4c400,_imjstart=0x7f7fa1d4c650,_imistart2=0x7f7fa1d4c8a0,
 _imjstart2=0x7f7fa1d4caf0,_unittip=0x7f7fa1e3c2a0,_unittilt=0x7f7fa1e3dcc0,
 _lgs_defocuses=0x7f7fa303f5a8,_unitdefocus=0x1082a2030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa210fe30,_flat=0x7f7fa2832830,_domask=1,
 _submask=0x7f7fa210f030,_kernel=0x7f7fa2107230,_kernels=0x106ae7030,_kerfftr=
 0x106b4d030,_kerffti=0x108ba5030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa3846630,_x=0x7f7fa20de630,_y=0x7f7fa20dec30,_centroidgain=1,_rayleigh=
 0x7f7fa303f618,_bckgrdcalib=0x7f7fa2849c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032558)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3032750,_ctrlden=0x7f7fa3032638,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1e3e340,_xlast=0x7f7fa1e3c930,_ylast=[0x7f7fa28ce230,0x7f7fa28ce230,
 0x7f7fa28ce230],_y0=0x7f7fa28d6a30,_signus=0x7f7fa1e21df0,_puppixoffset=[0,0],
 _nact=80,_def=0x106eb5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1d4a050,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3032360,xposition=0x7f7fa303f500,yposition=
 0x7f7fa303f2d0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032328,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cc40,layerfrac=0x7f7fa305cd50,
 layerspeed=0x7f7fa305ccc8,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa30561e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa303f260,lgs_prof_alt=0x7f7fa3032360,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1d6b0d0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1e4fa10,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109278030,_masks=0x0,_fluxpersub=0x7f7fa1e52350,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1e20520,_skyfluxpersub=0x7f7fa1e525a0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0825932,0.0297239],_lastvalidtt=
 [-0.0825932,0.0297239],_upttcommand=[0,0],_refmes=0x7f7fa3044830,_tiprefv=
 0x7f7fa384b630,_tiltrefv=0x7f7fa3071c30,_tiprefvn=0x7f7fa384be30,_tiltrefvn=
 0x7f7fa3077630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1e46de0,_jstart=0x7f7fa1e51150,_binindices=0x7f7fa283b230,
 _binxy=2,_centroidw=0x7f7fa303f618,_fimage=0x7f7fa283c030,_fimage2=0x0,
 _imistart=0x7f7fa1e50c70,_imjstart=0x7f7fa1e51c60,_imistart2=0x7f7fa1e51eb0,
 _imjstart2=0x7f7fa1e52100,_unittip=0x7f7fa1e50650,_unittilt=0x7f7fa1e4f7e0,
 _lgs_defocuses=0x7f7fa3030de8,_unitdefocus=0x107e9f030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa2839830,_flat=0x7f7fa281f630,_domask=1,
 _submask=0x7f7fa28d9c30,_kernel=0x7f7fa28d8e30,_kernels=0x106bfc030,_kerfftr=
 0x109379030,_kerffti=0x106ae7030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa28cd830,_x=0x7f7fa2833030,_y=0x7f7fa2820430,_centroidgain=1,_rayleigh=
 0x7f7fa3031050,_bckgrdcalib=0x7f7fa283a230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303fdc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3030b80,_ctrlden=0x7f7fa3030c98,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1d35f00,_xlast=0x7f7fa1d6a590,_ylast=[0x7f7fa2055030,0x7f7fa2055030,
 0x7f7fa2055030],_y0=0x7f7fa2099830,_signus=0x7f7fa1d6a980,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1e51800,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa303f378,xposition=0x7f7fa303f180,yposition=
 0x7f7fa303fdf8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032440,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cc40,layerfrac=0x7f7fa305cd50,
 layerspeed=0x7f7fa305ccc8,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa30565a0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa303f260,lgs_prof_alt=0x7f7fa3032360,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1e4f7e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1d6a590,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1087a3030,_masks=0x0,_fluxpersub=0x7f7fa1f1e160,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1f20360,_skyfluxpersub=0x7f7fa1f205b0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00835927,0.00575745],_lastvalidtt=
 [-0.00835927,0.00575745],_upttcommand=[0,0],_refmes=0x7f7fa20c2630,_tiprefv=
 0x7f7fa20e7030,_tiltrefv=0x7f7fa210ee30,_tiprefvn=0x7f7fa20dfa30,_tiltrefvn=
 0x7f7fa20e0e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1d6a980,_jstart=0x7f7fa1d6c2e0,_binindices=0x7f7fa20b8a30,
 _binxy=2,_centroidw=0x7f7fa3030ec8,_fimage=0x7f7fa283a630,_fimage2=0x0,
 _imistart=0x7f7fa1d6cb30,_imjstart=0x7f7fa1d6cd80,_imistart2=0x7f7fa1d6cfd0,
 _imjstart2=0x7f7fa1d6d220,_unittip=0x7f7fa1d5d670,_unittilt=0x7f7fa1d69da0,
 _lgs_defocuses=0x7f7fa303f068,_unitdefocus=0x107d9e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3846630,_flat=0x7f7fa3883430,_domask=1,
 _submask=0x7f7fa385be30,_kernel=0x7f7fa3842c30,_kernels=0x108c0b030,_kerfftr=
 0x106b4d030,_kerffti=0x106bfc030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa20e1630,_x=0x7f7fa20dd230,_y=0x7f7fa20e0230,_centroidgain=1,_rayleigh=
 0x7f7fa30310c0,_bckgrdcalib=0x7f7fa3847030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa30324b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa30310f8,_ctrlden=0x7f7fa30324e8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1d6a410,_xlast=0x7f7fa1d35f00,_ylast=[0x7f7fa2099830,0x7f7fa2099830,
 0x7f7fa2099830],_y0=0x7f7fa2106230,_signus=0x7f7fa1d26530,_puppixoffset=[0,0],
 _nact=80,_def=0x106eb5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1d6c530,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa303f378,xposition=0x7f7fa30322b8,yposition=
 0x7f7fa3030b48,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032440,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.658       98.0
Field Avg  1.65                     54.3   0.658       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cc40,layerfrac=0x7f7fa305cd50,
 layerspeed=0x7f7fa305ccc8,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa3056408)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa303f260,lgs_prof_alt=0x7f7fa3032360,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1d6cc10,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1e513a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x107fa0030,_masks=0x0,_fluxpersub=0x7f7fa1d5d670,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1d5ed90,_skyfluxpersub=0x7f7fa1d26530,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00453573,-0.000713945],_lastvalidtt=
 [-0.00453573,-0.000713945],_upttcommand=[0,0],_refmes=0x7f7fa28c6630,_tiprefv=
 0x7f7fa283ba30,_tiltrefv=0x7f7fa2820e30,_tiprefvn=0x7f7fa283c230,_tiltrefvn=
 0x7f7fa2857230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1e528c0,_jstart=0x7f7fa1e52b10,_binindices=0x7f7fa3085e30,
 _binxy=2,_centroidw=0x7f7fa303f1b8,_fimage=0x7f7fa20e3030,_fimage2=0x0,
 _imistart=0x7f7fa1c24d00,_imjstart=0x7f7fa1c24f50,_imistart2=0x7f7fa1c251a0,
 _imjstart2=0x7f7fa1c253f0,_unittip=0x7f7fa1e4fa30,_unittilt=0x7f7fa1e20520,
 _lgs_defocuses=0x7f7fa303f618,_unitdefocus=0x10537b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa20be430,_flat=0x7f7fa20e5c30,_domask=1,
 _submask=0x7f7fa2114230,_kernel=0x7f7fa28d8e30,_kernels=0x106bfc030,_kerfftr=
 0x109379030,_kerffti=0x108c0b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2104e30,_x=0x7f7fa283b030,_y=0x7f7fa2849c30,_centroidgain=1,_rayleigh=
 0x7f7fa3031050,_bckgrdcalib=0x7f7fa20b8a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303fdc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3032478,_ctrlden=0x7f7fa3032248,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1d6c6b0,_xlast=0x7f7fa1d6a410,_ylast=[0x7f7fa2106230,0x7f7fa2106230,
 0x7f7fa2106230],_y0=0x7f7fa2055030,_signus=0x7f7fa1d6a980,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1d69d90,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa303f378,xposition=0x7f7fa3030fe0,yposition=
 0x7f7fa3032638,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032440,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       71.4   0.159      324.3
Field Avg  1.65                     71.4   0.159      324.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cc40,layerfrac=0x7f7fa305cd50,
 layerspeed=0x7f7fa305ccc8,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa3056050)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa303f260,lgs_prof_alt=0x7f7fa3032360,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1d69c60,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1c1a6b0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x104e78030,_masks=0x0,_fluxpersub=0x7f7fa1f1e160,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1f24db0,_skyfluxpersub=0x7f7fa1f25000,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0150317,0.0367391],_lastvalidtt=
 [-0.0150317,0.0367391],_upttcommand=[0,0],_refmes=0x7f7fa2859c30,_tiprefv=
 0x7f7fa3074e30,_tiltrefv=0x7f7fa20e4a30,_tiprefvn=0x7f7fa3075630,_tiltrefvn=
 0x7f7fa20e5c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1c1a900,_jstart=0x7f7fa1c1ab50,_binindices=0x7f7fa20be430,
 _binxy=2,_centroidw=0x7f7fa3030e20,_fimage=0x7f7fa386de30,_fimage2=0x0,
 _imistart=0x7f7fa1d35f00,_imjstart=0x7f7fa1d6a980,_imistart2=0x7f7fa1d6a410,
 _imjstart2=0x7f7fa1d6a660,_unittip=0x7f7fa1c19820,_unittilt=0x7f7fa1c1a480,
 _lgs_defocuses=0x7f7fa3030ec8,_unitdefocus=0x108cb2030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3842c30,_flat=0x7f7fa3846630,_domask=1,
 _submask=0x7f7fa3870030,_kernel=0x7f7fa20e3a30,_kernels=0x108c0b030,_kerfftr=
 0x10507a030,_kerffti=0x106bfc030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa384b030,_x=0x7f7fa3073830,_y=0x7f7fa3085e30,_centroidgain=1,_rayleigh=
 0x7f7fa30310c0,_bckgrdcalib=0x7f7fa3870e30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa30324b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f148,_ctrlden=0x7f7fa303f068,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1e51800,_xlast=0x7f7fa1e45910,_ylast=[0x7f7fa288e430,0x7f7fa288e430,
 0x7f7fa288e430],_y0=0x7f7fa28c6630,_signus=0x7f7fa1e21920,_puppixoffset=[0,0],
 _nact=80,_def=0x106eb5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1e51150,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa303f378,xposition=0x7f7fa3030b80,yposition=
 0x7f7fa3032280,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032440,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      118.0   0.070      334.4
Field Avg  1.65                    118.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cc40,layerfrac=0x7f7fa305cd50,
 layerspeed=0x7f7fa305ccc8,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa3055968)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa303f260,lgs_prof_alt=0x7f7fa3032360,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1d75f60,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1f1e160,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x107e9f030,_masks=0x0,_fluxpersub=0x7f7fa1e53300,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1c19820,_skyfluxpersub=0x7f7fa1c1a480,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.0792866,0.0305579],_lastvalidtt=
 [-0.0792866,0.0305579],_upttcommand=[0,0],_refmes=0x7f7fa28ba630,_tiprefv=
 0x7f7fa3078430,_tiltrefv=0x7f7fa3077c30,_tiprefvn=0x7f7fa3074e30,_tiltrefvn=
 0x7f7fa3077230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1f24430,_jstart=0x7f7fa1f24680,_binindices=0x7f7fa2832830,
 _binxy=2,_centroidw=0x7f7fa30326a8,_fimage=0x7f7fa3079630,_fimage2=0x0,
 _imistart=0x7f7fa1e51c60,_imjstart=0x7f7fa1e52420,_imistart2=0x7f7fa1e52670,
 _imjstart2=0x7f7fa1e528c0,_unittip=0x7f7fa1c1a6d0,_unittilt=0x7f7fa1c1a900,
 _lgs_defocuses=0x7f7fa303f1b8,_unitdefocus=0x1088a4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3073030,_flat=0x7f7fa3078c30,_domask=1,
 _submask=0x7f7fa20dd230,_kernel=0x7f7fa3085e30,_kernels=0x106bfc030,_kerfftr=
 0x109379030,_kerffti=0x108c0b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa3076030,_x=0x7f7fa3847230,_y=0x7f7fa3847830,_centroidgain=1,_rayleigh=
 0x7f7fa3031050,_bckgrdcalib=0x7f7fa3075630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303fdc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f7a0,_ctrlden=0x7f7fa28e0230,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1d6a980,_xlast=0x7f7fa1d6ab00,_ylast=[0x7f7fa2099830,0x7f7fa2099830,
 0x7f7fa2099830],_y0=0x7f7fa20bee30,_signus=0x7f7fa1d69b40,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1d6a410,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa303f378,xposition=0x7f7fa30310f8,yposition=
 0x7f7fa3030c98,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032440,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.568      114.9
Field Avg  1.65                     55.4   0.568      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cc40,layerfrac=0x7f7fa305cd50,
 layerspeed=0x7f7fa305ccc8,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa3056518)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa303f260,lgs_prof_alt=0x7f7fa3032360,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1c21060,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1f29a00,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x106db4030,_masks=0x0,_fluxpersub=0x7f7fa1f2aed0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1f2b120,_skyfluxpersub=0x7f7fa1f24430,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00999245,0.0056295],_lastvalidtt=
 [-0.00999245,0.0056295],_upttcommand=[0,0],_refmes=0x7f7fa383e830,_tiprefv=
 0x7f7fa3073030,_tiltrefv=0x7f7fa2833030,_tiprefvn=0x7f7fa3078430,_tiltrefvn=
 0x7f7fa281f630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1f29c50,_jstart=0x7f7fa1f29ea0,_binindices=0x7f7fa3875630,
 _binxy=2,_centroidw=0x7f7fa303f5e0,_fimage=0x7f7fa307c430,_fimage2=0x0,
 _imistart=0x7f7fa1f2a590,_imjstart=0x7f7fa1f2a7e0,_imistart2=0x7f7fa1f2aa30,
 _imjstart2=0x7f7fa1f2ac80,_unittip=0x7f7fa1f1e160,_unittilt=0x7f7fa1f283a0,
 _lgs_defocuses=0x7f7fa3030e20,_unitdefocus=0x109177030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3882830,_flat=0x7f7fa384d030,_domask=1,
 _submask=0x7f7fa3877c30,_kernel=0x7f7fa3876e30,_kernels=0x108c0b030,_kerfftr=
 0x105243030,_kerffti=0x106bfc030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa307ce30,_x=0x7f7fa3885630,_y=0x7f7fa3846c30,_centroidgain=1,_rayleigh=
 0x7f7fa30310c0,_bckgrdcalib=0x7f7fa3883230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa30324b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3030cd0,_ctrlden=0x7f7fa3030e58,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1e52890,_xlast=0x7f7fa1e52e30,_ylast=[0x7f7fa284a630,0x7f7fa284a630,
 0x7f7fa284a630],_y0=0x7f7fa28ba630,_signus=0x7f7fa1e5d020,_puppixoffset=[0,0],
 _nact=80,_def=0x106eb5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1e52fb0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa303f378,xposition=0x7f7fa3032478,yposition=
 0x7f7fa30324e8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032440,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.645      101.3
Field Avg  1.65                     54.4   0.645      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cc40,layerfrac=0x7f7fa305cd50,
 layerspeed=0x7f7fa305ccc8,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa3056380)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa303f260,lgs_prof_alt=0x7f7fa3032360,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1d94b50,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1e68720,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x106cb3030,_masks=0x0,_fluxpersub=0x7f7fa1d83670,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1d838c0,_skyfluxpersub=0x7f7fa1d829a0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.002507,-0.00032071],_lastvalidtt=
 [-0.002507,-0.00032071],_upttcommand=[0,0],_refmes=0x7f7fa307e230,_tiprefv=
 0x7f7fa3076c30,_tiltrefv=0x7f7fa2857a30,_tiprefvn=0x7f7fa3073030,_tiltrefvn=
 0x7f7fa2833030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1e68970,_jstart=0x7f7fa1e660d0,_binindices=0x7f7fa281f630,
 _binxy=2,_centroidw=0x7f7fa3030f38,_fimage=0x7f7fa2106e30,_fimage2=0x0,
 _imistart=0x7f7fa1e667c0,_imjstart=0x7f7fa1e67050,_imistart2=0x7f7fa1e672a0,
 _imjstart2=0x7f7fa1e674f0,_unittip=0x7f7fa1e5d020,_unittilt=0x7f7fa1e684f0,
 _lgs_defocuses=0x7f7fa30326a8,_unitdefocus=0x107d9e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa2820430,_flat=0x7f7fa28d8e30,_domask=1,
 _submask=0x7f7fa210a030,_kernel=0x7f7fa20b8a30,_kernels=0x106bfc030,_kerfftr=
 0x109379030,_kerffti=0x108c0b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2105c30,_x=0x7f7fa284a230,_y=0x7f7fa283a230,_centroidgain=1,_rayleigh=
 0x7f7fa3031050,_bckgrdcalib=0x7f7fa28d9830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303fdc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3030c98,_ctrlden=0x7f7fa303f618,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1d834f0,_xlast=0x7f7fa1d77d70,_ylast=[0x7f7fa2055030,0x7f7fa2055030,
 0x7f7fa2055030],_y0=0x7f7fa2099830,_signus=0x7f7fa1d7c440,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1c253c0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa303f378,xposition=0x7f7fa303f148,yposition=
 0x7f7fa3032248,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032440,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       73.1   0.145      331.1
Field Avg  1.65                     73.1   0.145      331.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cc40,layerfrac=0x7f7fa305cd50,
 layerspeed=0x7f7fa305ccc8,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa3055c10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa303f260,lgs_prof_alt=0x7f7fa3032360,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1e7f270,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1d92170,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10557d030,_masks=0x0,_fluxpersub=0x7f7fa1f2a8d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1f2a680,_skyfluxpersub=0x7f7fa1f2ab20,
 _nphotons=221.659,_skynphotons=0,_tt=[0.0245443,0.00609964],_lastvalidtt=
 [0.0245443,0.00609964],_upttcommand=[0,0],_refmes=0x7f7fa2114c30,_tiprefv=
 0x7f7fa20b8a30,_tiltrefv=0x7f7fa210be30,_tiprefvn=0x7f7fa20b9230,_tiltrefvn=
 0x7f7fa2108830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1d7c440,_jstart=0x7f7fa1d9eb50,_binindices=0x7f7fa28db230,
 _binxy=2,_centroidw=0x7f7fa303f500,_fimage=0x7f7fa20be430,_fimage2=0x0,
 _imistart=0x7f7fa1c1c6a0,_imjstart=0x7f7fa1c21400,_imistart2=0x7f7fa1c21650,
 _imjstart2=0x7f7fa1c20330,_unittip=0x7f7fa1d829a0,_unittilt=0x7f7fa1d91ae0,
 _lgs_defocuses=0x7f7fa303f5e0,_unitdefocus=0x10537b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3846630,_flat=0x7f7fa3842c30,_domask=1,
 _submask=0x7f7fa384cc30,_kernel=0x7f7fa2109030,_kernels=0x108c0b030,_kerfftr=
 0x105243030,_kerffti=0x106bfc030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2104e30,_x=0x7f7fa20c2630,_y=0x7f7fa2114230,_centroidgain=1,_rayleigh=
 0x7f7fa30310c0,_bckgrdcalib=0x7f7fa3885630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa30324b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3030db0,_ctrlden=0x7f7fa3030e20,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1e6f990,_xlast=0x7f7fa1e718f0,_ylast=[0x7f7fa284a630,0x7f7fa284a630,
 0x7f7fa284a630],_y0=0x7f7fa2810230,_signus=0x7f7fa1e73150,_puppixoffset=[0,0],
 _nact=80,_def=0x107593030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1d934e0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa303f378,xposition=0x7f7fa303f7a0,yposition=
 0x7f7fa303f068,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032440,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      157.6   0.046      385.1
Field Avg  1.65                    157.6   0.046      385.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cc40,layerfrac=0x7f7fa305cd50,
 layerspeed=0x7f7fa305ccc8,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa305d080)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa303f260,lgs_prof_alt=0x7f7fa3032360,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1e85db0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1f2a8b0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10547c030,_masks=0x0,_fluxpersub=0x7f7fa1f31270,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1f314c0,_skyfluxpersub=0x7f7fa1f31710,
 _nphotons=0.882439,_skynphotons=0,_tt=[0.0124176,0.0205984],_lastvalidtt=
 [0.0124176,0.0205984],_upttcommand=[0,0],_refmes=0x7f7fa28d4030,_tiprefv=
 0x7f7fa2839830,_tiltrefv=0x7f7fa2849c30,_tiprefvn=0x7f7fa283a030,_tiltrefvn=
 0x7f7fa2856830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1f2ab00,_jstart=0x7f7fa1f300e0,_binindices=0x7f7fa384d030,
 _binxy=2,_centroidw=0x7f7fa3030f70,_fimage=0x7f7fa28d8e30,_fimage2=0x0,
 _imistart=0x7f7fa1f30930,_imjstart=0x7f7fa1f30b80,_imistart2=0x7f7fa1f30dd0,
 _imjstart2=0x7f7fa1f31020,_unittip=0x7f7fa1f2f400,_unittilt=0x7f7fa1f2a680,
 _lgs_defocuses=0x7f7fa3030f38,_unitdefocus=0x1085a5030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3877a30,_flat=0x7f7fa3877030,_domask=1,
 _submask=0x7f7fa3878a30,_kernel=0x7f7fa3073030,_kernels=0x106bfc030,_kerfftr=
 0x109379030,_kerffti=0x108c0b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2858c30,_x=0x7f7fa3842c30,_y=0x7f7fa3843230,_centroidgain=1,_rayleigh=
 0x7f7fa3031050,_bckgrdcalib=0x7f7fa386cc30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303fdc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa30322b8,_ctrlden=0x7f7fa30326a8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1d965c0,_xlast=0x7f7fa1da37d0,_ylast=[0x7f7fa2055030,0x7f7fa2055030,
 0x7f7fa2055030],_y0=0x7f7fa2099830,_signus=0x7f7fa1da3950,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1c25f90,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa303f378,xposition=0x7f7fa3030cd0,yposition=
 0x7f7fa28e0230,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032440,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      196.8   0.030      486.5
Field Avg  1.65                    196.8   0.030      486.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cc40,layerfrac=0x7f7fa305cd50,
 layerspeed=0x7f7fa305ccc8,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa3056270)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa303f260,lgs_prof_alt=0x7f7fa3032360,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1e92de0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1da3950,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x104f79030,_masks=0x0,_fluxpersub=0x7f7fa1db6fd0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1db76c0,_skyfluxpersub=0x7f7fa1db7910,
 _nphotons=0.882439,_skynphotons=0,_tt=[0.0121458,-0.00913524],_lastvalidtt=
 [0.0121458,-0.00913524],_upttcommand=[0,0],_refmes=0x7f7fa20bee30,_tiprefv=
 0x7f7fa3075630,_tiltrefv=0x7f7fa28d9630,_tiprefvn=0x7f7fa3075e30,_tiltrefvn=
 0x7f7fa2849c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1db5b20,_jstart=0x7f7fa1db5d70,_binindices=0x7f7fa2113030,
 _binxy=2,_centroidw=0x7f7fa303f6c0,_fimage=0x7f7fa2820430,_fimage2=0x0,
 _imistart=0x7f7fa1db7470,_imjstart=0x7f7fa1db68e0,_imistart2=0x7f7fa1db6b30,
 _imjstart2=0x7f7fa1db6d80,_unittip=0x7f7fa1da3720,_unittilt=0x7f7fa1db3540,
 _lgs_defocuses=0x7f7fa303f500,_unitdefocus=0x1088a4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa20ddc30,_flat=0x7f7fa20dd230,_domask=1,
 _submask=0x7f7fa20dec30,_kernel=0x7f7fa2109030,_kernels=0x108c0b030,_kerfftr=
 0x10517a030,_kerffti=0x106bfc030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2859630,_x=0x7f7fa20cfe30,_y=0x7f7fa2105c30,_centroidgain=1,_rayleigh=
 0x7f7fa30310c0,_bckgrdcalib=0x7f7fa210fc30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa30324b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f068,_ctrlden=0x7f7fa3030f00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1db4b60,_xlast=0x7f7fa1d965c0,_ylast=[0x7f7fa2099830,0x7f7fa2099830,
 0x7f7fa2099830],_y0=0x7f7fa20b9430,_signus=0x7f7fa1db6440,_puppixoffset=[0,0],
 _nact=80,_def=0x107593030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1db7220,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa303f378,xposition=0x7f7fa3030c98,yposition=
 0x7f7fa3030e58,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032440,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      488.9   0.006      996.5
Field Avg  1.65                    488.9   0.006      996.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cc40,layerfrac=0x7f7fa305cd50,
 layerspeed=0x7f7fa305ccc8,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa3055e30)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa303f260,lgs_prof_alt=0x7f7fa3032360,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1dd7660,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1dc6d20,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1082a2030,_masks=0x0,_fluxpersub=0x7f7fa1e85db0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1e95f20,_skyfluxpersub=0x7f7fa1e8f4c0,
 _nphotons=0.882439,_skynphotons=0,_tt=[-0.0111778,0.00450267],_lastvalidtt=
 [-0.0111778,0.00450267],_upttcommand=[0,0],_refmes=0x7f7fa2055030,_tiprefv=
 0x7f7fa2108630,_tiltrefv=0x7f7fa210be30,_tiprefvn=0x7f7fa3075630,_tiltrefvn=
 0x7f7fa2107630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1db46a0,_jstart=0x7f7fa1db63b0,_binindices=0x7f7fa210ee30,
 _binxy=2,_centroidw=0x7f7fa3030fe0,_fimage=0x7f7fa2120e30,_fimage2=0x0,
 _imistart=0x7f7fa1d963a0,_imjstart=0x7f7fa1da3720,_imistart2=0x7f7fa1da3970,
 _imjstart2=0x7f7fa1db7470,_unittip=0x7f7fa1dc5800,_unittilt=0x7f7fa1db3540,
 _lgs_defocuses=0x7f7fa3030f70,_unitdefocus=0x109177030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa283a630,_flat=0x7f7fa283c030,_domask=1,
 _submask=0x7f7fa2839830,_kernel=0x7f7fa283b230,_kernels=0x106bfc030,_kerfftr=
 0x105243030,_kerffti=0x108c0b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa210fc30,_x=0x7f7fa2105630,_y=0x7f7fa20bd030,_centroidgain=1,_rayleigh=
 0x7f7fa3031050,_bckgrdcalib=0x7f7fa281f630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303fdc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3030f38,_ctrlden=0x7f7fa3030c28,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1e93e50,_xlast=0x7f7fa1e7cda0,_ylast=[0x7f7fa28d4030,0x7f7fa28d4030,
 0x7f7fa28d4030],_y0=0x7f7fa28dae30,_signus=0x7f7fa1e9e7c0,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1e85230,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa303f378,xposition=0x7f7fa3030db0,yposition=
 0x7f7fa303f618,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032440,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      804.0   0.002     1442.5
Field Avg  1.65                    804.0   0.002     1442.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cc40,layerfrac=0x7f7fa305cd50,
 layerspeed=0x7f7fa305ccc8,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa305cee8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa303f260,lgs_prof_alt=0x7f7fa3032360,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1de5130,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1db46a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109278030,_masks=0x0,_fluxpersub=0x7f7fa1ea11f0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1ea1440,_skyfluxpersub=0x7f7fa1e85db0,
 _nphotons=0.882439,_skynphotons=0,_tt=[-0.0516745,0.0190719],_lastvalidtt=
 [-0.0516745,0.0190719],_upttcommand=[0,0],_refmes=0x7f7fa20bee30,_tiprefv=
 0x7f7fa2114030,_tiltrefv=0x7f7fa2106e30,_tiprefvn=0x7f7fa2108630,_tiltrefvn=
 0x7f7fa210be30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1dc7040,_jstart=0x7f7fa1da3970,_binindices=0x7f7fa2849c30,
 _binxy=2,_centroidw=0x7f7fa3032210,_fimage=0x7f7fa20be430,_fimage2=0x0,
 _imistart=0x7f7fa1e9c6f0,_imjstart=0x7f7fa1e9e750,_imistart2=0x7f7fa1ea1810,
 _imjstart2=0x7f7fa1ea1a60,_unittip=0x7f7fa1db3540,_unittilt=0x7f7fa1db7470,
 _lgs_defocuses=0x7f7fa303f6c0,_unitdefocus=0x107d9e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa28d9630,_flat=0x7f7fa284b630,_domask=1,
 _submask=0x7f7fa284f830,_kernel=0x7f7fa28dba30,_kernels=0x108c0b030,_kerfftr=
 0x1052a9030,_kerffti=0x106bfc030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2105830,_x=0x7f7fa20bd030,_y=0x7f7fa2110630,_centroidgain=1,_rayleigh=
 0x7f7fa30310c0,_bckgrdcalib=0x7f7fa28da030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa30324b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f1b8,_ctrlden=0x7f7fa3031018,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1dd57a0,_xlast=0x7f7fa1dd2b00,_ylast=[0x7f7fa2099830,0x7f7fa2099830,
 0x7f7fa2099830],_y0=0x7f7fa2055030,_signus=0x7f7fa1db42d0,_puppixoffset=[0,0],
 _nact=80,_def=0x107593030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1f31140,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa303f378,xposition=0x7f7fa30322b8,yposition=
 0x7f7fa3030e20,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032440,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305ce60,winddir=0x7f7fa305cdd8,
 _layeralt=0x7f7fa3056490)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e20,lgs_prof_alt=0x7f7fa303f378,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1f38140,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1e9c6f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1087a3030,_masks=0x0,_fluxpersub=0x7f7fa1eb1f20,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1ea11f0,_skyfluxpersub=0x7f7fa1ea1440,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0816856,0.0296978],_lastvalidtt=
 [-0.0816856,0.0296978],_upttcommand=[0,0],_refmes=0x7f7fa2055030,_tiprefv=
 0x7f7fa284a230,_tiltrefv=0x7f7fa28daa30,_tiprefvn=0x7f7fa284cc30,_tiltrefvn=
 0x7f7fa284de30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1ea0d50,_jstart=0x7f7fa1eae100,_binindices=0x7f7fa2852030,
 _binxy=2,_centroidw=0x7f7fa3031050,_fimage=0x7f7fa3885630,_fimage2=0x0,
 _imistart=0x7f7fa1eb15e0,_imjstart=0x7f7fa1eb1830,_imistart2=0x7f7fa1eb1a80,
 _imjstart2=0x7f7fa1eb1cd0,_unittip=0x7f7fa1eb0f10,_unittilt=0x7f7fa1e85db0,
 _lgs_defocuses=0x7f7fa28e0230,_unitdefocus=0x108df4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3842c30,_flat=0x7f7fa283b430,_domask=1,
 _submask=0x7f7fa28dba30,_kernel=0x7f7fa307f230,_kernels=0x1050c3030,_kerfftr=
 0x1052a9030,_kerffti=0x106bfc030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa3846630,_x=0x7f7fa284b630,_y=0x7f7fa283c430,_centroidgain=1,_rayleigh=
 0x7f7fa303f148,_bckgrdcalib=0x7f7fa28d8e30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032398)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3030fe0,_ctrlden=0x7f7fa303f618,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1eae350,_xlast=0x7f7fa1eaed80,_ylast=[0x7f7fa28c6630,0x7f7fa28c6630,
 0x7f7fa28c6630],_y0=0x7f7fa28d9c30,_signus=0x7f7fa1e953c0,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1dc7880,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3031018,xposition=0x7f7fa30310c0,yposition=
 0x7f7fa3032328,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa303f260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.567      114.9
Field Avg  1.65                     55.4   0.567      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305ce60,winddir=0x7f7fa305cdd8,
 _layeralt=0x7f7fa305d2a0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e20,lgs_prof_alt=0x7f7fa303f378,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1ea1450,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1e8fe80,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x107fa0030,_masks=0x0,_fluxpersub=0x7f7fa1d491a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1db46a0,_skyfluxpersub=0x7f7fa1db7470,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.00792253,0.00638272],_lastvalidtt=
 [-0.00792253,0.00638272],_upttcommand=[0,0],_refmes=0x7f7fa294de30,_tiprefv=
 0x7f7fa384d030,_tiltrefv=0x7f7fa3076830,_tiprefvn=0x7f7fa3880830,_tiltrefvn=
 0x7f7fa3077030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1eae100,_jstart=0x7f7fa1e953c0,_binindices=0x7f7fa3085e30,
 _binxy=2,_centroidw=0x7f7fa3032248,_fimage=0x7f7fa294e230,_fimage2=0x0,
 _imistart=0x7f7fa1c2d630,_imjstart=0x7f7fa1c2d880,_imistart2=0x7f7fa1c2dad0,
 _imjstart2=0x7f7fa1c2dd20,_unittip=0x7f7fa1ea0d50,_unittilt=0x7f7fa1eaed80,
 _lgs_defocuses=0x7f7fa303fdc0,_unitdefocus=0x10537b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa2109a30,_flat=0x7f7fa2108630,_domask=1,
 _submask=0x7f7fa20be430,_kernel=0x7f7fa294b630,_kernels=0x105129030,_kerfftr=
 0x1051cb030,_kerffti=0x1050c3030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2820230,_x=0x7f7fa284cc30,_y=0x7f7fa294d430,_centroidgain=1,_rayleigh=
 0x7f7fa3030fa8,_bckgrdcalib=0x7f7fa210b430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032360)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3032638,_ctrlden=0x7f7fa3032478,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1f42c80,_xlast=0x7f7fa1f42e00,_ylast=[0x7f7fa3848c30,0x7f7fa3848c30,
 0x7f7fa3848c30],_y0=0x7f7fa383e830,_signus=0x7f7fa1f42f80,_puppixoffset=[0,0],
 _nact=80,_def=0x109379030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1f43240,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3031018,xposition=0x7f7fa3032718,yposition=
 0x7f7fa3030f00,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa303f260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.658       98.0
Field Avg  1.65                     54.4   0.658       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305ce60,winddir=0x7f7fa305cdd8,
 _layeralt=0x7f7fa3055f40)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e20,lgs_prof_alt=0x7f7fa303f378,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1f38a10,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1ea1440,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x107d9e030,_masks=0x0,_fluxpersub=0x7f7fa1d491a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1db46a0,_skyfluxpersub=0x7f7fa1db63b0,
 _nphotons=3513.05,_skynphotons=0,_tt=[-0.0053439,-0.00146947],_lastvalidtt=
 [-0.0053439,-0.00146947],_upttcommand=[0,0],_refmes=0x7f7fa2810230,_tiprefv=
 0x7f7fa28daa30,_tiltrefv=0x7f7fa284cc30,_tiprefvn=0x7f7fa28d8e30,_tiltrefvn=
 0x7f7fa28dc230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1eb0f10,_jstart=0x7f7fa1eb1160,_binindices=0x7f7fa2858e30,
 _binxy=2,_centroidw=0x7f7fa303fdf8,_fimage=0x7f7fa3885630,_fimage2=0x0,
 _imistart=0x7f7fa1eb19b0,_imjstart=0x7f7fa1ea11f0,_imistart2=0x7f7fa1e8fe80,
 _imjstart2=0x7f7fa1e953c0,_unittip=0x7f7fa1e85db0,_unittilt=0x7f7fa1ea0d50,
 _lgs_defocuses=0x7f7fa3031050,_unitdefocus=0x1085a5030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa2109a30,_flat=0x7f7fa2106830,_domask=1,
 _submask=0x7f7fa210a430,_kernel=0x7f7fa284f630,_kernels=0x105297030,_kerfftr=
 0x105231030,_kerffti=0x1050c3030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa3843230,_x=0x7f7fa294b830,_y=0x7f7fa294be30,_centroidgain=1,_rayleigh=
 0x7f7fa303f148,_bckgrdcalib=0x7f7fa2108630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032398)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa28e0230,_ctrlden=0x7f7fa3032280,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1de2360,_xlast=0x7f7fa1dd57a0,_ylast=[0x7f7fa2099830,0x7f7fa2099830,
 0x7f7fa2099830],_y0=0x7f7fa2055030,_signus=0x7f7fa1de36e0,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1f31140,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3031018,xposition=0x7f7fa3032558,yposition=
 0x7f7fa3030c28,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa303f260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    3513.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       73.1   0.163      324.3
Field Avg  1.65                     73.1   0.163      324.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305ce60,winddir=0x7f7fa305cdd8,
 _layeralt=0x7f7fa30558e0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e20,lgs_prof_alt=0x7f7fa303f378,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1e953c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1f373c0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x107e9f030,_masks=0x0,_fluxpersub=0x7f7fa1db63b0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1d491a0,_skyfluxpersub=0x7f7fa1de6210,
 _nphotons=3513.05,_skynphotons=0,_tt=[0.00220538,0.0403207],_lastvalidtt=
 [0.00220538,0.0403207],_upttcommand=[0,0],_refmes=0x7f7fa28ba630,_tiprefv=
 0x7f7fa28d9630,_tiltrefv=0x7f7fa28dba30,_tiprefvn=0x7f7fa28daa30,_tiltrefvn=
 0x7f7fa284cc30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1f37610,_jstart=0x7f7fa1f37860,_binindices=0x7f7fa2849c30,
 _binxy=2,_centroidw=0x7f7fa3030f70,_fimage=0x7f7fa2820230,_fimage2=0x0,
 _imistart=0x7f7fa1e9c6f0,_imjstart=0x7f7fa1eaed80,_imistart2=0x7f7fa1ea0d50,
 _imjstart2=0x7f7fa1eaefd0,_unittip=0x7f7fa1f36f60,_unittilt=0x7f7fa1f37190,
 _lgs_defocuses=0x7f7fa3032248,_unitdefocus=0x1088a4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa284f630,_flat=0x7f7fa2851c30,_domask=1,
 _submask=0x7f7fa20e2030,_kernel=0x7f7fa2850e30,_kernels=0x105129030,_kerfftr=
 0x1051aa030,_kerffti=0x105297030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2850030,_x=0x7f7fa3846630,_y=0x7f7fa384d230,_centroidgain=1,_rayleigh=
 0x7f7fa3030fa8,_bckgrdcalib=0x7f7fa2852630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032360)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f2d0,_ctrlden=0x7f7fa3032718,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1db7470,_xlast=0x7f7fa1de2360,_ylast=[0x7f7fa2055030,0x7f7fa2055030,
 0x7f7fa2055030],_y0=0x7f7fa2110230,_signus=0x7f7fa1d5f0e0,_puppixoffset=[0,0],
 _nact=80,_def=0x106eb5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1e85db0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3031018,xposition=0x7f7fa3030fe0,yposition=
 0x7f7fa3032408,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa303f260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      115.0   0.071      334.4
Field Avg  1.65                    115.0   0.071      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305ce60,winddir=0x7f7fa305cdd8,
 _layeralt=0x7f7fa3055748)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e20,lgs_prof_alt=0x7f7fa303f378,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1db46a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1eb1370,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x106db4030,_masks=0x0,_fluxpersub=0x7f7fa1c2d3e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1c2d630,_skyfluxpersub=0x7f7fa1f36f60,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.0805599,0.0317821],_lastvalidtt=
 [-0.0805599,0.0317821],_upttcommand=[0,0],_refmes=0x7f7fa20bee30,_tiprefv=
 0x7f7fa210aa30,_tiltrefv=0x7f7fa210a230,_tiprefvn=0x7f7fa2113630,_tiltrefvn=
 0x7f7fa2104e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1eb15c0,_jstart=0x7f7fa1eb1810,_binindices=0x7f7fa284dc30,
 _binxy=2,_centroidw=0x7f7fa3030c98,_fimage=0x7f7fa2112c30,_fimage2=0x0,
 _imistart=0x7f7fa1eb2060,_imjstart=0x7f7fa1eb2b80,_imistart2=0x7f7fa1e9c6f0,
 _imjstart2=0x7f7fa1eaed80,_unittip=0x7f7fa1eb0f10,_unittilt=0x7f7fa1eb1140,
 _lgs_defocuses=0x7f7fa303fdf8,_unitdefocus=0x109177030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3842c30,_flat=0x7f7fa3885630,_domask=1,
 _submask=0x7f7fa3073030,_kernel=0x7f7fa20dd230,_kernels=0x105210030,_kerfftr=
 0x1050c3030,_kerffti=0x105129030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2108630,_x=0x7f7fa284cc30,_y=0x7f7fa2820230,_centroidgain=1,_rayleigh=
 0x7f7fa303f148,_bckgrdcalib=0x7f7fa3846630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032398)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3030d78,_ctrlden=0x7f7fa3030b10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1e953c0,_xlast=0x7f7fa1e8fe80,_ylast=[0x7f7fa28ba630,0x7f7fa28ba630,
 0x7f7fa28ba630],_y0=0x7f7fa28d6a30,_signus=0x7f7fa1eae100,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1ea0d50,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3031018,xposition=0x7f7fa3032638,yposition=
 0x7f7fa303f618,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa303f260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       56.5   0.566      114.9
Field Avg  1.65                     56.5   0.566      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305ce60,winddir=0x7f7fa305cdd8,
 _layeralt=0x7f7fa2807650)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e20,lgs_prof_alt=0x7f7fa303f378,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1eb1ab0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1e9c6f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x106cb3030,_masks=0x0,_fluxpersub=0x7f7fa1ea1440,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1eab4d0,_skyfluxpersub=0x7f7fa1eab720,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00842826,0.00726635],_lastvalidtt=
 [-0.00842826,0.00726635],_upttcommand=[0,0],_refmes=0x7f7fa3843630,_tiprefv=
 0x7f7fa2111630,_tiltrefv=0x7f7fa2109030,_tiprefvn=0x7f7fa210aa30,_tiltrefvn=
 0x7f7fa210a230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1e953c0,_jstart=0x7f7fa1eae100,_binindices=0x7f7fa28dba30,
 _binxy=2,_centroidw=0x7f7fa3030ec8,_fimage=0x7f7fa284b630,_fimage2=0x0,
 _imistart=0x7f7fa1ea05e0,_imjstart=0x7f7fa1ea1810,_imistart2=0x7f7fa1ea1a60,
 _imjstart2=0x7f7fa1ea11f0,_unittip=0x7f7fa1e85db0,_unittilt=0x7f7fa1eaed80,
 _lgs_defocuses=0x7f7fa3030f70,_unitdefocus=0x108df4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa2855630,_flat=0x7f7fa2854c30,_domask=1,
 _submask=0x7f7fa2853e30,_kernel=0x7f7fa2853030,_kernels=0x10518f030,_kerfftr=
 0x105297030,_kerffti=0x105210030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa283b830,_x=0x7f7fa284a430,_y=0x7f7fa2820230,_centroidgain=1,_rayleigh=
 0x7f7fa3030fa8,_bckgrdcalib=0x7f7fa2856030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032360)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3031088,_ctrlden=0x7f7fa3032558,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1d5f260,_xlast=0x7f7fa1dd57a0,_ylast=[0x7f7fa2099830,0x7f7fa2099830,
 0x7f7fa2099830],_y0=0x7f7fa2107a30,_signus=0x7f7fa1deede0,_puppixoffset=[0,0],
 _nact=80,_def=0x106eb5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1de2360,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3031018,xposition=0x7f7fa28e0230,yposition=
 0x7f7fa3032478,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa303f260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.646      101.3
Field Avg  1.65                     54.4   0.646      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305ce60,winddir=0x7f7fa305cdd8,
 _layeralt=0x7f7fa30560d8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e20,lgs_prof_alt=0x7f7fa303f378,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1db46a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1e85db0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10557d030,_masks=0x0,_fluxpersub=0x7f7fa1ea1a60,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1ea11f0,_skyfluxpersub=0x7f7fa1ea05e0,
 _nphotons=221.659,_skynphotons=0,_tt=[-0.00627586,-0.00157784],_lastvalidtt=
 [-0.00627586,-0.00157784],_upttcommand=[0,0],_refmes=0x7f7fa3848c30,_tiprefv=
 0x7f7fa28daa30,_tiltrefv=0x7f7fa2106830,_tiprefvn=0x7f7fa2856030,_tiltrefvn=
 0x7f7fa2109030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1eaed80,_jstart=0x7f7fa1e9c6f0,_binindices=0x7f7fa294ac30,
 _binxy=2,_centroidw=0x7f7fa303f5e0,_fimage=0x7f7fa2105e30,_fimage2=0x0,
 _imistart=0x7f7fa1ea0140,_imjstart=0x7f7fa1eaf820,_imistart2=0x7f7fa1ea0390,
 _imjstart2=0x7f7fa1ea1810,_unittip=0x7f7fa1e8fe80,_unittilt=0x7f7fa1ea0d50,
 _lgs_defocuses=0x7f7fa3030c98,_unitdefocus=0x10537b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa284dc30,_flat=0x7f7fa284b630,_domask=1,
 _submask=0x7f7fa294ba30,_kernel=0x7f7fa2856830,_kernels=0x105129030,_kerfftr=
 0x1050c3030,_kerffti=0x10518f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa20be430,_x=0x7f7fa283b830,_y=0x7f7fa2820830,_centroidgain=1,_rayleigh=
 0x7f7fa303f148,_bckgrdcalib=0x7f7fa284e630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032398)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3030b48,_ctrlden=0x7f7fa30324e8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1dc5800,_xlast=0x7f7fa1d5f220,_ylast=[0x7f7fa2107a30,0x7f7fa2107a30,
 0x7f7fa2107a30],_y0=0x7f7fa2055030,_signus=0x7f7fa1def360,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1ea1440,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3031018,xposition=0x7f7fa303f2d0,yposition=
 0x7f7fa3032280,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa303f260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    221.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       73.1   0.146      334.4
Field Avg  1.65                     73.1   0.146      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305ce60,winddir=0x7f7fa305cdd8,
 _layeralt=0x7f7fa3055b88)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e20,lgs_prof_alt=0x7f7fa303f378,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1c2ecc0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1db7470,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10547c030,_masks=0x0,_fluxpersub=0x7f7fa1de6f50,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1de71a0,_skyfluxpersub=0x7f7fa1de5a70,
 _nphotons=221.659,_skynphotons=0,_tt=[0.0113013,-0.00869036],_lastvalidtt=
 [0.0113013,-0.00869036],_upttcommand=[0,0],_refmes=0x7f7fa2114430,_tiprefv=
 0x7f7fa20e4030,_tiltrefv=0x7f7fa2108630,_tiprefvn=0x7f7fa20e4830,_tiltrefvn=
 0x7f7fa2106830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1dc7040,_jstart=0x7f7fa1da3970,_binindices=0x7f7fa2112630,
 _binxy=2,_centroidw=0x7f7fa303f0a0,_fimage=0x7f7fa3073030,_fimage2=0x0,
 _imistart=0x7f7fa1de5820,_imjstart=0x7f7fa1de6860,_imistart2=0x7f7fa1de6ab0,
 _imjstart2=0x7f7fa1de6d00,_unittip=0x7f7fa1de4af0,_unittilt=0x7f7fa1db3540,
 _lgs_defocuses=0x7f7fa3030ec8,_unitdefocus=0x1085a5030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa20e2830,_flat=0x7f7fa20e5a30,_domask=1,
 _submask=0x7f7fa20be430,_kernel=0x7f7fa20dd230,_kernels=0x10525b030,_kerfftr=
 0x1051f5030,_kerffti=0x105129030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa3085e30,_x=0x7f7fa20c2630,_y=0x7f7fa2108e30,_centroidgain=1,_rayleigh=
 0x7f7fa3030fa8,_bckgrdcalib=0x7f7fa210ce30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032360)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa28e0230,_ctrlden=0x7f7fa3032408,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1de2360,_xlast=0x7f7fa1dc5800,_ylast=[0x7f7fa2055030,0x7f7fa2055030,
 0x7f7fa2055030],_y0=0x7f7fa20e6430,_signus=0x7f7fa1de63c0,_puppixoffset=[0,0],
 _nact=80,_def=0x109379030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1dd57a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3031018,xposition=0x7f7fa3030d78,yposition=
 0x7f7fa3032718,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa303f260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      171.0   0.042      385.1
Field Avg  1.65                    171.0   0.042      385.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305ce60,winddir=0x7f7fa305cdd8,
 _layeralt=0x7f7fa3055c98)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e20,lgs_prof_alt=0x7f7fa303f378,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1db46a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1ea0d50,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x104f79030,_masks=0x0,_fluxpersub=0x7f7fa1db63b0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1d491a0,_skyfluxpersub=0x7f7fa1dc7040,
 _nphotons=0.882439,_skynphotons=0,_tt=[-0.0206476,-0.000898726],_lastvalidtt=
 [-0.0206476,-0.000898726],_upttcommand=[0,0],_refmes=0x7f7fa20bee30,_tiprefv=
 0x7f7fa28d8e30,_tiltrefv=0x7f7fa284a230,_tiprefvn=0x7f7fa28d9630,_tiltrefvn=
 0x7f7fa2839830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1eae100,_jstart=0x7f7fa1e953c0,_binindices=0x7f7fa2851e30,
 _binxy=2,_centroidw=0x7f7fa3030b80,_fimage=0x7f7fa2859630,_fimage2=0x0,
 _imistart=0x7f7fa1ea05e0,_imjstart=0x7f7fa1ea1a40,_imistart2=0x7f7fa1eaed80,
 _imjstart2=0x7f7fa1eaefd0,_unittip=0x7f7fa1e85db0,_unittilt=0x7f7fa1ea1810,
 _lgs_defocuses=0x7f7fa303f5e0,_unitdefocus=0x1088a4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa2108630,_flat=0x7f7fa210a230,_domask=1,
 _submask=0x7f7fa20b8a30,_kernel=0x7f7fa20d4430,_kernels=0x10518f030,_kerfftr=
 0x1050c3030,_kerffti=0x10525b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2820230,_x=0x7f7fa284b630,_y=0x7f7fa284ea30,_centroidgain=1,_rayleigh=
 0x7f7fa303f148,_bckgrdcalib=0x7f7fa2109030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032398)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3032280,_ctrlden=0x7f7fa3030e58,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1dc7880,_xlast=0x7f7fa1de2360,_ylast=[0x7f7fa20e6430,0x7f7fa20e6430,
 0x7f7fa20e6430],_y0=0x7f7fa2113030,_signus=0x7f7fa1de6680,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1e8fe80,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3031018,xposition=0x7f7fa3031088,yposition=
 0x7f7fa3030b10,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa303f260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      166.2   0.030      510.1
Field Avg  1.65                    166.2   0.030      510.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305ce60,winddir=0x7f7fa305cdd8,
 _layeralt=0x7f7fa305cff8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e20,lgs_prof_alt=0x7f7fa303f378,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1c2f070,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1ea0d50,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1082a2030,_masks=0x0,_fluxpersub=0x7f7fa1c2cfe0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1c2d3e0,_skyfluxpersub=0x7f7fa1c2d630,
 _nphotons=0.882439,_skynphotons=0,_tt=[-0.00174056,-0.0147876],_lastvalidtt=
 [-0.00174056,-0.0147876],_upttcommand=[0,0],_refmes=0x7f7fa20bee30,_tiprefv=
 0x7f7fa2112030,_tiltrefv=0x7f7fa20be430,_tiprefvn=0x7f7fa2112830,_tiltrefvn=
 0x7f7fa2121830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1eae100,_jstart=0x7f7fa1ea1370,_binindices=0x7f7fa2849c30,
 _binxy=2,_centroidw=0x7f7fa30322b8,_fimage=0x7f7fa3082e30,_fimage2=0x0,
 _imistart=0x7f7fa1eb1160,_imjstart=0x7f7fa1eb13b0,_imistart2=0x7f7fa1eb1600,
 _imjstart2=0x7f7fa1eb1850,_unittip=0x7f7fa1e9c6f0,_unittilt=0x7f7fa1e85db0,
 _lgs_defocuses=0x7f7fa303f0a0,_unitdefocus=0x109177030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3076830,_flat=0x7f7fa3075e30,_domask=1,
 _submask=0x7f7fa3085e30,_kernel=0x7f7fa3073030,_kernels=0x105129030,_kerfftr=
 0x1051f5030,_kerffti=0x10518f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa3083830,_x=0x7f7fa2859630,_y=0x7f7fa2820230,_centroidgain=1,_rayleigh=
 0x7f7fa3030fa8,_bckgrdcalib=0x7f7fa3077230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032360)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3030f38,_ctrlden=0x7f7fa3030d78,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1dd2a50,_xlast=0x7f7fa1dc7880,_ylast=[0x7f7fa2113030,0x7f7fa2113030,
 0x7f7fa2113030],_y0=0x7f7fa20e6030,_signus=0x7f7fa1de94f0,_puppixoffset=[0,0],
 _nact=80,_def=0x109379030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1ea15c0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3031018,xposition=0x7f7fa3030b48,yposition=
 0x7f7fa3032558,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa303f260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      452.9   0.006      922.2
Field Avg  1.65                    452.9   0.006      922.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305ce60,winddir=0x7f7fa305cdd8,
 _layeralt=0x7f7fa30556c0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e20,lgs_prof_alt=0x7f7fa303f378,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1eae100,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1db63b0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x104e78030,_masks=0x0,_fluxpersub=0x7f7fa1de5430,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1de5680,_skyfluxpersub=0x7f7fa1de58d0,
 _nphotons=0.882439,_skynphotons=0,_tt=[0.00128823,-0.0132571],_lastvalidtt=
 [0.00128823,-0.0132571],_upttcommand=[0,0],_refmes=0x7f7fa2055030,_tiprefv=
 0x7f7fa2839830,_tiltrefv=0x7f7fa2849c30,_tiprefvn=0x7f7fa283a030,_tiltrefvn=
 0x7f7fa28d8e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1db7470,_jstart=0x7f7fa1db46a0,_binindices=0x7f7fa20d4430,
 _binxy=2,_centroidw=0x7f7fa3031050,_fimage=0x7f7fa28d9630,_fimage2=0x0,
 _imistart=0x7f7fa1de4af0,_imjstart=0x7f7fa1de4d40,_imistart2=0x7f7fa1de4f90,
 _imjstart2=0x7f7fa1de51e0,_unittip=0x7f7fa1dc7040,_unittilt=0x7f7fa1dd2a50,
 _lgs_defocuses=0x7f7fa3030b80,_unitdefocus=0x108df4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa210ce30,_flat=0x7f7fa20b9030,_domask=1,
 _submask=0x7f7fa2110c30,_kernel=0x7f7fa2106630,_kernels=0x1050c3030,_kerfftr=
 0x10525b030,_kerffti=0x105129030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa284b630,_x=0x7f7fa20bd030,_y=0x7f7fa210a830,_centroidgain=1,_rayleigh=
 0x7f7fa303f148,_bckgrdcalib=0x7f7fa2107430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032398)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f618,_ctrlden=0x7f7fa30326e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1e9c6f0,_xlast=0x7f7fa1ea1330,_ylast=[0x7f7fa28c6630,0x7f7fa28c6630,
 0x7f7fa28c6630],_y0=0x7f7fa28ba630,_signus=0x7f7fa1e8fe80,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1c2cfe0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3031018,xposition=0x7f7fa28e0230,yposition=
 0x7f7fa30324e8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa303f260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    0.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      842.9   0.002     1466.1
Field Avg  1.65                    842.9   0.002     1466.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1e11;
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305ce60,winddir=0x7f7fa305cdd8,
 _layeralt=0x7f7fa3055da8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e20,lgs_prof_alt=0x7f7fa303f378,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1f38a10,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1e85db0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1087a3030,_masks=0x0,_fluxpersub=0x7f7fa1eb8c40,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1eb12c0,_skyfluxpersub=0x7f7fa1eb8e90,
 _nphotons=0.882439,_skynphotons=0,_tt=[0.0241529,0.00611971],_lastvalidtt=
 [0.0241529,0.00611971],_upttcommand=[0,0],_refmes=0x7f7fa2111630,_tiprefv=
 0x7f7fa3847830,_tiltrefv=0x7f7fa3076c30,_tiprefvn=0x7f7fa384be30,_tiltrefvn=
 0x7f7fa3077430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1e8fe80,_jstart=0x7f7fa1eb0f10,_binindices=0x7f7fa2931a30,
 _binxy=2,_centroidw=0x7f7fa303f500,_fimage=0x7f7fa2108630,_fimage2=0x0,
 _imistart=0x7f7fa1ea1440,_imjstart=0x7f7fa1eb8550,_imistart2=0x7f7fa1eb87a0,
 _imjstart2=0x7f7fa1eb89f0,_unittip=0x7f7fa1ea0d50,_unittilt=0x7f7fa1e95540,
 _lgs_defocuses=0x7f7fa30322b8,_unitdefocus=0x10537b030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa2925c30,_flat=0x7f7fa2932830,_domask=1,
 _submask=0x7f7fa2928430,_kernel=0x7f7fa2927630,_kernels=0x10518f030,_kerfftr=
 0x1051f5030,_kerffti=0x1050c3030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa210ce30,_x=0x7f7fa2859a30,_y=0x7f7fa283a230,_centroidgain=1,_rayleigh=
 0x7f7fa3030fa8,_bckgrdcalib=0x7f7fa2839830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=
 0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032360)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa28e01f8,_ctrlden=0x7f7fa3032558,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1dd2a50,_xlast=0x7f7fa1d491a0,_ylast=[0x7f7fa210ba30,0x7f7fa210ba30,
 0x7f7fa210ba30],_y0=0x7f7fa2055030,_signus=0x7f7fa1d5f0e0,_puppixoffset=[0,0],
 _nact=80,_def=0x109379030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1f31140,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3031018,xposition=0x7f7fa3032280,yposition=
 0x7f7fa3032408,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa303f260,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    5796.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.1   0.659       98.0
Field Avg  1.65                     54.1   0.659       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305ccc8,layerfrac=0x7f7fa305cc40,
 layerspeed=0x7f7fa305cd50,layeralt=0x7f7fa305cbb8,winddir=0x7f7fa305cb30,
 _layeralt=0x7f7fa30561e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3032408,lgs_prof_alt=0x7f7fa3031018,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1eb2740,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1e85db0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x107fa0030,_masks=0x0,_fluxpersub=0x7f7fa1e20f70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1ea11f0,_skyfluxpersub=0x7f7fa1ea1440,
 _nphotons=5796.54,_skynphotons=0,_tt=[-0.0047615,-0.00051337],_lastvalidtt=
 [-0.0047615,-0.00051337],_upttcommand=[0,0],_refmes=0x7f7fa28da630,_tiprefv=
 0x7f7fa284dc30,_tiltrefv=0x7f7fa28d9c30,_tiprefvn=0x7f7fa284e430,_tiltrefvn=
 0x7f7fa284ec30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1e20ad0,_jstart=0x7f7fa1e20d20,_binindices=0x7f7fa283b830,
 _binxy=2,_centroidw=0x7f7fa303f148,_fimage=0x7f7fa28d8e30,_fimage2=0x0,
 _imistart=0x7f7fa1db46a0,_imjstart=0x7f7fa1dc7040,_imistart2=0x7f7fa1da3970,
 _imjstart2=0x7f7fa1d25d80,_unittip=0x7f7fa1eb8840,_unittilt=0x7f7fa1e9c6f0,
 _lgs_defocuses=0x7f7fa3030b10,_unitdefocus=0x108aa6030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa284b630,_flat=0x7f7fa20b8a30,_domask=1,
 _submask=0x7f7fa2850e30,_kernel=0x7f7fa2857430,_kernels=0x105ee5030,_kerfftr=
 0x1051f5030,_kerffti=0x1050c3030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa20e4630,_x=0x7f7fa2859630,_y=0x7f7fa283ac30,_centroidgain=1,_rayleigh=
 0x7f7fa3032248,_bckgrdcalib=0x7f7fa20d4430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303fe30)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3031050,_ctrlden=0x7f7fa3030f00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1f31140,_xlast=0x7f7fa1f37cb0,_ylast=[0x7f7fa3848c30,0x7f7fa3848c30,
 0x7f7fa3848c30],_y0=0x7f7fa383e830,_signus=0x7f7fa1f36f60,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1eb0f10,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3032558,xposition=0x7f7fa30326a8,yposition=
 0x7f7fa3030fa8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030e20,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    11593.1
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.641      101.3
Field Avg  1.65                     54.4   0.641      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305ccc8,layerfrac=0x7f7fa305cc40,
 layerspeed=0x7f7fa305cd50,layeralt=0x7f7fa305cbb8,winddir=0x7f7fa305cb30,
 _layeralt=0x7f7fa30559f0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3032408,lgs_prof_alt=0x7f7fa3031018,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1d491a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1de6090,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x107d9e030,_masks=0x0,_fluxpersub=0x7f7fa1c2cfe0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1c11330,_skyfluxpersub=0x7f7fa1c2dba0,
 _nphotons=11593.1,_skynphotons=0,_tt=[0.00385934,-0.00344244],_lastvalidtt=
 [0.00385934,-0.00344244],_upttcommand=[0,0],_refmes=0x7f7fa3044830,_tiprefv=
 0x7f7fa3846630,_tiltrefv=0x7f7fa307ec30,_tiprefvn=0x7f7fa3846e30,_tiltrefvn=
 0x7f7fa3080030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1f37a60,_jstart=0x7f7fa1f37cb0,_binindices=0x7f7fa28dba30,
 _binxy=2,_centroidw=0x7f7fa303f340,_fimage=0x7f7fa20b9030,_fimage2=0x0,
 _imistart=0x7f7fa1f39720,_imjstart=0x7f7fa1db7470,_imistart2=0x7f7fa1db46a0,
 _imjstart2=0x7f7fa1db63b0,_unittip=0x7f7fa1f36f60,_unittilt=0x7f7fa1f38320,
 _lgs_defocuses=0x7f7fa3030aa0,_unitdefocus=0x1085a5030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3081230,_flat=0x7f7fa386ae30,_domask=1,
 _submask=0x7f7fa307da30,_kernel=0x7f7fa3084430,_kernels=0x1050c3030,_kerfftr=
 0x105e7f030,_kerffti=0x105ee5030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa20be430,_x=0x7f7fa20b8a30,_y=0x7f7fa384c430,_centroidgain=1,_rayleigh=
 0x7f7fa3032750,_bckgrdcalib=0x7f7fa3842c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303f378)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f650,_ctrlden=0x7f7fa3030b10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1e85db0,_xlast=0x7f7fa1eb2ed0,_ylast=[0x7f7fa2926230,0x7f7fa2926230,
 0x7f7fa2926230],_y0=0x7f7fa284a630,_signus=0x7f7fa1eb1090,_puppixoffset=[0,0],
 _nact=80,_def=0x107593030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1f31140,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3032558,xposition=0x7f7fa3032280,yposition=
 0x7f7fa3030d78,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030e20,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    28982.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.560      114.9
Field Avg  1.65                     54.9   0.560      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305ccc8,layerfrac=0x7f7fa305cc40,
 layerspeed=0x7f7fa305cd50,layeralt=0x7f7fa305cbb8,winddir=0x7f7fa305cb30,
 _layeralt=0x7f7fa3056270)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3032408,lgs_prof_alt=0x7f7fa3031018,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1db46a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1d5f0e0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10537b030,_masks=0x0,_fluxpersub=0x7f7fa1ea0d50,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1eb1650,_skyfluxpersub=0x7f7fa1eb18a0,
 _nphotons=28982.7,_skynphotons=0,_tt=[0.00473839,-0.00352291],_lastvalidtt=
 [0.00473839,-0.00352291],_upttcommand=[0,0],_refmes=0x7f7fa28d4030,_tiprefv=
 0x7f7fa3086830,_tiltrefv=0x7f7fa210ea30,_tiprefvn=0x7f7fa3080830,_tiltrefvn=
 0x7f7fa210f230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1d25d80,_jstart=0x7f7fa1dec840,_binindices=0x7f7fa20e0430,
 _binxy=2,_centroidw=0x7f7fa3032718,_fimage=0x7f7fa20be430,_fimage2=0x0,
 _imistart=0x7f7fa1decf30,_imjstart=0x7f7fa1ded180,_imistart2=0x7f7fa1ded3d0,
 _imjstart2=0x7f7fa1dedc80,_unittip=0x7f7fa1db3540,_unittilt=0x7f7fa1db7470,
 _lgs_defocuses=0x7f7fa303f148,_unitdefocus=0x1088a4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa28d9830,_flat=0x7f7fa28d8e30,_domask=1,
 _submask=0x7f7fa28dba30,_kernel=0x7f7fa2145e30,_kernels=0x105ee5030,_kerfftr=
 0x1051f5030,_kerffti=0x1050c3030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2108630,_x=0x7f7fa20c2630,_y=0x7f7fa2109430,_centroidgain=1,_rayleigh=
 0x7f7fa3032248,_bckgrdcalib=0x7f7fa2839830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303fe30)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3032328,_ctrlden=0x7f7fa30326a8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1eb14d0,_xlast=0x7f7fa1e85db0,_ylast=[0x7f7fa284a630,0x7f7fa284a630,
 0x7f7fa284a630],_y0=0x7f7fa28ba630,_signus=0x7f7fa1eb1e10,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1eb12a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3032558,xposition=0x7f7fa3030e90,yposition=
 0x7f7fa30326e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030e20,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    46372.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       57.0   0.397      239.8
Field Avg  1.65                     57.0   0.397      239.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305ccc8,layerfrac=0x7f7fa305cc40,
 layerspeed=0x7f7fa305cd50,layeralt=0x7f7fa305cbb8,winddir=0x7f7fa305cb30,
 _layeralt=0x7f7fa30560d8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3032408,lgs_prof_alt=0x7f7fa3031018,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1de5760,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1deded0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x106db4030,_masks=0x0,_fluxpersub=0x7f7fa1e85db0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1e9c6f0,_skyfluxpersub=0x7f7fa1ea0d50,
 _nphotons=46372.3,_skynphotons=0,_tt=[-0.0139508,0.0197999],_lastvalidtt=
 [-0.0139508,0.0197999],_upttcommand=[0,0],_refmes=0x7f7fa383e830,_tiprefv=
 0x7f7fa2110230,_tiltrefv=0x7f7fa3847830,_tiprefvn=0x7f7fa2110a30,_tiltrefvn=
 0x7f7fa384be30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1dee120,_jstart=0x7f7fa1dee370,_binindices=0x7f7fa2108630,
 _binxy=2,_centroidw=0x7f7fa3030cd0,_fimage=0x7f7fa20dd230,_fimage2=0x0,
 _imistart=0x7f7fa1dee810,_imjstart=0x7f7fa1d25d80,_imistart2=0x7f7fa1db7470,
 _imjstart2=0x7f7fa1ded9c0,_unittip=0x7f7fa1db46a0,_unittilt=0x7f7fa1db63b0,
 _lgs_defocuses=0x7f7fa303f340,_unitdefocus=0x106cb3030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa2145230,_flat=0x7f7fa20dfa30,_domask=1,
 _submask=0x7f7fa2858e30,_kernel=0x7f7fa20dec30,_kernels=0x1050c3030,_kerfftr=
 0x105e7f030,_kerffti=0x105ee5030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa20ddc30,_x=0x7f7fa20c2630,_y=0x7f7fa2114230,_centroidgain=1,_rayleigh=
 0x7f7fa3032750,_bckgrdcalib=0x7f7fa20e0430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303f378)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f148,_ctrlden=0x7f7fa28e0230,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1de2360,_xlast=0x7f7fa1d25fd0,_ylast=[0x7f7fa2055030,0x7f7fa2055030,
 0x7f7fa2055030],_y0=0x7f7fa2109630,_signus=0x7f7fa1dedc10,_puppixoffset=[0,0],
 _nact=80,_def=0x106eb5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1eb2dc0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3032558,xposition=0x7f7fa3031050,yposition=
 0x7f7fa303f6c0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030e20,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.008,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    365.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.652      101.3
Field Avg  1.65                     54.3   0.652      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305ccc8,layerfrac=0x7f7fa305cc40,
 layerspeed=0x7f7fa305cd50,layeralt=0x7f7fa305cbb8,winddir=0x7f7fa305cb30,
 _layeralt=0x7f7fa305d218)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3032408,lgs_prof_alt=0x7f7fa3031018,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1eb12f0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1ea0d50,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x108aa6030,_masks=0x0,_fluxpersub=0x7f7fa1f38580,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1f387d0,_skyfluxpersub=0x7f7fa1f38a20,
 _nphotons=365.737,_skynphotons=0,_tt=[-0.00445382,-0.00209346],_lastvalidtt=
 [-0.00445382,-0.00209346],_upttcommand=[0,0],_refmes=0x7f7fa2099830,_tiprefv=
 0x7f7fa3877430,_tiltrefv=0x7f7fa2106630,_tiprefvn=0x7f7fa3877c30,_tiltrefvn=
 0x7f7fa2106e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1eaf820,_jstart=0x7f7fa1eb2f40,_binindices=0x7f7fa307da30,
 _binxy=2,_centroidw=0x7f7fa30322f0,_fimage=0x7f7fa28da030,_fimage2=0x0,
 _imistart=0x7f7fa1c2e040,_imjstart=0x7f7fa1c2e290,_imistart2=0x7f7fa1c2e740,
 _imjstart2=0x7f7fa1c2e990,_unittip=0x7f7fa1e85db0,_unittilt=0x7f7fa1e9c6f0,
 _lgs_defocuses=0x7f7fa3032718,_unitdefocus=0x1087a3030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa283bc30,_flat=0x7f7fa283a030,_domask=1,
 _submask=0x7f7fa3847030,_kernel=0x7f7fa210a230,_kernels=0x105ee5030,_kerfftr=
 0x1051f5030,_kerffti=0x1050c3030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa284e630,_x=0x7f7fa28dc230,_y=0x7f7fa283b030,_centroidgain=1,_rayleigh=
 0x7f7fa3032248,_bckgrdcalib=0x7f7fa284dc30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303fe30)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3032478,_ctrlden=0x7f7fa303fd88,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1db3540,_xlast=0x7f7fa1de2360,_ylast=[0x7f7fa2109630,0x7f7fa2109630,
 0x7f7fa2109630],_y0=0x7f7fa210ba30,_signus=0x7f7fa1de4e20,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1db46a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3032558,xposition=0x7f7fa303f650,yposition=
 0x7f7fa3030f00,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030e20,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    731.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.638      101.3
Field Avg  1.65                     54.4   0.638      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305ccc8,layerfrac=0x7f7fa305cc40,
 layerspeed=0x7f7fa305cd50,layeralt=0x7f7fa305cbb8,winddir=0x7f7fa305cb30,
 _layeralt=0x7f7fa30566b0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3032408,lgs_prof_alt=0x7f7fa3031018,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1db7470,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1eb1bf0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10557d030,_masks=0x0,_fluxpersub=0x7f7fa1d491a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1db63b0,_skyfluxpersub=0x7f7fa1dc7040,
 _nphotons=731.473,_skynphotons=0,_tt=[0.00450838,-0.00413743],_lastvalidtt=
 [0.00450838,-0.00413743],_upttcommand=[0,0],_refmes=0x7f7fa2099830,_tiprefv=
 0x7f7fa284f830,_tiltrefv=0x7f7fa384be30,_tiprefvn=0x7f7fa2839830,_tiltrefvn=
 0x7f7fa384c630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1eb1e40,_jstart=0x7f7fa1eb2090,_binindices=0x7f7fa2856c30,
 _binxy=2,_centroidw=0x7f7fa3030d78,_fimage=0x7f7fa28da030,_fimage2=0x0,
 _imistart=0x7f7fa1eb28e0,_imjstart=0x7f7fa1ea0d50,_imistart2=0x7f7fa1eb0f10,
 _imjstart2=0x7f7fa1eb2b30,_unittip=0x7f7fa1eb1790,_unittilt=0x7f7fa1eb19c0,
 _lgs_defocuses=0x7f7fa3030cd0,_unitdefocus=0x108df4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa20b8a30,_flat=0x7f7fa20be430,_domask=1,
 _submask=0x7f7fa2113230,_kernel=0x7f7fa2858a30,_kernels=0x1050c3030,_kerfftr=
 0x105175030,_kerffti=0x105ee5030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa3071230,_x=0x7f7fa283bc30,_y=0x7f7fa284b630,_centroidgain=1,_rayleigh=
 0x7f7fa3032750,_bckgrdcalib=0x7f7fa210a230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303f378)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f7a0,_ctrlden=0x7f7fa3030aa0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1eb39d0,_xlast=0x7f7fa1e20ad0,_ylast=[0x7f7fa284a630,0x7f7fa284a630,
 0x7f7fa284a630],_y0=0x7f7fa28d4030,_signus=0x7f7fa1e20c50,_puppixoffset=[0,0],
 _nact=80,_def=0x106eb5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1dd57a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3032558,xposition=0x7f7fa3032328,yposition=
 0x7f7fa3030b10,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030e20,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    1828.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.560      114.9
Field Avg  1.65                     54.9   0.560      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305ccc8,layerfrac=0x7f7fa305cc40,
 layerspeed=0x7f7fa305cd50,layeralt=0x7f7fa305cbb8,winddir=0x7f7fa305cb30,
 _layeralt=0x7f7fa3055858)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3032408,lgs_prof_alt=0x7f7fa3031018,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1db63b0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1c2e740,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10547c030,_masks=0x0,_fluxpersub=0x7f7fa1db46a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1d491a0,_skyfluxpersub=0x7f7fa1db7470,
 _nphotons=1828.68,_skynphotons=0,_tt=[0.00386905,-0.00504446],_lastvalidtt=
 [0.00386905,-0.00504446],_upttcommand=[0,0],_refmes=0x7f7fa2099830,_tiprefv=
 0x7f7fa210a230,_tiltrefv=0x7f7fa3882630,_tiprefvn=0x7f7fa210aa30,_tiltrefvn=
 0x7f7fa384be30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1c2e990,_jstart=0x7f7fa1c2ebe0,_binindices=0x7f7fa2859230,
 _binxy=2,_centroidw=0x7f7fa3030c98,_fimage=0x7f7fa3071230,_fimage2=0x0,
 _imistart=0x7f7fa1eb1780,_imjstart=0x7f7fa1e211d0,_imistart2=0x7f7fa1eb1e60,
 _imjstart2=0x7f7fa1ea0d50,_unittip=0x7f7fa1c11330,_unittilt=0x7f7fa1c2cfe0,
 _lgs_defocuses=0x7f7fa30322f0,_unitdefocus=0x1085a5030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa210e030,_flat=0x7f7fa2108630,_domask=1,
 _submask=0x7f7fa2113230,_kernel=0x7f7fa20e3c30,_kernels=0x105ee5030,_kerfftr=
 0x1051f5030,_kerffti=0x1050c3030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa20b8a30,_x=0x7f7fa3013c30,_y=0x7f7fa3085e30,_centroidgain=1,_rayleigh=
 0x7f7fa3032248,_bckgrdcalib=0x7f7fa210ea30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303fe30)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3032210,_ctrlden=0x7f7fa30326e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1eb2d80,_xlast=0x7f7fa1eb13b0,_ylast=[0x7f7fa28d4030,0x7f7fa28d4030,
 0x7f7fa28d4030],_y0=0x7f7fa28da630,_signus=0x7f7fa1e20f10,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1de2360,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3032558,xposition=0x7f7fa303f148,yposition=
 0x7f7fa30326a8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030e20,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    2925.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       57.0   0.397      239.8
Field Avg  1.65                     57.0   0.397      239.8
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305ccc8,layerfrac=0x7f7fa305cc40,
 layerspeed=0x7f7fa305cd50,layeralt=0x7f7fa305cbb8,winddir=0x7f7fa305cb30,
 _layeralt=0x7f7fa3055a78)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3032408,lgs_prof_alt=0x7f7fa3031018,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1de9c80,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1e20d20,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x104f79030,_masks=0x0,_fluxpersub=0x7f7fa1e21670,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1ea0d50,_skyfluxpersub=0x7f7fa1ea11f0,
 _nphotons=2925.89,_skynphotons=0,_tt=[-0.0139481,0.0197825],_lastvalidtt=
 [-0.0139481,0.0197825],_upttcommand=[0,0],_refmes=0x7f7fa210ba30,_tiprefv=
 0x7f7fa20e3e30,_tiltrefv=0x7f7fa20e2a30,_tiprefvn=0x7f7fa210a230,_tiltrefvn=
 0x7f7fa2113c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1e20f70,_jstart=0x7f7fa1eb0f10,_binindices=0x7f7fa284fc30,
 _binxy=2,_centroidw=0x7f7fa3030fe0,_fimage=0x7f7fa20e3230,_fimage2=0x0,
 _imistart=0x7f7fa1e21420,_imjstart=0x7f7fa1e20ad0,_imistart2=0x7f7fa1eb1760,
 _imjstart2=0x7f7fa1e211c0,_unittip=0x7f7fa1e9c6f0,_unittilt=0x7f7fa1eb1b10,
 _lgs_defocuses=0x7f7fa3030d78,_unitdefocus=0x1088a4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa2852430,_flat=0x7f7fa2851a30,_domask=1,
 _submask=0x7f7fa283b830,_kernel=0x7f7fa2854c30,_kernels=0x1050c3030,_kerfftr=
 0x105175030,_kerffti=0x105ee5030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa20e4630,_x=0x7f7fa28d9630,_y=0x7f7fa28da230,_centroidgain=1,_rayleigh=
 0x7f7fa3032750,_bckgrdcalib=0x7f7fa2852e30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303f378)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3030e90,_ctrlden=0x7f7fa3030ec8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1d491a0,_xlast=0x7f7fa1de7770,_ylast=[0x7f7fa2114430,0x7f7fa2114430,
 0x7f7fa2114430],_y0=0x7f7fa2099830,_signus=0x7f7fa1d5f0e0,_puppixoffset=[0,0],
 _nact=80,_def=0x107593030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1f31140,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3032558,xposition=0x7f7fa3032478,yposition=
 0x7f7fa28e0230,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030e20,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.008,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    1.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      364.3   0.011      692.5
Field Avg  1.65                    364.3   0.011      692.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305ccc8,layerfrac=0x7f7fa305cc40,
 layerspeed=0x7f7fa305cd50,layeralt=0x7f7fa305cbb8,winddir=0x7f7fa305cb30,
 _layeralt=0x7f7fa3055f40)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3032408,lgs_prof_alt=0x7f7fa3031018,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1e9c6f0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1d491a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1082a2030,_masks=0x0,_fluxpersub=0x7f7fa1de5d40,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1de63e0,_skyfluxpersub=0x7f7fa1de6630,
 _nphotons=1.45602,_skynphotons=0,_tt=[0.0174104,0.0065472],_lastvalidtt=
 [0.0174104,0.0065472],_upttcommand=[0,0],_refmes=0x7f7fa2055030,_tiprefv=
 0x7f7fa210f030,_tiltrefv=0x7f7fa20b8a30,_tiprefvn=0x7f7fa20e3e30,_tiltrefvn=
 0x7f7fa20e2a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1db46a0,_jstart=0x7f7fa1db7470,_binindices=0x7f7fa20be430,
 _binxy=2,_centroidw=0x7f7fa3032788,_fimage=0x7f7fa20dd230,_fimage2=0x0,
 _imistart=0x7f7fa1de5400,_imjstart=0x7f7fa1de5650,_imistart2=0x7f7fa1de58a0,
 _imjstart2=0x7f7fa1de5af0,_unittip=0x7f7fa1dd2a50,_unittilt=0x7f7fa1de4d50,
 _lgs_defocuses=0x7f7fa3030c98,_unitdefocus=0x1084a4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa2121830,_flat=0x7f7fa2120e30,_domask=1,
 _submask=0x7f7fa2110230,_kernel=0x7f7fa210e030,_kernels=0x105ee5030,_kerfftr=
 0x1051f5030,_kerffti=0x1050c3030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa210f830,_x=0x7f7fa20c2630,_y=0x7f7fa2107030,_centroidgain=1,_rayleigh=
 0x7f7fa3032248,_bckgrdcalib=0x7f7fa2108630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303fe30)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3032398,_ctrlden=0x7f7fa30324e8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1e85db0,_xlast=0x7f7fa1ea0d50,_ylast=[0x7f7fa28d4030,0x7f7fa28d4030,
 0x7f7fa28d4030],_y0=0x7f7fa28da630,_signus=0x7f7fa1ea0470,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1de2360,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3032558,xposition=0x7f7fa303f7a0,yposition=
 0x7f7fa303fd88,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030e20,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    2.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      155.3   0.031      523.6
Field Avg  1.65                    155.3   0.031      523.6
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305ccc8,layerfrac=0x7f7fa305cc40,
 layerspeed=0x7f7fa305cd50,layeralt=0x7f7fa305cbb8,winddir=0x7f7fa305cb30,
 _layeralt=0x7f7fa3056518)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3032408,lgs_prof_alt=0x7f7fa3031018,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1eb68a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1da3970,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x104e78030,_masks=0x0,_fluxpersub=0x7f7fa1eab720,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1eb8840,_skyfluxpersub=0x7f7fa1eb8a90,
 _nphotons=2.91205,_skynphotons=0,_tt=[-0.0320591,0.00365032],_lastvalidtt=
 [-0.0320591,0.00365032],_upttcommand=[0,0],_refmes=0x7f7fa2055030,_tiprefv=
 0x7f7fa307ec30,_tiltrefv=0x7f7fa284f030,_tiprefvn=0x7f7fa3080230,_tiltrefvn=
 0x7f7fa284f830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1db63b0,_jstart=0x7f7fa1d491a0,_binindices=0x7f7fa20e0c30,
 _binxy=2,_centroidw=0x7f7fa3030b10,_fimage=0x7f7fa284e630,_fimage2=0x0,
 _imistart=0x7f7fa1d25d80,_imjstart=0x7f7fa1de5af0,_imistart2=0x7f7fa1de5d40,
 _imjstart2=0x7f7fa1de5310,_unittip=0x7f7fa1db7470,_unittilt=0x7f7fa1dc7040,
 _lgs_defocuses=0x7f7fa3030fe0,_unitdefocus=0x1087a3030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa2108630,_flat=0x7f7fa20e4430,_domask=1,
 _submask=0x7f7fa2850030,_kernel=0x7f7fa28d9630,_kernels=0x1050c3030,_kerfftr=
 0x105e7f030,_kerffti=0x105ee5030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa298ae30,_x=0x7f7fa2113630,_y=0x7f7fa20b8a30,_centroidgain=1,_rayleigh=
 0x7f7fa3032750,_bckgrdcalib=0x7f7fa20be430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303f378)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3032478,_ctrlden=0x7f7fa3030d40,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1eb8340,_xlast=0x7f7fa1e85db0,_ylast=[0x7f7fa28da630,0x7f7fa28da630,
 0x7f7fa28da630],_y0=0x7f7fa2820a30,_signus=0x7f7fa1eb1570,_puppixoffset=[0,0],
 _nact=80,_def=0x107593030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1dd57a0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3032558,xposition=0x7f7fa3032210,yposition=
 0x7f7fa3030aa0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030e20,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.002,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    7.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       84.1   0.099      381.7
Field Avg  1.65                     84.1   0.099      381.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305ccc8,layerfrac=0x7f7fa305cc40,
 layerspeed=0x7f7fa305cd50,layeralt=0x7f7fa305cbb8,winddir=0x7f7fa305cb30,
 _layeralt=0x7f7fa3056408)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3032408,lgs_prof_alt=0x7f7fa3031018,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1e85db0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1db7470,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x107e9f030,_masks=0x0,_fluxpersub=0x7f7fa1d25d80,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1d491a0,_skyfluxpersub=0x7f7fa1db63b0,
 _nphotons=7.28012,_skynphotons=0,_tt=[0.0202785,-0.033472],_lastvalidtt=
 [0.0202785,-0.033472],_upttcommand=[0,0],_refmes=0x7f7fa28d4030,_tiprefv=
 0x7f7fa210fc30,_tiltrefv=0x7f7fa210f430,_tiprefvn=0x7f7fa2110430,_tiltrefvn=
 0x7f7fa2110c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1db46a0,_jstart=0x7f7fa1dc7040,_binindices=0x7f7fa307fa30,
 _binxy=2,_centroidw=0x7f7fa303f180,_fimage=0x7f7fa2839830,_fimage2=0x0,
 _imistart=0x7f7fa1c2dba0,_imjstart=0x7f7fa1c2ddf0,_imistart2=0x7f7fa1c2e040,
 _imjstart2=0x7f7fa1c2e290,_unittip=0x7f7fa1dd2a50,_unittilt=0x7f7fa1db3540,
 _lgs_defocuses=0x7f7fa3032788,_unitdefocus=0x108df4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa20d4430,_flat=0x7f7fa210a230,_domask=1,
 _submask=0x7f7fa2106630,_kernel=0x7f7fa3081830,_kernels=0x105ee5030,_kerfftr=
 0x105175030,_kerffti=0x1050c3030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa28da030,_x=0x7f7fa2111430,_y=0x7f7fa20cfe30,_centroidgain=1,_rayleigh=
 0x7f7fa3032248,_bckgrdcalib=0x7f7fa20be430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303fe30)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f650,_ctrlden=0x7f7fa303f7a0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1eb81a0,_xlast=0x7f7fa1eb8320,_ylast=[0x7f7fa2820a30,0x7f7fa2820a30,
 0x7f7fa2820a30],_y0=0x7f7fa2926230,_signus=0x7f7fa1eab4d0,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1d25fd0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3032558,xposition=0x7f7fa3030e90,yposition=
 0x7f7fa30326e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030e20,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.005,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    11.6
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       76.9   0.122      361.5
Field Avg  1.65                     76.9   0.122      361.5
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305ccc8,layerfrac=0x7f7fa305cc40,
 layerspeed=0x7f7fa305cd50,layeralt=0x7f7fa305cbb8,winddir=0x7f7fa305cb30,
 _layeralt=0x7f7fa305d080)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3032408,lgs_prof_alt=0x7f7fa3031018,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1db7470,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1eab4d0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x107fa0030,_masks=0x0,_fluxpersub=0x7f7fa1f36f60,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1f38320,_skyfluxpersub=0x7f7fa1f38570,
 _nphotons=11.6482,_skynphotons=0,_tt=[0.00137462,0.023992],_lastvalidtt=
 [0.00137462,0.023992],_upttcommand=[0,0],_refmes=0x7f7fa28d4030,_tiprefv=
 0x7f7fa210aa30,_tiltrefv=0x7f7fa210a230,_tiprefvn=0x7f7fa210fc30,_tiltrefvn=
 0x7f7fa210f430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1eb8840,_jstart=0x7f7fa1eb8a90,_binindices=0x7f7fa292a830,
 _binxy=2,_centroidw=0x7f7fa3030b80,_fimage=0x7f7fa210e030,_fimage2=0x0,
 _imistart=0x7f7fa1eb7010,_imjstart=0x7f7fa1eb79b0,_imistart2=0x7f7fa1eb7c00,
 _imjstart2=0x7f7fa1eb7e50,_unittip=0x7f7fa1e9c6f0,_unittilt=0x7f7fa1ea0d50,
 _lgs_defocuses=0x7f7fa3030b10,_unitdefocus=0x1085a5030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3847030,_flat=0x7f7fa3846630,_domask=1,
 _submask=0x7f7fa3842c30,_kernel=0x7f7fa20d4430,_kernels=0x1050c3030,_kerfftr=
 0x105e7f030,_kerffti=0x105ee5030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa210ea30,_x=0x7f7fa28d9630,_y=0x7f7fa28d9c30,_centroidgain=1,_rayleigh=
 0x7f7fa3032750,_bckgrdcalib=0x7f7fa386ae30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa303f378)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3030c28,_ctrlden=0x7f7fa30326a8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1de2360,_xlast=0x7f7fa1d25d80,_ylast=[0x7f7fa2055030,0x7f7fa2055030,
 0x7f7fa2055030],_y0=0x7f7fa20bee30,_signus=0x7f7fa1de36e0,_puppixoffset=[0,0],
 _nact=80,_def=0x106eb5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1dd2a50,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3032558,xposition=0x7f7fa3032398,yposition=
 0x7f7fa3030ec8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030e20,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.008,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    5796.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cc40,layerfrac=0x7f7fa305cd50,
 layerspeed=0x7f7fa305ccc8,layeralt=0x7f7fa305cdd8,winddir=0x7f7fa305ce60,
 _layeralt=0x7f7fa3055638)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030ec8,lgs_prof_alt=0x7f7fa3032558,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1de5ac0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1f39640,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x107d9e030,_masks=0x0,_fluxpersub=0x7f7fa1c11330,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1c2dba0,_skyfluxpersub=0x7f7fa1c2ddf0,
 _nphotons=5796.54,_skynphotons=0,_tt=[-0.0818691,0.0294178],_lastvalidtt=
 [-0.0818691,0.0294178],_upttcommand=[0,0],_refmes=0x7f7fa3044830,_tiprefv=
 0x7f7fa28dba30,_tiltrefv=0x7f7fa2849c30,_tiprefvn=0x7f7fa28dc230,_tiltrefvn=
 0x7f7fa283aa30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1f39890,_jstart=0x7f7fa1f39ae0,_binindices=0x7f7fa283b230,
 _binxy=2,_centroidw=0x7f7fa3032788,_fimage=0x7f7fa283c030,_fimage2=0x0,
 _imistart=0x7f7fa1eaf820,_imjstart=0x7f7fa1eafb00,_imistart2=0x7f7fa1eafd50,
 _imjstart2=0x7f7fa1eaffa0,_unittip=0x7f7fa1f391e0,_unittilt=0x7f7fa1f39410,
 _lgs_defocuses=0x7f7fa3030fa8,_unitdefocus=0x1088a4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3075830,_flat=0x7f7fa3074e30,_domask=1,
 _submask=0x7f7fa3078030,_kernel=0x7f7fa3085e30,_kernels=0x10529c030,_kerfftr=
 0x105e7f030,_kerffti=0x105ee5030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2925c30,_x=0x7f7fa3847a30,_y=0x7f7fa3883630,_centroidgain=1,_rayleigh=
 0x7f7fa3030f38,_bckgrdcalib=0x7f7fa3076230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa30322b8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303fd88,_ctrlden=0x7f7fa3030de8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1db63b0,_xlast=0x7f7fa1de4d20,_ylast=[0x7f7fa20d5030,0x7f7fa20d5030,
 0x7f7fa20d5030],_y0=0x7f7fa2055030,_signus=0x7f7fa1d25d80,_puppixoffset=[0,0],
 _nact=80,_def=0x10aa6d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1db3540,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa30326a8,xposition=0x7f7fa3032520,yposition=
 0x7f7fa3030e58,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3032408,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    5796.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.0   0.070      334.4
Field Avg  1.65                    117.0   0.070      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa3055c10)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e58,lgs_prof_alt=0x7f7fa30326a8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1d25d80,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1d491a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10537b030,_masks=0x0,_fluxpersub=0x7f7fa1de53a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1de55f0,_skyfluxpersub=0x7f7fa1de5840,
 _nphotons=5796.54,_skynphotons=0,_tt=[-0.0821077,0.0290961],_lastvalidtt=
 [-0.0821077,0.0290961],_upttcommand=[0,0],_refmes=0x7f7fa28dc630,_tiprefv=
 0x7f7fa3847030,_tiltrefv=0x7f7fa384c630,_tiprefvn=0x7f7fa3847830,_tiltrefvn=
 0x7f7fa387e630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1db7470,_jstart=0x7f7fa1dc7040,_binindices=0x7f7fa2152830,
 _binxy=2,_centroidw=0x7f7fa303f618,_fimage=0x7f7fa2110e30,_fimage2=0x0,
 _imistart=0x7f7fa1de3cd0,_imjstart=0x7f7fa1de3f20,_imistart2=0x7f7fa1de4170,
 _imjstart2=0x7f7fa1de5150,_unittip=0x7f7fa1db3540,_unittilt=0x7f7fa1dd2a50,
 _lgs_defocuses=0x7f7fa3030b48,_unitdefocus=0x1084a4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa2110430,_flat=0x7f7fa20e1e30,_domask=1,
 _submask=0x7f7fa20be430,_kernel=0x7f7fa2849c30,_kernels=0x105175030,_kerfftr=
 0x105e7f030,_kerffti=0x105ee5030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa20dec30,_x=0x7f7fa20bd030,_y=0x7f7fa20cfe30,_centroidgain=1,_rayleigh=
 0x7f7fa3032280,_bckgrdcalib=0x7f7fa210f430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa30324e8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f0a0,_ctrlden=0x7f7fa3030bf0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1e85db0,_xlast=0x7f7fa1ea0670,_ylast=[0x7f7fa28d4030,0x7f7fa28d4030,
 0x7f7fa28d4030],_y0=0x7f7fa28ba630,_signus=0x7f7fa1eaed80,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1de5a90,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3030de8,xposition=0x7f7fa3030f38,yposition=
 0x7f7fa3030e20,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030ec8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    5796.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.568      114.9
Field Avg  1.65                     55.4   0.568      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa3055a78)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e58,lgs_prof_alt=0x7f7fa30326a8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1de59a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1da3970,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1085a5030,_masks=0x0,_fluxpersub=0x7f7fa1c2cfe0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1c2ed60,_skyfluxpersub=0x7f7fa1c2efb0,
 _nphotons=5796.54,_skynphotons=0,_tt=[-0.0072904,0.00581576],_lastvalidtt=
 [-0.0072904,0.00581576],_upttcommand=[0,0],_refmes=0x7f7fa20bee30,_tiprefv=
 0x7f7fa2110e30,_tiltrefv=0x7f7fa307a830,_tiprefvn=0x7f7fa2112630,_tiltrefvn=
 0x7f7fa307b030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1d5f0e0,_jstart=0x7f7fa1d491a0,_binindices=0x7f7fa28d9630,
 _binxy=2,_centroidw=0x7f7fa30326e0,_fimage=0x7f7fa2106630,_fimage2=0x0,
 _imistart=0x7f7fa1ea0420,_imjstart=0x7f7fa1ea11f0,_imistart2=0x7f7fa1ea1440,
 _imjstart2=0x7f7fa1eab4d0,_unittip=0x7f7fa1e9c6f0,_unittilt=0x7f7fa1ea0d50,
 _lgs_defocuses=0x7f7fa3032440,_unitdefocus=0x1087a3030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3084430,_flat=0x7f7fa3086830,_domask=1,
 _submask=0x7f7fa307da30,_kernel=0x7f7fa2852230,_kernels=0x10529c030,_kerfftr=
 0x1050c3030,_kerffti=0x105175030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa20b8a30,_x=0x7f7fa20d4430,_y=0x7f7fa20d4a30,_centroidgain=1,_rayleigh=
 0x7f7fa30322f0,_bckgrdcalib=0x7f7fa307e830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032558)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f378,_ctrlden=0x7f7fa3030f00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1db63b0,_xlast=0x7f7fa1d25d80,_ylast=[0x7f7fa2112e30,0x7f7fa2112e30,
 0x7f7fa2112e30],_y0=0x7f7fa2099830,_signus=0x7f7fa1f36f60,_puppixoffset=[0,0],
 _nact=80,_def=0x107593030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1eaf110,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3030de8,xposition=0x7f7fa3030b10,yposition=
 0x7f7fa303f7a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030ec8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    5796.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.658       98.0
Field Avg  1.65                     54.3   0.658       98.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa3055eb8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e58,lgs_prof_alt=0x7f7fa30326a8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1db7470,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1e9c6f0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1088a4030,_masks=0x0,_fluxpersub=0x7f7fa1c2cfe0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1eab4d0,_skyfluxpersub=0x7f7fa1ea0420,
 _nphotons=5796.54,_skynphotons=0,_tt=[-0.0042381,-0.000513127],_lastvalidtt=
 [-0.0042381,-0.000513127],_upttcommand=[0,0],_refmes=0x7f7fa28c6630,_tiprefv=
 0x7f7fa2856630,_tiltrefv=0x7f7fa2853c30,_tiprefvn=0x7f7fa2857a30,_tiltrefvn=
 0x7f7fa2858230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1ea0d50,_jstart=0x7f7fa1eb0f10,_binindices=0x7f7fa28dba30,
 _binxy=2,_centroidw=0x7f7fa3032638,_fimage=0x7f7fa2108630,_fimage2=0x0,
 _imistart=0x7f7fa1ea1440,_imjstart=0x7f7fa1ead790,_imistart2=0x7f7fa1eb1420,
 _imjstart2=0x7f7fa1eb1670,_unittip=0x7f7fa1e9e750,_unittilt=0x7f7fa1eab720,
 _lgs_defocuses=0x7f7fa303f618,_unitdefocus=0x108df4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa307da30,_flat=0x7f7fa3086830,_domask=1,
 _submask=0x7f7fa307b030,_kernel=0x7f7fa3842c30,_kernels=0x105e7f030,_kerfftr=
 0x105ee5030,_kerffti=0x10529c030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa20e3e30,_x=0x7f7fa284a430,_y=0x7f7fa2856e30,_centroidgain=1,_rayleigh=
 0x7f7fa3032280,_bckgrdcalib=0x7f7fa307e430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa30324e8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3030f38,_ctrlden=0x7f7fa303fdc0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1de2360,_xlast=0x7f7fa1d31e20,_ylast=[0x7f7fa2099830,0x7f7fa2099830,
 0x7f7fa2099830],_y0=0x7f7fa2055030,_signus=0x7f7fa1d25d80,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1c2e180,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3030de8,xposition=0x7f7fa303f2d0,yposition=
 0x7f7fa303f500,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030ec8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    5796.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       67.3   0.184      324.3
Field Avg  1.65                     67.3   0.184      324.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa30561e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e58,lgs_prof_alt=0x7f7fa30326a8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1d491a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1c2d5a0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10557d030,_masks=0x0,_fluxpersub=0x7f7fa1f36f60,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1f37cb0,_skyfluxpersub=0x7f7fa1f38320,
 _nphotons=5796.54,_skynphotons=0,_tt=[-0.0107432,0.00693943],_lastvalidtt=
 [-0.0107432,0.00693943],_upttcommand=[0,0],_refmes=0x7f7fa210ba30,_tiprefv=
 0x7f7fa2849c30,_tiltrefv=0x7f7fa28da230,_tiprefvn=0x7f7fa2856630,_tiltrefvn=
 0x7f7fa2853c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1c2dba0,_jstart=0x7f7fa1c2ddf0,_binindices=0x7f7fa30b6a30,
 _binxy=2,_centroidw=0x7f7fa3030b80,_fimage=0x7f7fa2106630,_fimage2=0x0,
 _imistart=0x7f7fa1c2f6d0,_imjstart=0x7f7fa1c2f920,_imistart2=0x7f7fa1c2fb70,
 _imjstart2=0x7f7fa1c2fdc0,_unittip=0x7f7fa1c2cfe0,_unittilt=0x7f7fa1c2ed60,
 _lgs_defocuses=0x7f7fa30326e0,_unitdefocus=0x107fa0030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3875630,_flat=0x7f7fa3846630,_domask=1,
 _submask=0x7f7fa3842c30,_kernel=0x7f7fa20be430,_kernels=0x105175030,_kerfftr=
 0x1050c3030,_kerffti=0x105e7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa20d4430,_x=0x7f7fa3013c30,_y=0x7f7fa3078830,_centroidgain=1,_rayleigh=
 0x7f7fa30322f0,_bckgrdcalib=0x7f7fa2839830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032558)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3030b10,_ctrlden=0x7f7fa303fdf8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1ea11f0,_xlast=0x7f7fa1eab4d0,_ylast=[0x7f7fa2856230,0x7f7fa2856230,
 0x7f7fa2856230],_y0=0x7f7fa28c6630,_signus=0x7f7fa1eb0f10,_puppixoffset=[0,0],
 _nact=80,_def=0x107593030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1e9c6f0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3030de8,xposition=0x7f7fa303f0a0,yposition=
 0x7f7fa303f110,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030ec8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    365.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      116.0   0.071      334.4
Field Avg  1.65                    116.0   0.071      334.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa30567c0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e58,lgs_prof_alt=0x7f7fa30326a8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1db63b0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1c2ed60,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10547c030,_masks=0x0,_fluxpersub=0x7f7fa1c2fb80,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1c2fdd0,_skyfluxpersub=0x7f7fa1c30020,
 _nphotons=365.737,_skynphotons=0,_tt=[-0.0800214,0.0300618],_lastvalidtt=
 [-0.0800214,0.0300618],_upttcommand=[0,0],_refmes=0x7f7fa383e830,_tiprefv=
 0x7f7fa3875630,_tiltrefv=0x7f7fa20e1e30,_tiprefvn=0x7f7fa3842c30,_tiltrefvn=
 0x7f7fa20e2630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1c2cfe0,_jstart=0x7f7fa1c2d3e0,_binindices=0x7f7fa3076e30,
 _binxy=2,_centroidw=0x7f7fa3030aa0,_fimage=0x7f7fa2925c30,_fimage2=0x0,
 _imistart=0x7f7fa1c2efb0,_imjstart=0x7f7fa1c2f490,_imistart2=0x7f7fa1c2f6e0,
 _imjstart2=0x7f7fa1c2f930,_unittip=0x7f7fa1c2ddf0,_unittilt=0x7f7fa1c2d630,
 _lgs_defocuses=0x7f7fa3032638,_unitdefocus=0x1083a3030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa307e430,_flat=0x7f7fa307da30,_domask=1,
 _submask=0x7f7fa307fe30,_kernel=0x7f7fa2853630,_kernels=0x105e7f030,_kerfftr=
 0x105ee5030,_kerffti=0x105175030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2839830,_x=0x7f7fa3013c30,_y=0x7f7fa3074e30,_centroidgain=1,_rayleigh=
 0x7f7fa3032280,_bckgrdcalib=0x7f7fa3080c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa30324e8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f420,_ctrlden=0x7f7fa3030cd0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1e85db0,_xlast=0x7f7fa1ea11f0,_ylast=[0x7f7fa28c6630,0x7f7fa28c6630,
 0x7f7fa28c6630],_y0=0x7f7fa28da630,_signus=0x7f7fa1eb1500,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1c2e180,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3030de8,xposition=0x7f7fa303f378,yposition=
 0x7f7fa3030bf0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030ec8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    365.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.566      114.9
Field Avg  1.65                     55.4   0.566      114.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa305d2a0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e58,lgs_prof_alt=0x7f7fa30326a8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1da3970,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1eb3bb0,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x104f79030,_masks=0x0,_fluxpersub=0x7f7fa1c2cfe0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1c2dba0,_skyfluxpersub=0x7f7fa1c2ddf0,
 _nphotons=365.737,_skynphotons=0,_tt=[-0.00571295,0.00705506],_lastvalidtt=
 [-0.00571295,0.00705506],_upttcommand=[0,0],_refmes=0x7f7fa305ae30,_tiprefv=
 0x7f7fa283aa30,_tiltrefv=0x7f7fa28d9e30,_tiprefvn=0x7f7fa283b230,_tiltrefvn=
 0x7f7fa2855830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1eb1e20,_jstart=0x7f7fa1eb2070,_binindices=0x7f7fa2853630,
 _binxy=2,_centroidw=0x7f7fa30324b0,_fimage=0x7f7fa20be430,_fimage2=0x0,
 _imistart=0x7f7fa1eb2760,_imjstart=0x7f7fa1eb29b0,_imistart2=0x7f7fa1eb2c00,
 _imjstart2=0x7f7fa1eb2e50,_unittip=0x7f7fa1dd2a50,_unittilt=0x7f7fa1db3540,
 _lgs_defocuses=0x7f7fa3030b80,_unitdefocus=0x1084a4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3076e30,_flat=0x7f7fa3086830,_domask=1,
 _submask=0x7f7fa3074e30,_kernel=0x7f7fa2966430,_kernels=0x105175030,_kerfftr=
 0x10529c030,_kerffti=0x105e7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2113a30,_x=0x7f7fa2857430,_y=0x7f7fa2857a30,_centroidgain=1,_rayleigh=
 0x7f7fa30322f0,_bckgrdcalib=0x7f7fa3077830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032558)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f500,_ctrlden=0x7f7fa3032638,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1ea0d50,_xlast=0x7f7fa1e85db0,_ylast=[0x7f7fa28da630,0x7f7fa28da630,
 0x7f7fa28da630],_y0=0x7f7fa2810230,_signus=0x7f7fa1eb38f0,_puppixoffset=[0,0],
 _nact=80,_def=0x107593030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1eb3e00,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3030de8,xposition=0x7f7fa3030f38,yposition=
 0x7f7fa3030f00,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030ec8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    365.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.654      101.3
Field Avg  1.65                     54.4   0.654      101.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa305cff8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e58,lgs_prof_alt=0x7f7fa30326a8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1ea0420,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1eb0f10,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1082a2030,_masks=0x0,_fluxpersub=0x7f7fa1eb23e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1eb2630,_skyfluxpersub=0x7f7fa1eb2880,
 _nphotons=365.737,_skynphotons=0,_tt=[-0.00304655,0.00139431],_lastvalidtt=
 [-0.00304655,0.00139431],_upttcommand=[0,0],_refmes=0x7f7fa28c6630,_tiprefv=
 0x7f7fa2857830,_tiltrefv=0x7f7fa28d9630,_tiprefvn=0x7f7fa283aa30,_tiltrefvn=
 0x7f7fa28d9e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1eb1160,_jstart=0x7f7fa1eb13b0,_binindices=0x7f7fa2853630,
 _binxy=2,_centroidw=0x7f7fa28e0230,_fimage=0x7f7fa3846630,_fimage2=0x0,
 _imistart=0x7f7fa1eb1aa0,_imjstart=0x7f7fa1eb1cf0,_imistart2=0x7f7fa1eb1f40,
 _imjstart2=0x7f7fa1eb2190,_unittip=0x7f7fa1e9e750,_unittilt=0x7f7fa1ea0d50,
 _lgs_defocuses=0x7f7fa3030aa0,_unitdefocus=0x107d9e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa20be430,_flat=0x7f7fa2955c30,_domask=1,
 _submask=0x7f7fa2954430,_kernel=0x7f7fa2953630,_kernels=0x105e7f030,_kerfftr=
 0x105ee5030,_kerffti=0x105175030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa3842c30,_x=0x7f7fa2858030,_y=0x7f7fa2859630,_centroidgain=1,_rayleigh=
 0x7f7fa3032280,_bckgrdcalib=0x7f7fa2955230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa30324e8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3030db0,_ctrlden=0x7f7fa30310c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1d31e20,_xlast=0x7f7fa1db4770,_ylast=[0x7f7fa210ba30,0x7f7fa210ba30,
 0x7f7fa210ba30],_y0=0x7f7fa2099830,_signus=0x7f7fa1d5f0e0,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1ea11f0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3030de8,xposition=0x7f7fa3030b10,yposition=
 0x7f7fa303fdc0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030ec8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    365.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       65.1   0.188      327.7
Field Avg  1.65                     65.1   0.188      327.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa3056518)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e58,lgs_prof_alt=0x7f7fa30326a8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1e9e750,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1c30940,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x104e78030,_masks=0x0,_fluxpersub=0x7f7fa1c2ed40,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1c2ef90,_skyfluxpersub=0x7f7fa1c2f1e0,
 _nphotons=365.737,_skynphotons=0,_tt=[-0.0109224,-0.0137899],_lastvalidtt=
 [-0.0109224,-0.0137899],_upttcommand=[0,0],_refmes=0x7f7fa3848c30,_tiprefv=
 0x7f7fa307fa30,_tiltrefv=0x7f7fa3881830,_tiprefvn=0x7f7fa3081430,_tiltrefvn=
 0x7f7fa3882030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1c2e8a0,_jstart=0x7f7fa1c2eaf0,_binindices=0x7f7fa210fa30,
 _binxy=2,_centroidw=0x7f7fa303f340,_fimage=0x7f7fa2839830,_fimage2=0x0,
 _imistart=0x7f7fa1d5f0e0,_imjstart=0x7f7fa1de4af0,_imistart2=0x7f7fa1de4d40,
 _imjstart2=0x7f7fa1de4f90,_unittip=0x7f7fa1c30710,_unittilt=0x7f7fa1c2de00,
 _lgs_defocuses=0x7f7fa30324b0,_unitdefocus=0x108df4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3081c30,_flat=0x7f7fa307da30,_domask=1,
 _submask=0x7f7fa3080630,_kernel=0x7f7fa28dba30,_kernels=0x105175030,_kerfftr=
 0x10529c030,_kerffti=0x105e7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2925c30,_x=0x7f7fa3086830,_y=0x7f7fa307e630,_centroidgain=1,_rayleigh=
 0x7f7fa30322f0,_bckgrdcalib=0x7f7fa3082630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032558)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f5e0,_ctrlden=0x7f7fa303f260,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1c2cfe0,_xlast=0x7f7fa1c302d0,_ylast=[0x7f7fa3080230,0x7f7fa3080230,
 0x7f7fa3080230],_y0=0x7f7fa307c030,_signus=0x7f7fa1c30450,_puppixoffset=[0,0],
 _nact=80,_def=0x106eb5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1e85db0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3030de8,xposition=0x7f7fa303f420,yposition=
 0x7f7fa303fdf8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030ec8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    1.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      145.3   0.049      381.7
Field Avg  1.65                    145.3   0.049      381.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa3056408)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e58,lgs_prof_alt=0x7f7fa30326a8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1f39c00,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1ea0d50,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x107e9f030,_masks=0x0,_fluxpersub=0x7f7fa1db7470,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1c2cfe0,_skyfluxpersub=0x7f7fa1c2d3e0,
 _nphotons=1.45602,_skynphotons=0,_tt=[-0.0103241,0.00961306],_lastvalidtt=
 [-0.0103241,0.00961306],_upttcommand=[0,0],_refmes=0x7f7fa2055030,_tiprefv=
 0x7f7fa20e0230,_tiltrefv=0x7f7fa283b630,_tiprefvn=0x7f7fa20e0a30,_tiltrefvn=
 0x7f7fa28dba30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1eb5120,_jstart=0x7f7fa1eb5370,_binindices=0x7f7fa28d9630,
 _binxy=2,_centroidw=0x7f7fa3032478,_fimage=0x7f7fa3880830,_fimage2=0x0,
 _imistart=0x7f7fa1eb5ad0,_imjstart=0x7f7fa1eb5d20,_imistart2=0x7f7fa1eb5f70,
 _imjstart2=0x7f7fa1eb61c0,_unittip=0x7f7fa1e9c6f0,_unittilt=0x7f7fa1e9e750,
 _lgs_defocuses=0x7f7fa28e0230,_unitdefocus=0x107fa0030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3842c30,_flat=0x7f7fa3846630,_domask=1,
 _submask=0x7f7fa3078030,_kernel=0x7f7fa284dc30,_kernels=0x105e7f030,_kerfftr=
 0x105ee5030,_kerffti=0x105175030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa3882030,_x=0x7f7fa28dc230,_y=0x7f7fa2925c30,_centroidgain=1,_rayleigh=
 0x7f7fa3032280,_bckgrdcalib=0x7f7fa3881630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa30324e8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3030b10,_ctrlden=0x7f7fa3032520,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1f370a0,_xlast=0x7f7fa1d31e20,_ylast=[0x7f7fa20e1230,0x7f7fa20e1230,
 0x7f7fa20e1230],_y0=0x7f7fa2099830,_signus=0x7f7fa1d25d80,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1db4770,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3030de8,xposition=0x7f7fa303f500,yposition=
 0x7f7fa3030cd0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030ec8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.01,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    1.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      146.1   0.043      429.0
Field Avg  1.65                    146.1   0.043      429.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa30566b0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e58,lgs_prof_alt=0x7f7fa30326a8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1f3aeb0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1db7470,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x106db4030,_masks=0x0,_fluxpersub=0x7f7fa1f38eb0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1f39100,_skyfluxpersub=0x7f7fa1f39350,
 _nphotons=1.45602,_skynphotons=0,_tt=[0.0351639,0.0231579],_lastvalidtt=
 [0.0351639,0.0231579],_upttcommand=[0,0],_refmes=0x7f7fa210ba30,_tiprefv=
 0x7f7fa20df830,_tiltrefv=0x7f7fa20b9230,_tiprefvn=0x7f7fa20e0230,_tiltrefvn=
 0x7f7fa20dda30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1dc7040,_jstart=0x7f7fa1d25d80,_binindices=0x7f7fa3846630,
 _binxy=2,_centroidw=0x7f7fa3030aa0,_fimage=0x7f7fa3876030,_fimage2=0x0,
 _imistart=0x7f7fa1f38570,_imjstart=0x7f7fa1f387c0,_imistart2=0x7f7fa1f38a10,
 _imjstart2=0x7f7fa1f38c60,_unittip=0x7f7fa1dd2a50,_unittilt=0x7f7fa1db63b0,
 _lgs_defocuses=0x7f7fa303f340,_unitdefocus=0x1083a3030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa3876a30,_flat=0x7f7fa2925c30,_domask=1,
 _submask=0x7f7fa2853630,_kernel=0x7f7fa3077c30,_kernels=0x105175030,_kerfftr=
 0x1050a0030,_kerffti=0x105e7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa3842c30,_x=0x7f7fa20e2e30,_y=0x7f7fa20bec30,_centroidgain=1,_rayleigh=
 0x7f7fa30322f0,_bckgrdcalib=0x7f7fa28da030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032558)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303f538,_ctrlden=0x7f7fa3030d78,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1ea0420,_xlast=0x7f7fa1ea05a0,_ylast=[0x7f7fa2810230,0x7f7fa2810230,
 0x7f7fa2810230],_y0=0x7f7fa2839e30,_signus=0x7f7fa1eb64f0,_puppixoffset=[0,0],
 _nact=80,_def=0x106eb5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1e9c6f0,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3030de8,xposition=0x7f7fa3030db0,yposition=
 0x7f7fa3032638,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030ec8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.1,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    1.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      335.8   0.012      702.7
Field Avg  1.65                    335.8   0.012      702.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa3055968)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e58,lgs_prof_alt=0x7f7fa30326a8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1eb6580,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1f3a220,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x108aa6030,_masks=0x0,_fluxpersub=0x7f7fa1de4f90,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1d5f0e0,_skyfluxpersub=0x7f7fa1de39a0,
 _nphotons=1.45602,_skynphotons=0,_tt=[-0.00923992,-0.0312753],_lastvalidtt=
 [-0.00923992,-0.0312753],_upttcommand=[0,0],_refmes=0x7f7fa28ba630,_tiprefv=
 0x7f7fa3877430,_tiltrefv=0x7f7fa3083c30,_tiprefvn=0x7f7fa3877c30,_tiltrefvn=
 0x7f7fa3084430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1f3a470,_jstart=0x7f7fa1f3a6c0,_binindices=0x7f7fa20e0830,
 _binxy=2,_centroidw=0x7f7fa303f2d0,_fimage=0x7f7fa2849c30,_fimage2=0x0,
 _imistart=0x7f7fa1defb50,_imjstart=0x7f7fa1d25d80,_imistart2=0x7f7fa1de4af0,
 _imjstart2=0x7f7fa1de4d40,_unittip=0x7f7fa1f37a60,_unittilt=0x7f7fa1f36f60,
 _lgs_defocuses=0x7f7fa3032478,_unitdefocus=0x1084a4030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa2130030,_flat=0x7f7fa28dba30,_domask=1,
 _submask=0x7f7fa212f230,_kernel=0x7f7fa210a230,_kernels=0x105e7f030,_kerfftr=
 0x10529c030,_kerffti=0x105175030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa2130a30,_x=0x7f7fa3876a30,_y=0x7f7fa3846630,_centroidgain=1,_rayleigh=
 0x7f7fa3032280,_bckgrdcalib=0x7f7fa2925c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa30324e8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa303fdc0,_ctrlden=0x7f7fa30324b0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1e85db0,_xlast=0x7f7fa1ea0420,_ylast=[0x7f7fa2839e30,0x7f7fa2839e30,
 0x7f7fa2839e30],_y0=0x7f7fa28c6630,_signus=0x7f7fa1ea05a0,_puppixoffset=[0,0],
 _nact=80,_def=0x10567e030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1e9e750,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3030de8,xposition=0x7f7fa303f5e0,yposition=
 0x7f7fa30310c0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030ec8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.1912  0.0851  1.1912   2.72  2.38  2.38    2x 2    2x 2    1.5
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 120 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 35.0; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      588.6   0.005     1020.2
Field Avg  1.65                    588.6   0.005     1020.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12-imav.fits
Some other graphics in sh12x12.ps

Original parameter file: sh12x12.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132;
 sim.debug          = 0;
 sim.verbose        = 1;
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // this is r0=0.166 at 550 nm
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (>1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 12;  //# of subapertures in telescope diameter
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, plate scale is 60 um/arcsec
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture
 wfs(n).npixpersub  = 11;
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 //wfs(n).fracIllum   = 0.75;
 //wfs(n).shthreshold = 0.;
 //wfs(n).nintegcycles= 1;
 //wfs(n).nzer        = 80;
 wfs(n).fssize      = 2.4;
 wfs(n).fstop       = "square";
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";
 dm(n).nzer         = 80;
 //dm(n).iffile	   = "";
 //dm(n).nxact	       = 20;
 dm(n).pitch	       = 7;
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt  = 0.01;
 //dm(n).push4imat    = 100;
 
 //n  =2;
 //dm(n).type	   = "tiptilt";
 //dm(n).iffile	   = "";
 //dm(n).alt          = 0.;
 //dm(n).unitpervolt   = 0.0005;
 //dm(n).push4imat    = 400;
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	   = 6.5;
 tel.cobs	   = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([1.65]);
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 1.65e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated with the H band.
 
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 1;
 loop.niter	       = 500;
 loop.ittime	       = 1e-3;
 loop.startskip     = 10;
 loop.skipevery     = 10000;
 loop.skipby        = 10000;
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=35,screen=0x7f7fa305cd50,layerfrac=0x7f7fa305ccc8,
 layerspeed=0x7f7fa305cc40,layeralt=0x7f7fa305cb30,winddir=0x7f7fa305cbb8,
 _layeralt=0x7f7fa3055d20)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=0,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=12,npixpersub=11,pixsize=1.19121,npixels=2,
 spotpitch=2,extfield=2.38243,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="square",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7f7fa3030e58,lgs_prof_alt=0x7f7fa30326a8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=1,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7f7fa1f3aaa0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7f7fa1f38580,_origpixsize=1.2,_rebinfactor=14,_gsalt=0,_gsdepth=0,_nsub=120,
 _nsub4disp=132,_nmes=240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10537b030,_masks=0x0,_fluxpersub=0x7f7fa1db63b0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7f7fa1db7470,_skyfluxpersub=0x7f7fa1dc7040,
 _nphotons=1.45602,_skynphotons=0,_tt=[-0.0219327,0.00232589],_lastvalidtt=
 [-0.0219327,0.00232589],_upttcommand=[0,0],_refmes=0x7f7fa383e830,_tiprefv=
 0x7f7fa3076030,_tiltrefv=0x7f7fa3075830,_tiprefvn=0x7f7fa3076830,_tiltrefvn=
 0x7f7fa3083c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=28,_nx4fft=28,
 _istart=0x7f7fa1f36f60,_jstart=0x7f7fa1f39cb0,_binindices=0x7f7fa2849c30,
 _binxy=2,_centroidw=0x7f7fa3032398,_fimage=0x7f7fa3843230,_fimage2=0x0,
 _imistart=0x7f7fa1eb0870,_imjstart=0x7f7fa1eb0ac0,_imistart2=0x7f7fa1ea0420,
 _imjstart2=0x7f7fa1eafb50,_unittip=0x7f7fa1f395e0,_unittilt=0x7f7fa1f39a80,
 _lgs_defocuses=0x7f7fa3030aa0,_unitdefocus=0x107d9e030,_fimnx=24,_fimny=24,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7f7fa20df830,_flat=0x7f7fa20e3c30,_domask=1,
 _submask=0x7f7fa2113630,_kernel=0x7f7fa210a230,_kernels=0x105175030,_kerfftr=
 0x105ee5030,_kerffti=0x105e7f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7f7fa387e430,_x=0x7f7fa3846c30,_y=0x7f7fa3842c30,_centroidgain=1,_rayleigh=
 0x7f7fa30322f0,_bckgrdcalib=0x7f7fa2858230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=1.65e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7f7fa3032558)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f7fa3032478,_ctrlden=0x7f7fa3032638,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12-ecmat1.fits",noextrap=0,elt=0,irexp=0,irfact=0,
 filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=0,regtype=
 0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,0.35,0.45],
 _x0=0x7f7fa1ea0d50,_xlast=0x7f7fa1e85db0,_ylast=[0x7f7fa28c6630,0x7f7fa28c6630,
 0x7f7fa28c6630],_y0=0x7f7fa28ba630,_signus=0x7f7fa1ead790,_puppixoffset=[0,0],
 _nact=80,_def=0x106eb5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,_ei1=0x0,_ej1=0x0,
 _indval=0x0,_indext=0x0,_eiffile="sh12x12-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=
 0x0,_enact=0,_n1=182,_n2=331,_pupil=0x0,_command=0x7f7fa1c2e180,_flat_command=
 0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f7fa30323d0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f7fa3030de8,xposition=0x7f7fa3030b10,yposition=
 0x7f7fa303f260,xspeed=0x0,yspeed=0x0,dispzoom=0x7f7fa3030ec8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=1.65e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.9,leak=0,gainho=0x0,leakho=0x0,framedelay=1,niter=500,
 ittime=0.001,startskip=10,skipevery=10000,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
