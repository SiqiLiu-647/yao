=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    644934.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a848570)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=1,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a819b50,lgs_prof_alt=0x7fad1a819bc0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e1d8e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c5d690,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1092d8030,_masks=0x0,_fluxpersub=0x7fad18f0a4d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f08ff0,_skyfluxpersub=0x7fad18f093b0,
 _nphotons=644935,_skynphotons=0.174543,_tt=[-0.000367321,0.000550002],
 _lastvalidtt=[-0.000367321,0.000550002],_upttcommand=[0,0],_refmes=
 0x7fad1a0cce30,_tiprefv=0x7fad1a0fd230,_tiltrefv=0x7fad1a0d9630,_tiprefvn=
 0x7fad1a0da230,_tiltrefvn=0x7fad1a0dd430,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c5da50,_jstart=0x7fad18c5de10,
 _binindices=0x7fad1915a830,_binxy=2,_centroidw=0x7fad1a837768,_fimage=
 0x7fad1a0e2c30,_fimage2=0x0,_imistart=0x7fad18c530a0,_imjstart=0x7fad18c4b590,
 _imistart2=0x7fad18c4b950,_imjstart2=0x7fad18c4bd10,_unittip=0x7fad18c4c4c0,
 _unittilt=0x7fad18c4ae10,_lgs_defocuses=0x7fad1a837308,_unitdefocus=
 0x10f0c7030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a858030,
 _flat=0x7fad1a82d030,_domask=1,_submask=0x7fad1a804630,_kernel=0x7fad1913b630,
 _kernels=0x10ea62030,_kerfftr=0x10a846030,_kerffti=0x10a7dc030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a0e1230,_x=0x7fad1913e630,_y=0x7fad19131230,
 _centroidgain=1,_rayleigh=0x7fad1a837810,_bckgrdcalib=0x7fad1a859230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a819840)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8379d0,_ctrlden=0x7fad1a837b20,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18d05660,_xlast=0x7fad18d057e0,_ylast=[0x7fad1980ae30,
 0x7fad1980ae30,0x7fad1980ae30],_y0=0x7fad19810430,_signus=0x7fad18d06a50,
 _puppixoffset=[0,0],_nact=80,_def=0x10ba33030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5d070,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819958,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8198b0,xposition=0x7fad1a819878,yposition=
 0x7fad1a819a00,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a819a38,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a848c38)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a819b50,lgs_prof_alt=0x7fad1a819bc0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e21230,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c57390,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1091d7030,_masks=0x0,_fluxpersub=0x7fad18e1b120,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e18710,_skyfluxpersub=0x7fad18e18ad0,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-0.000648682,0.000621045],
 _lastvalidtt=[-0.000648682,0.000621045],_upttcommand=[0,0],_refmes=
 0x7fad1a0e1c30,_tiprefv=0x7fad1a0d7e30,_tiltrefv=0x7fad1a091630,_tiprefvn=
 0x7fad1a0fd230,_tiltrefvn=0x7fad1a0d9630,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c58290,_jstart=0x7fad18c58650,
 _binindices=0x7fad1a832030,_binxy=2,_centroidw=0x7fad1a837148,_fimage=
 0x7fad1a13f030,_fimage2=0x0,_imistart=0x7fad18f19d40,_imjstart=0x7fad18f1a100,
 _imistart2=0x7fad18f19440,_imjstart2=0x7fad18f19800,_unittip=0x7fad18f0a330,
 _unittilt=0x7fad18f0a560,_lgs_defocuses=0x7fad1a8373b0,_unitdefocus=
 0x10f2c7030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a0e0a30,
 _flat=0x7fad1a0fc030,_domask=1,_submask=0x7fad1a0e2430,_kernel=0x7fad1a090e30,
 _kernels=0x10ea62030,_kerfftr=0x10eb4e030,_kerffti=0x10a8b0030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a13de30,_x=0x7fad1913be30,_y=0x7fad1913c630,
 _centroidgain=1,_rayleigh=0x7fad1a819878,_bckgrdcalib=0x7fad1a0dc630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a819b88)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837ae8,_ctrlden=0x7fad1a837c70,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c54280,_xlast=0x7fad18c54400,_ylast=[0x7fad19116a30,
 0x7fad19116a30,0x7fad19116a30],_y0=0x7fad19063030,_signus=0x7fad18c55bd0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f4c7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1d620,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819958,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8198b0,xposition=0x7fad1a819bf8,yposition=
 0x7fad1a819aa8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a819a38,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    406.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.946       84.1
Field Avg  2.20                     70.7   0.946       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a848d48)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a819b50,lgs_prof_alt=0x7fad1a819bc0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c56eb0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18f19440,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x108cd4030,_masks=0x0,_fluxpersub=0x7fad18e1b120,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e21cc0,_skyfluxpersub=0x7fad18e22080,
 _nphotons=406.926,_skynphotons=0.174543,_tt=[0.000346617,0.00150929],
 _lastvalidtt=[0.000346617,0.00150929],_upttcommand=[0,0],_refmes=
 0x7fad1915dc30,_tiprefv=0x7fad1913be30,_tiltrefv=0x7fad1914f030,_tiprefvn=
 0x7fad19155030,_tiltrefvn=0x7fad1914e430,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18f19800,_jstart=0x7fad18f19bc0,
 _binindices=0x7fad19867630,_binxy=2,_centroidw=0x7fad1a837a40,_fimage=
 0x7fad1915ca30,_fimage2=0x0,_imistart=0x7fad18d05df0,_imjstart=0x7fad18d061b0,
 _imistart2=0x7fad18d06570,_imjstart2=0x7fad18d06930,_unittip=0x7fad18f1a1d0,
 _unittilt=0x7fad18f1a400,_lgs_defocuses=0x7fad1a8370d8,_unitdefocus=
 0x10efc6030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a0e6230,
 _flat=0x7fad1a0e5030,_domask=1,_submask=0x7fad1a099230,_kernel=0x7fad1a0dd830,
 _kernels=0x10944f030,_kerfftr=0x109b5c030,_kerffti=0x1095d9030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1914a230,_x=0x7fad1a804630,_y=0x7fad1a819e30,
 _centroidgain=1,_rayleigh=0x7fad1a819bf8,_bckgrdcalib=0x7fad1a0e8a30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8377a0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8375e0,_ctrlden=0x7fad1a837768,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5d070,_xlast=0x7fad18c54140,_ylast=[0x7fad19063030,
 0x7fad19063030,0x7fad19063030],_y0=0x7fad1913ca30,_signus=0x7fad18c542c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10ba33030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1f1e0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819958,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8198b0,xposition=0x7fad1a819840,yposition=
 0x7fad1a837490,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a819a38,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    162.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.943       84.1
Field Avg  2.20                     70.7   0.943       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849078)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a819b50,lgs_prof_alt=
 0x7fad1a819bc0,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18e1ebe0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18f09d10,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10dbb2030,_masks=0x0,_fluxpersub=0x7fad18d04fb0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d05a30,_skyfluxpersub=0x7fad18d05df0,
 _nphotons=162,_skynphotons=0.174543,_tt=[-0.00225949,-0.00210652],_lastvalidtt=
 [-0.00225949,-0.00210652],_upttcommand=[0,0],_refmes=0x7fad1a099230,_tiprefv=
 0x7fad1a0dc630,_tiltrefv=0x7fad1a0e8a30,_tiprefvn=0x7fad1a0e3830,_tiltrefvn=
 0x7fad1a0dd230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18f0a0d0,_jstart=0x7fad18f0a490,_binindices=0x7fad1a846030,
 _binxy=2,_centroidw=0x7fad1a837810,_fimage=0x7fad1a0e1630,_fimage2=0x0,
 _imistart=0x7fad18f0b130,_imjstart=0x7fad18f0b4f0,_imistart2=0x7fad18f0b8b0,
 _imjstart2=0x7fad18f0bc70,_unittip=0x7fad18f1a1d0,_unittilt=0x7fad18f1a400,
 _lgs_defocuses=0x7fad1a837260,_unitdefocus=0x10ecc4030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad1981e230,_flat=0x7fad1981d030,_domask=1,
 _submask=0x7fad19866630,_kernel=0x7fad1913e430,_kernels=0x109668030,_kerfftr=
 0x10a8b0030,_kerffti=0x10a7dc030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad1a090e30,_x=0x7fad1a804630,_y=0x7fad1a819e30,_centroidgain=1,_rayleigh=
 0x7fad1a819840,_bckgrdcalib=0x7fad1981f430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a8379d0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8373b0,_ctrlden=0x7fad1a819a00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e1e350,_ylast=[0x7fad1a0e9630,
 0x7fad1a0e9630,0x7fad1a0e9630],_y0=0x7fad1a0fb430,_signus=0x7fad18e215e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f2c7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c4baf0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819958,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8198b0,xposition=0x7fad1a819b88,yposition=
 0x7fad1a837378,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a819a38,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    40.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       73.9   0.612      144.1
Field Avg  2.20                     73.9   0.612      144.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849540)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 14,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a819b50,lgs_prof_alt=
 0x7fad1a819bc0,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18e20a30,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18c5f570,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10aed9030,_masks=0x0,_fluxpersub=0x7fad18c61d00,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c620c0,_skyfluxpersub=0x7fad18c62840,
 _nphotons=40.6926,_skynphotons=1.74543,_tt=[0.0117201,-0.00347491],
 _lastvalidtt=[0.0117201,-0.00347491],_upttcommand=[0,0],_refmes=0x7fad1a099230,
 _tiprefv=0x7fad1a0e7c30,_tiltrefv=0x7fad1a0d9830,_tiprefvn=0x7fad1a0dc630,
 _tiltrefvn=0x7fad1a0e8a30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7fad18c5f930,_jstart=0x7fad18c5fcf0,_binindices=
 0x7fad1913c830,_binxy=2,_centroidw=0x7fad1a837998,_fimage=0x7fad1a0fc030,
 _fimage2=0x0,_imistart=0x7fad18c60830,_imjstart=0x7fad18c60bf0,_imistart2=
 0x7fad18c60fb0,_imjstart2=0x7fad18c61370,_unittip=0x7fad18c5f110,_unittilt=
 0x7fad18c5f340,_lgs_defocuses=0x7fad1a819aa8,_unitdefocus=0x10ebc3030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19152030,_flat=
 0x7fad19150e30,_domask=1,_submask=0x7fad1913b630,_kernel=0x7fad1914f430,
 _kernels=0x109668030,_kerfftr=0x10eb4e030,_kerffti=0x109b5c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a0dec30,_x=0x7fad1915aa30,_y=0x7fad1913d030,
 _centroidgain=1,_rayleigh=0x7fad1a819b88,_bckgrdcalib=0x7fad191a8630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837ae8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837490,_ctrlden=0x7fad1a837260,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c4b8a0,_xlast=0x7fad18c62ff0,_ylast=[0x7fad19063030,
 0x7fad19063030,0x7fad19063030],_y0=0x7fad1915e030,_signus=0x7fad18c63170,
 _puppixoffset=[0,0],_nact=80,_def=0x1109c0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5d070,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819958,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8198b0,xposition=0x7fad1a8377a0,yposition=
 0x7fad1a837b20,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a819a38,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    16.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       76.0   0.559      150.1
Field Avg  2.20                     76.0   0.559      150.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849100)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a819b50,lgs_prof_alt=
 0x7fad1a819bc0,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18e21c10,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18e1e1d0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10b4dc030,_masks=0x0,_fluxpersub=0x7fad18d06360,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d06720,_skyfluxpersub=0x7fad18d06ae0,
 _nphotons=16.2,_skynphotons=1.74543,_tt=[0.00908368,0.00206599],_lastvalidtt=
 [0.00908368,0.00206599],_upttcommand=[0,0],_refmes=0x7fad1a0d8e30,_tiprefv=
 0x7fad1a122a30,_tiltrefv=0x7fad1a0e4030,_tiprefvn=0x7fad1a0e7c30,_tiltrefvn=
 0x7fad1a0d9830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18e1b120,_jstart=0x7fad18e1e8d0,_binindices=0x7fad1a0d8630,
 _binxy=2,_centroidw=0x7fad1a8375a8,_fimage=0x7fad1a0dec30,_fimage2=0x0,
 _imistart=0x7fad18e23090,_imjstart=0x7fad18e20d00,_imistart2=0x7fad18e210c0,
 _imjstart2=0x7fad18e21480,_unittip=0x7fad18e1d510,_unittilt=0x7fad18e18170,
 _lgs_defocuses=0x7fad1a837308,_unitdefocus=0x10afda030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad19860e30,_flat=0x7fad1985fc30,_domask=1,
 _submask=0x7fad1981d030,_kernel=0x7fad1a0d7e30,_kernels=0x1093d9030,_kerfftr=
 0x10a7dc030,_kerffti=0x10a8b0030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad1a0e1c30,_x=0x7fad1a0da430,_y=0x7fad1a0e8830,_centroidgain=1,_rayleigh=
 0x7fad1a8377a0,_bckgrdcalib=0x7fad19862030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a8375e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a819b88,_ctrlden=0x7fad1a837928,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c618b0,_xlast=0x7fad18c4b740,_ylast=[0x7fad1915e030,
 0x7fad1915e030,0x7fad1915e030],_y0=0x7fad19131a30,_signus=0x7fad18c62900,
 _puppixoffset=[0,0],_nact=80,_def=0x10f0c7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d04a50,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819958,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8198b0,xposition=0x7fad1a8379d0,yposition=
 0x7fad1a837c70,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a819a38,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       82.6   0.404      180.2
Field Avg  2.20                     82.6   0.404      180.2
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a848e58)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 16,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a819b50,lgs_prof_alt=
 0x7fad1a819bc0,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18c60d00,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18e18710,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10efc6030,_masks=0x0,_fluxpersub=0x7fad18d05a30,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d05df0,_skyfluxpersub=0x7fad18d061b0,
 _nphotons=6.44935,_skynphotons=1.74543,_tt=[0.0105751,0.00140722],_lastvalidtt=
 [0.0105751,0.00140722],_upttcommand=[0,0],_refmes=0x7fad1a0da430,_tiprefv=
 0x7fad1a0e0a30,_tiltrefv=0x7fad1a0dec30,_tiprefvn=0x7fad1a122a30,_tiltrefvn=
 0x7fad1a0e4030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18e18ad0,_jstart=0x7fad18e1df90,_binindices=0x7fad1a0dd830,
 _binxy=2,_centroidw=0x7fad1a8370d8,_fimage=0x7fad1915ca30,_fimage2=0x0,
 _imistart=0x7fad18e22450,_imjstart=0x7fad18e22810,_imistart2=0x7fad18e22bd0,
 _imjstart2=0x7fad18e22f90,_unittip=0x7fad18e18170,_unittilt=0x7fad18e1e8d0,
 _lgs_defocuses=0x7fad1a837688,_unitdefocus=0x10d52e030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad19823030,_flat=0x7fad19821e30,_domask=1,
 _submask=0x7fad19814430,_kernel=0x7fad19813c30,_kernels=0x109668030,_kerfftr=
 0x109b5c030,_kerffti=0x1093d9030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad19149230,_x=0x7fad1a091c30,_y=0x7fad1a099230,_centroidgain=1,_rayleigh=
 0x7fad1a8379d0,_bckgrdcalib=0x7fad19824230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a8373b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a819878,_ctrlden=0x7fad1a837960,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e1d510,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a0e7030,_signus=0x7fad18e1b120,
 _puppixoffset=[0,0],_nact=80,_def=0x1107c0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1e350,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819958,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8198b0,xposition=0x7fad1a837ae8,yposition=
 0x7fad1a837768,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a819a38,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    644934.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8480a8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=1,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8375e0,lgs_prof_alt=0x7fad1a837bc8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e21da0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e17a60,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ebc3030,_masks=0x0,_fluxpersub=0x7fad18f0a330,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0ad30,_skyfluxpersub=0x7fad18f0b0f0,
 _nphotons=644935,_skynphotons=0.174543,_tt=[-0.000343603,0.000541292],
 _lastvalidtt=[-0.000343603,0.000541292],_upttcommand=[0,0],_refmes=
 0x7fad1a830630,_tiprefv=0x7fad1a0e4030,_tiltrefv=0x7fad1a0a8e30,_tiprefvn=
 0x7fad1a0e0a30,_tiltrefvn=0x7fad1a0e7c30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e1ec90,_jstart=0x7fad18e20ea0,
 _binindices=0x7fad1a0e6630,_binxy=2,_centroidw=0x7fad1a837ab0,_fimage=
 0x7fad1a0e2630,_fimage2=0x0,_imistart=0x7fad18e219e0,_imjstart=0x7fad18e18940,
 _imistart2=0x7fad18e1de10,_imjstart2=0x7fad18e1e1d0,_unittip=0x7fad18e18710,
 _unittilt=0x7fad18e18170,_lgs_defocuses=0x7fad1a837848,_unitdefocus=
 0x10e825030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a82c830,
 _flat=0x7fad1a819e30,_domask=1,_submask=0x7fad1a830e30,_kernel=0x7fad1a84b030,
 _kernels=0x10953a030,_kerfftr=0x10a7dc030,_kerffti=0x109b5c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a0e4c30,_x=0x7fad1a0cce30,_y=0x7fad1a0dec30,
 _centroidgain=1,_rayleigh=0x7fad1a8384c8,_bckgrdcalib=0x7fad1a82da30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a819b50)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8383b0,_ctrlden=0x7fad1a837880,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e1b350,_ylast=[0x7fad1a069c30,
 0x7fad1a069c30,0x7fad1a069c30],_y0=0x7fad1a0fb430,_signus=0x7fad18e20920,
 _puppixoffset=[0,0],_nact=80,_def=0x10f0c7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f0b4b0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819920,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837688,xposition=0x7fad1a8198b0,yposition=
 0x7fad1a8199c8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8370d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848dd0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8375e0,lgs_prof_alt=0x7fad1a837bc8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c60220,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c61c80,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10d52e030,_masks=0x0,_fluxpersub=0x7fad18e1b120,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e17a60,_skyfluxpersub=0x7fad18e1ee60,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-7.74221e-05,0.000281173],
 _lastvalidtt=[-7.74221e-05,0.000281173],_upttcommand=[0,0],_refmes=
 0x7fad1a099230,_tiprefv=0x7fad1a804630,_tiltrefv=0x7fad19154230,_tiprefvn=
 0x7fad1a808e30,_tiltrefvn=0x7fad19154e30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c65cf0,_jstart=0x7fad18c5f410,
 _binindices=0x7fad1a831430,_binxy=2,_centroidw=0x7fad1a838688,_fimage=
 0x7fad1916ca30,_fimage2=0x0,_imistart=0x7fad18f0afd0,_imjstart=0x7fad18f0b630,
 _imistart2=0x7fad18f0b9f0,_imjstart2=0x7fad18f0bdb0,_unittip=0x7fad18c61110,
 _unittilt=0x7fad18c65ac0,_lgs_defocuses=0x7fad1a8373b0,_unitdefocus=
 0x10ab1b030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a090e30,
 _flat=0x7fad1a0dec30,_domask=1,_submask=0x7fad1a0cce30,_kernel=0x7fad1913c830,
 _kernels=0x1098de030,_kerfftr=0x109143030,_kerffti=0x10a8b0030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1915bc30,_x=0x7fad1913e430,_y=0x7fad1915b430,
 _centroidgain=1,_rayleigh=0x7fad1a8198b0,_bckgrdcalib=0x7fad1a0e4030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837960)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837378,_ctrlden=0x7fad1a8383e8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c497f0,_xlast=0x7fad18c549d0,_ylast=[0x7fad19116a30,
 0x7fad19116a30,0x7fad19116a30],_y0=0x7fad19131a30,_signus=0x7fad18c60e50,
 _puppixoffset=[0,0],_nact=80,_def=0x1107c0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c660b0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819920,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837688,xposition=0x7fad1a837768,yposition=
 0x7fad1a837260,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8370d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    406.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.946       84.1
Field Avg  2.20                     70.7   0.946       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849a08)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8375e0,lgs_prof_alt=0x7fad1a837bc8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e1e8d0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d04fb0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x108bd3030,_masks=0x0,_fluxpersub=0x7fad18f0aaf0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0aeb0,_skyfluxpersub=0x7fad18f0b270,
 _nphotons=406.926,_skynphotons=0.174543,_tt=[-0.0025637,9.28555e-05],
 _lastvalidtt=[-0.0025637,9.28555e-05],_upttcommand=[0,0],_refmes=
 0x7fad1913e430,_tiprefv=0x7fad1913c630,_tiltrefv=0x7fad19171830,_tiprefvn=
 0x7fad19186830,_tiltrefvn=0x7fad19154230,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18d05fb0,_jstart=0x7fad18d06370,
 _binindices=0x7fad1913d230,_binxy=2,_centroidw=0x7fad1a819990,_fimage=
 0x7fad1a0e2630,_fimage2=0x0,_imistart=0x7fad18c61c40,_imjstart=0x7fad18c62000,
 _imistart2=0x7fad18c623c0,_imjstart2=0x7fad18c62780,_unittip=0x7fad18d04a50,
 _unittilt=0x7fad18d05a30,_lgs_defocuses=0x7fad1a837ab0,_unitdefocus=
 0x10aa1a030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a82da30,
 _flat=0x7fad1a82c830,_domask=1,_submask=0x7fad1a81aa30,_kernel=0x7fad1a84b030,
 _kernels=0x10953a030,_kerfftr=0x109b5c030,_kerffti=0x10a7dc030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a090e30,_x=0x7fad19814430,_y=0x7fad1982c830,
 _centroidgain=1,_rayleigh=0x7fad1a837768,_bckgrdcalib=0x7fad1a830030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8376c0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8379d0,_ctrlden=0x7fad1a838490,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1e1f0,_xlast=0x7fad18e1e370,_ylast=[0x7fad1a099230,
 0x7fad1a099230,0x7fad1a099230],_y0=0x7fad1a0fb430,_signus=0x7fad18e2f180,
 _puppixoffset=[0,0],_nact=80,_def=0x10f0c7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819920,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837688,xposition=0x7fad1a819b50,yposition=
 0x7fad1a837928,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8370d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    162.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.943       84.1
Field Avg  2.20                     70.7   0.943       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849760)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8375e0,lgs_prof_alt=
 0x7fad1a837bc8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18e210d0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18c63f60,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10b0db030,_masks=0x0,_fluxpersub=0x7fad18d04fb0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d05a30,_skyfluxpersub=0x7fad18d06270,
 _nphotons=162,_skynphotons=0.174543,_tt=[-0.000504516,0.00219377],_lastvalidtt=
 [-0.000504516,0.00219377],_upttcommand=[0,0],_refmes=0x7fad1915da30,_tiprefv=
 0x7fad19184a30,_tiltrefv=0x7fad19170c30,_tiprefvn=0x7fad1913c630,_tiltrefvn=
 0x7fad19171830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18c63560,_jstart=0x7fad18c5ff50,_binindices=0x7fad1915c430,
 _binxy=2,_centroidw=0x7fad1a837848,_fimage=0x7fad1a0e2630,_fimage2=0x0,
 _imistart=0x7fad18c60bf0,_imjstart=0x7fad18c60fb0,_imistart2=0x7fad18c5f410,
 _imjstart2=0x7fad18c5f7d0,_unittip=0x7fad18c549d0,_unittilt=0x7fad18c496e0,
 _lgs_defocuses=0x7fad1a8199c8,_unitdefocus=0x1092d8030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad1982be30,_flat=0x7fad1981e030,_domask=1,
 _submask=0x7fad19813c30,_kernel=0x7fad1981d030,_kernels=0x10953a030,_kerfftr=
 0x10a8b0030,_kerffti=0x109143030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad1a091430,_x=0x7fad1913d230,_y=0x7fad19160630,_centroidgain=1,_rayleigh=
 0x7fad1a819b50,_bckgrdcalib=0x7fad1982d030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a8383b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a819990,_ctrlden=0x7fad1a838538,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5d070,_xlast=0x7fad18c5eab0,_ylast=[0x7fad19131a30,
 0x7fad19131a30,0x7fad19131a30],_y0=0x7fad19116a30,_signus=0x7fad18c62c50,
 _puppixoffset=[0,0],_nact=80,_def=0x1107c0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5fb90,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819920,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837688,xposition=0x7fad1a837960,yposition=
 0x7fad1a819808,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8370d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    40.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       73.5   0.614      144.1
Field Avg  2.20                     73.5   0.614      144.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849078)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 14,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8375e0,lgs_prof_alt=
 0x7fad1a837bc8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18e2c5d0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18e2ba80,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10afda030,_masks=0x0,_fluxpersub=0x7fad18f0a2a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0b180,_skyfluxpersub=0x7fad18f0b540,
 _nphotons=40.6926,_skynphotons=1.74543,_tt=[0.00159495,0.00251522],
 _lastvalidtt=[0.00159495,0.00251522],_upttcommand=[0,0],_refmes=0x7fad1a0e6c30,
 _tiprefv=0x7fad1a0dc630,_tiltrefv=0x7fad1a0e2630,_tiprefvn=0x7fad1a0cce30,
 _tiltrefvn=0x7fad1a0e8e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7fad18e17a60,_jstart=0x7fad18e1e8d0,_binindices=
 0x7fad1913b630,_binxy=2,_centroidw=0x7fad1a819a38,_fimage=0x7fad1a0d8c30,
 _fimage2=0x0,_imistart=0x7fad18c4e6e0,_imjstart=0x7fad18c4eaa0,_imistart2=
 0x7fad18c4ee60,_imjstart2=0x7fad18c4f220,_unittip=0x7fad18e1e140,_unittilt=
 0x7fad18e20920,_lgs_defocuses=0x7fad1a838340,_unitdefocus=0x1091d7030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a845030,_flat=
 0x7fad1a819e30,_domask=1,_submask=0x7fad1a84b030,_kernel=0x7fad1a82f430,
 _kernels=0x1093d9030,_kerfftr=0x10a7dc030,_kerffti=0x109b5c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a090e30,_x=0x7fad1a069c30,_y=0x7fad1a099230,
 _centroidgain=1,_rayleigh=0x7fad1a837960,_bckgrdcalib=0x7fad1a82c830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837378)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8382d0,_ctrlden=0x7fad1a8199c8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5ffd0,_xlast=0x7fad18c5d070,_ylast=[0x7fad19116a30,
 0x7fad19116a30,0x7fad19116a30],_y0=0x7fad1913d830,_signus=0x7fad18c5f840,
 _puppixoffset=[0,0],_nact=80,_def=0x10f0c7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5eab0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819920,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837688,xposition=0x7fad1a8376c0,yposition=
 0x7fad1a837880,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8370d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    16.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       77.2   0.548      156.1
Field Avg  2.20                     77.2   0.548      156.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849188)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8375e0,lgs_prof_alt=
 0x7fad1a837bc8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18c52580,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18e20b50,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10ab1b030,_masks=0x0,_fluxpersub=0x7fad18e22d10,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e230d0,_skyfluxpersub=0x7fad18e23490,
 _nphotons=16.2,_skynphotons=1.74543,_tt=[-0.00655215,0.00671673],_lastvalidtt=
 [-0.00655215,0.00671673],_upttcommand=[0,0],_refmes=0x7fad1915d830,_tiprefv=
 0x7fad19173830,_tiltrefv=0x7fad1a0d8c30,_tiprefvn=0x7fad19170030,_tiltrefvn=
 0x7fad1a0e2630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18e20f10,_jstart=0x7fad18e212d0,_binindices=0x7fad1a0e6c30,
 _binxy=2,_centroidw=0x7fad1a8371b8,_fimage=0x7fad1916d630,_fimage2=0x0,
 _imistart=0x7fad18e21e10,_imjstart=0x7fad18e221d0,_imistart2=0x7fad18e22590,
 _imjstart2=0x7fad18e22950,_unittip=0x7fad18e1d510,_unittilt=0x7fad18e20920,
 _lgs_defocuses=0x7fad1a8385a8,_unitdefocus=0x108cd4030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a10fa30,_flat=0x7fad1a10dc30,_domask=1,
 _submask=0x7fad1a0ea630,_kernel=0x7fad1a0e9e30,_kernels=0x10953a030,_kerfftr=
 0x109143030,_kerffti=0x10a8b0030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad19158230,_x=0x7fad1a099230,_y=0x7fad1a0e0a30,_centroidgain=1,_rayleigh=
 0x7fad1a8376c0,_bckgrdcalib=0x7fad1a110c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a8379d0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8385e0,_ctrlden=0x7fad1a819a38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c4e320,_xlast=0x7fad18c496e0,_ylast=[0x7fad1913d830,
 0x7fad1913d830,0x7fad1913d830],_y0=0x7fad1915e030,_signus=0x7fad18c518f0,
 _puppixoffset=[0,0],_nact=80,_def=0x1107c0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819920,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837688,xposition=0x7fad1a8383b0,yposition=
 0x7fad1a8383e8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8370d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       81.8   0.409      180.2
Field Avg  2.20                     81.8   0.409      180.2
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8489b0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 16,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8375e0,lgs_prof_alt=
 0x7fad1a837bc8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18e21fd0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18e22a60,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10aa1a030,_masks=0x0,_fluxpersub=0x7fad18f0a950,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0ad10,_skyfluxpersub=0x7fad18f0b0d0,
 _nphotons=6.44935,_skynphotons=1.74543,_tt=[-0.00512487,-0.00879357],
 _lastvalidtt=[-0.00512487,-0.00879357],_upttcommand=[0,0],_refmes=
 0x7fad1a099230,_tiprefv=0x7fad1a0e0a30,_tiltrefv=0x7fad19170030,_tiprefvn=
 0x7fad1a090e30,_tiltrefvn=0x7fad19173630,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e22e20,_jstart=0x7fad18e20920,
 _binindices=0x7fad1a0ee230,_binxy=2,_centroidw=0x7fad1a837ce0,_fimage=
 0x7fad1a0d9030,_fimage2=0x0,_imistart=0x7fad18e24d40,_imjstart=0x7fad18e245b0,
 _imistart2=0x7fad18e210a0,_imjstart2=0x7fad18e21460,_unittip=0x7fad18e22600,
 _unittilt=0x7fad18e22830,_lgs_defocuses=0x7fad1a837960,_unitdefocus=
 0x10dbb2030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a830630,
 _flat=0x7fad1a82f430,_domask=1,_submask=0x7fad1a84b030,_kernel=0x7fad1a858030,
 _kernels=0x10953a030,_kerfftr=0x109b5c030,_kerffti=0x10a7dc030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a0d7e30,_x=0x7fad1a069c30,_y=0x7fad1a0e2630,
 _centroidgain=1,_rayleigh=0x7fad1a8383b0,_bckgrdcalib=0x7fad1a831830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a819990)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8376c0,_ctrlden=0x7fad1a838768,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e17ba0,_xlast=0x7fad18e1de10,_ylast=[0x7fad1a0a9630,
 0x7fad1a0a9630,0x7fad1a0a9630],_y0=0x7fad1a091a30,_signus=0x7fad18e24170,
 _puppixoffset=[0,0],_nact=80,_def=0x10f0c7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1df90,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819920,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837688,xposition=0x7fad1a837378,yposition=
 0x7fad1a838490,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8370d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    644934.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a8497e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=1,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8382d0,lgs_prof_alt=0x7fad1a8370d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e23900,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c5f740,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10b0db030,_masks=0x0,_fluxpersub=0x7fad18d09c60,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d0a020,_skyfluxpersub=0x7fad18d0a3e0,
 _nphotons=644935,_skynphotons=0.174543,_tt=[-0.000404539,0.000533826],
 _lastvalidtt=[-0.000404539,0.000533826],_upttcommand=[0,0],_refmes=
 0x7fad1982ce30,_tiprefv=0x7fad1a103230,_tiltrefv=0x7fad1a11d630,_tiprefvn=
 0x7fad1a0dd230,_tiltrefvn=0x7fad1a0e7c30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c0b1f0,_jstart=0x7fad18c5eab0,
 _binindices=0x7fad19030230,_binxy=2,_centroidw=0x7fad1a074240,_fimage=
 0x7fad1a0d9030,_fimage2=0x0,_imistart=0x7fad18c4e6e0,_imjstart=0x7fad18c4eaa0,
 _imistart2=0x7fad18c4ee60,_imjstart2=0x7fad18c4f220,_unittip=0x7fad18c0b5b0,
 _unittilt=0x7fad18c0eaa0,_lgs_defocuses=0x7fad1903f8d8,_unitdefocus=
 0x10afda030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1982de30,
 _flat=0x7fad1982b230,_domask=1,_submask=0x7fad1982d630,_kernel=0x7fad1a0e6c30,
 _kernels=0x109550030,_kerfftr=0x109143030,_kerffti=0x108dfa030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19170c30,_x=0x7fad1916f230,_y=0x7fad1913c630,
 _centroidgain=1,_rayleigh=0x7fad1a837148,_bckgrdcalib=0x7fad1982f030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fbb0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838618,_ctrlden=0x7fad1a837340,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18d079a0,_xlast=0x7fad18d08be0,_ylast=[0x7fad19813c30,
 0x7fad19813c30,0x7fad19813c30],_y0=0x7fad19810430,_signus=0x7fad18d08d60,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d09020,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819bc0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819920,xposition=0x7fad1a837688,yposition=
 0x7fad1a819878,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8376c0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849298)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8382d0,lgs_prof_alt=0x7fad1a8370d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e323b0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c5ff60,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10a9de030,_masks=0x0,_fluxpersub=0x7fad18c60aa0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c0b1f0,_skyfluxpersub=0x7fad18c5f740,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-0.00060091,0.00134171],
 _lastvalidtt=[-0.00060091,0.00134171],_upttcommand=[0,0],_refmes=
 0x7fad1a0df430,_tiprefv=0x7fad1a0fe430,_tiltrefv=0x7fad1a102630,_tiprefvn=
 0x7fad1a103230,_tiltrefvn=0x7fad1a11d630,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c60320,_jstart=0x7fad18c606e0,
 _binindices=0x7fad1a84b030,_binxy=2,_centroidw=0x7fad1a837ae8,_fimage=
 0x7fad19832430,_fimage2=0x0,_imistart=0x7fad18f0a490,_imjstart=0x7fad18f0adf0,
 _imistart2=0x7fad18f0b1b0,_imjstart2=0x7fad18f0b570,_unittip=0x7fad18e32c60,
 _unittilt=0x7fad18e18170,_lgs_defocuses=0x7fad1903fd70,_unitdefocus=
 0x109643030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a090e30,
 _flat=0x7fad1916b230,_domask=1,_submask=0x7fad1918cc30,_kernel=0x7fad1a0ee230,
 _kernels=0x1093d9030,_kerfftr=0x1094cd030,_kerffti=0x109550030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1982aa30,_x=0x7fad1913e430,_y=0x7fad19158230,
 _centroidgain=1,_rayleigh=0x7fad1a837688,_bckgrdcalib=0x7fad1918d430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837960)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837260,_ctrlden=0x7fad1a838148,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1a3c0,_xlast=0x7fad18e319f0,_ylast=[0x7fad1a10e430,
 0x7fad1a10e430,0x7fad1a10e430],_y0=0x7fad1a0fb430,_signus=0x7fad18e21c00,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d079a0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819bc0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819920,xposition=0x7fad1a838490,yposition=
 0x7fad1a837928,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8376c0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    406.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.946       84.1
Field Avg  2.20                     70.7   0.946       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a8495c8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8382d0,lgs_prof_alt=0x7fad1a8370d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e20f00,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e21ae0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ab1b030,_masks=0x0,_fluxpersub=0x7fad18e32ef0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d094e0,_skyfluxpersub=0x7fad18d09cf0,
 _nphotons=406.926,_skynphotons=0.174543,_tt=[-0.00103557,0.00131974],
 _lastvalidtt=[-0.00103557,0.00131974],_upttcommand=[0,0],_refmes=
 0x7fad1a0ee230,_tiprefv=0x7fad1a091a30,_tiltrefv=0x7fad19832430,_tiprefvn=
 0x7fad1a0fe430,_tiltrefvn=0x7fad1981d030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e31b70,_jstart=0x7fad18e31f30,
 _binindices=0x7fad19041430,_binxy=2,_centroidw=0x7fad1a8386f8,_fimage=
 0x7fad1a108430,_fimage2=0x0,_imistart=0x7fad18c4e6e0,_imjstart=0x7fad18c4eaa0,
 _imistart2=0x7fad18c4ee60,_imjstart2=0x7fad18c4f220,_unittip=0x7fad18e332b0,
 _unittilt=0x7fad18e17a60,_lgs_defocuses=0x7fad1903f8d8,_unitdefocus=
 0x1097be030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1982aa30,
 _flat=0x7fad1982f830,_domask=1,_submask=0x7fad1a0cce30,_kernel=0x7fad1a099230,
 _kernels=0x108dfa030,_kerfftr=0x1095d9030,_kerffti=0x109143030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a128230,_x=0x7fad1a0da230,_y=0x7fad1a090e30,
 _centroidgain=1,_rayleigh=0x7fad1a838490,_bckgrdcalib=0x7fad1982bc30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fc20)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837b90,_ctrlden=0x7fad1a837ae8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5d070,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad19116a30,
 0x7fad19116a30,0x7fad19116a30],_y0=0x7fad19131a30,_signus=0x7fad18c0cf50,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0e060,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819bc0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819920,xposition=0x7fad1903fbb0,yposition=
 0x7fad1903ffd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8376c0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    162.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.943       84.1
Field Avg  2.20                     70.7   0.943       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a8488a0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8382d0,lgs_prof_alt=
 0x7fad1a8370d8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18f0c730,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18e31f30,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x1092d8030,_masks=0x0,_fluxpersub=0x7fad18d088b0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d08c70,_skyfluxpersub=0x7fad18d09030,
 _nphotons=162,_skynphotons=0.174543,_tt=[0.00364751,-0.00235866],_lastvalidtt=
 [0.00364751,-0.00235866],_upttcommand=[0,0],_refmes=0x7fad1918cc30,_tiprefv=
 0x7fad1a82c830,_tiltrefv=0x7fad1916f030,_tiprefvn=0x7fad1a81a630,_tiltrefvn=
 0x7fad1915d430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18e322f0,_jstart=0x7fad18e2f860,_binindices=0x7fad1a82e430,
 _binxy=2,_centroidw=0x7fad1903fad0,_fimage=0x7fad1913c630,_fimage2=0x0,
 _imistart=0x7fad18f0b460,_imjstart=0x7fad18f0b820,_imistart2=0x7fad18f0bbe0,
 _imjstart2=0x7fad18f0bfa0,_unittip=0x7fad18f09f00,_unittilt=0x7fad18f0a130,
 _lgs_defocuses=0x7fad1a838340,_unitdefocus=0x10a7dc030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad1981ea30,_flat=0x7fad1981d830,_domask=1,
 _submask=0x7fad19813c30,_kernel=0x7fad1a84b030,_kernels=0x108fda030,_kerfftr=
 0x10944f030,_kerffti=0x1094cd030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad1916c430,_x=0x7fad1a091630,_y=0x7fad1a091e30,_centroidgain=1,_rayleigh=
 0x7fad1903fbb0,_bckgrdcalib=0x7fad1981fc30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a838618)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838500,_ctrlden=0x7fad1a8386f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0eaa0,_xlast=0x7fad18c5d070,_ylast=[0x7fad19131a30,
 0x7fad19131a30,0x7fad19131a30],_y0=0x7fad1915e030,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d079a0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819bc0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819920,xposition=0x7fad1a837960,yposition=
 0x7fad1a819a00,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8376c0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    40.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       73.5   0.616      144.1
Field Avg  2.20                     73.5   0.616      144.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a8484e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 14,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8382d0,lgs_prof_alt=
 0x7fad1a8370d8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18e22530,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18f09f40,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x1091d7030,_masks=0x0,_fluxpersub=0x7fad18e1b120,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e21260,_skyfluxpersub=0x7fad18e21620,
 _nphotons=40.6926,_skynphotons=1.74543,_tt=[0.00245389,-8.4006e-05],
 _lastvalidtt=[0.00245389,-8.4006e-05],_upttcommand=[0,0],_refmes=
 0x7fad1a0da230,_tiprefv=0x7fad1a0a8e30,_tiltrefv=0x7fad19152630,_tiprefvn=
 0x7fad1a10a430,_tiltrefvn=0x7fad1916f030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18f0b300,_jstart=0x7fad18f0b6c0,
 _binindices=0x7fad1a819e30,_binxy=2,_centroidw=0x7fad1a838308,_fimage=
 0x7fad1a116430,_fimage2=0x0,_imistart=0x7fad18f0cdf0,_imjstart=0x7fad18f0d1b0,
 _imistart2=0x7fad18f0d570,_imjstart2=0x7fad18f0d930,_unittip=0x7fad18f0a830,
 _unittilt=0x7fad18f09d10,_lgs_defocuses=0x7fad1903fec0,_unitdefocus=
 0x1098bf030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a0ed230,
 _flat=0x7fad1a108a30,_domask=1,_submask=0x7fad1a109c30,_kernel=0x7fad19829230,
 _kernels=0x108f50030,_kerfftr=0x108dfa030,_kerffti=0x1095d9030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a112e30,_x=0x7fad1a845030,_y=0x7fad1a81a630,
 _centroidgain=1,_rayleigh=0x7fad1a837960,_bckgrdcalib=0x7fad1a0dc630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837260)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903f9b8,_ctrlden=0x7fad1903fad0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cbd0,_xlast=0x7fad18c0eaa0,_ylast=[0x7fad1915e030,
 0x7fad1915e030,0x7fad1915e030],_y0=0x7fad19153230,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e18170,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819bc0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819920,xposition=0x7fad1903fc20,yposition=
 0x7fad1a837340,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8376c0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    16.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       76.0   0.563      150.1
Field Avg  2.20                     76.0   0.563      150.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a848c38)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8382d0,lgs_prof_alt=
 0x7fad1a8370d8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18e22c00,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18c4e320,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10dbb2030,_masks=0x0,_fluxpersub=0x7fad18c4f5e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d09740,_skyfluxpersub=0x7fad18d09b00,
 _nphotons=16.2,_skynphotons=1.74543,_tt=[0.00736318,0.000996626],_lastvalidtt=
 [0.00736318,0.000996626],_upttcommand=[0,0],_refmes=0x7fad19160630,_tiprefv=
 0x7fad1915c230,_tiltrefv=0x7fad1918cc30,_tiprefvn=0x7fad1915ce30,_tiltrefvn=
 0x7fad19152630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18c5eab0,_jstart=0x7fad18c5ee70,_binindices=0x7fad19041430,
 _binxy=2,_centroidw=0x7fad1903f8d8,_fimage=0x7fad1a0e1e30,_fimage2=0x0,
 _imistart=0x7fad18c4fd60,_imjstart=0x7fad18c4eaa0,_imistart2=0x7fad18c4ee60,
 _imjstart2=0x7fad18c4f220,_unittip=0x7fad18c0eaa0,_unittilt=0x7fad18c0c650,
 _lgs_defocuses=0x7fad19040048,_unitdefocus=0x10a8dd030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad1981ea30,_flat=0x7fad1981d830,_domask=1,
 _submask=0x7fad19149230,_kernel=0x7fad19173630,_kernels=0x108fc5030,_kerfftr=
 0x1094cd030,_kerffti=0x108f50030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad1a0d9030,_x=0x7fad1915da30,_y=0x7fad19173e30,_centroidgain=1,_rayleigh=
 0x7fad1903fc20,_bckgrdcalib=0x7fad1981fc30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a837b90)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8381b8,_ctrlden=0x7fad1a838308,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e22fc0,_xlast=0x7fad18e1a3c0,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a0e6030,_signus=0x7fad18e22330,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e17a60,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819bc0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819920,xposition=0x7fad1a838618,yposition=
 0x7fad1a838148,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8376c0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       82.9   0.401      180.2
Field Avg  2.20                     82.9   0.401      180.2
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a848928)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 16,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8382d0,lgs_prof_alt=
 0x7fad1a8370d8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18c56710,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18c59210,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10af8f030,_masks=0x0,_fluxpersub=0x7fad18e22770,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e1b120,_skyfluxpersub=0x7fad18e22ef0,
 _nphotons=6.44935,_skynphotons=1.74543,_tt=[-0.0141889,0.0136378],_lastvalidtt=
 [-0.0141889,0.0136378],_upttcommand=[0,0],_refmes=0x7fad1a111230,_tiprefv=
 0x7fad1a0eb230,_tiltrefv=0x7fad1a117430,_tiprefvn=0x7fad1a0e1a30,_tiltrefvn=
 0x7fad1a113e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18c55bd0,_jstart=0x7fad18c55f90,_binindices=0x7fad19173e30,
 _binxy=2,_centroidw=0x7fad1903fd38,_fimage=0x7fad1916de30,_fimage2=0x0,
 _imistart=0x7fad18c56ad0,_imjstart=0x7fad18c56e90,_imistart2=0x7fad18c57250,
 _imjstart2=0x7fad18c57c20,_unittip=0x7fad18c0c650,_unittilt=0x7fad18c0cf50,
 _lgs_defocuses=0x7fad1903fa60,_unitdefocus=0x109643030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a0dec30,_flat=0x7fad1a0e2630,_domask=1,
 _submask=0x7fad1a110a30,_kernel=0x7fad1a0a8e30,_kernels=0x10944f030,_kerfftr=
 0x109143030,_kerffti=0x108dfa030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad19170c30,_x=0x7fad1913e430,_y=0x7fad19160630,_centroidgain=1,_rayleigh=
 0x7fad1a838618,_bckgrdcalib=0x7fad1a0ed230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a838500)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838570,_ctrlden=0x7fad1a819a00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cbd0,_xlast=0x7fad18c0eaa0,_ylast=[0x7fad19116a30,
 0x7fad19116a30,0x7fad19116a30],_y0=0x7fad19131a30,_signus=0x7fad18c549c0,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e18170,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819bc0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819920,xposition=0x7fad1a837260,yposition=
 0x7fad1a837ae8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8376c0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    644934.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849980)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=1,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f9b8,lgs_prof_alt=0x7fad1a838340,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e24df0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c57af0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1092d8030,_masks=0x0,_fluxpersub=0x7fad18c5a690,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c5aa50,_skyfluxpersub=0x7fad18c5ae10,
 _nphotons=644935,_skynphotons=0.174543,_tt=[-0.000373427,0.000600371],
 _lastvalidtt=[-0.000373427,0.000600371],_upttcommand=[0,0],_refmes=
 0x7fad1a10ac30,_tiprefv=0x7fad1a16b430,_tiltrefv=0x7fad1a108a30,_tiprefvn=
 0x7fad1a0cce30,_tiltrefvn=0x7fad1a169030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c566c0,_jstart=0x7fad18c58c50,
 _binindices=0x7fad1916de30,_binxy=2,_centroidw=0x7fad1903fd00,_fimage=
 0x7fad1a090e30,_fimage2=0x0,_imistart=0x7fad18c59790,_imjstart=0x7fad18c59b50,
 _imistart2=0x7fad18c59f10,_imjstart2=0x7fad18c5a2d0,_unittip=0x7fad18c57470,
 _unittilt=0x7fad18c576a0,_lgs_defocuses=0x7fad1a838768,_unitdefocus=
 0x1099c0030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a0dc630,
 _flat=0x7fad1a0e7c30,_domask=1,_submask=0x7fad1916c230,_kernel=0x7fad1918ee30,
 _kernels=0x109744030,_kerfftr=0x1095c1030,_kerffti=0x1094cd030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a169c30,_x=0x7fad191a2030,_y=0x7fad1915d430,
 _centroidgain=1,_rayleigh=0x7fad1a8385a8,_bckgrdcalib=0x7fad1a109630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838650)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837260,_ctrlden=0x7fad1a8377d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1a3c0,_xlast=0x7fad18e23c50,_ylast=[0x7fad1a0ee630,
 0x7fad1a0ee630,0x7fad1a0ee630],_y0=0x7fad1a0a9630,_signus=0x7fad18e31d20,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f09fd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819808,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd38,xposition=0x7fad1a819920,yposition=
 0x7fad1a8380d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838570,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849dc0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f9b8,lgs_prof_alt=0x7fad1a838340,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c0b1f0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d06020,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1091d7030,_masks=0x0,_fluxpersub=0x7fad18d06b60,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d04fb0,_skyfluxpersub=0x7fad18d05a30,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[8.69997e-05,0.000816142],
 _lastvalidtt=[8.69997e-05,0.000816142],_upttcommand=[0,0],_refmes=
 0x7fad1a16ac30,_tiprefv=0x7fad1a091a30,_tiltrefv=0x7fad1a090e30,_tiprefvn=
 0x7fad1a16b430,_tiltrefvn=0x7fad1a108a30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18d063e0,_jstart=0x7fad18d067a0,
 _binindices=0x7fad1a0e0a30,_binxy=2,_centroidw=0x7fad1903fec0,_fimage=
 0x7fad1919e230,_fimage2=0x0,_imistart=0x7fad18e250e0,_imjstart=0x7fad18e23f10,
 _imistart2=0x7fad18e242d0,_imjstart2=0x7fad18e20920,_unittip=0x7fad18d04a50,
 _unittilt=0x7fad18d05df0,_lgs_defocuses=0x7fad1a819a38,_unitdefocus=
 0x109ac1030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19822430,
 _flat=0x7fad19820230,_domask=1,_submask=0x7fad19814430,_kernel=0x7fad1a0e4030,
 _kernels=0x108fc5030,_kerfftr=0x1090e8030,_kerffti=0x109744030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19178c30,_x=0x7fad1981e230,_y=0x7fad1981ea30,
 _centroidgain=1,_rayleigh=0x7fad1a819920,_bckgrdcalib=0x7fad19823630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fa60)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fd00,_ctrlden=0x7fad19035830,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e18170,_xlast=0x7fad18e24910,_ylast=[0x7fad1a0a9630,
 0x7fad1a0a9630,0x7fad1a0a9630],_y0=0x7fad1a0fb430,_signus=0x7fad18e23c50,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5d070,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819808,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd38,xposition=0x7fad1a837ae8,yposition=
 0x7fad1a838068,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838570,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    406.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.946       84.1
Field Avg  2.20                     70.7   0.946       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848ff0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f9b8,lgs_prof_alt=0x7fad1a838340,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5a690,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d05a30,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10dbb2030,_masks=0x0,_fluxpersub=0x7fad18c5f740,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c59b50,_skyfluxpersub=0x7fad18c59f10,
 _nphotons=406.926,_skynphotons=0.174543,_tt=[0.00153357,0.000272301],
 _lastvalidtt=[0.00153357,0.000272301],_upttcommand=[0,0],_refmes=
 0x7fad1a858030,_tiprefv=0x7fad1a0dc630,_tiltrefv=0x7fad1916b230,_tiprefvn=
 0x7fad1a091a30,_tiltrefvn=0x7fad19179e30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18d04fb0,_jstart=0x7fad18d06570,
 _binindices=0x7fad1916ee30,_binxy=2,_centroidw=0x7fad1a838500,_fimage=
 0x7fad19158230,_fimage2=0x0,_imistart=0x7fad18c58c50,_imjstart=0x7fad18c59010,
 _imistart2=0x7fad18c593d0,_imjstart2=0x7fad18c59790,_unittip=0x7fad18c57830,
 _unittilt=0x7fad18f116d0,_lgs_defocuses=0x7fad1a8379d0,_unitdefocus=
 0x108bd3030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19149230,
 _flat=0x7fad1917fa30,_domask=1,_submask=0x7fad1913e430,_kernel=0x7fad19179630,
 _kernels=0x1095c1030,_kerfftr=0x109744030,_kerffti=0x108fc5030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1915c230,_x=0x7fad1981e230,_y=0x7fad1982d830,
 _centroidgain=1,_rayleigh=0x7fad1a837ae8,_bckgrdcalib=0x7fad1914a430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837880)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a819a38,_ctrlden=0x7fad1a838618,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c56e60,_xlast=0x7fad18c57af0,_ylast=[0x7fad1916ea30,
 0x7fad1916ea30,0x7fad1916ea30],_y0=0x7fad1916be30,_signus=0x7fad18c57c70,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d04a50,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819808,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd38,xposition=0x7fad1a838650,yposition=
 0x7fad1a838538,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838570,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    162.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.942       84.1
Field Avg  2.20                     70.7   0.942       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848f68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f9b8,lgs_prof_alt=
 0x7fad1a838340,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18e27c00,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18c575f0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10ebc3030,_masks=0x0,_fluxpersub=0x7fad18e25880,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e25c40,_skyfluxpersub=0x7fad18e26000,
 _nphotons=162,_skynphotons=0.174543,_tt=[0.00582361,-0.00110323],_lastvalidtt=
 [0.00582361,-0.00110323],_upttcommand=[0,0],_refmes=0x7fad1a146830,_tiprefv=
 0x7fad1a0e2430,_tiltrefv=0x7fad1913c630,_tiprefvn=0x7fad1a0dc630,_tiltrefvn=
 0x7fad1916b230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18c579b0,_jstart=0x7fad18c566c0,_binindices=0x7fad1916ee30,
 _binxy=2,_centroidw=0x7fad1a8381f0,_fimage=0x7fad1a12d630,_fimage2=0x0,
 _imistart=0x7fad18c4eaa0,_imjstart=0x7fad18c4ee60,_imistart2=0x7fad18c4f220,
 _imjstart2=0x7fad18c4f5e0,_unittip=0x7fad18c0b5b0,_unittilt=0x7fad18c0cf50,
 _lgs_defocuses=0x7fad1a074278,_unitdefocus=0x10ad8e030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a145630,_flat=0x7fad1a0dec30,_domask=1,
 _submask=0x7fad1a0fd230,_kernel=0x7fad1a0e3030,_kernels=0x1094cd030,_kerfftr=
 0x108ec9030,_kerffti=0x1090e8030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad1a12a030,_x=0x7fad1913e430,_y=0x7fad191a2030,_centroidgain=1,_rayleigh=
 0x7fad1a838650,_bckgrdcalib=0x7fad1a090e30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a837260)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8379d0,_ctrlden=0x7fad1a837ce0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e25140,_xlast=0x7fad18e252c0,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a147030,_signus=0x7fad18e25440,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e18170,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819808,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd38,xposition=0x7fad1903fa60,yposition=
 0x7fad1a8375e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838570,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    40.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       73.9   0.613      144.1
Field Avg  2.20                     73.9   0.613      144.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848ee0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 14,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f9b8,lgs_prof_alt=
 0x7fad1a838340,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18e24fe0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18c4fb30,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x1098bf030,_masks=0x0,_fluxpersub=0x7fad18c51cf0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c520b0,_skyfluxpersub=0x7fad18c52470,
 _nphotons=40.6926,_skynphotons=1.74543,_tt=[0.0106244,0.00123862],_lastvalidtt=
 [0.0106244,0.00123862],_upttcommand=[0,0],_refmes=0x7fad1918de30,_tiprefv=
 0x7fad19179630,_tiltrefv=0x7fad19158230,_tiprefvn=0x7fad1917c630,_tiltrefvn=
 0x7fad1913c630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18c4fef0,_jstart=0x7fad18c502b0,_binindices=0x7fad1916ee30,
 _binxy=2,_centroidw=0x7fad1903ffd8,_fimage=0x7fad1917d230,_fimage2=0x0,
 _imistart=0x7fad18c50df0,_imjstart=0x7fad18c511b0,_imistart2=0x7fad18c51570,
 _imjstart2=0x7fad18c51930,_unittip=0x7fad18c4f6d0,_unittilt=0x7fad18c4f900,
 _lgs_defocuses=0x7fad1a837ae8,_unitdefocus=0x109bc2030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad1917e430,_flat=0x7fad1918cc30,_domask=1,
 _submask=0x7fad19036430,_kernel=0x7fad1918ee30,_kernels=0x109744030,_kerfftr=
 0x108fc5030,_kerffti=0x1094cd030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad1a109630,_x=0x7fad1917a230,_y=0x7fad1913e430,_centroidgain=1,_rayleigh=
 0x7fad1903fa60,_bckgrdcalib=0x7fad1917f630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1903fd00)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fc58,_ctrlden=0x7fad1a8381f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5d070,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad1916d230,
 0x7fad1916d230,0x7fad1916d230],_y0=0x7fad191a2830,_signus=0x7fad18c0cf50,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c52830,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819808,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd38,xposition=0x7fad1a837880,yposition=
 0x7fad1a8377d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838570,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    16.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       76.3   0.559      150.1
Field Avg  2.20                     76.3   0.559      150.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8488a0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f9b8,lgs_prof_alt=
 0x7fad1a838340,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18e25190,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18e33c90,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x109643030,_masks=0x0,_fluxpersub=0x7fad18e265c0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e26980,_skyfluxpersub=0x7fad18e23c50,
 _nphotons=16.2,_skynphotons=1.74543,_tt=[0.00783376,0.0167221],_lastvalidtt=
 [0.00783376,0.0167221],_upttcommand=[0,0],_refmes=0x7fad1916ee30,_tiprefv=
 0x7fad1915c230,_tiltrefv=0x7fad19155030,_tiprefvn=0x7fad19179630,_tiltrefvn=
 0x7fad19158230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18e256c0,_jstart=0x7fad18e27dd0,_binindices=0x7fad1a0e0a30,
 _binxy=2,_centroidw=0x7fad1a8386c0,_fimage=0x7fad1a142830,_fimage2=0x0,
 _imistart=0x7fad18e28910,_imjstart=0x7fad18e25a80,_imistart2=0x7fad18e25e40,
 _imjstart2=0x7fad18e26200,_unittip=0x7fad18e1a3c0,_unittilt=0x7fad18e33a60,
 _lgs_defocuses=0x7fad1a838688,_unitdefocus=0x10ae8f030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a0e9630,_flat=0x7fad1a109630,_domask=1,
 _submask=0x7fad1a0eb630,_kernel=0x7fad1a10e230,_kernels=0x1094cd030,_kerfftr=
 0x108e44030,_kerffti=0x109744030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad1a13ca30,_x=0x7fad1a0e1230,_y=0x7fad1a0e1a30,_centroidgain=1,_rayleigh=
 0x7fad1a837880,_bckgrdcalib=0x7fad1a141630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a819a38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838650,_ctrlden=0x7fad1a8375e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e18170,_xlast=0x7fad18e24010,_ylast=[0x7fad1a092030,
 0x7fad1a092030,0x7fad1a092030],_y0=0x7fad1a0fb430,_signus=0x7fad18e24c10,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0e060,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819808,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd38,xposition=0x7fad1a837260,yposition=
 0x7fad19035830,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838570,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       85.1   0.395      180.2
Field Avg  2.20                     85.1   0.395      180.2
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8496d8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 16,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f9b8,lgs_prof_alt=
 0x7fad1a838340,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18c50190,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18c4fa00,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x108bd3030,_masks=0x0,_fluxpersub=0x7fad18f0bc70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0b4a0,_skyfluxpersub=0x7fad18f0c300,
 _nphotons=6.44935,_skynphotons=1.74543,_tt=[0.0124273,-0.00552496],
 _lastvalidtt=[0.0124273,-0.00552496],_upttcommand=[0,0],_refmes=0x7fad1913c630,
 _tiprefv=0x7fad1916b230,_tiltrefv=0x7fad19180c30,_tiprefvn=0x7fad1915c230,
 _tiltrefvn=0x7fad19155030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7fad18c50850,_jstart=0x7fad18c50c10,_binindices=
 0x7fad19158a30,_binxy=2,_centroidw=0x7fad1a074278,_fimage=0x7fad1917f230,
 _fimage2=0x0,_imistart=0x7fad18c51750,_imjstart=0x7fad18c51b10,_imistart2=
 0x7fad18c51ed0,_imjstart2=0x7fad18c52360,_unittip=0x7fad18c4ec90,_unittilt=
 0x7fad18c4f7d0,_lgs_defocuses=0x7fad1903fec0,_unitdefocus=0x10b0db030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a82c830,_flat=
 0x7fad1a872430,_domask=1,_submask=0x7fad1a845030,_kernel=0x7fad1a858030,
 _kernels=0x1093d9030,_kerfftr=0x108ec9030,_kerffti=0x108fc5030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1915ce30,_x=0x7fad1917c630,_y=0x7fad191a2030,
 _centroidgain=1,_rayleigh=0x7fad1a837260,_bckgrdcalib=0x7fad1a82da30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8379d0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8377d8,_ctrlden=0x7fad1a837bc8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cf50,_xlast=0x7fad18c4e320,_ylast=[0x7fad19181830,
 0x7fad19181830,0x7fad19181830],_y0=0x7fad1916be30,_signus=0x7fad18c4e4a0,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5d070,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a819808,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1903fd38,xposition=0x7fad1903fd00,yposition=
 0x7fad1a838618,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838570,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    644934.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       53.0   0.909       63.1
Field Avg  1.65                     53.0   0.909       63.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a848570)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=1,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1a837b90,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c62420,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18f0bc80,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ebc3030,_masks=0x0,_fluxpersub=0x7fad18e17b30,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e20a30,_skyfluxpersub=0x7fad18e20df0,
 _nphotons=644935,_skynphotons=0.174543,_tt=[-0.000410312,0.000537161],
 _lastvalidtt=[-0.000410312,0.000537161],_upttcommand=[0,0],_refmes=
 0x7fad1981ea30,_tiprefv=0x7fad1a819e30,_tiltrefv=0x7fad1a0da030,_tiprefvn=
 0x7fad1a867e30,_tiltrefvn=0x7fad1a0e9430,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18f0ace0,_jstart=0x7fad18f0b0a0,
 _binindices=0x7fad19193830,_binxy=2,_centroidw=0x7fad1a819a70,_fimage=
 0x7fad1917b230,_fimage2=0x0,_imistart=0x7fad18c60d70,_imjstart=0x7fad18c61130,
 _imistart2=0x7fad18c614f0,_imjstart2=0x7fad18c618b0,_unittip=0x7fad18f0b820,
 _unittilt=0x7fad18f0ba50,_lgs_defocuses=0x7fad1a8384c8,_unitdefocus=
 0x1098bf030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a0dc630,
 _flat=0x7fad1a0dec30,_domask=1,_submask=0x7fad1a0a8e30,_kernel=0x7fad1a10aa30,
 _kernels=0x109542030,_kerfftr=0x109105030,_kerffti=0x108e44030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19192630,_x=0x7fad1a82d030,_y=0x7fad1a82d830,
 _centroidgain=1,_rayleigh=0x7fad1a838650,_bckgrdcalib=0x7fad1a090e30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838458)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8199c8,_ctrlden=0x7fad1a838228,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c4ea50,_xlast=0x7fad18c4e700,_ylast=[0x7fad19155830,
 0x7fad19155830,0x7fad19155830],_y0=0x7fad1915ce30,_signus=0x7fad18c4e320,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0cbd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1903fd70,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837c38,xposition=0x7fad1903fd38,yposition=
 0x7fad1a8376c0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8377d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       53.0   0.909       63.1
Field Avg  1.65                     53.0   0.909       63.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849cb0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1a837b90,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e241d0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e17b30,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109cc3030,_masks=0x0,_fluxpersub=0x7fad18c4fdb0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c50fd0,_skyfluxpersub=0x7fad18c0b1f0,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[0.000184056,0.000370922],
 _lastvalidtt=[0.000184056,0.000370922],_upttcommand=[0,0],_refmes=
 0x7fad1a0e2430,_tiprefv=0x7fad1a0e7c30,_tiltrefv=0x7fad1a0a8e30,_tiprefvn=
 0x7fad1a0dec30,_tiltrefvn=0x7fad1a0da030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e210e0,_jstart=0x7fad18e232d0,
 _binindices=0x7fad1a0e1c30,_binxy=2,_centroidw=0x7fad1a837960,_fimage=
 0x7fad1a12b230,_fimage2=0x0,_imistart=0x7fad18e23e10,_imjstart=0x7fad18e21dd0,
 _imistart2=0x7fad18e22190,_imjstart2=0x7fad18e22550,_unittip=0x7fad18f0b770,
 _unittilt=0x7fad18f0b9a0,_lgs_defocuses=0x7fad1a838730,_unitdefocus=
 0x109643030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19178430,
 _flat=0x7fad19036430,_domask=1,_submask=0x7fad1917aa30,_kernel=0x7fad1a0ee230,
 _kernels=0x108ebe030,_kerfftr=0x109067030,_kerffti=0x109542030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a0e9c30,_x=0x7fad1a10aa30,_y=0x7fad1a0e2c30,
 _centroidgain=1,_rayleigh=0x7fad1903fd38,_bckgrdcalib=0x7fad19191830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fec0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a819a00,_ctrlden=0x7fad1a819a70,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e22cd0,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a0e8830,_signus=0x7fad18e1a3c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e214a0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1903fd70,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837c38,xposition=0x7fad1a838618,yposition=
 0x7fad1903fbb0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8377d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    406.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       53.0   0.906       63.1
Field Avg  1.65                     53.0   0.906       63.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849650)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=0x7fad1a837b90,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e22390,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e21850,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109ec5030,_masks=0x0,_fluxpersub=0x7fad18c55bd0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c55f90,_skyfluxpersub=0x7fad18c56350,
 _nphotons=406.926,_skynphotons=0.174543,_tt=[-0.00141737,0.00187399],
 _lastvalidtt=[-0.00141737,0.00187399],_upttcommand=[0,0],_refmes=
 0x7fad1913e430,_tiprefv=0x7fad1985e830,_tiltrefv=0x7fad1a0e7c30,_tiprefvn=
 0x7fad1985f430,_tiltrefvn=0x7fad1a0a8e30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e23690,_jstart=0x7fad18e23a50,
 _binindices=0x7fad1a13e430,_binxy=2,_centroidw=0x7fad1a8379d0,_fimage=
 0x7fad1a13fc30,_fimage2=0x0,_imistart=0x7fad18e22ec0,_imjstart=0x7fad18e21c10,
 _imistart2=0x7fad18e21fd0,_imjstart2=0x7fad18e20b50,_unittip=0x7fad18e21620,
 _unittilt=0x7fad18e20920,_lgs_defocuses=0x7fad1a837848,_unitdefocus=
 0x1099c0030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a0e4030,
 _flat=0x7fad1a0e1c30,_domask=1,_submask=0x7fad19179630,_kernel=0x7fad1a090e30,
 _kernels=0x109542030,_kerfftr=0x108c2c030,_kerffti=0x108ebe030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a0e0a30,_x=0x7fad1a107e30,_y=0x7fad1a108630,
 _centroidgain=1,_rayleigh=0x7fad1a838618,_bckgrdcalib=0x7fad1a144e30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a819808)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8371b8,_ctrlden=0x7fad1a837ce0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1d690,_xlast=0x7fad18e1bf00,_ylast=[0x7fad1a0e8830,
 0x7fad1a0e8830,0x7fad1a0e8830],_y0=0x7fad1a0ebe30,_signus=0x7fad18e22840,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c4ea50,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1903fd70,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837c38,xposition=0x7fad1a838458,yposition=
 0x7fad1a837df8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8377d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    162.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       53.0   0.901       63.1
Field Avg  1.65                     53.0   0.901       63.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a8497e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=
 0x7fad1a837b90,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18c0b1f0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18e23a20,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10ad8e030,_masks=0x0,_fluxpersub=0x7fad18f08e70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f09230,_skyfluxpersub=0x7fad18f0b0a0,
 _nphotons=162,_skynphotons=0.174543,_tt=[0.00382163,-6.88468e-05],_lastvalidtt=
 [0.00382163,-6.88468e-05],_upttcommand=[0,0],_refmes=0x7fad1a0eae30,_tiprefv=
 0x7fad1a100230,_tiltrefv=0x7fad1a0ff630,_tiprefvn=0x7fad1a102a30,_tiltrefvn=
 0x7fad1a0e7c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18e24430,_jstart=0x7fad18e21330,_binindices=0x7fad1a0e9430,
 _binxy=2,_centroidw=0x7fad1a838650,_fimage=0x7fad19178430,_fimage2=0x0,
 _imistart=0x7fad18e1f050,_imjstart=0x7fad18e24ab0,_imistart2=0x7fad18e220a0,
 _imjstart2=0x7fad18e216f0,_unittip=0x7fad18e20ce0,_unittilt=0x7fad18e1a3c0,
 _lgs_defocuses=0x7fad1903fb78,_unitdefocus=0x109ac1030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a830630,_flat=0x7fad1a82f430,_domask=1,
 _submask=0x7fad1a858030,_kernel=0x7fad1a0dce30,_kernels=0x1093d9030,_kerfftr=
 0x10944f030,_kerffti=0x109067030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad19170c30,_x=0x7fad1a0dc630,_y=0x7fad1a0a8e30,_centroidgain=1,_rayleigh=
 0x7fad1a838458,_bckgrdcalib=0x7fad1a831830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a8199c8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837848,_ctrlden=0x7fad1a838260,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c4e700,_xlast=0x7fad18c0e060,_ylast=[0x7fad1916f830,
 0x7fad1916f830,0x7fad1916f830],_y0=0x7fad19155830,_signus=0x7fad18c4e320,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1d690,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1903fd70,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837c38,xposition=0x7fad1903fec0,yposition=
 0x7fad1a8382d0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8377d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    40.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       57.2   0.421      166.7
Field Avg  1.65                     57.2   0.421      166.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a849a08)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 14,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=
 0x7fad1a837b90,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18f0b3b0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18c54140,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x109bc2030,_masks=0x0,_fluxpersub=0x7fad18c615e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c619a0,_skyfluxpersub=0x7fad18c61d60,
 _nphotons=40.6926,_skynphotons=1.74543,_tt=[0.00292339,0.00531295],
 _lastvalidtt=[0.00292339,0.00531295],_upttcommand=[0,0],_refmes=0x7fad1a102030,
 _tiprefv=0x7fad1a12e030,_tiltrefv=0x7fad1a0a8e30,_tiprefvn=0x7fad1a100230,
 _tiltrefvn=0x7fad1a0ff630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7fad18c51cc0,_jstart=0x7fad18c52500,_binindices=
 0x7fad19192030,_binxy=2,_centroidw=0x7fad1a8386f8,_fimage=0x7fad19036430,
 _fimage2=0x0,_imistart=0x7fad18c606e0,_imjstart=0x7fad18c60aa0,_imistart2=
 0x7fad18c60e60,_imjstart2=0x7fad18c61220,_unittip=0x7fad18c5eb80,_unittilt=
 0x7fad18c0b5b0,_lgs_defocuses=0x7fad1a837960,_unitdefocus=0x109dc4030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1914ac30,_flat=
 0x7fad19149a30,_domask=1,_submask=0x7fad19149230,_kernel=0x7fad1916ba30,
 _kernels=0x109744030,_kerfftr=0x1090dc030,_kerffti=0x108c2c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1917c230,_x=0x7fad19179630,_y=0x7fad19193030,
 _centroidgain=1,_rayleigh=0x7fad1903fec0,_bckgrdcalib=0x7fad1914be30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a819a00)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8384c8,_ctrlden=0x7fad1903fa60,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c4f510,_xlast=0x7fad18c4e700,_ylast=[0x7fad19155830,
 0x7fad19155830,0x7fad19155830],_y0=0x7fad19181830,_signus=0x7fad18c4fda0,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c528c0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1903fd70,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837c38,xposition=0x7fad1a819808,yposition=
 0x7fad1a838228,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8377d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    16.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       59.6   0.369      166.7
Field Avg  1.65                     59.6   0.369      166.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a8495c8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=
 0x7fad1a837b90,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18c51c10,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18c52200,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10b0db030,_masks=0x0,_fluxpersub=0x7fad18c60e60,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c61220,_skyfluxpersub=0x7fad18c615e0,
 _nphotons=16.2,_skynphotons=1.74543,_tt=[0.000504513,-0.0014134],_lastvalidtt=
 [0.000504513,-0.0014134],_upttcommand=[0,0],_refmes=0x7fad191f4c30,_tiprefv=
 0x7fad191f5430,_tiltrefv=0x7fad1917c230,_tiprefvn=0x7fad191f6030,_tiltrefvn=
 0x7fad19179630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18c5ff60,_jstart=0x7fad18c60320,_binindices=0x7fad19192830,
 _binxy=2,_centroidw=0x7fad1a838068,_fimage=0x7fad19194230,_fimage2=0x0,
 _imistart=0x7fad18c631d0,_imjstart=0x7fad18c62110,_imistart2=0x7fad18c606e0,
 _imjstart2=0x7fad18c60aa0,_unittip=0x7fad18c4f510,_unittilt=0x7fad18c4fda0,
 _lgs_defocuses=0x7fad1903fad0,_unitdefocus=0x10ae8f030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad19170c30,_flat=0x7fad19180630,_domask=1,
 _submask=0x7fad19178c30,_kernel=0x7fad1917ee30,_kernels=0x1093d9030,_kerfftr=
 0x108e44030,_kerffti=0x10944f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad1914a230,_x=0x7fad1913e430,_y=0x7fad19160630,_centroidgain=1,_rayleigh=
 0x7fad1a819808,_bckgrdcalib=0x7fad19193030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a8371b8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838688,_ctrlden=0x7fad1a8382d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c4ea50,_xlast=0x7fad18c61f90,_ylast=[0x7fad19181830,
 0x7fad19181830,0x7fad19181830],_y0=0x7fad1917f630,_signus=0x7fad18c54140,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c4e700,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1903fd70,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837c38,xposition=0x7fad1a8199c8,yposition=
 0x7fad1a819a70,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8377d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       73.9   0.216      198.2
Field Avg  1.65                     73.9   0.216      198.2
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a8483d8,winddir=0x7fad1a848460,
 _layeralt=0x7fad1a848ff0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 16,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903fc58,lgs_prof_alt=
 0x7fad1a837b90,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18e21b00,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18c60320,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10af90030,_masks=0x0,_fluxpersub=0x7fad18f0a370,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0a730,_skyfluxpersub=0x7fad18f19a30,
 _nphotons=6.44935,_skynphotons=1.74543,_tt=[0.015065,0.0197175],_lastvalidtt=
 [0.015065,0.0197175],_upttcommand=[0,0],_refmes=0x7fad1a10aa30,_tiprefv=
 0x7fad1a0a8e30,_tiltrefv=0x7fad1a0da030,_tiprefvn=0x7fad1a107e30,_tiltrefvn=
 0x7fad1a0e7c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18c4f200,_jstart=0x7fad18c50fd0,_binindices=0x7fad19191830,
 _binxy=2,_centroidw=0x7fad1903fb78,_fimage=0x7fad1a0e4030,_fimage2=0x0,
 _imistart=0x7fad18c51ce0,_imjstart=0x7fad18c520a0,_imistart2=0x7fad18c0b1f0,
 _imjstart2=0x7fad18c51390,_unittip=0x7fad18c0b5b0,_unittilt=0x7fad18c4e320,
 _lgs_defocuses=0x7fad1a819920,_unitdefocus=0x109643030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a82da30,_flat=0x7fad1a82c830,_domask=1,
 _submask=0x7fad1a845030,_kernel=0x7fad1a858030,_kernels=0x1093d9030,_kerfftr=
 0x1095c5030,_kerffti=0x1090dc030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad1a0ed230,_x=0x7fad19152230,_y=0x7fad1917ea30,_centroidgain=1,_rayleigh=
 0x7fad1a8199c8,_bckgrdcalib=0x7fad1a82f430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a837848)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8386f8,_ctrlden=0x7fad1a838570,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1d510,_xlast=0x7fad18e1d690,_ylast=[0x7fad1a108a30,
 0x7fad1a108a30,0x7fad1a108a30],_y0=0x7fad1a0e8830,_signus=0x7fad18e17b30,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e20920,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1903fd70,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837c38,xposition=0x7fad1a819a00,yposition=
 0x7fad1a837ce0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8377d8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    644934.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.847       51.2
Field Avg  1.25                     40.2   0.847       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848cc0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=1,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8384c8,lgs_prof_alt=0x7fad1a838228,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e22330,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c4e700,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ad8e030,_masks=0x0,_fluxpersub=0x7fad18c51610,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c5eb80,_skyfluxpersub=0x7fad18c54140,
 _nphotons=644935,_skynphotons=0.174543,_tt=[-0.000345858,0.00054766],
 _lastvalidtt=[-0.000345858,0.00054766],_upttcommand=[0,0],_refmes=
 0x7fad19813c30,_tiprefv=0x7fad1a0e7c30,_tiltrefv=0x7fad1a0ed230,_tiprefvn=
 0x7fad1a0da030,_tiltrefvn=0x7fad1a0e2830,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c4f810,_jstart=0x7fad18c4fbd0,
 _binindices=0x7fad19191830,_binxy=2,_centroidw=0x7fad1a838298,_fimage=
 0x7fad1a13ca30,_fimage2=0x0,_imistart=0x7fad18c50710,_imjstart=0x7fad18c50ad0,
 _imistart2=0x7fad18c50e90,_imjstart2=0x7fad18c51250,_unittip=0x7fad18f0c460,
 _unittilt=0x7fad18f0c690,_lgs_defocuses=0x7fad1903fc90,_unitdefocus=
 0x1098b2030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1916de30,
 _flat=0x7fad1918e430,_domask=1,_submask=0x7fad19170c30,_kernel=0x7fad1a10aa30,
 _kernels=0x109554030,_kerfftr=0x108e44030,_kerffti=0x10906b030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a0e4830,_x=0x7fad19036430,_y=0x7fad1918cc30,
 _centroidgain=1,_rayleigh=0x7fad1a8380d8,_bckgrdcalib=0x7fad1917c230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8199c8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837570,_ctrlden=0x7fad1a837848,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e1d650,_ylast=[0x7fad1a0e8830,
 0x7fad1a0e8830,0x7fad1a0e8830],_y0=0x7fad1a0e3430,_signus=0x7fad18e1a3c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d09c40,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a837110,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819b50,xposition=0x7fad1a837c38,yposition=
 0x7fad1a838768,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8386f8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.847       51.2
Field Avg  1.25                     40.2   0.847       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8485f8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8384c8,lgs_prof_alt=0x7fad1a838228,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c54140,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e222d0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109bc2030,_masks=0x0,_fluxpersub=0x7fad18e25140,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e25500,_skyfluxpersub=0x7fad18e258c0,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-0.000156587,0.00079382],
 _lastvalidtt=[-0.000156587,0.00079382],_upttcommand=[0,0],_refmes=
 0x7fad1a0dce30,_tiprefv=0x7fad198b6230,_tiltrefv=0x7fad1a0da030,_tiprefvn=
 0x7fad19820630,_tiltrefvn=0x7fad1a0ed230,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e22a00,_jstart=0x7fad18e22dc0,
 _binindices=0x7fad1a0e1230,_binxy=2,_centroidw=0x7fad1a8377d8,_fimage=
 0x7fad19173630,_fimage2=0x0,_imistart=0x7fad18e240a0,_imjstart=0x7fad18e24460,
 _imistart2=0x7fad18e24820,_imjstart2=0x7fad18e24be0,_unittip=0x7fad18e1a3c0,
 _unittilt=0x7fad18e218b0,_lgs_defocuses=0x7fad1903fb08,_unitdefocus=
 0x1091c0030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a144630,
 _flat=0x7fad1a143430,_domask=1,_submask=0x7fad1a141830,_kernel=0x7fad1a0dec30,
 _kernels=0x1093d9030,_kerfftr=0x1095ce030,_kerffti=0x109554030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19180a30,_x=0x7fad1a108430,_y=0x7fad1a10aa30,
 _centroidgain=1,_rayleigh=0x7fad1a837c38,_bckgrdcalib=0x7fad1a0fc030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a819920)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837490,_ctrlden=0x7fad1a8386c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0e060,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad1916d230,
 0x7fad1916d230,0x7fad1916d230],_y0=0x7fad19063030,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10c9e3030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a837110,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819b50,xposition=0x7fad1a837ce0,yposition=
 0x7fad1903fe50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8386f8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    406.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.843       51.2
Field Avg  1.25                     40.2   0.843       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849188)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8384c8,lgs_prof_alt=0x7fad1a838228,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c4ee60,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c51590,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10b0db030,_masks=0x0,_fluxpersub=0x7fad18f0c930,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c4eaa0,_skyfluxpersub=0x7fad18c4f570,
 _nphotons=406.926,_skynphotons=0.174543,_tt=[-0.000446813,-0.000770156],
 _lastvalidtt=[-0.000446813,-0.000770156],_upttcommand=[0,0],_refmes=
 0x7fad1a146a30,_tiprefv=0x7fad1a13fc30,_tiltrefv=0x7fad1a0ede30,_tiprefvn=
 0x7fad1a0e7c30,_tiltrefvn=0x7fad1a0da030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c4e320,_jstart=0x7fad18c4e6e0,
 _binindices=0x7fad1a858030,_binxy=2,_centroidw=0x7fad1a8376f8,_fimage=
 0x7fad1914d830,_fimage2=0x0,_imistart=0x7fad18f0b5c0,_imjstart=0x7fad18f0bdf0,
 _imistart2=0x7fad18f0c1b0,_imjstart2=0x7fad18f0c570,_unittip=0x7fad18c0c650,
 _unittilt=0x7fad18c5ed30,_lgs_defocuses=0x7fad1a838298,_unitdefocus=
 0x109ab0030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1917ec30,
 _flat=0x7fad1918e430,_domask=1,_submask=0x7fad1a804630,_kernel=0x7fad1a845030,
 _kernels=0x109554030,_kerfftr=0x108eb9030,_kerffti=0x108e44030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1914c630,_x=0x7fad1913e430,_y=0x7fad1917dc30,
 _centroidgain=1,_rayleigh=0x7fad1a837ce0,_bckgrdcalib=0x7fad19149230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fbe8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fb08,_ctrlden=0x7fad1a8370a0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1d650,_xlast=0x7fad18e1a3c0,_ylast=[0x7fad1a0e8830,
 0x7fad1a0e8830,0x7fad1a0e8830],_y0=0x7fad1a108a30,_signus=0x7fad18e20920,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0cbd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a837110,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819b50,xposition=0x7fad1a8199c8,yposition=
 0x7fad1a837ab0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8386f8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    162.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.834       51.2
Field Avg  1.25                     40.2   0.834       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8496d8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8384c8,lgs_prof_alt=
 0x7fad1a838228,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18e31b70,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18f0b7c0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x1092d8030,_masks=0x0,_fluxpersub=0x7fad18c5eb80,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c0b1f0,_skyfluxpersub=0x7fad18c4ecb0,
 _nphotons=162,_skynphotons=0.174543,_tt=[-0.00330598,-0.00112972],_lastvalidtt=
 [-0.00330598,-0.00112972],_upttcommand=[0,0],_refmes=0x7fad19036430,_tiprefv=
 0x7fad1915c230,_tiltrefv=0x7fad19180630,_tiprefvn=0x7fad19178430,_tiltrefvn=
 0x7fad19179030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18f0c1b0,_jstart=0x7fad18f0c570,_binindices=0x7fad1a146a30,
 _binxy=2,_centroidw=0x7fad1903fa28,_fimage=0x7fad1a13d030,_fimage2=0x0,
 _imistart=0x7fad18e34060,_imjstart=0x7fad18e21a60,_imistart2=0x7fad18e21e20,
 _imjstart2=0x7fad18e221e0,_unittip=0x7fad18f0b360,_unittilt=0x7fad18f0b590,
 _lgs_defocuses=0x7fad1a8377d8,_unitdefocus=0x10bce0030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a82f430,_flat=0x7fad1a830630,_domask=1,
 _submask=0x7fad1918cc30,_kernel=0x7fad19813c30,_kernels=0x10906b030,_kerfftr=
 0x10915b030,_kerffti=0x1095ce030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad1a131a30,_x=0x7fad1a819e30,_y=0x7fad1a82e230,_centroidgain=1,_rayleigh=
 0x7fad1a8199c8,_bckgrdcalib=0x7fad1a831830,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1a837570)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8376c0,_ctrlden=0x7fad1a819a70,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e1f050,_ylast=[0x7fad1a108a30,
 0x7fad1a108a30,0x7fad1a108a30],_y0=0x7fad1a109e30,_signus=0x7fad18e1a3c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10cce6030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1d650,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a837110,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819b50,xposition=0x7fad1a819920,yposition=
 0x7fad1903f9b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8386f8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    40.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       46.6   0.237      187.7
Field Avg  1.25                     46.6   0.237      187.7
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849298)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 14,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8384c8,lgs_prof_alt=
 0x7fad1a838228,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18c4b950,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18e21830,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x109dc4030,_masks=0x0,_fluxpersub=0x7fad18e22680,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e32b70,_skyfluxpersub=0x7fad18e32f30,
 _nphotons=40.6926,_skynphotons=1.74543,_tt=[0.000689833,0.0114846],
 _lastvalidtt=[0.000689833,0.0114846],_upttcommand=[0,0],_refmes=0x7fad1916ba30,
 _tiprefv=0x7fad1917ec30,_tiltrefv=0x7fad1916f030,_tiprefvn=0x7fad1915c230,
 _tiltrefvn=0x7fad19180630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7fad18e345b0,_jstart=0x7fad18e33d70,_binindices=
 0x7fad19813c30,_binxy=2,_centroidw=0x7fad1a8373b0,_fimage=0x7fad1917c230,
 _fimage2=0x0,_imistart=0x7fad18d061b0,_imjstart=0x7fad18d06570,_imistart2=
 0x7fad18d0a0f0,_imjstart2=0x7fad18d0a4b0,_unittip=0x7fad18e1a3c0,_unittilt=
 0x7fad18e21600,_lgs_defocuses=0x7fad1a8382d0,_unitdefocus=0x10bee2030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a0e4030,_flat=
 0x7fad1a137430,_domask=1,_submask=0x7fad1a146a30,_kernel=0x7fad1a132430,
 _kernels=0x10920b030,_kerfftr=0x1095ce030,_kerffti=0x108eb9030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1918e430,_x=0x7fad1a10aa30,_y=0x7fad1a0dce30,
 _centroidgain=1,_rayleigh=0x7fad1a819920,_bckgrdcalib=0x7fad1a0e5230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837490)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fa28,_ctrlden=0x7fad1a837e30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e20920,_xlast=0x7fad18e1bf00,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a0fb430,_signus=0x7fad18e33ab0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f4c5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e34130,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a837110,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819b50,xposition=0x7fad1903fbe8,yposition=
 0x7fad1a837848,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8386f8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    16.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       51.9   0.187      187.7
Field Avg  1.25                     51.9   0.187      187.7
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8489b0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8384c8,lgs_prof_alt=
 0x7fad1a838228,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18c580b0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18e34970,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x109643030,_masks=0x0,_fluxpersub=0x7fad18e32240,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e32600,_skyfluxpersub=0x7fad18e332e0,
 _nphotons=16.2,_skynphotons=1.74543,_tt=[-0.00141684,-0.00918419],_lastvalidtt=
 [-0.00141684,-0.00918419],_upttcommand=[0,0],_refmes=0x7fad1a0eb830,_tiprefv=
 0x7fad1a0da030,_tiltrefv=0x7fad1a0ed230,_tiprefvn=0x7fad1a0dec30,_tiltrefvn=
 0x7fad1a13e030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18e212d0,_jstart=0x7fad18e31e80,_binindices=0x7fad1a13d630,
 _binxy=2,_centroidw=0x7fad1a074240,_fimage=0x7fad1916de30,_fimage2=0x0,
 _imistart=0x7fad18e34570,_imjstart=0x7fad18e218c0,_imistart2=0x7fad18e21c80,
 _imjstart2=0x7fad18e22040,_unittip=0x7fad18e1d510,_unittilt=0x7fad18e21690,
 _lgs_defocuses=0x7fad1903fcc8,_unitdefocus=0x10abdd030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a0e1230,_flat=0x7fad1a0e4830,_domask=1,
 _submask=0x7fad1a0ee230,_kernel=0x7fad1a0dce30,_kernels=0x108c76030,_kerfftr=
 0x10915b030,_kerffti=0x10920b030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad19178430,_x=0x7fad1a10aa30,_y=0x7fad1a13ce30,_centroidgain=1,_rayleigh=
 0x7fad1903fbe8,_bckgrdcalib=0x7fad1a0e2430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1903fb08)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fb78,_ctrlden=0x7fad1903fc20,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1f1d0,_xlast=0x7fad18e20920,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a0ede30,_signus=0x7fad18e342b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10cde5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1f050,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a837110,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819b50,xposition=0x7fad1a837570,yposition=
 0x7fad1a8386c0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8386f8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       72.2   0.104      215.0
Field Avg  1.25                     72.2   0.104      215.0
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849650)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 16,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a8384c8,lgs_prof_alt=
 0x7fad1a838228,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fad18c5eb80,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fad18e212d0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x109ab0030,_masks=0x0,_fluxpersub=0x7fad18e21a50,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e32d60,_skyfluxpersub=0x7fad18e32090,
 _nphotons=6.44935,_skynphotons=1.74543,_tt=[0.00571509,-0.00398396],
 _lastvalidtt=[0.00571509,-0.00398396],_upttcommand=[0,0],_refmes=
 0x7fad1a0e8430,_tiprefv=0x7fad1a132430,_tiltrefv=0x7fad1a142e30,_tiprefvn=
 0x7fad1a0da030,_tiltrefvn=0x7fad1a0ed230,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e1e8d0,_jstart=0x7fad18e1de10,
 _binindices=0x7fad1a13fc30,_binxy=2,_centroidw=0x7fad1a837ab0,_fimage=
 0x7fad19149230,_fimage2=0x0,_imistart=0x7fad18e21e10,_imjstart=0x7fad18e325e0,
 _imistart2=0x7fad18e329a0,_imjstart2=0x7fad18e21690,_unittip=0x7fad18e31a10,
 _unittilt=0x7fad18e1a3c0,_lgs_defocuses=0x7fad1a838260,_unitdefocus=
 0x10ebc3030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a141430,
 _flat=0x7fad1a143a30,_domask=1,_submask=0x7fad1a0e7c30,_kernel=0x7fad1a140430,
 _kernels=0x108c76030,_kerfftr=0x10903b030,_kerffti=0x1095ce030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19178c30,_x=0x7fad1a0ede30,_y=0x7fad1a144c30,
 _centroidgain=1,_rayleigh=0x7fad1a837570,_bckgrdcalib=0x7fad1a134230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8376c0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fcc8,_ctrlden=0x7fad1a8381f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0eaa0,_xlast=0x7fad18c0c650,_ylast=[0x7fad19063030,
 0x7fad19063030,0x7fad19063030],_y0=0x7fad1916d230,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f4c5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e32450,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a837110,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a819b50,xposition=0x7fad1a837490,yposition=
 0x7fad1a8370a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a8386f8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.4   0.954       78.1
Field Avg  2.20                     70.4   0.954       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849100)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e26420,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e17b30,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10abde030,_masks=0x0,_fluxpersub=0x7fad18e25510,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e258d0,_skyfluxpersub=0x7fad18e25c90,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[0.0016209,-0.00137],_lastvalidtt=
 [0.0016209,-0.00137],_upttcommand=[0,0],_refmes=0x7fad1a0e9c30,_tiprefv=
 0x7fad1a091630,_tiltrefv=0x7fad1a13fc30,_tiprefvn=0x7fad1a142630,_tiltrefvn=
 0x7fad1a100030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fad18e229d0,_jstart=0x7fad18e22d90,_binindices=0x7fad1a0eda30,
 _binxy=2,_centroidw=0x7fad1a838378,_fimage=0x7fad1a106430,_fimage2=0x0,
 _imistart=0x7fad18e24610,_imjstart=0x7fad18e249d0,_imistart2=0x7fad18e24d90,
 _imjstart2=0x7fad18e25150,_unittip=0x7fad18e18170,_unittilt=0x7fad18e21ac0,
 _lgs_defocuses=0x7fad1903f9b8,_unitdefocus=0x10bde1030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fad19227e30,_flat=0x7fad19226c30,_domask=1,
 _submask=0x7fad1a0e2430,_kernel=0x7fad1a107c30,_kernels=0x10918c030,_kerfftr=
 0x108d5f030,_kerffti=0x108c9f030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fad1a105230,_x=0x7fad1a143230,_y=0x7fad1a0da030,_centroidgain=1,_rayleigh=
 0x7fad1a838538,_bckgrdcalib=0x7fad19229030,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fad1903fda8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8378b8,_ctrlden=0x7fad1a837260,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18f0caf0,_xlast=0x7fad18f0cc70,_ylast=[0x7fad1a809630,
 0x7fad1a809630,0x7fad1a809630],_y0=0x7fad1a81ae30,_signus=0x7fad18f0cdf0,
 _puppixoffset=[0,0],_nact=80,_def=0x10ecc4030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1903fc58,yposition=
 0x7fad19040048,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.954       78.1
Field Avg  2.20                     70.7   0.954       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848790)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18d08cc0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e17b30,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ad8e030,_masks=0x0,_fluxpersub=0x7fad18c5ff60,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c5f740,_skyfluxpersub=0x7fad18c5dc90,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[0.000140599,-0.000795995],
 _lastvalidtt=[0.000140599,-0.000795995],_upttcommand=[0,0],_refmes=
 0x7fad19225a30,_tiprefv=0x7fad19229030,_tiltrefv=0x7fad19155030,_tiprefvn=
 0x7fad19229c30,_tiltrefvn=0x7fad1914f830,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e23ca0,_jstart=0x7fad18e24060,
 _binindices=0x7fad1a105230,_binxy=2,_centroidw=0x7fad1903fbe8,_fimage=
 0x7fad1a139430,_fimage2=0x0,_imistart=0x7fad18d079f0,_imjstart=0x7fad18d07db0,
 _imistart2=0x7fad18d08170,_imjstart2=0x7fad18d08530,_unittip=0x7fad18e18170,
 _unittilt=0x7fad18e21ac0,_lgs_defocuses=0x7fad1903fd38,_unitdefocus=
 0x109cc3030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a102630,
 _flat=0x7fad1a106230,_domask=1,_submask=0x7fad1917d230,_kernel=0x7fad19152e30,
 _kernels=0x10918c030,_kerfftr=0x1093d9030,_kerffti=0x109122030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a0eae30,_x=0x7fad1a0e2430,_y=0x7fad1a0e8230,
 _centroidgain=1,_rayleigh=0x7fad1903fc58,_bckgrdcalib=0x7fad1a0fc030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fd70)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8373b0,_ctrlden=0x7fad1a838768,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5e050,_xlast=0x7fad18c5d9d0,_ylast=[0x7fad19063030,
 0x7fad19063030,0x7fad19063030],_y0=0x7fad1916d230,_signus=0x7fad18c0e700,
 _puppixoffset=[0,0],_nact=80,_def=0x1103bd030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e22520,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1903fc90,yposition=
 0x7fad1a837c00,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.25,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.954       78.1
Field Avg  2.20                     70.7   0.954       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849c28)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e23300,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c62750,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1098b2030,_masks=0x0,_fluxpersub=0x7fad18c60aa0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c60e60,_skyfluxpersub=0x7fad18c5ff60,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[0.000109423,0.000126742],
 _lastvalidtt=[0.000109423,0.000126742],_upttcommand=[0,0],_refmes=
 0x7fad19226a30,_tiprefv=0x7fad1922b430,_tiltrefv=0x7fad1922a830,_tiprefvn=
 0x7fad19229030,_tiltrefvn=0x7fad19155030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c60320,_jstart=0x7fad18c606e0,
 _binindices=0x7fad1a0ed230,_binxy=2,_centroidw=0x7fad1a8380d8,_fimage=
 0x7fad1a142630,_fimage2=0x0,_imistart=0x7fad18e23c40,_imjstart=0x7fad18e24000,
 _imistart2=0x7fad18e24730,_imjstart2=0x7fad18e24af0,_unittip=0x7fad18c5df50,
 _unittilt=0x7fad18c0bdc0,_lgs_defocuses=0x7fad1903f9b8,_unitdefocus=
 0x109a34030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a139430,
 _flat=0x7fad1a0e9c30,_domask=1,_submask=0x7fad19149a30,_kernel=0x7fad1a106c30,
 _kernels=0x10918c030,_kerfftr=0x109443030,_kerffti=0x108d5f030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a141430,_x=0x7fad1917d230,_y=0x7fad19228430,
 _centroidgain=1,_rayleigh=0x7fad1903fc90,_bckgrdcalib=0x7fad1a0eae30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837ce0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fc58,_ctrlden=0x7fad1903fb08,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c618c0,_xlast=0x7fad18c61a40,_ylast=[0x7fad1916d230,
 0x7fad1916d230,0x7fad1916d230],_y0=0x7fad19150a30,_signus=0x7fad18c5dc90,
 _puppixoffset=[0,0],_nact=80,_def=0x10d4e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c54910,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1903fda8,yposition=
 0x7fad1903fa98,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.954       78.1
Field Avg  2.20                     70.7   0.954       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a8485f8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e23b20,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e25dd0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10b0db030,_masks=0x0,_fluxpersub=0x7fad18c4b590,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c5dc90,_skyfluxpersub=0x7fad18c50730,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[0.000506273,-0.000918918],
 _lastvalidtt=[0.000506273,-0.000918918],_upttcommand=[0,0],_refmes=
 0x7fad1a141430,_tiprefv=0x7fad1a0fec30,_tiltrefv=0x7fad1a804630,_tiprefvn=
 0x7fad1a141c30,_tiltrefvn=0x7fad1a82c830,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e22ce0,_jstart=0x7fad18e24e50,
 _binindices=0x7fad19814430,_binxy=2,_centroidw=0x7fad1a838260,_fimage=
 0x7fad1a0e9c30,_fimage2=0x0,_imistart=0x7fad18d05df0,_imjstart=0x7fad18d061b0,
 _imistart2=0x7fad18d06570,_imjstart2=0x7fad18d06930,_unittip=0x7fad18e238f0,
 _unittilt=0x7fad18e18170,_lgs_defocuses=0x7fad1a8376f8,_unitdefocus=
 0x10a7dc030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a0eae30,
 _flat=0x7fad1a139430,_domask=1,_submask=0x7fad19170c30,_kernel=0x7fad1917d230,
 _kernels=0x1094ad030,_kerfftr=0x109122030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a105230,_x=0x7fad1a0e1230,_y=0x7fad1a0e2430,
 _centroidgain=1,_rayleigh=0x7fad1903fda8,_bckgrdcalib=0x7fad19299830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8378b8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838378,_ctrlden=0x7fad1a838298,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1d510,_xlast=0x7fad18e230a0,_ylast=[0x7fad1a108030,
 0x7fad1a108030,0x7fad1a108030],_y0=0x7fad1a140830,_signus=0x7fad18e21ac0,
 _puppixoffset=[0,0],_nact=80,_def=0x10ebe0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e23620,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1903fd70,yposition=
 0x7fad1903fcc8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.33,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.953       78.1
Field Avg  2.20                     70.7   0.953       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a8488a0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5dc90,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d06920,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109ec5030,_masks=0x0,_fluxpersub=0x7fad18d09110,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d05d40,_skyfluxpersub=0x7fad18d06100,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[-0.000877708,-0.00145715],
 _lastvalidtt=[-0.000877708,-0.00145715],_upttcommand=[0,0],_refmes=
 0x7fad192e3e30,_tiprefv=0x7fad1914be30,_tiltrefv=0x7fad19152630,_tiprefvn=
 0x7fad192e6830,_tiltrefvn=0x7fad192e9230,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18d07310,_jstart=0x7fad18d076d0,
 _binindices=0x7fad19826430,_binxy=2,_centroidw=0x7fad1903fbe8,_fimage=
 0x7fad1914f830,_fimage2=0x0,_imistart=0x7fad18d08210,_imjstart=0x7fad18d085d0,
 _imistart2=0x7fad18d08990,_imjstart2=0x7fad18d08d50,_unittip=0x7fad18d064c0,
 _unittilt=0x7fad18d066f0,_lgs_defocuses=0x7fad1a8370d8,_unitdefocus=
 0x10b8df030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1982b030,
 _flat=0x7fad19829e30,_domask=1,_submask=0x7fad19814430,_kernel=0x7fad192ec230,
 _kernels=0x10918c030,_kerfftr=0x108d5f030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad192e4630,_x=0x7fad1981e230,_y=0x7fad19822e30,
 _centroidgain=1,_rayleigh=0x7fad1903fd70,_bckgrdcalib=0x7fad1982d630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8373b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fa98,_ctrlden=0x7fad1a837df8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18f09d10,_xlast=0x7fad18f09e90,_ylast=[0x7fad1a80b030,
 0x7fad1a80b030,0x7fad1a80b030],_y0=0x7fad1a809630,_signus=0x7fad18f0a010,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5d9d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1a837ce0,yposition=
 0x7fad1a837260,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.35,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.944       84.1
Field Avg  2.20                     70.7   0.944       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849dc0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e2ba40,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e2c300,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1092d8030,_masks=0x0,_fluxpersub=0x7fad18c4b590,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c4b950,_skyfluxpersub=0x7fad18c5f740,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[-9.36077e-05,0.00159745],
 _lastvalidtt=[-9.36077e-05,0.00159745],_upttcommand=[0,0],_refmes=
 0x7fad19151e30,_tiprefv=0x7fad192e9e30,_tiltrefv=0x7fad1a091630,_tiprefvn=
 0x7fad1914be30,_tiltrefvn=0x7fad1a12d430,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e17b30,_jstart=0x7fad18e229d0,
 _binindices=0x7fad1a13fc30,_binxy=2,_centroidw=0x7fad19040080,_fimage=
 0x7fad1a13c830,_fimage2=0x0,_imistart=0x7fad18e2ce40,_imjstart=0x7fad18e2d200,
 _imistart2=0x7fad18e2d5c0,_imjstart2=0x7fad18e2d980,_unittip=0x7fad18e2c0d0,
 _unittilt=0x7fad18e18170,_lgs_defocuses=0x7fad1a838618,_unitdefocus=
 0x109dc4030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1914f830,
 _flat=0x7fad1a830630,_domask=1,_submask=0x7fad19225a30,_kernel=0x7fad1a0ed230,
 _kernels=0x1093d9030,_kerfftr=0x109122030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a139430,_x=0x7fad1a12e030,_y=0x7fad1a0eae30,
 _centroidgain=1,_rayleigh=0x7fad1a837ce0,_bckgrdcalib=0x7fad1a82f430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fc58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903f9f0,_ctrlden=0x7fad1a837378,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e223a0,_xlast=0x7fad18e22520,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a092230,_signus=0x7fad18e2b230,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c54910,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1a8378b8,yposition=
 0x7fad1a838768,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       73.2   0.768       96.1
Field Avg  2.20                     73.2   0.768       96.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849650)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e23190,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c60dd0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109a34030,_masks=0x0,_fluxpersub=0x7fad18c62400,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c627c0,_skyfluxpersub=0x7fad18c4b590,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[0.00816979,0.00567731],
 _lastvalidtt=[0.00816979,0.00567731],_upttcommand=[0,0],_refmes=0x7fad1a142a30,
 _tiprefv=0x7fad1914ca30,_tiltrefv=0x7fad19155030,_tiprefvn=0x7fad192e9e30,
 _tiltrefvn=0x7fad192e9030,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7fad18c5ff60,_jstart=0x7fad18c60320,_binindices=
 0x7fad192ec230,_binxy=2,_centroidw=0x7fad1a837c00,_fimage=0x7fad1981fa30,
 _fimage2=0x0,_imistart=0x7fad18c63980,_imjstart=0x7fad18c618c0,_imistart2=
 0x7fad18c61c80,_imjstart2=0x7fad18c62040,_unittip=0x7fad18c0e700,_unittilt=
 0x7fad18c0bdc0,_lgs_defocuses=0x7fad1a8370d8,_unitdefocus=0x109643030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19264030,_flat=
 0x7fad1914d630,_domask=1,_submask=0x7fad1914aa30,_kernel=0x7fad19149a30,
 _kernels=0x10918c030,_kerfftr=0x108d5f030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19262e30,_x=0x7fad192e8430,_y=0x7fad19151e30,
 _centroidgain=1,_rayleigh=0x7fad1a8378b8,_bckgrdcalib=0x7fad19265230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838378)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fcc8,_ctrlden=0x7fad1a837768,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5d9d0,_xlast=0x7fad18c5ed80,_ylast=[0x7fad19063030,
 0x7fad19063030,0x7fad19063030],_y0=0x7fad1916d230,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0eaa0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1a8373b0,yposition=
 0x7fad1903fb08,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.45,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a8496d8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c61c90,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c4b590,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10a7dc030,_masks=0x0,_fluxpersub=0x7fad18e229d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e22d90,_skyfluxpersub=0x7fad18e23150,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-0.00245901,0.000106376],
 _lastvalidtt=[-0.00245901,0.000106376],_upttcommand=[0,0],_refmes=
 0x7fad192e8430,_tiprefv=0x7fad1a0eae30,_tiltrefv=0x7fad1a0fc830,_tiprefvn=
 0x7fad1a139430,_tiltrefvn=0x7fad1a13a030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c5dc90,_jstart=0x7fad18c5ff60,
 _binindices=0x7fad192e9430,_binxy=2,_centroidw=0x7fad1a838538,_fimage=
 0x7fad192e9c30,_fimage2=0x0,_imistart=0x7fad18c60320,_imjstart=0x7fad18c606e0,
 _imistart2=0x7fad18c60aa0,_imjstart2=0x7fad18c60e60,_unittip=0x7fad18c0bdc0,
 _unittilt=0x7fad18c496e0,_lgs_defocuses=0x7fad1903fd70,_unitdefocus=
 0x10bce0030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a10fa30,
 _flat=0x7fad1a141430,_domask=1,_submask=0x7fad1a143430,_kernel=0x7fad1a0ed230,
 _kernels=0x1093d9030,_kerfftr=0x109122030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad192eae30,_x=0x7fad1917d230,_y=0x7fad19155030,
 _centroidgain=1,_rayleigh=0x7fad1a8373b0,_bckgrdcalib=0x7fad1a110c30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fa98)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838768,_ctrlden=0x7fad1903fb78,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18d145a0,_xlast=0x7fad18d14720,_ylast=[0x7fad1980ae30,
 0x7fad1980ae30,0x7fad1980ae30],_y0=0x7fad19810430,_signus=0x7fad18d04fb0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5d9d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1903fc58,yposition=
 0x7fad1a838298,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849320)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e23190,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c5f030,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10b8df030,_masks=0x0,_fluxpersub=0x7fad18f09d10,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0a0d0,_skyfluxpersub=0x7fad18f0a490,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-0.00169415,-0.000339834],
 _lastvalidtt=[-0.00169415,-0.000339834],_upttcommand=[0,0],_refmes=
 0x7fad1a13da30,_tiprefv=0x7fad1a13b430,_tiltrefv=0x7fad1a128230,_tiprefvn=
 0x7fad1a0eae30,_tiltrefvn=0x7fad1a0fc830,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c5f740,_jstart=0x7fad18c4b590,
 _binindices=0x7fad1914c630,_binxy=2,_centroidw=0x7fad1a837260,_fimage=
 0x7fad1a0e9c30,_fimage2=0x0,_imistart=0x7fad18c60320,_imjstart=0x7fad18c606e0,
 _imistart2=0x7fad18c60aa0,_imjstart2=0x7fad18c60e60,_unittip=0x7fad18c0bdc0,
 _unittilt=0x7fad18c0eaa0,_lgs_defocuses=0x7fad1903fda8,_unitdefocus=
 0x10c3e4030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a82c830,
 _flat=0x7fad1a141430,_domask=1,_submask=0x7fad1a858030,_kernel=0x7fad1a13ca30,
 _kernels=0x10918c030,_kerfftr=0x108d5f030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a101430,_x=0x7fad19173630,_y=0x7fad1917d230,
 _centroidgain=1,_rayleigh=0x7fad1903fc58,_bckgrdcalib=0x7fad1a139430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903f9f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fd70,_ctrlden=0x7fad1a8378b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e17d60,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a109e30,_signus=0x7fad18e223a0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e17b30,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1a838378,yposition=
 0x7fad1a837df8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.25,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a8495c8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c61f90,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e23460,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109dc4030,_masks=0x0,_fluxpersub=0x7fad18c62350,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c5f030,_skyfluxpersub=0x7fad18c61bd0,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-8.12388e-05,0.000541087],
 _lastvalidtt=[-8.12388e-05,0.000541087],_upttcommand=[0,0],_refmes=
 0x7fad19232430,_tiprefv=0x7fad19230030,_tiltrefv=0x7fad1922ac30,_tiprefvn=
 0x7fad19149a30,_tiltrefvn=0x7fad1923ee30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e23fb0,_jstart=0x7fad18e24370,
 _binindices=0x7fad19814430,_binxy=2,_centroidw=0x7fad1a837490,_fimage=
 0x7fad1922ec30,_fimage2=0x0,_imistart=0x7fad18d14820,_imjstart=0x7fad18d14be0,
 _imistart2=0x7fad18d14fa0,_imjstart2=0x7fad18d15360,_unittip=0x7fad18e18170,
 _unittilt=0x7fad18e17cb0,_lgs_defocuses=0x7fad1a837ab0,_unitdefocus=
 0x109bc2030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19225a30,
 _flat=0x7fad19230c30,_domask=1,_submask=0x7fad1914c630,_kernel=0x7fad19152e30,
 _kernels=0x1093d9030,_kerfftr=0x109122030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19229230,_x=0x7fad1a0e1230,_y=0x7fad1a0e8230,
 _centroidgain=1,_rayleigh=0x7fad1a838378,_bckgrdcalib=0x7fad1922b830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fcc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fc90,_ctrlden=0x7fad1903ffd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18f09d10,_xlast=0x7fad18f09e90,_ylast=[0x7fad1a858030,
 0x7fad1a858030,0x7fad1a858030],_y0=0x7fad1a809630,_signus=0x7fad18f0a010,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c54910,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1903fa98,yposition=
 0x7fad1a837378,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.947       78.1
Field Avg  2.20                     70.7   0.947       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849b18)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c4b950,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18f08e70,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109643030,_masks=0x0,_fluxpersub=0x7fad18e23f80,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e24340,_skyfluxpersub=0x7fad18e24700,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[9.43849e-05,-0.000138274],
 _lastvalidtt=[9.43849e-05,-0.000138274],_upttcommand=[0,0],_refmes=
 0x7fad19152e30,_tiprefv=0x7fad1914f830,_tiltrefv=0x7fad1916ee30,_tiprefvn=
 0x7fad19230030,_tiltrefvn=0x7fad1922ac30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18f09230,_jstart=0x7fad18f0bbf0,
 _binindices=0x7fad19814430,_binxy=2,_centroidw=0x7fad1a8380d8,_fimage=
 0x7fad1922b830,_fimage2=0x0,_imistart=0x7fad18d06ae0,_imjstart=0x7fad18d06ea0,
 _imistart2=0x7fad18d07260,_imjstart2=0x7fad18d07620,_unittip=0x7fad18e229d0,
 _unittilt=0x7fad18e21ac0,_lgs_defocuses=0x7fad1903fc58,_unitdefocus=
 0x10abde030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a0eae30,
 _flat=0x7fad1a0e9c30,_domask=1,_submask=0x7fad1a0ed230,_kernel=0x7fad1a0fc830,
 _kernels=0x10918c030,_kerfftr=0x108d5f030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19225a30,_x=0x7fad1a82f430,_y=0x7fad1a82fc30,
 _centroidgain=1,_rayleigh=0x7fad1903fa98,_bckgrdcalib=0x7fad1a139430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838768)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fec0,_ctrlden=0x7fad1903fda8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e1d510,_ylast=[0x7fad1a102230,
 0x7fad1a102230,0x7fad1a102230],_y0=0x7fad1a108030,_signus=0x7fad18e17b30,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5d9d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1903f9f0,yposition=
 0x7fad1a837768,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.33,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.946       84.1
Field Avg  2.20                     70.7   0.946       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848f68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18d04fb0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c4b950,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10bce0030,_masks=0x0,_fluxpersub=0x7fad18e229d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e1f050,_skyfluxpersub=0x7fad18e24190,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[0.000454366,0.000505722],
 _lastvalidtt=[0.000454366,0.000505722],_upttcommand=[0,0],_refmes=
 0x7fad19236630,_tiprefv=0x7fad1a82da30,_tiltrefv=0x7fad1922fe30,_tiprefvn=
 0x7fad1a845030,_tiltrefvn=0x7fad1916ee30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c4b590,_jstart=0x7fad18c5f740,
 _binindices=0x7fad19152e30,_binxy=2,_centroidw=0x7fad19040080,_fimage=
 0x7fad1914f830,_fimage2=0x0,_imistart=0x7fad18c5a940,_imjstart=0x7fad18c58a80,
 _imistart2=0x7fad18c58e40,_imjstart2=0x7fad18c59200,_unittip=0x7fad18c61420,
 _unittilt=0x7fad18c0bdc0,_lgs_defocuses=0x7fad1a838538,_unitdefocus=
 0x10ad8e030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a0e9c30,
 _flat=0x7fad1a12d230,_domask=1,_submask=0x7fad1a0e8230,_kernel=0x7fad1a0ed230,
 _kernels=0x1093d9030,_kerfftr=0x109122030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19149a30,_x=0x7fad19155030,_y=0x7fad19235430,
 _centroidgain=1,_rayleigh=0x7fad1903f9f0,_bckgrdcalib=0x7fad1a0eae30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fd70)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837148,_ctrlden=0x7fad1a837c38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5ed80,_xlast=0x7fad18c0e060,_ylast=[0x7fad1916d230,
 0x7fad1916d230,0x7fad1916d230],_y0=0x7fad19063030,_signus=0x7fad18c0e700,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1903fcc8,yposition=
 0x7fad1903fb78,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.35,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.936       84.1
Field Avg  2.20                     70.7   0.936       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849d38)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e23780,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c58e90,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c3e4030,_masks=0x0,_fluxpersub=0x7fad18c5ba90,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c5be50,_skyfluxpersub=0x7fad18c5c210,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-0.00163433,-0.00235612],
 _lastvalidtt=[-0.00163433,-0.00235612],_upttcommand=[0,0],_refmes=
 0x7fad1a0e8230,_tiprefv=0x7fad1a169630,_tiltrefv=0x7fad1a168a30,_tiprefvn=
 0x7fad1a102230,_tiltrefvn=0x7fad1a16a230,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c59250,_jstart=0x7fad18c59be0,
 _binindices=0x7fad19225a30,_binxy=2,_centroidw=0x7fad1a838180,_fimage=
 0x7fad1a13a030,_fimage2=0x0,_imistart=0x7fad18c5ab90,_imjstart=0x7fad18c5af50,
 _imistart2=0x7fad18c5b310,_imjstart2=0x7fad18c5b6d0,_unittip=0x7fad18c0bdc0,
 _unittilt=0x7fad18c0eaa0,_lgs_defocuses=0x7fad1a838378,_unitdefocus=
 0x1098b2030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1922d430,
 _flat=0x7fad19229c30,_domask=1,_submask=0x7fad1922cc30,_kernel=0x7fad1914de30,
 _kernels=0x10918c030,_kerfftr=0x108d5f030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a0eae30,_x=0x7fad1916ee30,_y=0x7fad1914ac30,
 _centroidgain=1,_rayleigh=0x7fad1903fcc8,_bckgrdcalib=0x7fad1922e630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fc90)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837df8,_ctrlden=0x7fad1903f868,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5d9d0,_xlast=0x7fad18c5ed80,_ylast=[0x7fad19063030,
 0x7fad19063030,0x7fad19063030],_y0=0x7fad19150a30,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0e060,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1a838768,yposition=
 0x7fad1a8378b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       72.0   0.783       90.1
Field Avg  2.20                     72.0   0.783       90.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848818)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5f030,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c58e00,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109bc2030,_masks=0x0,_fluxpersub=0x7fad18d13ba0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d13f60,_skyfluxpersub=0x7fad18d14320,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-1.41741e-05,0.00242522],
 _lastvalidtt=[-1.41741e-05,0.00242522],_upttcommand=[0,0],_refmes=
 0x7fad1917d230,_tiprefv=0x7fad19155030,_tiltrefv=0x7fad1916ee30,_tiprefvn=
 0x7fad1914de30,_tiltrefvn=0x7fad19227430,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c59980,_jstart=0x7fad18c5a7a0,
 _binindices=0x7fad1914d630,_binxy=2,_centroidw=0x7fad1a8380d8,_fimage=
 0x7fad19149a30,_fimage2=0x0,_imistart=0x7fad18c5bb00,_imjstart=0x7fad18c5bec0,
 _imistart2=0x7fad18c582c0,_imjstart2=0x7fad18c58680,_unittip=0x7fad18c0eaa0,
 _unittilt=0x7fad18c5cd50,_lgs_defocuses=0x7fad1903fc58,_unitdefocus=
 0x10b0db030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1986c230,
 _flat=0x7fad1986b030,_domask=1,_submask=0x7fad19814430,_kernel=0x7fad19152e30,
 _kernels=0x1093d9030,_kerfftr=0x109122030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19237430,_x=0x7fad19151e30,_y=0x7fad19225a30,
 _centroidgain=1,_rayleigh=0x7fad1a838768,_bckgrdcalib=0x7fad1986d430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fec0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838378,_ctrlden=0x7fad19040080,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e23910,_xlast=0x7fad18e223a0,_ylast=[0x7fad1a106e30,
 0x7fad1a106e30,0x7fad1a106e30],_y0=0x7fad1a13d230,_signus=0x7fad18e22d90,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5ed80,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1903fd70,yposition=
 0x7fad1903ffd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.45,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.943       84.1
Field Avg  2.20                     70.7   0.943       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848cc0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5f030,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18f0bbf0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10abde030,_masks=0x0,_fluxpersub=0x7fad18d04fb0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d13ba0,_skyfluxpersub=0x7fad18d13f60,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00756406,0.000328556],
 _lastvalidtt=[0.00756406,0.000328556],_upttcommand=[0,0],_refmes=
 0x7fad1a141430,_tiprefv=0x7fad1a0fda30,_tiltrefv=0x7fad1a142e30,_tiprefvn=
 0x7fad1a13fc30,_tiltrefvn=0x7fad1a091630,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18f0bfb0,_jstart=0x7fad18f0c370,
 _binindices=0x7fad1a85b030,_binxy=2,_centroidw=0x7fad1a8376f8,_fimage=
 0x7fad19151e30,_fimage2=0x0,_imistart=0x7fad18f0ceb0,_imjstart=0x7fad18f0d5c0,
 _imistart2=0x7fad18f0d980,_imjstart2=0x7fad18f0dd40,_unittip=0x7fad18f09180,
 _unittilt=0x7fad18f093b0,_lgs_defocuses=0x7fad1a8370d8,_unitdefocus=
 0x109ec5030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1981fc30,
 _flat=0x7fad1981ea30,_domask=1,_submask=0x7fad19814430,_kernel=0x7fad1a0ed230,
 _kernels=0x10918c030,_kerfftr=0x108d5f030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1914f830,_x=0x7fad1a845030,_y=0x7fad1a859030,
 _centroidgain=1,_rayleigh=0x7fad1903fd70,_bckgrdcalib=0x7fad19820e30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837148)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838458,_ctrlden=0x7fad1a8380d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0e700,_xlast=0x7fad18c54910,_ylast=[0x7fad1916d230,
 0x7fad1916d230,0x7fad1916d230],_y0=0x7fad19063030,_signus=0x7fad18c61420,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5d9d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1903fc90,yposition=
 0x7fad1903fda8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.944       84.1
Field Avg  2.20                     70.7   0.944       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848ee0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5f740,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d07280,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ad8e030,_masks=0x0,_fluxpersub=0x7fad18e23690,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e229d0,_skyfluxpersub=0x7fad18e22d90,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00585317,0.000259613],
 _lastvalidtt=[0.00585317,0.000259613],_upttcommand=[0,0],_refmes=
 0x7fad1923ee30,_tiprefv=0x7fad19151e30,_tiltrefv=0x7fad1923b230,_tiprefvn=
 0x7fad19225a30,_tiltrefvn=0x7fad19227830,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18d05c60,_jstart=0x7fad18d06020,
 _binindices=0x7fad19832430,_binxy=2,_centroidw=0x7fad1a838180,_fimage=
 0x7fad1923d830,_fimage2=0x0,_imistart=0x7fad18d07a00,_imjstart=0x7fad18d07dc0,
 _imistart2=0x7fad18d08180,_imjstart2=0x7fad18d08540,_unittip=0x7fad18d07050,
 _unittilt=0x7fad18d05a30,_lgs_defocuses=0x7fad1a837d50,_unitdefocus=
 0x1092d8030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a139430,
 _flat=0x7fad1a0eae30,_domask=1,_submask=0x7fad1a0e1230,_kernel=0x7fad1a0ed230,
 _kernels=0x1093d9030,_kerfftr=0x109122030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1923c630,_x=0x7fad1981d030,_y=0x7fad1982fa30,
 _centroidgain=1,_rayleigh=0x7fad1903fc90,_bckgrdcalib=0x7fad1a13a630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837df8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837490,_ctrlden=0x7fad1a8376f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e18170,_xlast=0x7fad18e23510,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a109e30,_signus=0x7fad18e223a0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1f050,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1903fec0,yposition=
 0x7fad1a837c38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.25,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.942       84.1
Field Avg  2.20                     70.7   0.942       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849980)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5f030,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e17b30,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1098b2030,_masks=0x0,_fluxpersub=0x7fad18f09d10,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0a4a0,_skyfluxpersub=0x7fad18f08e70,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00528631,0.000301006],
 _lastvalidtt=[0.00528631,0.000301006],_upttcommand=[0,0],_refmes=
 0x7fad1a102c30,_tiprefv=0x7fad19152a30,_tiltrefv=0x7fad1a0da030,_tiprefvn=
 0x7fad19151e30,_tiltrefvn=0x7fad1a141430,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e23500,_jstart=0x7fad18e238c0,
 _binindices=0x7fad19814430,_binxy=2,_centroidw=0x7fad1903fb78,_fimage=
 0x7fad1922f630,_fimage2=0x0,_imistart=0x7fad18d07d10,_imjstart=0x7fad18d080d0,
 _imistart2=0x7fad18d08490,_imjstart2=0x7fad18d08850,_unittip=0x7fad18e18170,
 _unittilt=0x7fad18e1f1d0,_lgs_defocuses=0x7fad1a8386c0,_unitdefocus=
 0x109a34030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a82da30,
 _flat=0x7fad1a82c830,_domask=1,_submask=0x7fad1a845030,_kernel=0x7fad1a0ed230,
 _kernels=0x10918c030,_kerfftr=0x108d5f030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1914f830,_x=0x7fad1a0e1230,_y=0x7fad1a100830,
 _centroidgain=1,_rayleigh=0x7fad1903fec0,_bckgrdcalib=0x7fad1a82f430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838378)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fd70,_ctrlden=0x7fad1903fc90,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e23380,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a103430,_signus=0x7fad18e21ac0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1d510,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1a837148,yposition=
 0x7fad1903f868,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.938       84.1
Field Avg  2.20                     70.7   0.938       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849cb0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e26bf0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e271e0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10b0db030,_masks=0x0,_fluxpersub=0x7fad18e258b0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e25c70,_skyfluxpersub=0x7fad18e26030,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00489209,0.000732181],
 _lastvalidtt=[0.00489209,0.000732181],_upttcommand=[0,0],_refmes=
 0x7fad19155030,_tiprefv=0x7fad19232c30,_tiltrefv=0x7fad19234230,_tiprefvn=
 0x7fad19152a30,_tiltrefvn=0x7fad19151e30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e1f050,_jstart=0x7fad18e17b30,
 _binindices=0x7fad1a102c30,_binxy=2,_centroidw=0x7fad1a838768,_fimage=
 0x7fad1a147c30,_fimage2=0x0,_imistart=0x7fad18e27960,_imjstart=0x7fad18e24d70,
 _imistart2=0x7fad18e25130,_imjstart2=0x7fad18e254f0,_unittip=0x7fad18e21ac0,
 _unittilt=0x7fad18e23bf0,_lgs_defocuses=0x7fad19035830,_unitdefocus=
 0x10a7dc030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a149e30,
 _flat=0x7fad1a141430,_domask=1,_submask=0x7fad1a100830,_kernel=0x7fad1a13b030,
 _kernels=0x1093d9030,_kerfftr=0x109122030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a14c230,_x=0x7fad1a107830,_y=0x7fad1a13d230,
 _centroidgain=1,_rayleigh=0x7fad1a837148,_bckgrdcalib=0x7fad1a14b030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838458)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fc58,_ctrlden=0x7fad1a838298,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e23200,_xlast=0x7fad18e1bf00,_ylast=[0x7fad1a103430,
 0x7fad1a103430,0x7fad1a103430],_y0=0x7fad1a13e030,_signus=0x7fad18e24ab0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e266a0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1a837df8,yposition=
 0x7fad19040080,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.33,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.934       84.1
Field Avg  2.20                     70.7   0.934       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849210)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e229d0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c59b60,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109ec5030,_masks=0x0,_fluxpersub=0x7fad18c5c680,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c5ca40,_skyfluxpersub=0x7fad18c582c0,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00473484,0.00138825],
 _lastvalidtt=[0.00473484,0.00138825],_upttcommand=[0,0],_refmes=0x7fad19233830,
 _tiprefv=0x7fad1916ee30,_tiltrefv=0x7fad1914f830,_tiprefvn=0x7fad19232c30,
 _tiltrefvn=0x7fad19234230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7fad18c5a650,_jstart=0x7fad18c5aa10,_binindices=
 0x7fad19155030,_binxy=2,_centroidw=0x7fad1903f9b8,_fimage=0x7fad1a0fec30,
 _fimage2=0x0,_imistart=0x7fad18c5b550,_imjstart=0x7fad18c5b910,_imistart2=
 0x7fad18c5bcd0,_imjstart2=0x7fad18c5c090,_unittip=0x7fad18c0eaa0,_unittilt=
 0x7fad18c59930,_lgs_defocuses=0x7fad1903fb08,_unitdefocus=0x10b8df030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19246230,_flat=
 0x7fad19245030,_domask=1,_submask=0x7fad1914b230,_kernel=0x7fad1a0ed230,
 _kernels=0x10918c030,_kerfftr=0x108d5f030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a13d230,_x=0x7fad19152c30,_y=0x7fad19150430,
 _centroidgain=1,_rayleigh=0x7fad1a837df8,_bckgrdcalib=0x7fad19249030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837490)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837ab0,_ctrlden=0x7fad1a838768,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c54910,_xlast=0x7fad18c0bdc0,_ylast=[0x7fad1916d230,
 0x7fad1916d230,0x7fad1916d230],_y0=0x7fad19155830,_signus=0x7fad18c0e700,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5ce00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1a838378,yposition=
 0x7fad1a8380d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.35,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.903       84.1
Field Avg  2.20                     70.7   0.903       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849870)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c58a50,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d05c60,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1092d8030,_masks=0x0,_fluxpersub=0x7fad18d07e20,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d081e0,_skyfluxpersub=0x7fad18d085a0,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00484855,-6.89817e-05],
 _lastvalidtt=[0.00484855,-6.89817e-05],_upttcommand=[0,0],_refmes=
 0x7fad1a142e30,_tiprefv=0x7fad1a0da030,_tiltrefv=0x7fad1a13fc30,_tiprefvn=
 0x7fad1a091630,_tiltrefvn=0x7fad1a139430,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18d06020,_jstart=0x7fad18d063e0,
 _binindices=0x7fad19820a30,_binxy=2,_centroidw=0x7fad1a838180,_fimage=
 0x7fad19151e30,_fimage2=0x0,_imistart=0x7fad18d06f20,_imjstart=0x7fad18d072e0,
 _imistart2=0x7fad18d076a0,_imjstart2=0x7fad18d07a60,_unittip=0x7fad18d04fb0,
 _unittilt=0x7fad18d05a30,_lgs_defocuses=0x7fad1903fd38,_unitdefocus=
 0x109dc4030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19828e30,
 _flat=0x7fad19825630,_domask=1,_submask=0x7fad19828630,_kernel=0x7fad19822c30,
 _kernels=0x1093d9030,_kerfftr=0x109122030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1914f830,_x=0x7fad1981e230,_y=0x7fad1981ea30,
 _centroidgain=1,_rayleigh=0x7fad1a838378,_bckgrdcalib=0x7fad1982a030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fd70)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8378b8,_ctrlden=0x7fad1903f9b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0e060,_xlast=0x7fad18c54910,_ylast=[0x7fad19155830,
 0x7fad19155830,0x7fad19155830],_y0=0x7fad19063030,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5ed80,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1a838458,yposition=
 0x7fad1a8376f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       71.6   0.765       96.1
Field Avg  2.20                     71.6   0.765       96.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848d48)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e233c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c58a40,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109a34030,_masks=0x0,_fluxpersub=0x7fad18c58e00,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c591c0,_skyfluxpersub=0x7fad18c5b6b0,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[-0.00102699,-0.00400179],
 _lastvalidtt=[-0.00102699,-0.00400179],_upttcommand=[0,0],_refmes=
 0x7fad1a105830,_tiprefv=0x7fad1a106830,_tiltrefv=0x7fad1a174230,_tiprefvn=
 0x7fad1a0da030,_tiltrefvn=0x7fad1a13fc30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c5a3f0,_jstart=0x7fad18c5a7b0,
 _binindices=0x7fad19232c30,_binxy=2,_centroidw=0x7fad1a838260,_fimage=
 0x7fad1a104030,_fimage2=0x0,_imistart=0x7fad18c5b2f0,_imjstart=0x7fad18c5dc90,
 _imistart2=0x7fad18c582c0,_imjstart2=0x7fad18c58680,_unittip=0x7fad18c0bdc0,
 _unittilt=0x7fad18c0eaa0,_lgs_defocuses=0x7fad1a837768,_unitdefocus=
 0x109643030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19237630,
 _flat=0x7fad1914aa30,_domask=1,_submask=0x7fad1914de30,_kernel=0x7fad19152e30,
 _kernels=0x10918c030,_kerfftr=0x108d5f030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a139430,_x=0x7fad1914ce30,_y=0x7fad1914d630,
 _centroidgain=1,_rayleigh=0x7fad1a838458,_bckgrdcalib=0x7fad19238830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fc58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903ffd8,_ctrlden=0x7fad1a838180,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5e050,_xlast=0x7fad18c0e060,_ylast=[0x7fad19063030,
 0x7fad19063030,0x7fad19063030],_y0=0x7fad1916d230,_signus=0x7fad18c61420,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d04b20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1a837490,yposition=
 0x7fad1903fc90,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.45,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.937       84.1
Field Avg  2.20                     70.7   0.937       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849e48)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c4b590,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c4e320,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10a7dc030,_masks=0x0,_fluxpersub=0x7fad18c57610,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c579d0,_skyfluxpersub=0x7fad18c5f740,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00433335,-0.00200633],
 _lastvalidtt=[0.00433335,-0.00200633],_upttcommand=[0,0],_refmes=
 0x7fad1a091630,_tiprefv=0x7fad1a0fda30,_tiltrefv=0x7fad1a107430,_tiprefvn=
 0x7fad1a106830,_tiltrefvn=0x7fad1a174230,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c5dc90,_jstart=0x7fad18c55bd0,
 _binindices=0x7fad1914d630,_binxy=2,_centroidw=0x7fad1a837148,_fimage=
 0x7fad19151e30,_fimage2=0x0,_imistart=0x7fad18c56710,_imjstart=0x7fad18c56ad0,
 _imistart2=0x7fad18c56e90,_imjstart2=0x7fad18c57250,_unittip=0x7fad18c0bdc0,
 _unittilt=0x7fad18c0eaa0,_lgs_defocuses=0x7fad1903fcc8,_unitdefocus=
 0x10bce0030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19231430,
 _flat=0x7fad19225a30,_domask=1,_submask=0x7fad19234a30,_kernel=0x7fad19230c30,
 _kernels=0x1093d9030,_kerfftr=0x109122030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1922fa30,_x=0x7fad1914f830,_y=0x7fad1916ee30,
 _centroidgain=1,_rayleigh=0x7fad1a837490,_bckgrdcalib=0x7fad19232630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837ab0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8386f8,_ctrlden=0x7fad1a838260,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e18170,_xlast=0x7fad18e17cb0,_ylast=[0x7fad1a0ebe30,
 0x7fad1a0ebe30,0x7fad1a0ebe30],_y0=0x7fad1a108030,_signus=0x7fad18e1f050,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5e050,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1903fd70,yposition=
 0x7fad1a838298,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.941       84.1
Field Avg  2.20                     70.7   0.941       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a8497e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e232e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e229d0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10b8df030,_masks=0x0,_fluxpersub=0x7fad18c4b590,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c55bd0,_skyfluxpersub=0x7fad18c5dc90,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.0042951,-0.00151442],
 _lastvalidtt=[0.0042951,-0.00151442],_upttcommand=[0,0],_refmes=0x7fad1914ce30,
 _tiprefv=0x7fad19229c30,_tiltrefv=0x7fad19279c30,_tiprefvn=0x7fad1922a830,
 _tiltrefvn=0x7fad1922d230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7fad18e1f050,_jstart=0x7fad18e1de10,_binindices=
 0x7fad1a0ed230,_binxy=2,_centroidw=0x7fad1a837df8,_fimage=0x7fad1a0ea430,
 _fimage2=0x0,_imistart=0x7fad18e23900,_imjstart=0x7fad18e23cc0,_imistart2=
 0x7fad18e24080,_imjstart2=0x7fad18e24440,_unittip=0x7fad18f09d10,_unittilt=
 0x7fad18f09f40,_lgs_defocuses=0x7fad1a8381f0,_unitdefocus=0x10c3e4030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1914f830,_flat=
 0x7fad1914d630,_domask=1,_submask=0x7fad1927ba30,_kernel=0x7fad19235230,
 _kernels=0x10918c030,_kerfftr=0x108d5f030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a12d230,_x=0x7fad1a0e1230,_y=0x7fad1a091630,
 _centroidgain=1,_rayleigh=0x7fad1903fd70,_bckgrdcalib=0x7fad1922b430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8378b8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fec0,_ctrlden=0x7fad1a837148,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e17b30,_xlast=0x7fad18e1d510,_ylast=[0x7fad1a108030,
 0x7fad1a108030,0x7fad1a108030],_y0=0x7fad1a0fb430,_signus=0x7fad18e21ac0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5d9d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1903fc58,yposition=
 0x7fad1a838768,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.25,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.940       84.1
Field Avg  2.20                     70.7   0.940       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849760)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c4b950,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d05c60,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109dc4030,_masks=0x0,_fluxpersub=0x7fad18d067a0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d06b60,_skyfluxpersub=0x7fad18d06f20,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00456609,-0.00178884],
 _lastvalidtt=[0.00456609,-0.00178884],_upttcommand=[0,0],_refmes=
 0x7fad1a107630,_tiprefv=0x7fad1a091630,_tiltrefv=0x7fad1a0ea430,_tiprefvn=
 0x7fad1a170c30,_tiltrefvn=0x7fad1a172a30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18d06020,_jstart=0x7fad18d063e0,
 _binindices=0x7fad19814430,_binxy=2,_centroidw=0x7fad1a838378,_fimage=
 0x7fad19226c30,_fimage2=0x0,_imistart=0x7fad18e25940,_imjstart=0x7fad18e23aa0,
 _imistart2=0x7fad18e23e60,_imjstart2=0x7fad18e24220,_unittip=0x7fad18d04fb0,
 _unittilt=0x7fad18d05a30,_lgs_defocuses=0x7fad1a838148,_unitdefocus=
 0x109bc2030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19825630,
 _flat=0x7fad1914f830,_domask=1,_submask=0x7fad19820a30,_kernel=0x7fad19234830,
 _kernels=0x1093d9030,_kerfftr=0x109122030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19268830,_x=0x7fad1981e230,_y=0x7fad1981ea30,
 _centroidgain=1,_rayleigh=0x7fad1903fc58,_bckgrdcalib=0x7fad19225a30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903ffd8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8370a0,_ctrlden=0x7fad1903f868,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1e400,_xlast=0x7fad18e22520,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a092230,_signus=0x7fad18e17b30,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1d510,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1a837ab0,yposition=
 0x7fad1903f9b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.936       84.1
Field Avg  2.20                     70.7   0.936       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849078)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5c800,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c4b950,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109643030,_masks=0x0,_fluxpersub=0x7fad18c5be00,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c4b590,_skyfluxpersub=0x7fad18c5f030,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00487708,-0.00125483],
 _lastvalidtt=[0.00487708,-0.00125483],_upttcommand=[0,0],_refmes=
 0x7fad1a0fc830,_tiprefv=0x7fad1a100030,_tiltrefv=0x7fad1a0fd030,_tiprefvn=
 0x7fad1a091630,_tiltrefvn=0x7fad1a0ea430,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c5f740,_jstart=0x7fad18c5a780,
 _binindices=0x7fad19151e30,_binxy=2,_centroidw=0x7fad1a838458,_fimage=
 0x7fad1924e230,_fimage2=0x0,_imistart=0x7fad18c5af00,_imjstart=0x7fad18c5b2c0,
 _imistart2=0x7fad18c5b680,_imjstart2=0x7fad18c5ba40,_unittip=0x7fad18c0eaa0,
 _unittilt=0x7fad18c0e700,_lgs_defocuses=0x7fad1a837490,_unitdefocus=
 0x10abde030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19269e30,
 _flat=0x7fad19268c30,_domask=1,_submask=0x7fad19268430,_kernel=0x7fad1914b230,
 _kernels=0x10918c030,_kerfftr=0x108d5f030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19250630,_x=0x7fad1914a230,_y=0x7fad1914e030,
 _centroidgain=1,_rayleigh=0x7fad1a837ab0,_bckgrdcalib=0x7fad1926b030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8386f8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad19040080,_ctrlden=0x7fad1a838378,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0e060,_xlast=0x7fad18c5ed80,_ylast=[0x7fad19063030,
 0x7fad19063030,0x7fad19063030],_y0=0x7fad1916d230,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c54910,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1a8378b8,yposition=
 0x7fad1a838180,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.33,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.932       84.1
Field Avg  2.20                     70.7   0.932       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a849188)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e241a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d05c60,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10bce0030,_masks=0x0,_fluxpersub=0x7fad18c582c0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c58680,_skyfluxpersub=0x7fad18c58a40,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00560554,-0.00140808],
 _lastvalidtt=[0.00560554,-0.00140808],_upttcommand=[0,0],_refmes=
 0x7fad1a13a630,_tiprefv=0x7fad1a104030,_tiltrefv=0x7fad1a107430,_tiprefvn=
 0x7fad1a100030,_tiltrefvn=0x7fad1a0fd030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18d06020,_jstart=0x7fad18d063e0,
 _binindices=0x7fad1a845030,_binxy=2,_centroidw=0x7fad1903fd70,_fimage=
 0x7fad19236430,_fimage2=0x0,_imistart=0x7fad18f09360,_imjstart=0x7fad18f0bbf0,
 _imistart2=0x7fad18f0bfb0,_imjstart2=0x7fad18f0c370,_unittip=0x7fad18d04fb0,
 _unittilt=0x7fad18d05a30,_lgs_defocuses=0x7fad1a838298,_unitdefocus=
 0x10ad8e030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1914ce30,
 _flat=0x7fad1914f830,_domask=1,_submask=0x7fad19151e30,_kernel=0x7fad19149a30,
 _kernels=0x1093d9030,_kerfftr=0x109122030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19239830,_x=0x7fad1981e230,_y=0x7fad1981ea30,
 _centroidgain=1,_rayleigh=0x7fad1a8378b8,_bckgrdcalib=0x7fad19237630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fec0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837c00,_ctrlden=0x7fad1903fcc8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5d9d0,_xlast=0x7fad18c5c030,_ylast=[0x7fad1916d230,
 0x7fad1916d230,0x7fad1916d230],_y0=0x7fad19116a30,_signus=0x7fad18c0e700,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5ed80,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1903ffd8,yposition=
 0x7fad1a838260,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.35,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.907       84.1
Field Avg  2.20                     70.7   0.907       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a848928)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5dc90,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e1f050,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c3e4030,_masks=0x0,_fluxpersub=0x7fad18c4b590,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c58a60,_skyfluxpersub=0x7fad18c582c0,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00556121,-0.00123924],
 _lastvalidtt=[0.00556121,-0.00123924],_upttcommand=[0,0],_refmes=
 0x7fad1a0da030,_tiprefv=0x7fad1a091630,_tiltrefv=0x7fad19234430,_tiprefvn=
 0x7fad1a104030,_tiltrefvn=0x7fad19235030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e1de10,_jstart=0x7fad18e1e1d0,
 _binindices=0x7fad1a0ed230,_binxy=2,_centroidw=0x7fad1a8370d8,_fimage=
 0x7fad1926b830,_fimage2=0x0,_imistart=0x7fad18e248f0,_imjstart=0x7fad18e24cb0,
 _imistart2=0x7fad18e25070,_imjstart2=0x7fad18e25430,_unittip=0x7fad18e236c0,
 _unittilt=0x7fad18e238f0,_lgs_defocuses=0x7fad1a837260,_unitdefocus=
 0x1098b2030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1923b630,
 _flat=0x7fad1923a430,_domask=1,_submask=0x7fad1914a230,_kernel=0x7fad19233c30,
 _kernels=0x10918c030,_kerfftr=0x108d5f030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1926ca30,_x=0x7fad1a0e1230,_y=0x7fad1a12d230,
 _centroidgain=1,_rayleigh=0x7fad1903ffd8,_bckgrdcalib=0x7fad19236430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8370a0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8376f8,_ctrlden=0x7fad1903fd70,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e223a0,_xlast=0x7fad18e22520,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a092230,_signus=0x7fad18e229d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c54450,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1a8386f8,yposition=
 0x7fad1a837148,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       72.9   0.769       96.1
Field Avg  2.20                     72.9   0.769       96.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848240,layerfrac=0x7fad1a848350,
 layerspeed=0x7fad1a8482c8,layeralt=0x7fad1a848130,winddir=0x7fad1a8481b8,
 _layeralt=0x7fad1a8480a8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a838068,lgs_prof_alt=0x7fad1a837880,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c58680,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e25000,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109bc2030,_masks=0x0,_fluxpersub=0x7fad18f08e70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f09230,_skyfluxpersub=0x7fad18f09d10,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[-0.00859841,0.00178187],
 _lastvalidtt=[-0.00859841,0.00178187],_upttcommand=[0,0],_refmes=
 0x7fad1a0e1230,_tiprefv=0x7fad1a103430,_tiltrefv=0x7fad1914ce30,_tiprefvn=
 0x7fad1a091630,_tiltrefvn=0x7fad19234430,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e235c0,_jstart=0x7fad18e1f050,
 _binindices=0x7fad1a0eb030,_binxy=2,_centroidw=0x7fad1a8380d8,_fimage=
 0x7fad1a819e30,_fimage2=0x0,_imistart=0x7fad18e278a0,_imjstart=0x7fad18e25bb0,
 _imistart2=0x7fad18e23980,_imjstart2=0x7fad18e23d40,_unittip=0x7fad18e229d0,
 _unittilt=0x7fad18e18170,_lgs_defocuses=0x7fad1a837ab0,_unitdefocus=
 0x10b0db030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a82f430,
 _flat=0x7fad1a82d030,_domask=1,_submask=0x7fad1a804630,_kernel=0x7fad19151e30,
 _kernels=0x1093d9030,_kerfftr=0x109122030,_kerffti=0x109523030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a859030,_x=0x7fad1a0da030,_y=0x7fad1a142e30,
 _centroidgain=1,_rayleigh=0x7fad1a8386f8,_bckgrdcalib=0x7fad1a830630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad19040080)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837730,_ctrlden=0x7fad1a8370d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e223a0,_ylast=[0x7fad1a092230,
 0x7fad1a092230,0x7fad1a092230],_y0=0x7fad1a13ac30,_signus=0x7fad18e25790,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5d9d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a01a288,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a837d88,xposition=0x7fad1903fec0,yposition=
 0x7fad1903f868,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903fa28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.45,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.954       78.1
Field Avg  2.20                     70.7   0.954       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848d48)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e24e90,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18f08e70,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10abde030,_masks=0x0,_fluxpersub=0x7fad18d05cf0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d060b0,_skyfluxpersub=0x7fad18d06470,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[0.0010599,-0.00109612],
 _lastvalidtt=[0.0010599,-0.00109612],_upttcommand=[0,0],_refmes=0x7fad1a13a630,
 _tiprefv=0x7fad19228c30,_tiltrefv=0x7fad1a0da030,_tiprefvn=0x7fad19229830,
 _tiltrefvn=0x7fad1a13d230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7fad18f09230,_jstart=0x7fad18f0bbf0,_binindices=
 0x7fad1924b030,_binxy=2,_centroidw=0x7fad1903fec0,_fimage=0x7fad1a103e30,
 _fimage2=0x0,_imistart=0x7fad18c582c0,_imjstart=0x7fad18c58680,_imistart2=
 0x7fad18c58a40,_imjstart2=0x7fad18c59b70,_unittip=0x7fad18f0a510,_unittilt=
 0x7fad18f0a740,_lgs_defocuses=0x7fad1a837768,_unitdefocus=0x109ec5030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19820c30,_flat=
 0x7fad1981fa30,_domask=1,_submask=0x7fad1981d030,_kernel=0x7fad19814430,
 _kernels=0x10918c030,_kerfftr=0x109523030,_kerffti=0x109122030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a139430,_x=0x7fad1a82c830,_y=0x7fad1a819e30,
 _centroidgain=1,_rayleigh=0x7fad1a838180,_bckgrdcalib=0x7fad19821e30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8370a0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fc58,_ctrlden=0x7fad1903fd38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18f09d10,_xlast=0x7fad18f09e90,_ylast=[0x7fad1a809630,
 0x7fad1a809630,0x7fad1a809630],_y0=0x7fad1a845830,_signus=0x7fad18f0a250,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d04b20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1903fc20,yposition=
 0x7fad1a8384c8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.954       78.1
Field Avg  2.20                     70.7   0.954       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849540)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e1e1d0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d075d0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ad8e030,_masks=0x0,_fluxpersub=0x7fad18f09d10,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0a0d0,_skyfluxpersub=0x7fad18f0a490,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[-8.82183e-05,-0.00148152],
 _lastvalidtt=[-8.82183e-05,-0.00148152],_upttcommand=[0,0],_refmes=
 0x7fad1914b230,_tiprefv=0x7fad19149a30,_tiltrefv=0x7fad19249630,_tiprefvn=
 0x7fad19228c30,_tiltrefvn=0x7fad1928bc30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18d07990,_jstart=0x7fad18d07d50,
 _binindices=0x7fad1981f230,_binxy=2,_centroidw=0x7fad1903ffd8,_fimage=
 0x7fad1a0eaa30,_fimage2=0x0,_imistart=0x7fad18d08890,_imjstart=0x7fad18d08c50,
 _imistart2=0x7fad18d09010,_imjstart2=0x7fad18d093d0,_unittip=0x7fad18e25b90,
 _unittilt=0x7fad18e24700,_lgs_defocuses=0x7fad1a8380a0,_unitdefocus=
 0x1092d8030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a85a230,
 _flat=0x7fad19227430,_domask=1,_submask=0x7fad1a82f430,_kernel=0x7fad1a804630,
 _kernels=0x10918c030,_kerfftr=0x109443030,_kerffti=0x1093d9030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a106e30,_x=0x7fad19820230,_y=0x7fad19820a30,
 _centroidgain=1,_rayleigh=0x7fad1903fc20,_bckgrdcalib=0x7fad19247c30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838420)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838180,_ctrlden=0x7fad1a837730,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c59940,_xlast=0x7fad18c0e060,_ylast=[0x7fad1914ba30,
 0x7fad1914ba30,0x7fad1914ba30],_y0=0x7fad1914a630,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10efe1030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f0a850,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a837ab0,yposition=
 0x7fad1903fcc8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.25,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.954       78.1
Field Avg  2.20                     70.7   0.954       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848c38)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e1de10,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c4b950,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10b0db030,_masks=0x0,_fluxpersub=0x7fad18c4b590,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c582c0,_skyfluxpersub=0x7fad18c54140,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[0.000768883,-0.00118605],
 _lastvalidtt=[0.000768883,-0.00118605],_upttcommand=[0,0],_refmes=
 0x7fad1a0da030,_tiprefv=0x7fad1a105c30,_tiltrefv=0x7fad1a147c30,_tiprefvn=
 0x7fad1a14e630,_tiltrefvn=0x7fad1a12d830,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c5eb80,_jstart=0x7fad18c5f740,
 _binindices=0x7fad1a0ed230,_binxy=2,_centroidw=0x7fad1a819a00,_fimage=
 0x7fad1a149830,_fimage2=0x0,_imistart=0x7fad18e24a30,_imjstart=0x7fad18e24df0,
 _imistart2=0x7fad18e251b0,_imjstart2=0x7fad18e25570,_unittip=0x7fad18c0bdc0,
 _unittilt=0x7fad18c0eaa0,_lgs_defocuses=0x7fad1a838298,_unitdefocus=
 0x109a34030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19244830,
 _flat=0x7fad1a106830,_domask=1,_submask=0x7fad19248e30,_kernel=0x7fad1a139430,
 _kernels=0x10918c030,_kerfftr=0x1094ad030,_kerffti=0x109122030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a0ea430,_x=0x7fad1914b230,_y=0x7fad19149a30,
 _centroidgain=1,_rayleigh=0x7fad1a837ab0,_bckgrdcalib=0x7fad1a14aa30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837378)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837148,_ctrlden=0x7fad1903ffd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0d030,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad1914a630,
 0x7fad1914a630,0x7fad1914a630],_y0=0x7fad1916d230,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e21ac0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a8370a0,yposition=
 0x7fad1903fd70,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.954       78.1
Field Avg  2.20                     70.7   0.954       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848ff0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e25b90,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d0c210,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10af90030,_masks=0x0,_fluxpersub=0x7fad18d070b0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d04fb0,_skyfluxpersub=0x7fad18d07470,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[-0.000147989,-0.00050146],
 _lastvalidtt=[-0.000147989,-0.00050146],_upttcommand=[0,0],_refmes=
 0x7fad19149a30,_tiprefv=0x7fad19226e30,_tiltrefv=0x7fad19226230,_tiprefvn=
 0x7fad19234e30,_tiltrefvn=0x7fad1922a030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18d0c5d0,_jstart=0x7fad18d0c990,
 _binindices=0x7fad19843830,_binxy=2,_centroidw=0x7fad1903fec0,_fimage=
 0x7fad1a0ea430,_fimage2=0x0,_imistart=0x7fad18d061b0,_imjstart=0x7fad18d06570,
 _imistart2=0x7fad18d06930,_imjstart2=0x7fad18d06cf0,_unittip=0x7fad18f09130,
 _unittilt=0x7fad18f09360,_lgs_defocuses=0x7fad1a838618,_unitdefocus=
 0x109cc3030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19845a30,
 _flat=0x7fad1983ec30,_domask=1,_submask=0x7fad19844030,_kernel=0x7fad1914a230,
 _kernels=0x1092b8030,_kerfftr=0x1093d9030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a10fa30,_x=0x7fad19841030,_y=0x7fad19841830,
 _centroidgain=1,_rayleigh=0x7fad1a8370a0,_bckgrdcalib=0x7fad19846c30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fc58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837df8,_ctrlden=0x7fad1a838298,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c679b0,_xlast=0x7fad18c0d030,_ylast=[0x7fad1916d230,
 0x7fad1916d230,0x7fad1916d230],_y0=0x7fad1914ba30,_signus=0x7fad18c0e700,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0cbd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a838420,yposition=
 0x7fad1903fa28,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.33,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.954       78.1
Field Avg  2.20                     70.7   0.954       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848570)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18f09380,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d04fb0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10a7dc030,_masks=0x0,_fluxpersub=0x7fad18c616d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c61a90,_skyfluxpersub=0x7fad18c61e50,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[-0.000236187,-0.000768025],
 _lastvalidtt=[-0.000236187,-0.000768025],_upttcommand=[0,0],_refmes=
 0x7fad1a13d230,_tiprefv=0x7fad1a124630,_tiltrefv=0x7fad1a0ea430,_tiprefvn=
 0x7fad1a0da030,_tiltrefvn=0x7fad1a126430,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18d061b0,_jstart=0x7fad18d069f0,
 _binindices=0x7fad1914b230,_binxy=2,_centroidw=0x7fad1a837c38,_fimage=
 0x7fad1a128830,_fimage2=0x0,_imistart=0x7fad18c671a0,_imjstart=0x7fad18c5f030,
 _imistart2=0x7fad18c0b1f0,_imjstart2=0x7fad18c61310,_unittip=0x7fad18e1e310,
 _unittilt=0x7fad18e24260,_lgs_defocuses=0x7fad1903fcc8,_unitdefocus=
 0x109bc2030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a125230,
 _flat=0x7fad1a0eb030,_domask=1,_submask=0x7fad1914e030,_kernel=0x7fad19225a30,
 _kernels=0x10918c030,_kerfftr=0x109122030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19228630,_x=0x7fad1982ca30,_y=0x7fad1982d230,
 _centroidgain=1,_rayleigh=0x7fad1a838420,_bckgrdcalib=0x7fad1a139430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838180)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fc90,_ctrlden=0x7fad1903fd70,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0bdc0,_xlast=0x7fad18c0eaa0,_ylast=[0x7fad1914ba30,
 0x7fad1914ba30,0x7fad1914ba30],_y0=0x7fad19155830,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0d030,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a837378,yposition=
 0x7fad1903fd38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.35,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.944       84.1
Field Avg  2.20                     70.7   0.944       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849a08)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e26120,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c4b590,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10b8df030,_masks=0x0,_fluxpersub=0x7fad18e25b90,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e25600,_skyfluxpersub=0x7fad18e23610,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[-5.77531e-05,0.00110556],
 _lastvalidtt=[-5.77531e-05,0.00110556],_upttcommand=[0,0],_refmes=
 0x7fad19232e30,_tiprefv=0x7fad1922bc30,_tiltrefv=0x7fad19149a30,_tiprefvn=
 0x7fad19234c30,_tiltrefvn=0x7fad1914da30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c5ff60,_jstart=0x7fad18c60e10,
 _binindices=0x7fad1a12d830,_binxy=2,_centroidw=0x7fad1a8378b8,_fimage=
 0x7fad1a128830,_fimage2=0x0,_imistart=0x7fad18e1de10,_imjstart=0x7fad18e24e80,
 _imistart2=0x7fad18e25240,_imjstart2=0x7fad18e1e1d0,_unittip=0x7fad18c0bdc0,
 _unittilt=0x7fad18c0eaa0,_lgs_defocuses=0x7fad1a838260,_unitdefocus=
 0x109dc4030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1922a030,
 _flat=0x7fad19243e30,_domask=1,_submask=0x7fad1a13a630,_kernel=0x7fad19242e30,
 _kernels=0x1093a3030,_kerfftr=0x1092b8030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a12c630,_x=0x7fad19227c30,_y=0x7fad19228430,
 _centroidgain=1,_rayleigh=0x7fad1a837378,_bckgrdcalib=0x7fad19245030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837148)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fbe8,_ctrlden=0x7fad1903fa98,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18d04b20,_xlast=0x7fad18d05a30,_ylast=[0x7fad1980ae30,
 0x7fad1980ae30,0x7fad1980ae30],_y0=0x7fad19810430,_signus=0x7fad18d05bb0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1903fc58,yposition=
 0x7fad1a837730,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       73.5   0.760       96.1
Field Avg  2.20                     73.5   0.760       96.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8489b0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e26f80,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d07d30,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109a34030,_masks=0x0,_fluxpersub=0x7fad18e1de10,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e24700,_skyfluxpersub=0x7fad18e25b90,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[0.00793374,-0.00625915],
 _lastvalidtt=[0.00793374,-0.00625915],_upttcommand=[0,0],_refmes=
 0x7fad19232c30,_tiprefv=0x7fad19227c30,_tiltrefv=0x7fad19231a30,_tiprefvn=
 0x7fad1922bc30,_tiltrefvn=0x7fad19149a30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18d080f0,_jstart=0x7fad18d084b0,
 _binindices=0x7fad19825430,_binxy=2,_centroidw=0x7fad1a8370a0,_fimage=
 0x7fad1a114c30,_fimage2=0x0,_imistart=0x7fad18d08ff0,_imjstart=0x7fad18d093b0,
 _imistart2=0x7fad18d09770,_imjstart2=0x7fad18d09b30,_unittip=0x7fad18d04fb0,
 _unittilt=0x7fad18d05a30,_lgs_defocuses=0x7fad19035830,_unitdefocus=
 0x109643030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a10fa30,
 _flat=0x7fad1a0ea430,_domask=1,_submask=0x7fad1a0e1230,_kernel=0x7fad1a13d230,
 _kernels=0x10918c030,_kerfftr=0x109122030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a110c30,_x=0x7fad1981d030,_y=0x7fad19822a30,
 _centroidgain=1,_rayleigh=0x7fad1903fc58,_bckgrdcalib=0x7fad1a139430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837df8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fd38,_ctrlden=0x7fad1a8378b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e21ac0,_xlast=0x7fad18e1d510,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a13da30,_signus=0x7fad18e17b30,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1e1d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a838180,yposition=
 0x7fad1903ffd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.45,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848dd0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c582c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c60aa0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109cc3030,_masks=0x0,_fluxpersub=0x7fad18c58a40,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c58e00,_skyfluxpersub=0x7fad18c591c0,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-0.00181206,0.000395978],
 _lastvalidtt=[-0.00181206,0.000395978],_upttcommand=[0,0],_refmes=
 0x7fad1a142e30,_tiprefv=0x7fad1a128230,_tiltrefv=0x7fad1a124c30,_tiprefvn=
 0x7fad1a128e30,_tiltrefvn=0x7fad1a12ac30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c4b8a0,_jstart=0x7fad18c5ff60,
 _binindices=0x7fad19227230,_binxy=2,_centroidw=0x7fad1a838420,_fimage=
 0x7fad1914d630,_fimage2=0x0,_imistart=0x7fad18c58680,_imjstart=0x7fad18c60e60,
 _imistart2=0x7fad18c61220,_imjstart2=0x7fad18c615e0,_unittip=0x7fad18c0c280,
 _unittilt=0x7fad18c0bdc0,_lgs_defocuses=0x7fad1a838768,_unitdefocus=
 0x10bce0030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19239030,
 _flat=0x7fad19237e30,_domask=1,_submask=0x7fad1922c630,_kernel=0x7fad1914ce30,
 _kernels=0x1093a3030,_kerfftr=0x1092b8030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19236c30,_x=0x7fad19228c30,_y=0x7fad19232830,
 _centroidgain=1,_rayleigh=0x7fad1a838180,_bckgrdcalib=0x7fad1923be30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fc90)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8380a0,_ctrlden=0x7fad1a838618,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e27870,_xlast=0x7fad18e21ac0,_ylast=[0x7fad1a13da30,
 0x7fad1a13da30,0x7fad1a13da30],_y0=0x7fad1a0ebe30,_signus=0x7fad18e26120,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e27df0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a837148,yposition=
 0x7fad1a838298,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849100)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e271c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c582c0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109bc2030,_masks=0x0,_fluxpersub=0x7fad18c59b50,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c0b330,_skyfluxpersub=0x7fad18c58a40,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-0.00135713,0.000192048],
 _lastvalidtt=[-0.00135713,0.000192048],_upttcommand=[0,0],_refmes=
 0x7fad19232830,_tiprefv=0x7fad1922ec30,_tiltrefv=0x7fad1914d630,_tiprefvn=
 0x7fad19226230,_tiltrefvn=0x7fad19230a30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c4b950,_jstart=0x7fad18c5eb80,
 _binindices=0x7fad19225a30,_binxy=2,_centroidw=0x7fad1903fa28,_fimage=
 0x7fad1a147c30,_fimage2=0x0,_imistart=0x7fad18c59790,_imjstart=0x7fad18c5f740,
 _imistart2=0x7fad18c58680,_imjstart2=0x7fad18c60650,_unittip=0x7fad18c0e700,
 _unittilt=0x7fad18c0eaa0,_lgs_defocuses=0x7fad1903fb08,_unitdefocus=
 0x10c3e4030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19236430,
 _flat=0x7fad19227230,_domask=1,_submask=0x7fad1922da30,_kernel=0x7fad19230030,
 _kernels=0x10918c030,_kerfftr=0x109122030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a10fa30,_x=0x7fad1914a230,_y=0x7fad1914b230,
 _centroidgain=1,_rayleigh=0x7fad1a837148,_bckgrdcalib=0x7fad19237630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fbe8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837ab0,_ctrlden=0x7fad1a819a00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cbd0,_xlast=0x7fad18c0bdc0,_ylast=[0x7fad19226e30,
 0x7fad19226e30,0x7fad19226e30],_y0=0x7fad19231630,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0c280,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a837df8,yposition=
 0x7fad1903fd70,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.25,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848790)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e1de10,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d06650,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109dc4030,_masks=0x0,_fluxpersub=0x7fad18c4b590,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c5eb80,_skyfluxpersub=0x7fad18c582c0,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-0.000252226,-0.000222447],
 _lastvalidtt=[-0.000252226,-0.000222447],_upttcommand=[0,0],_refmes=
 0x7fad1a0e1230,_tiprefv=0x7fad19149a30,_tiltrefv=0x7fad1a871430,_tiprefvn=
 0x7fad1922ec30,_tiltrefvn=0x7fad1a86ea30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18d06a10,_jstart=0x7fad18d06dd0,
 _binindices=0x7fad1a804630,_binxy=2,_centroidw=0x7fad1a837c38,_fimage=
 0x7fad1a139430,_fimage2=0x0,_imistart=0x7fad18f0c370,_imjstart=0x7fad18f0cd00,
 _imistart2=0x7fad18f0d0c0,_imjstart2=0x7fad18f0daa0,_unittip=0x7fad18d061f0,
 _unittilt=0x7fad18d06420,_lgs_defocuses=0x7fad1903fda8,_unitdefocus=
 0x1098b2030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19233e30,
 _flat=0x7fad1914d630,_domask=1,_submask=0x7fad1922b630,_kernel=0x7fad1914ce30,
 _kernels=0x1093a3030,_kerfftr=0x1092b8030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a0ea430,_x=0x7fad1981d030,_y=0x7fad19820630,
 _centroidgain=1,_rayleigh=0x7fad1a837df8,_bckgrdcalib=0x7fad19229630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fd38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fa28,_ctrlden=0x7fad1a838298,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18f0a040,_xlast=0x7fad18f0a1c0,_ylast=[0x7fad1a809630,
 0x7fad1a809630,0x7fad1a809630],_y0=0x7fad1a86f630,_signus=0x7fad18f0c8e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0e060,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1903fc90,yposition=
 0x7fad1903fa98,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.947       78.1
Field Avg  2.20                     70.7   0.947       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849ba0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c619d0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c4b590,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109643030,_masks=0x0,_fluxpersub=0x7fad18d04fb0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d05a30,_skyfluxpersub=0x7fad18d05df0,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[0.000601257,0.00022336],
 _lastvalidtt=[0.000601257,0.00022336],_upttcommand=[0,0],_refmes=
 0x7fad1a091630,_tiprefv=0x7fad1a139430,_tiltrefv=0x7fad19821630,_tiprefvn=
 0x7fad1a14a030,_tiltrefvn=0x7fad19822230,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c4b950,_jstart=0x7fad18c5f030,
 _binindices=0x7fad19225a30,_binxy=2,_centroidw=0x7fad1903fcc8,_fimage=
 0x7fad192eb230,_fimage2=0x0,_imistart=0x7fad18c60320,_imjstart=0x7fad18c606e0,
 _imistart2=0x7fad18c60aa0,_imjstart2=0x7fad18c60e60,_unittip=0x7fad18c0eaa0,
 _unittilt=0x7fad18c0b5b0,_lgs_defocuses=0x7fad1a837490,_unitdefocus=
 0x10abde030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1981f430,
 _flat=0x7fad1981e230,_domask=1,_submask=0x7fad1a0e1230,_kernel=0x7fad1a091e30,
 _kernels=0x10918c030,_kerfftr=0x109122030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad192ea030,_x=0x7fad19235030,_y=0x7fad1914b230,
 _centroidgain=1,_rayleigh=0x7fad1903fc90,_bckgrdcalib=0x7fad19822e30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8380a0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837df8,_ctrlden=0x7fad1a8373b0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0d030,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad19155830,
 0x7fad19155830,0x7fad19155830],_y0=0x7fad1922ce30,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d0b1d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1903fbe8,yposition=
 0x7fad1a8378b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.33,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.946       84.1
Field Avg  2.20                     70.7   0.946       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8485f8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e22c90,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c5f740,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10bce0030,_masks=0x0,_fluxpersub=0x7fad18c4f220,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c4f5e0,_skyfluxpersub=0x7fad18c4f9a0,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-0.000440801,-0.000418051],
 _lastvalidtt=[-0.000440801,-0.000418051],_upttcommand=[0,0],_refmes=
 0x7fad1a0fd030,_tiprefv=0x7fad1a113030,_tiltrefv=0x7fad1a0eb630,_tiprefvn=
 0x7fad1a139430,_tiltrefvn=0x7fad1a116430,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c60a10,_jstart=0x7fad18c4b590,
 _binindices=0x7fad1922da30,_binxy=2,_centroidw=0x7fad1903fb08,_fimage=
 0x7fad1a0ea430,_fimage2=0x0,_imistart=0x7fad18c4e320,_imjstart=0x7fad18c4e6e0,
 _imistart2=0x7fad18c4eaa0,_imjstart2=0x7fad18c4ee60,_unittip=0x7fad18c0bdc0,
 _unittilt=0x7fad18c496e0,_lgs_defocuses=0x7fad1903fd70,_unitdefocus=
 0x10ad8e030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad192a2a30,
 _flat=0x7fad192a1830,_domask=1,_submask=0x7fad19230e30,_kernel=0x7fad1914d630,
 _kernels=0x1093a3030,_kerfftr=0x1092b8030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a114c30,_x=0x7fad19235030,_y=0x7fad1914b230,
 _centroidgain=1,_rayleigh=0x7fad1903fbe8,_bckgrdcalib=0x7fad192a5030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837ab0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fec0,_ctrlden=0x7fad1a8375e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0e880,_xlast=0x7fad18c0d030,_ylast=[0x7fad1922ce30,
 0x7fad1922ce30,0x7fad1922ce30],_y0=0x7fad192ec030,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1d510,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1903fd38,yposition=
 0x7fad1a838618,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.35,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.936       84.1
Field Avg  2.20                     70.7   0.936       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8488a0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c4eea0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e26120,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c3e4030,_masks=0x0,_fluxpersub=0x7fad18e23c90,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e268b0,_skyfluxpersub=0x7fad18e26c70,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[0.000312542,-0.00160405],
 _lastvalidtt=[0.000312542,-0.00160405],_upttcommand=[0,0],_refmes=
 0x7fad1a13fc30,_tiprefv=0x7fad1914de30,_tiltrefv=0x7fad1a139430,_tiprefvn=
 0x7fad1929fe30,_tiltrefvn=0x7fad1a0eb630,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e1de10,_jstart=0x7fad18e25b90,
 _binindices=0x7fad1a0e1230,_binxy=2,_centroidw=0x7fad1903fda8,_fimage=
 0x7fad1922fc30,_fimage2=0x0,_imistart=0x7fad18e1f050,_imjstart=0x7fad18e23150,
 _imistart2=0x7fad18e23510,_imjstart2=0x7fad18e238d0,_unittip=0x7fad18e21ac0,
 _unittilt=0x7fad18e17b30,_lgs_defocuses=0x7fad19040048,_unitdefocus=
 0x10b0db030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a102030,
 _flat=0x7fad1a100e30,_domask=1,_submask=0x7fad1a0fd830,_kernel=0x7fad1a13a830,
 _kernels=0x10918c030,_kerfftr=0x109122030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad191a5030,_x=0x7fad1a111a30,_y=0x7fad1a112230,
 _centroidgain=1,_rayleigh=0x7fad1903fd38,_bckgrdcalib=0x7fad1a104e30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fa28)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fb08,_ctrlden=0x7fad1903fc20,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0bdc0,_xlast=0x7fad18c0e7d0,_ylast=[0x7fad192ec030,
 0x7fad192ec030,0x7fad192ec030],_y0=0x7fad1914ba30,_signus=0x7fad18c54140,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a8380a0,yposition=
 0x7fad1a819a00,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       71.6   0.792       90.1
Field Avg  2.20                     71.6   0.792       90.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849dc0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e25b90,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c4b590,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1098b2030,_masks=0x0,_fluxpersub=0x7fad18c5a0c0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c5a480,_skyfluxpersub=0x7fad18c5a840,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[0.00424866,-0.00254103],
 _lastvalidtt=[0.00424866,-0.00254103],_upttcommand=[0,0],_refmes=
 0x7fad1914b230,_tiprefv=0x7fad192a3630,_tiltrefv=0x7fad192a2a30,_tiprefvn=
 0x7fad1914de30,_tiltrefvn=0x7fad1922ac30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c582c0,_jstart=0x7fad18c58680,
 _binindices=0x7fad19230c30,_binxy=2,_centroidw=0x7fad1a837378,_fimage=
 0x7fad1a0ffe30,_fimage2=0x0,_imistart=0x7fad18c591c0,_imjstart=0x7fad18c59580,
 _imistart2=0x7fad18c59940,_imjstart2=0x7fad18c59d00,_unittip=0x7fad18c0e7d0,
 _unittilt=0x7fad18c0bdc0,_lgs_defocuses=0x7fad1903fbe8,_unitdefocus=
 0x10af90030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad192e4c30,
 _flat=0x7fad192e3a30,_domask=1,_submask=0x7fad19233e30,_kernel=0x7fad19231430,
 _kernels=0x1093a3030,_kerfftr=0x1092b8030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a0ea430,_x=0x7fad19232430,_y=0x7fad1922e230,
 _centroidgain=1,_rayleigh=0x7fad1a8380a0,_bckgrdcalib=0x7fad192e7230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837df8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838420,_ctrlden=0x7fad1a8381f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c54400,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad1914ba30,
 0x7fad1914ba30,0x7fad1914ba30],_y0=0x7fad19233230,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e35a70,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a837ab0,yposition=
 0x7fad1a838298,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.45,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.943       84.1
Field Avg  2.20                     70.7   0.943       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849650)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5d9d0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e34a90,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10abde030,_masks=0x0,_fluxpersub=0x7fad18f09d10,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0c250,_skyfluxpersub=0x7fad18f0c610,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00693291,0.000120057],
 _lastvalidtt=[0.00693291,0.000120057],_upttcommand=[0,0],_refmes=
 0x7fad19235030,_tiprefv=0x7fad192e8430,_tiltrefv=0x7fad192e7830,_tiprefvn=
 0x7fad192a3630,_tiltrefvn=0x7fad192a2a30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e34e50,_jstart=0x7fad18e35210,
 _binindices=0x7fad19814430,_binxy=2,_centroidw=0x7fad1a837d50,_fimage=
 0x7fad19231630,_fimage2=0x0,_imistart=0x7fad18d061b0,_imjstart=0x7fad18d06570,
 _imistart2=0x7fad18d06930,_imjstart2=0x7fad18d06cf0,_unittip=0x7fad18e17b30,
 _unittilt=0x7fad18e34860,_lgs_defocuses=0x7fad1a837768,_unitdefocus=
 0x10a7dc030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a870c30,
 _flat=0x7fad1a82d030,_domask=1,_submask=0x7fad1a819e30,_kernel=0x7fad1a804630,
 _kernels=0x10918c030,_kerfftr=0x109122030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1914d630,_x=0x7fad1a0fc830,_y=0x7fad1a101830,
 _centroidgain=1,_rayleigh=0x7fad1a837ab0,_bckgrdcalib=0x7fad1a871e30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fec0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838570,_ctrlden=0x7fad1a838148,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1d510,_xlast=0x7fad18e24330,_ylast=[0x7fad1a13da30,
 0x7fad1a13da30,0x7fad1a13da30],_y0=0x7fad1a139c30,_signus=0x7fad18e1e0d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e17d60,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1903fa28,yposition=
 0x7fad1a8373b0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.944       84.1
Field Avg  2.20                     70.7   0.944       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8496d8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18f09240,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c4b950,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ad8e030,_masks=0x0,_fluxpersub=0x7fad18d061f0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d06980,_skyfluxpersub=0x7fad18d06d40,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00605206,0.000499935],
 _lastvalidtt=[0.00605206,0.000499935],_upttcommand=[0,0],_refmes=
 0x7fad1a0fdc30,_tiprefv=0x7fad1a101230,_tiltrefv=0x7fad1a12de30,_tiprefvn=
 0x7fad1a105430,_tiltrefvn=0x7fad1a102a30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c5eb80,_jstart=0x7fad18c54140,
 _binindices=0x7fad1922e230,_binxy=2,_centroidw=0x7fad1903fd70,_fimage=
 0x7fad191b0830,_fimage2=0x0,_imistart=0x7fad18c5ff60,_imjstart=0x7fad18c582c0,
 _imistart2=0x7fad18c58680,_imjstart2=0x7fad18c58a40,_unittip=0x7fad18c0eaa0,
 _unittilt=0x7fad18c0e7d0,_lgs_defocuses=0x7fad1903fad0,_unitdefocus=
 0x10b8df030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1985d030,
 _flat=0x7fad1985be30,_domask=1,_submask=0x7fad19814430,_kernel=0x7fad19233e30,
 _kernels=0x1093a3030,_kerfftr=0x1092b8030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a819e30,_x=0x7fad1922f830,_y=0x7fad19234630,
 _centroidgain=1,_rayleigh=0x7fad1903fa28,_bckgrdcalib=0x7fad1985e230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fb08)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838618,_ctrlden=0x7fad1a8386c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0d030,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad19155830,
 0x7fad19155830,0x7fad19155830],_y0=0x7fad1914ba30,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d04b20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a837df8,yposition=
 0x7fad1a8375e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.25,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.942       84.1
Field Avg  2.20                     70.7   0.942       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8484e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18d05f60,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e26e90,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10b0db030,_masks=0x0,_fluxpersub=0x7fad18c5eb80,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c0b1f0,_skyfluxpersub=0x7fad18c4b590,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00521115,6.14989e-05],
 _lastvalidtt=[0.00521115,6.14989e-05],_upttcommand=[0,0],_refmes=
 0x7fad1a13a830,_tiprefv=0x7fad1a091630,_tiltrefv=0x7fad1922ac30,_tiprefvn=
 0x7fad19228e30,_tiltrefvn=0x7fad1922b830,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e28de0,_jstart=0x7fad18e291a0,
 _binindices=0x7fad1a0fc830,_binxy=2,_centroidw=0x7fad1903fbe8,_fimage=
 0x7fad1981e230,_fimage2=0x0,_imistart=0x7fad18e29ce0,_imjstart=0x7fad18e2a180,
 _imistart2=0x7fad18e2a540,_imjstart2=0x7fad18e2a900,_unittip=0x7fad18e27f10,
 _unittilt=0x7fad18e28140,_lgs_defocuses=0x7fad1a01a288,_unitdefocus=
 0x109a34030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19233e30,
 _flat=0x7fad19229a30,_domask=1,_submask=0x7fad19232a30,_kernel=0x7fad1914b230,
 _kernels=0x10918c030,_kerfftr=0x109122030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1922e230,_x=0x7fad1a0eb630,_y=0x7fad1a13fc30,
 _centroidgain=1,_rayleigh=0x7fad1a837df8,_bckgrdcalib=0x7fad19230a30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838420)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837c00,_ctrlden=0x7fad1a838298,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e26120,_xlast=0x7fad18e276d0,_ylast=[0x7fad1a13da30,
 0x7fad1a13da30,0x7fad1a13da30],_y0=0x7fad1a092230,_signus=0x7fad18e26bd0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0d030,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1903fec0,yposition=
 0x7fad1903fc20,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.938       84.1
Field Avg  2.20                     70.7   0.938       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a8495c8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e26c70,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c58ca0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10af90030,_masks=0x0,_fluxpersub=0x7fad18e17b30,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e26120,_skyfluxpersub=0x7fad18e264e0,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.0053509,0.00139226],
 _lastvalidtt=[0.0053509,0.00139226],_upttcommand=[0,0],_refmes=0x7fad1919a830,
 _tiprefv=0x7fad1a0eb430,_tiltrefv=0x7fad1914b230,_tiprefvn=0x7fad1a091630,
 _tiltrefvn=0x7fad1922ac30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7fad18c4b590,_jstart=0x7fad18c5da30,_binindices=
 0x7fad1a832030,_binxy=2,_centroidw=0x7fad1a837ab0,_fimage=0x7fad1a106030,
 _fimage2=0x0,_imistart=0x7fad18f0a490,_imjstart=0x7fad18f08e70,_imistart2=
 0x7fad18f0bbf0,_imjstart2=0x7fad18f0bfb0,_unittip=0x7fad18c0e7d0,_unittilt=
 0x7fad18c0b5d0,_lgs_defocuses=0x7fad1903fd70,_unitdefocus=0x109cc3030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a101830,_flat=
 0x7fad1a100630,_domask=1,_submask=0x7fad1a13fc30,_kernel=0x7fad1a0fec30,
 _kernels=0x1093a3030,_kerfftr=0x1092b8030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a147c30,_x=0x7fad1922b830,_y=0x7fad19149a30,
 _centroidgain=1,_rayleigh=0x7fad1903fec0,_bckgrdcalib=0x7fad1a102a30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838570)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a01a288,_ctrlden=0x7fad1903f9f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e25860,_ylast=[0x7fad1a092230,
 0x7fad1a092230,0x7fad1a092230],_y0=0x7fad1a109e30,_signus=0x7fad18e21ac0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e18710,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1903fb08,yposition=
 0x7fad1a8381f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.33,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.934       84.1
Field Avg  2.20                     70.7   0.934       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849b18)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e1f050,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d05d10,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10a7dc030,_masks=0x0,_fluxpersub=0x7fad18c582c0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c58680,_skyfluxpersub=0x7fad18c0b1f0,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00427359,0.00169071],
 _lastvalidtt=[0.00427359,0.00169071],_upttcommand=[0,0],_refmes=0x7fad19233e30,
 _tiprefv=0x7fad1922b830,_tiltrefv=0x7fad19192830,_tiprefvn=0x7fad19193430,
 _tiltrefvn=0x7fad1914b230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7fad18d060d0,_jstart=0x7fad18d06490,_binindices=
 0x7fad19234630,_binxy=2,_centroidw=0x7fad1a8378b8,_fimage=0x7fad1a106830,
 _fimage2=0x0,_imistart=0x7fad18c4b950,_imjstart=0x7fad18c5d9d0,_imistart2=
 0x7fad18c5f740,_imjstart2=0x7fad18c5dd90,_unittip=0x7fad18d05a30,_unittilt=
 0x7fad18d04fb0,_lgs_defocuses=0x7fad1903fcc8,_unitdefocus=0x109bc2030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19288030,_flat=
 0x7fad19232230,_domask=1,_submask=0x7fad19149a30,_kernel=0x7fad1914a230,
 _kernels=0x10918c030,_kerfftr=0x109122030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a0fec30,_x=0x7fad1981e230,_y=0x7fad1981ea30,
 _centroidgain=1,_rayleigh=0x7fad1903fb08,_bckgrdcalib=0x7fad19289230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838618)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837df8,_ctrlden=0x7fad1a8375e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e25e50,_xlast=0x7fad18e1bf00,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a0fb430,_signus=0x7fad18e17b30,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0cbd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a838420,yposition=
 0x7fad1a838148,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.35,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.903       84.1
Field Avg  2.20                     70.7   0.903       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848f68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c594d0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c0b1f0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10b8df030,_masks=0x0,_fluxpersub=0x7fad18e17b30,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e1de10,_skyfluxpersub=0x7fad18e24700,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00611308,-0.000578172],
 _lastvalidtt=[0.00611308,-0.000578172],_upttcommand=[0,0],_refmes=
 0x7fad1a116430,_tiprefv=0x7fad1a104e30,_tiltrefv=0x7fad1a111e30,_tiprefvn=
 0x7fad1a139430,_tiltrefvn=0x7fad1a106430,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c58d50,_jstart=0x7fad18c59110,
 _binindices=0x7fad19149a30,_binxy=2,_centroidw=0x7fad1903fad0,_fimage=
 0x7fad1922b030,_fimage2=0x0,_imistart=0x7fad18c60320,_imjstart=0x7fad18c606e0,
 _imistart2=0x7fad18c4b8a0,_imjstart2=0x7fad18c60aa0,_unittip=0x7fad18c496e0,
 _unittilt=0x7fad18c0bdc0,_lgs_defocuses=0x7fad19035830,_unitdefocus=
 0x109dc4030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a10fa30,
 _flat=0x7fad1a107030,_domask=1,_submask=0x7fad1a13fc30,_kernel=0x7fad1a0ea430,
 _kernels=0x1093a3030,_kerfftr=0x1092b8030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19192830,_x=0x7fad19225a30,_y=0x7fad19233e30,
 _centroidgain=1,_rayleigh=0x7fad1a838420,_bckgrdcalib=0x7fad1a110c30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837c00)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fda8,_ctrlden=0x7fad1a8378b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e24330,_xlast=0x7fad18e21ac0,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a102230,_signus=0x7fad18e26120,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c54450,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a838570,yposition=
 0x7fad1a8386c0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       72.0   0.762       96.1
Field Avg  2.20                     72.0   0.762       96.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849d38)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c582c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d06b80,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109a34030,_masks=0x0,_fluxpersub=0x7fad18f09d10,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0a0d0,_skyfluxpersub=0x7fad18f0a490,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.000943422,-0.00646147],
 _lastvalidtt=[0.000943422,-0.00646147],_upttcommand=[0,0],_refmes=
 0x7fad1a0fd830,_tiprefv=0x7fad1a0ea430,_tiltrefv=0x7fad1a10fa30,_tiprefvn=
 0x7fad1a104e30,_tiltrefvn=0x7fad1a111e30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18d07450,_jstart=0x7fad18d07810,
 _binindices=0x7fad1914d630,_binxy=2,_centroidw=0x7fad19040048,_fimage=
 0x7fad19229e30,_fimage2=0x0,_imistart=0x7fad18c5eb80,_imjstart=0x7fad18c58a40,
 _imistart2=0x7fad18c600e0,_imjstart2=0x7fad18c604a0,_unittip=0x7fad18d05a30,
 _unittilt=0x7fad18d06950,_lgs_defocuses=0x7fad1903fc20,_unitdefocus=
 0x109643030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a830630,
 _flat=0x7fad1a82f430,_domask=1,_submask=0x7fad1a832030,_kernel=0x7fad1914a230,
 _kernels=0x10918c030,_kerfftr=0x109122030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19228c30,_x=0x7fad1981e230,_y=0x7fad1981ea30,
 _centroidgain=1,_rayleigh=0x7fad1a838570,_bckgrdcalib=0x7fad1a82c830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a01a288)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837378,_ctrlden=0x7fad1a838458,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e24330,_ylast=[0x7fad1a102230,
 0x7fad1a102230,0x7fad1a102230],_y0=0x7fad1a0eb030,_signus=0x7fad18e23d80,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0d030,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a838618,yposition=
 0x7fad1a838298,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.45,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.937       84.1
Field Avg  2.20                     70.7   0.937       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848818)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5d9d0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e18ad0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109cc3030,_masks=0x0,_fluxpersub=0x7fad18f09d10,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0a0d0,_skyfluxpersub=0x7fad18f0a490,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00406801,-0.00147919],
 _lastvalidtt=[0.00406801,-0.00147919],_upttcommand=[0,0],_refmes=
 0x7fad1a107430,_tiprefv=0x7fad1a114e30,_tiltrefv=0x7fad1a101630,_tiprefvn=
 0x7fad1a0ea430,_tiltrefvn=0x7fad1a10fa30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e1de10,_jstart=0x7fad18e17b30,
 _binindices=0x7fad1a091630,_binxy=2,_centroidw=0x7fad1a837768,_fimage=
 0x7fad19225a30,_fimage2=0x0,_imistart=0x7fad18e23cd0,_imjstart=0x7fad18e24700,
 _imistart2=0x7fad18e24ac0,_imjstart2=0x7fad18e24e80,_unittip=0x7fad18e1e1d0,
 _unittilt=0x7fad18e24330,_lgs_defocuses=0x7fad1903fd70,_unitdefocus=
 0x10bce0030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a830630,
 _flat=0x7fad1a82f430,_domask=1,_submask=0x7fad1a81aa30,_kernel=0x7fad19814430,
 _kernels=0x1093a3030,_kerfftr=0x1092b8030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19226c30,_x=0x7fad1a113e30,_y=0x7fad1a114630,
 _centroidgain=1,_rayleigh=0x7fad1a838618,_bckgrdcalib=0x7fad1a82c830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837df8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838570,_ctrlden=0x7fad1903ffd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cbd0,_xlast=0x7fad18c0e7d0,_ylast=[0x7fad19155830,
 0x7fad19155830,0x7fad19155830],_y0=0x7fad19116a30,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1d510,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a837c00,yposition=
 0x7fad1903f9f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.941       84.1
Field Avg  2.20                     70.7   0.941       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a848cc0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5d9d0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c4e320,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109bc2030,_masks=0x0,_fluxpersub=0x7fad18f0bf00,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f09d10,_skyfluxpersub=0x7fad18f0a0d0,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00451655,-0.00164385],
 _lastvalidtt=[0.00451655,-0.00164385],_upttcommand=[0,0],_refmes=
 0x7fad1a107430,_tiprefv=0x7fad19821630,_tiltrefv=0x7fad1a100830,_tiprefvn=
 0x7fad1a82c830,_tiltrefvn=0x7fad1a101630,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c4e6e0,_jstart=0x7fad18c4eaa0,
 _binindices=0x7fad19814430,_binxy=2,_centroidw=0x7fad1a838768,_fimage=
 0x7fad1a102230,_fimage2=0x0,_imistart=0x7fad18d061b0,_imjstart=0x7fad18d06570,
 _imistart2=0x7fad18d06930,_imjstart2=0x7fad18d06cf0,_unittip=0x7fad18c0e7d0,
 _unittilt=0x7fad18c0bdc0,_lgs_defocuses=0x7fad1a838420,_unitdefocus=
 0x10c3e4030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a85a830,
 _flat=0x7fad1a82fc30,_domask=1,_submask=0x7fad1a859030,_kernel=0x7fad1a81aa30,
 _kernels=0x10918c030,_kerfftr=0x109122030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a112630,_x=0x7fad19235030,_y=0x7fad192a3830,
 _centroidgain=1,_rayleigh=0x7fad1a837c00,_bckgrdcalib=0x7fad1a85ba30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fda8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad19040048,_ctrlden=0x7fad1a837c38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e21c00,_xlast=0x7fad18e229d0,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a139c30,_signus=0x7fad18e1de10,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a01a288,yposition=
 0x7fad1a8375e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.25,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.940       84.1
Field Avg  2.20                     70.7   0.940       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849298)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e26120,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18f0a170,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109dc4030,_masks=0x0,_fluxpersub=0x7fad18e1de10,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e23880,_skyfluxpersub=0x7fad18e23c40,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00459117,-0.00184009],
 _lastvalidtt=[0.00459117,-0.00184009],_upttcommand=[0,0],_refmes=
 0x7fad1914a230,_tiprefv=0x7fad1922ee30,_tiltrefv=0x7fad1922e230,_tiprefvn=
 0x7fad19235030,_tiltrefvn=0x7fad19231c30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18f0a530,_jstart=0x7fad18f08e70,
 _binindices=0x7fad1a82e230,_binxy=2,_centroidw=0x7fad1a838180,_fimage=
 0x7fad1a128c30,_fimage2=0x0,_imistart=0x7fad18f0bfb0,_imjstart=0x7fad18f0c370,
 _imistart2=0x7fad18f0c730,_imjstart2=0x7fad18f0caf0,_unittip=0x7fad18f09d10,
 _unittilt=0x7fad18f09f40,_lgs_defocuses=0x7fad1903fcc8,_unitdefocus=
 0x1098b2030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a12ca30,
 _flat=0x7fad1a12b830,_domask=1,_submask=0x7fad1a139430,_kernel=0x7fad1a13fc30,
 _kernels=0x1093a3030,_kerfftr=0x1092b8030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a113030,_x=0x7fad1a832030,_y=0x7fad1a82da30,
 _centroidgain=1,_rayleigh=0x7fad1a01a288,_bckgrdcalib=0x7fad1a111630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837378)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838298,_ctrlden=0x7fad1a837ce0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1d510,_xlast=0x7fad18e18850,_ylast=[0x7fad1a139c30,
 0x7fad1a139c30,0x7fad1a139c30],_y0=0x7fad1a0eb030,_signus=0x7fad18e21ac0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e24700,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a837df8,yposition=
 0x7fad1a8378b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.936       84.1
Field Avg  2.20                     70.7   0.936       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849980)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e332d0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c4b950,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109643030,_masks=0x0,_fluxpersub=0x7fad18c4f220,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c4f5e0,_skyfluxpersub=0x7fad18c4f9a0,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00505133,-0.00161929],
 _lastvalidtt=[0.00505133,-0.00161929],_upttcommand=[0,0],_refmes=
 0x7fad1922ba30,_tiprefv=0x7fad1a10fa30,_tiltrefv=0x7fad1a0ea430,_tiprefvn=
 0x7fad1a113030,_tiltrefvn=0x7fad1a129e30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c5d9d0,_jstart=0x7fad18c4e320,
 _binindices=0x7fad19230630,_binxy=2,_centroidw=0x7fad1a838618,_fimage=
 0x7fad19230e30,_fimage2=0x0,_imistart=0x7fad18c4fd60,_imjstart=0x7fad18c4e6e0,
 _imistart2=0x7fad18c4eaa0,_imjstart2=0x7fad18c4ee60,_unittip=0x7fad18c0eaa0,
 _unittilt=0x7fad18c0e7d0,_lgs_defocuses=0x7fad1a837ab0,_unitdefocus=
 0x10abde030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19197430,
 _flat=0x7fad19196230,_domask=1,_submask=0x7fad19193830,_kernel=0x7fad1914e230,
 _kernels=0x10918c030,_kerfftr=0x109122030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19225a30,_x=0x7fad19192830,_y=0x7fad19193030,
 _centroidgain=1,_rayleigh=0x7fad1a837df8,_bckgrdcalib=0x7fad19198630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838570)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837d50,_ctrlden=0x7fad1903fc90,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e1d510,_ylast=[0x7fad1a0eb030,
 0x7fad1a0eb030,0x7fad1a0eb030],_y0=0x7fad1a0fb430,_signus=0x7fad18e25b90,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0d030,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1903fda8,yposition=
 0x7fad1a838458,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.33,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.932       84.1
Field Avg  2.20                     70.7   0.932       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849cb0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e33650,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e1de10,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10bce0030,_masks=0x0,_fluxpersub=0x7fad18c4eaa0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c5ff60,_skyfluxpersub=0x7fad18c60320,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00582626,-0.00136126],
 _lastvalidtt=[0.00582626,-0.00136126],_upttcommand=[0,0],_refmes=
 0x7fad1914a230,_tiprefv=0x7fad19227a30,_tiltrefv=0x7fad1a112e30,_tiprefvn=
 0x7fad19228630,_tiltrefvn=0x7fad1a0ea430,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e27230,_jstart=0x7fad18e32ec0,
 _binindices=0x7fad19149a30,_binxy=2,_centroidw=0x7fad1a837768,_fimage=
 0x7fad1a111230,_fimage2=0x0,_imistart=0x7fad18c5f030,_imjstart=0x7fad18c4b890,
 _imistart2=0x7fad18c0b1f0,_imjstart2=0x7fad18c4e6e0,_unittip=0x7fad18e25b90,
 _unittilt=0x7fad18e24330,_lgs_defocuses=0x7fad1903fcc8,_unitdefocus=
 0x10ad8e030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19229230,
 _flat=0x7fad19232430,_domask=1,_submask=0x7fad19235030,_kernel=0x7fad1914e030,
 _kernels=0x1093a3030,_kerfftr=0x1092b8030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a12b030,_x=0x7fad1a10fa30,_y=0x7fad1a139430,
 _centroidgain=1,_rayleigh=0x7fad1903fda8,_bckgrdcalib=0x7fad1922a430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad19040048)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fb08,_ctrlden=0x7fad1a8378b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e25e50,_xlast=0x7fad18e1bf00,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a14f630,_signus=0x7fad18e17b30,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e18d00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a837378,yposition=
 0x7fad1903ffd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.35,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.907       84.1
Field Avg  2.20                     70.7   0.907       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849210)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18f0a0e0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e34c30,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c3e4030,_masks=0x0,_fluxpersub=0x7fad18e27020,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e273e0,_skyfluxpersub=0x7fad18e277a0,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00606514,-0.00153274],
 _lastvalidtt=[0.00606514,-0.00153274],_upttcommand=[0,0],_refmes=
 0x7fad1a830c30,_tiprefv=0x7fad1a82fc30,_tiltrefv=0x7fad19225a30,_tiprefvn=
 0x7fad1a804630,_tiltrefvn=0x7fad1922ee30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e25b90,_jstart=0x7fad18e353c0,
 _binindices=0x7fad1a13fc30,_binxy=2,_centroidw=0x7fad1903fa98,_fimage=
 0x7fad1914d630,_fimage2=0x0,_imistart=0x7fad18e26120,_imjstart=0x7fad18e264e0,
 _imistart2=0x7fad18e268a0,_imjstart2=0x7fad18e26c60,_unittip=0x7fad18e24330,
 _unittilt=0x7fad18e17b30,_lgs_defocuses=0x7fad1903fbe8,_unitdefocus=
 0x10b0db030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a149630,
 _flat=0x7fad1a14ce30,_domask=1,_submask=0x7fad1a14ee30,_kernel=0x7fad1a147c30,
 _kernels=0x10918c030,_kerfftr=0x109122030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1922fa30,_x=0x7fad1a139430,_y=0x7fad1a114e30,
 _centroidgain=1,_rayleigh=0x7fad1a837378,_bckgrdcalib=0x7fad1a14a830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838298)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837ab0,_ctrlden=0x7fad1903fcc8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5dff0,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad19116a30,
 0x7fad19116a30,0x7fad19116a30],_y0=0x7fad1922be30,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1e1f0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad1a838570,yposition=
 0x7fad1a837c38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       72.9   0.769       96.1
Field Avg  2.20                     72.9   0.769       96.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a848350,layerfrac=0x7fad1a8482c8,
 layerspeed=0x7fad1a848240,layeralt=0x7fad1a848460,winddir=0x7fad1a8483d8,
 _layeralt=0x7fad1a849870)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1903f868,lgs_prof_alt=0x7fad1a837d88,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e27b70,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c61ed0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1098b2030,_masks=0x0,_fluxpersub=0x7fad18d05a30,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d05df0,_skyfluxpersub=0x7fad18d061b0,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[-0.0098779,0.000570759],
 _lastvalidtt=[-0.0098779,0.000570759],_upttcommand=[0,0],_refmes=
 0x7fad1922aa30,_tiprefv=0x7fad1a832030,_tiltrefv=0x7fad19262e30,_tiprefvn=
 0x7fad1a82fc30,_tiltrefvn=0x7fad19225a30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c62dd0,_jstart=0x7fad18c63190,
 _binindices=0x7fad19232e30,_binxy=2,_centroidw=0x7fad1a8381f0,_fimage=
 0x7fad1a127230,_fimage2=0x0,_imistart=0x7fad18c63cd0,_imjstart=0x7fad18c64090,
 _imistart2=0x7fad18c64450,_imjstart2=0x7fad18c64810,_unittip=0x7fad18c496e0,
 _unittilt=0x7fad18c5de10,_lgs_defocuses=0x7fad1a8380a0,_unitdefocus=
 0x10af90030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19820c30,
 _flat=0x7fad1981fa30,_domask=1,_submask=0x7fad1981d030,_kernel=0x7fad19814430,
 _kernels=0x1093a3030,_kerfftr=0x1092b8030,_kerffti=0x10932e030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a12a830,_x=0x7fad19235430,_y=0x7fad192a2030,
 _centroidgain=1,_rayleigh=0x7fad1a838570,_bckgrdcalib=0x7fad19821e30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837d50)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903ffd8,_ctrlden=0x7fad1903fd70,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c61d50,_xlast=0x7fad18c5d9d0,_ylast=[0x7fad1922be30,
 0x7fad1922be30,0x7fad1922be30],_y0=0x7fad1922b230,_signus=0x7fad18c5db50,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c5e040,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a8386f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8380d8,xposition=0x7fad19040048,yposition=
 0x7fad1a837ce0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1a838068,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.45,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.954       78.1
Field Avg  2.20                     70.7   0.954       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849d38)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c4b590,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18f0c5d0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10abde030,_masks=0x0,_fluxpersub=0x7fad18f0e790,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0eb50,_skyfluxpersub=0x7fad18f0ef10,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[0.00104621,-0.00101827],
 _lastvalidtt=[0.00104621,-0.00101827],_upttcommand=[0,0],_refmes=
 0x7fad192a3030,_tiprefv=0x7fad19229830,_tiltrefv=0x7fad19227630,_tiprefvn=
 0x7fad19225a30,_tiltrefvn=0x7fad1922a430,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18f0c990,_jstart=0x7fad18f0cd50,
 _binindices=0x7fad1a85b030,_binxy=2,_centroidw=0x7fad19040048,_fimage=
 0x7fad1922f430,_fimage2=0x0,_imistart=0x7fad18f0d890,_imjstart=0x7fad18f0dc50,
 _imistart2=0x7fad18f0e010,_imjstart2=0x7fad18f0e3d0,_unittip=0x7fad18f0c170,
 _unittilt=0x7fad18f0c3a0,_lgs_defocuses=0x7fad1a838538,_unitdefocus=
 0x10a7dc030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a866830,
 _flat=0x7fad1a865630,_domask=1,_submask=0x7fad1a864e30,_kernel=0x7fad1a82da30,
 _kernels=0x10916c030,_kerfftr=0x10932e030,_kerffti=0x1092b8030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1928b230,_x=0x7fad1a82e230,_y=0x7fad1a832030,
 _centroidgain=1,_rayleigh=0x7fad1903fec0,_bckgrdcalib=0x7fad1a85fc30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838298)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8385a8,_ctrlden=0x7fad1a819a00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18f0bbf0,_xlast=0x7fad18f09130,_ylast=[0x7fad1a809630,
 0x7fad1a809630,0x7fad1a809630],_y0=0x7fad1a831430,_signus=0x7fad18f092b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10cce6030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c54910,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a8370d8,yposition=
 0x7fad1a837e30,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.954       78.1
Field Avg  2.20                     70.7   0.954       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849e48)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e24e00,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c4b590,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ad8e030,_masks=0x0,_fluxpersub=0x7fad18c61820,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c61be0,_skyfluxpersub=0x7fad18c61fa0,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[0.00116937,-0.00140992],
 _lastvalidtt=[0.00116937,-0.00140992],_upttcommand=[0,0],_refmes=
 0x7fad192a2e30,_tiprefv=0x7fad1928cc30,_tiltrefv=0x7fad1a113030,_tiprefvn=
 0x7fad19229830,_tiltrefvn=0x7fad1a113c30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c4b950,_jstart=0x7fad18c5ff60,
 _binindices=0x7fad19235430,_binxy=2,_centroidw=0x7fad1a8373b0,_fimage=
 0x7fad1a110a30,_fimage2=0x0,_imistart=0x7fad18c5f030,_imjstart=0x7fad18c60320,
 _imistart2=0x7fad18c610a0,_imjstart2=0x7fad18c61460,_unittip=0x7fad18c496e0,
 _unittilt=0x7fad18c0e7d0,_lgs_defocuses=0x7fad1a8376f8,_unitdefocus=
 0x10b8df030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a819e30,
 _flat=0x7fad1a82fc30,_domask=1,_submask=0x7fad192a3630,_kernel=0x7fad1928c230,
 _kernels=0x10916c030,_kerfftr=0x1093a3030,_kerffti=0x108e85030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a12c430,_x=0x7fad1914b230,_y=0x7fad19225a30,
 _centroidgain=1,_rayleigh=0x7fad1a8370d8,_bckgrdcalib=0x7fad1a82c830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838378)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad19040048,_ctrlden=0x7fad19040080,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c5f740,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad19116a30,
 0x7fad19116a30,0x7fad19116a30],_y0=0x7fad1922be30,_signus=0x7fad18c0b1f0,
 _puppixoffset=[0,0],_nact=80,_def=0x10ebe0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e21c00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a8380a0,yposition=
 0x7fad1a8378b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.25,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.954       78.1
Field Avg  2.20                     70.7   0.954       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a8497e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5ff60,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d06a50,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10af90030,_masks=0x0,_fluxpersub=0x7fad18f0c370,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0c730,_skyfluxpersub=0x7fad18f0caf0,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[3.86084e-05,6.1357e-05],
 _lastvalidtt=[3.86084e-05,6.1357e-05],_upttcommand=[0,0],_refmes=
 0x7fad1a11a830,_tiprefv=0x7fad1a12c430,_tiltrefv=0x7fad1a107430,_tiprefvn=
 0x7fad1a091630,_tiltrefvn=0x7fad1a113030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18d06e10,_jstart=0x7fad18d071d0,
 _binindices=0x7fad1a830c30,_binxy=2,_centroidw=0x7fad1a837148,_fimage=
 0x7fad19231630,_fimage2=0x0,_imistart=0x7fad18f08e70,_imjstart=0x7fad18f09230,
 _imistart2=0x7fad18f0bbf0,_imjstart2=0x7fad18f0bfb0,_unittip=0x7fad18d065f0,
 _unittilt=0x7fad18d06820,_lgs_defocuses=0x7fad1a837490,_unitdefocus=
 0x109a34030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a872c30,
 _flat=0x7fad1a819e30,_domask=1,_submask=0x7fad1a804630,_kernel=0x7fad1a832030,
 _kernels=0x10916c030,_kerfftr=0x109322030,_kerffti=0x1092b8030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19225a30,_x=0x7fad1981ec30,_y=0x7fad1981f430,
 _centroidgain=1,_rayleigh=0x7fad1a8380a0,_bckgrdcalib=0x7fad1a87ae30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fa28)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fa98,_ctrlden=0x7fad1a8373b0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18d04b20,_xlast=0x7fad18d061b0,_ylast=[0x7fad1980ae30,
 0x7fad1980ae30,0x7fad1980ae30],_y0=0x7fad19810430,_signus=0x7fad18d06330,
 _puppixoffset=[0,0],_nact=80,_def=0x10cce6030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c54910,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a838298,yposition=
 0x7fad1903fcc8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.954       78.1
Field Avg  2.20                     70.7   0.954       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849760)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e33a50,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18f0c380,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10b9e0030,_masks=0x0,_fluxpersub=0x7fad18d07670,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c5f030,_skyfluxpersub=0x7fad18c0b1f0,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[-0.000154846,8.05926e-05],
 _lastvalidtt=[-0.000154846,8.05926e-05],_upttcommand=[0,0],_refmes=
 0x7fad19232830,_tiprefv=0x7fad1922e230,_tiltrefv=0x7fad1a859030,_tiprefvn=
 0x7fad19249a30,_tiltrefvn=0x7fad1a832030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18f0c740,_jstart=0x7fad18f09d10,
 _binindices=0x7fad1914e030,_binxy=2,_centroidw=0x7fad1a838618,_fimage=
 0x7fad1a113030,_fimage2=0x0,_imistart=0x7fad18c58680,_imjstart=0x7fad18c58a40,
 _imistart2=0x7fad18c58e00,_imjstart2=0x7fad18c591c0,_unittip=0x7fad18d06fa0,
 _unittilt=0x7fad18d07440,_lgs_defocuses=0x7fad1a8370d8,_unitdefocus=
 0x109ec5030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a867e30,
 _flat=0x7fad19226c30,_domask=1,_submask=0x7fad19814430,_kernel=0x7fad1a831030,
 _kernels=0x1093f6030,_kerfftr=0x10938c030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a110c30,_x=0x7fad1a866630,_y=0x7fad1a866e30,
 _centroidgain=1,_rayleigh=0x7fad1a838298,_bckgrdcalib=0x7fad19231630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8385a8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838260,_ctrlden=0x7fad1a8384c8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e21c00,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a0fb430,_signus=0x7fad18e23f10,
 _puppixoffset=[0,0],_nact=80,_def=0x10ebe0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e23d90,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a838378,yposition=
 0x7fad1a838068,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.33,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.954       78.1
Field Avg  2.20                     70.7   0.954       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849078)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e249c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e236b0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109cc3030,_masks=0x0,_fluxpersub=0x7fad18c59890,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c59c50,_skyfluxpersub=0x7fad18c5a010,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[-0.00147984,-0.00208411],
 _lastvalidtt=[-0.00147984,-0.00208411],_upttcommand=[0,0],_refmes=
 0x7fad1a106230,_tiprefv=0x7fad1a107430,_tiltrefv=0x7fad1a091630,_tiprefvn=
 0x7fad1a105030,_tiltrefvn=0x7fad1a113030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e24de0,_jstart=0x7fad18e25e60,
 _binindices=0x7fad1a100830,_binxy=2,_centroidw=0x7fad1a838180,_fimage=
 0x7fad1a111430,_fimage2=0x0,_imistart=0x7fad18e26b80,_imjstart=0x7fad18e26f40,
 _imistart2=0x7fad18e27300,_imjstart2=0x7fad18e276c0,_unittip=0x7fad18e23f10,
 _unittilt=0x7fad18e22e70,_lgs_defocuses=0x7fad1a837148,_unitdefocus=
 0x1098b2030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19236430,
 _flat=0x7fad19229c30,_domask=1,_submask=0x7fad1914d630,_kernel=0x7fad19235430,
 _kernels=0x1092b8030,_kerfftr=0x10916c030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a110230,_x=0x7fad1a0eac30,_y=0x7fad1a13da30,
 _centroidgain=1,_rayleigh=0x7fad1a838378,_bckgrdcalib=0x7fad19237630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad19040048)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838458,_ctrlden=0x7fad1a8370d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e18170,_xlast=0x7fad18e1bf00,_ylast=[0x7fad1a0fb430,
 0x7fad1a0fb430,0x7fad1a0fb430],_y0=0x7fad1a108030,_signus=0x7fad18e24330,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c54910,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1903fa28,yposition=
 0x7fad1a819a00,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.35,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.945       84.1
Field Avg  2.20                     70.7   0.945       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849188)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c59500,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e23e40,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109bc2030,_masks=0x0,_fluxpersub=0x7fad18c4eaa0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c54140,_skyfluxpersub=0x7fad18c55bd0,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[-0.000290176,0.000959494],
 _lastvalidtt=[-0.000290176,0.000959494],_upttcommand=[0,0],_refmes=
 0x7fad19249630,_tiprefv=0x7fad19248430,_tiltrefv=0x7fad19243e30,_tiprefvn=
 0x7fad19233e30,_tiltrefvn=0x7fad19245630,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e23220,_jstart=0x7fad18e235e0,
 _binindices=0x7fad1922a230,_binxy=2,_centroidw=0x7fad1a8378b8,_fimage=
 0x7fad19237630,_fimage2=0x0,_imistart=0x7fad18c58680,_imjstart=0x7fad18c59140,
 _imistart2=0x7fad18c4e320,_imjstart2=0x7fad18c4e6e0,_unittip=0x7fad18e22e70,
 _unittilt=0x7fad18e18170,_lgs_defocuses=0x7fad1a838618,_unitdefocus=
 0x109dc4030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1922e230,
 _flat=0x7fad19226c30,_domask=1,_submask=0x7fad19244e30,_kernel=0x7fad1922aa30,
 _kernels=0x109398030,_kerfftr=0x10932e030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19225a30,_x=0x7fad1a0eac30,_y=0x7fad1a106230,
 _centroidgain=1,_rayleigh=0x7fad1903fa28,_bckgrdcalib=0x7fad1922f430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fa98)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837c38,_ctrlden=0x7fad1a838180,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c58fc0,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad1914e630,
 0x7fad1914e630,0x7fad1914e630],_y0=0x7fad19244a30,_signus=0x7fad18c58a40,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0e7d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a8385a8,yposition=
 0x7fad19040080,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    3224.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       73.2   0.762       96.1
Field Avg  2.20                     73.2   0.762       96.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a848928)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18d08b90,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18d05e90,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109a34030,_masks=0x0,_fluxpersub=0x7fad18d08050,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d08410,_skyfluxpersub=0x7fad18d087d0,
 _nphotons=3224.67,_skynphotons=0.0872713,_tt=[0.00772291,0.00733167],
 _lastvalidtt=[0.00772291,0.00733167],_upttcommand=[0,0],_refmes=0x7fad1a0fe230,
 _tiprefv=0x7fad1a113030,_tiltrefv=0x7fad1a102030,_tiprefvn=0x7fad1a104230,
 _tiltrefvn=0x7fad1a110c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7fad18d06250,_jstart=0x7fad18d06610,_binindices=
 0x7fad19814430,_binxy=2,_centroidw=0x7fad1903fd38,_fimage=0x7fad1981f230,
 _fimage2=0x0,_imistart=0x7fad18d07150,_imjstart=0x7fad18d07510,_imistart2=
 0x7fad18d078d0,_imjstart2=0x7fad18d07c90,_unittip=0x7fad18d05a30,_unittilt=
 0x7fad18d05c60,_lgs_defocuses=0x7fad1a837490,_unitdefocus=0x109643030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19828e30,_flat=
 0x7fad19825630,_domask=1,_submask=0x7fad19828630,_kernel=0x7fad19820a30,
 _kernels=0x1092b8030,_kerfftr=0x10916c030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19826830,_x=0x7fad1981e230,_y=0x7fad1981ea30,
 _centroidgain=1,_rayleigh=0x7fad1a8385a8,_bckgrdcalib=0x7fad1982a030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838260)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838618,_ctrlden=0x7fad1a837260,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e21c00,_xlast=0x7fad18e24070,_ylast=[0x7fad1a100030,
 0x7fad1a100030,0x7fad1a100030],_y0=0x7fad1a106830,_signus=0x7fad18e27820,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad19040048,yposition=
 0x7fad1a8373b0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.45,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0005,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a8494b8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c51ed0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c0b1f0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109ec5030,_masks=0x0,_fluxpersub=0x7fad18c4f5e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c4f9a0,_skyfluxpersub=0x7fad18c50120,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-0.00235659,0.000447756],
 _lastvalidtt=[-0.00235659,0.000447756],_upttcommand=[0,0],_refmes=
 0x7fad1a101630,_tiprefv=0x7fad19242a30,_tiltrefv=0x7fad19238830,_tiprefvn=
 0x7fad19239e30,_tiltrefvn=0x7fad19227430,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c4e320,_jstart=0x7fad18c4e6e0,
 _binindices=0x7fad19192830,_binxy=2,_centroidw=0x7fad1903f9b8,_fimage=
 0x7fad192a1030,_fimage2=0x0,_imistart=0x7fad18c4fd60,_imjstart=0x7fad18c54140,
 _imistart2=0x7fad18c4ee60,_imjstart2=0x7fad18c4f220,_unittip=0x7fad18c4bad0,
 _unittilt=0x7fad18c0e7d0,_lgs_defocuses=0x7fad1903fc20,_unitdefocus=
 0x10bce0030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1922a430,
 _flat=0x7fad19229230,_domask=1,_submask=0x7fad19242230,_kernel=0x7fad19225a30,
 _kernels=0x109398030,_kerfftr=0x10932e030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1929a430,_x=0x7fad19230430,_y=0x7fad1923aa30,
 _centroidgain=1,_rayleigh=0x7fad19040048,_bckgrdcalib=0x7fad19195a30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838458)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fda8,_ctrlden=0x7fad1903fd38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e25e00,_xlast=0x7fad18e21c00,_ylast=[0x7fad1a106830,
 0x7fad1a106830,0x7fad1a106830],_y0=0x7fad1a109e30,_signus=0x7fad18e229d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c54910,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1903fa98,yposition=
 0x7fad1a8384c8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a848d48)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c4b590,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e25850,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1098b2030,_masks=0x0,_fluxpersub=0x7fad18e26ed0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e27290,_skyfluxpersub=0x7fad18e27650,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-0.00109618,0.000117845],
 _lastvalidtt=[-0.00109618,0.000117845],_upttcommand=[0,0],_refmes=
 0x7fad1a13fc30,_tiprefv=0x7fad1a0fda30,_tiltrefv=0x7fad1a104c30,_tiprefvn=
 0x7fad1a102a30,_tiltrefvn=0x7fad1a100030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e23a60,_jstart=0x7fad18e23e20,
 _binindices=0x7fad1a100c30,_binxy=2,_centroidw=0x7fad1a838148,_fimage=
 0x7fad19226230,_fimage2=0x0,_imistart=0x7fad18e25fd0,_imjstart=0x7fad18e26390,
 _imistart2=0x7fad18e26750,_imjstart2=0x7fad18e26b10,_unittip=0x7fad18c496e0,
 _unittilt=0x7fad18c4ec20,_lgs_defocuses=0x7fad1903fcc8,_unitdefocus=
 0x10c3e4030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a113630,
 _flat=0x7fad1a112430,_domask=1,_submask=0x7fad1a0fc830,_kernel=0x7fad1a0ff830,
 _kernels=0x1092b8030,_kerfftr=0x10916c030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19231630,_x=0x7fad1a105830,_y=0x7fad1a106030,
 _centroidgain=1,_rayleigh=0x7fad1903fa98,_bckgrdcalib=0x7fad1a147c30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837c38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837e30,_ctrlden=0x7fad1903f9b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cbd0,_xlast=0x7fad18c0e7d0,_ylast=[0x7fad1914ba30,
 0x7fad1914ba30,0x7fad1914ba30],_y0=0x7fad1922be30,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a838260,yposition=
 0x7fad1a8370d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.25,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849540)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5dda0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e23590,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109dc4030,_masks=0x0,_fluxpersub=0x7fad18f08ff0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f093b0,_skyfluxpersub=0x7fad18f0bbf0,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-0.000974562,0.000932536],
 _lastvalidtt=[-0.000974562,0.000932536],_upttcommand=[0,0],_refmes=
 0x7fad1a13fc30,_tiprefv=0x7fad1a12de30,_tiltrefv=0x7fad1a101c30,_tiprefvn=
 0x7fad1a0fda30,_tiltrefvn=0x7fad1a104c30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e255c0,_jstart=0x7fad18e25980,
 _binindices=0x7fad1a0ffe30,_binxy=2,_centroidw=0x7fad1a838378,_fimage=
 0x7fad1922a430,_fimage2=0x0,_imistart=0x7fad18e24e00,_imjstart=0x7fad18e251c0,
 _imistart2=0x7fad18e25d40,_imjstart2=0x7fad18e26100,_unittip=0x7fad18e23130,
 _unittilt=0x7fad18e23360,_lgs_defocuses=0x7fad1a837bc8,_unitdefocus=
 0x10b0db030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a85ba30,
 _flat=0x7fad1a85a830,_domask=1,_submask=0x7fad1a819e30,_kernel=0x7fad1a832030,
 _kernels=0x109398030,_kerfftr=0x10932e030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19226c30,_x=0x7fad1a102830,_y=0x7fad1a0fc830,
 _centroidgain=1,_rayleigh=0x7fad1a838260,_bckgrdcalib=0x7fad1a82fc30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838618)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fec0,_ctrlden=0x7fad1a8376f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e21c00,_xlast=0x7fad18e18170,_ylast=[0x7fad1a115830,
 0x7fad1a115830,0x7fad1a115830],_y0=0x7fad1a109e30,_signus=0x7fad18e22e70,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1d510,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a838458,yposition=
 0x7fad1a838180,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.947       78.1
Field Avg  2.20                     70.7   0.947       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849320)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e25140,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e249b0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109643030,_masks=0x0,_fluxpersub=0x7fad18d07e50,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d08210,_skyfluxpersub=0x7fad18d085d0,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[0.00118958,0.000377179],
 _lastvalidtt=[0.00118958,0.000377179],_upttcommand=[0,0],_refmes=
 0x7fad19195430,_tiprefv=0x7fad19194230,_tiltrefv=0x7fad19226c30,_tiprefvn=
 0x7fad1922e230,_tiltrefvn=0x7fad19230030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e26c40,_jstart=0x7fad18e27000,
 _binindices=0x7fad19814430,_binxy=2,_centroidw=0x7fad1a8385a8,_fimage=
 0x7fad1922ee30,_fimage2=0x0,_imistart=0x7fad18d06f50,_imjstart=0x7fad18d07310,
 _imistart2=0x7fad18d076d0,_imjstart2=0x7fad18d07a90,_unittip=0x7fad18e18170,
 _unittilt=0x7fad18e24330,_lgs_defocuses=0x7fad1903fa98,_unitdefocus=
 0x10abde030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19848c30,
 _flat=0x7fad19847a30,_domask=1,_submask=0x7fad19847230,_kernel=0x7fad1981d030,
 _kernels=0x1092b8030,_kerfftr=0x10916c030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1914d630,_x=0x7fad1a113030,_y=0x7fad1a091630,
 _centroidgain=1,_rayleigh=0x7fad1a838458,_bckgrdcalib=0x7fad19841e30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fda8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838068,_ctrlden=0x7fad1a838378,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c54910,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad19116a30,
 0x7fad19116a30,0x7fad19116a30],_y0=0x7fad1914ba30,_signus=0x7fad18c5f740,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d04b20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a837c38,yposition=
 0x7fad1a837260,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.33,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.946       84.1
Field Avg  2.20                     70.7   0.946       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a848ff0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e34bc0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c582c0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10bce0030,_masks=0x0,_fluxpersub=0x7fad18f0bfb0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0c370,_skyfluxpersub=0x7fad18f0c730,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-0.00046431,0.00174996],
 _lastvalidtt=[-0.00046431,0.00174996],_upttcommand=[0,0],_refmes=
 0x7fad192a8230,_tiprefv=0x7fad192ac230,_tiltrefv=0x7fad19194e30,_tiprefvn=
 0x7fad19194230,_tiltrefvn=0x7fad19226c30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c4b590,_jstart=0x7fad18c4b950,
 _binindices=0x7fad1a830c30,_binxy=2,_centroidw=0x7fad1903fcc8,_fimage=
 0x7fad1922e230,_fimage2=0x0,_imistart=0x7fad18f0a490,_imjstart=0x7fad18f08e70,
 _imistart2=0x7fad18f09230,_imjstart2=0x7fad18f0bbf0,_unittip=0x7fad18c0e7d0,
 _unittilt=0x7fad18c5f260,_lgs_defocuses=0x7fad19035830,_unitdefocus=
 0x10ad8e030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a82da30,
 _flat=0x7fad1a82c830,_domask=1,_submask=0x7fad1a85a230,_kernel=0x7fad1a832030,
 _kernels=0x109398030,_kerfftr=0x10932e030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad192a6c30,_x=0x7fad19232630,_y=0x7fad19232e30,
 _centroidgain=1,_rayleigh=0x7fad1a837c38,_bckgrdcalib=0x7fad1a85d230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837e30)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837c00,_ctrlden=0x7fad1a8385a8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e18170,_xlast=0x7fad18e24ac0,_ylast=[0x7fad1a139c30,
 0x7fad1a139c30,0x7fad1a139c30],_y0=0x7fad1a109e30,_signus=0x7fad18e25f00,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18f095f0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a838618,yposition=
 0x7fad1903fd38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.35,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.936       84.1
Field Avg  2.20                     70.7   0.936       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a848570)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5dda0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c657a0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c3e4030,_masks=0x0,_fluxpersub=0x7fad18e28fe0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e293a0,_skyfluxpersub=0x7fad18e29760,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[0.000164921,6.84981e-05],
 _lastvalidtt=[0.000164921,6.84981e-05],_upttcommand=[0,0],_refmes=
 0x7fad1a13da30,_tiprefv=0x7fad192a7430,_tiltrefv=0x7fad1a0fda30,_tiprefvn=
 0x7fad192ac230,_tiltrefvn=0x7fad1a147c30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c5ff60,_jstart=0x7fad18c60320,
 _binindices=0x7fad192aba30,_binxy=2,_centroidw=0x7fad1903fc58,_fimage=
 0x7fad1922a430,_fimage2=0x0,_imistart=0x7fad18c60e60,_imjstart=0x7fad18c61220,
 _imistart2=0x7fad18c615e0,_imjstart2=0x7fad18c619a0,_unittip=0x7fad18c0e7d0,
 _unittilt=0x7fad18c65570,_lgs_defocuses=0x7fad1a8378b8,_unitdefocus=
 0x10af90030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a114630,
 _flat=0x7fad1a0fc830,_domask=1,_submask=0x7fad1a13fc30,_kernel=0x7fad1a091630,
 _kernels=0x1092b8030,_kerfftr=0x10916c030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad192b1c30,_x=0x7fad19231630,_y=0x7fad192a8030,
 _centroidgain=1,_rayleigh=0x7fad1a838618,_bckgrdcalib=0x7fad1a0fe630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fec0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad19040080,_ctrlden=0x7fad1903fcc8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c54450,_xlast=0x7fad18c0d030,_ylast=[0x7fad19233230,
 0x7fad19233230,0x7fad19233230],_y0=0x7fad192a7030,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c54910,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1903fda8,yposition=
 0x7fad1903f9b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       72.0   0.793       90.1
Field Avg  2.20                     72.0   0.793       90.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849a08)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e26ef0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e245f0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10b0db030,_masks=0x0,_fluxpersub=0x7fad18c615e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c619a0,_skyfluxpersub=0x7fad18c60320,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[0.00194287,0.00381647],
 _lastvalidtt=[0.00194287,0.00381647],_upttcommand=[0,0],_refmes=0x7fad1981d030,
 _tiprefv=0x7fad192ace30,_tiltrefv=0x7fad192b3630,_tiprefvn=0x7fad192a7430,
 _tiltrefvn=0x7fad192ac230,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7fad18e249b0,_jstart=0x7fad18e25d80,_binindices=
 0x7fad192b2e30,_binxy=2,_centroidw=0x7fad1a838260,_fimage=0x7fad1a0ffe30,
 _fimage2=0x0,_imistart=0x7fad18c5ff60,_imjstart=0x7fad18c61d60,_imistart2=
 0x7fad18c60e60,_imjstart2=0x7fad18c61220,_unittip=0x7fad18e229d0,_unittilt=
 0x7fad18e256f0,_lgs_defocuses=0x7fad1a8380a0,_unitdefocus=0x10b9e0030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19229a30,_flat=
 0x7fad192aa830,_domask=1,_submask=0x7fad19193430,_kernel=0x7fad1914d630,
 _kernels=0x109398030,_kerfftr=0x10932e030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a0fc830,_x=0x7fad1a13da30,_y=0x7fad1a12c830,
 _centroidgain=1,_rayleigh=0x7fad1903fda8,_bckgrdcalib=0x7fad19226830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838068)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8373b0,_ctrlden=0x7fad1903fc58,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e21c00,_xlast=0x7fad18e18170,_ylast=[0x7fad1a139c30,
 0x7fad1a139c30,0x7fad1a139c30],_y0=0x7fad1a115830,_signus=0x7fad18e25170,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0d030,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a837e30,yposition=
 0x7fad1a8376f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.45,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.943       84.1
Field Avg  2.20                     70.7   0.943       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a8489b0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e282c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e26e20,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10abde030,_masks=0x0,_fluxpersub=0x7fad18f08e70,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f09230,_skyfluxpersub=0x7fad18f09d10,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00712737,9.89307e-05],
 _lastvalidtt=[0.00712737,9.89307e-05],_upttcommand=[0,0],_refmes=
 0x7fad19230230,_tiprefv=0x7fad19233e30,_tiltrefv=0x7fad192a5e30,_tiprefvn=
 0x7fad192ace30,_tiltrefvn=0x7fad192b3630,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e266a0,_jstart=0x7fad18e245f0,
 _binindices=0x7fad1a0fe230,_binxy=2,_centroidw=0x7fad1a838458,_fimage=
 0x7fad1a110c30,_fimage2=0x0,_imistart=0x7fad18e25130,_imjstart=0x7fad18e254f0,
 _imistart2=0x7fad18e258b0,_imjstart2=0x7fad18e26a60,_unittip=0x7fad18e18170,
 _unittilt=0x7fad18e275c0,_lgs_defocuses=0x7fad1a8375e0,_unitdefocus=
 0x109cc3030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a865a30,
 _flat=0x7fad1a82d030,_domask=1,_submask=0x7fad1a832030,_kernel=0x7fad1a830c30,
 _kernels=0x1092b8030,_kerfftr=0x10916c030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a111e30,_x=0x7fad1a106430,_y=0x7fad1a107c30,
 _centroidgain=1,_rayleigh=0x7fad1a837e30,_bckgrdcalib=0x7fad1a866c30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837c00)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837df8,_ctrlden=0x7fad1a838260,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c54910,_xlast=0x7fad18c0e7d0,_ylast=[0x7fad192b4230,
 0x7fad192b4230,0x7fad192b4230],_y0=0x7fad19230a30,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0b5d0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1903fec0,yposition=
 0x7fad1a838378,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.944       84.1
Field Avg  2.20                     70.7   0.944       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a848dd0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5a2c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e27f00,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10ad8e030,_masks=0x0,_fluxpersub=0x7fad18d05a30,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f09d10,_skyfluxpersub=0x7fad18f0a0d0,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00624172,0.000246583],
 _lastvalidtt=[0.00624172,0.000246583],_upttcommand=[0,0],_refmes=
 0x7fad1a100a30,_tiprefv=0x7fad1a102e30,_tiltrefv=0x7fad1a110c30,_tiprefvn=
 0x7fad1a116430,_tiltrefvn=0x7fad1a118830,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e261b0,_jstart=0x7fad18e26cf0,
 _binindices=0x7fad1a105430,_binxy=2,_centroidw=0x7fad1a837c38,_fimage=
 0x7fad1919f230,_fimage2=0x0,_imistart=0x7fad18e270b0,_imjstart=0x7fad18e288c0,
 _imistart2=0x7fad18e24fd0,_imjstart2=0x7fad18e25390,_unittip=0x7fad18e28690,
 _unittilt=0x7fad18e25f80,_lgs_defocuses=0x7fad1903fad0,_unitdefocus=
 0x109bc2030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a82fc30,
 _flat=0x7fad1a819e30,_domask=1,_submask=0x7fad19814430,_kernel=0x7fad1914d630,
 _kernels=0x109398030,_kerfftr=0x10932e030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19231e30,_x=0x7fad1a114630,_y=0x7fad1a117030,
 _centroidgain=1,_rayleigh=0x7fad1903fec0,_bckgrdcalib=0x7fad1a82c830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad19040080)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838148,_ctrlden=0x7fad1a838458,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cbd0,_xlast=0x7fad18c54910,_ylast=[0x7fad19230a30,
 0x7fad19230a30,0x7fad19230a30],_y0=0x7fad1914e630,_signus=0x7fad18c5f740,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a838068,yposition=
 0x7fad1a8385a8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.25,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.942       84.1
Field Avg  2.20                     70.7   0.942       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a8498f8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5c890,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e1e040,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10af90030,_masks=0x0,_fluxpersub=0x7fad18c5acf0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c5bd40,_skyfluxpersub=0x7fad18c5c100,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00533284,0.000771942],
 _lastvalidtt=[0.00533284,0.000771942],_upttcommand=[0,0],_refmes=
 0x7fad19227e30,_tiprefv=0x7fad19821630,_tiltrefv=0x7fad1a116430,_tiprefvn=
 0x7fad19822230,_tiltrefvn=0x7fad1a110c30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e25230,_jstart=0x7fad18e255f0,
 _binindices=0x7fad19814430,_binxy=2,_centroidw=0x7fad1a838618,_fimage=
 0x7fad191a8230,_fimage2=0x0,_imistart=0x7fad18d06df0,_imjstart=0x7fad18d071b0,
 _imistart2=0x7fad18d07570,_imjstart2=0x7fad18d07930,_unittip=0x7fad18e1de10,
 _unittilt=0x7fad18e18170,_lgs_defocuses=0x7fad1a837e30,_unitdefocus=
 0x109a34030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1922e230,
 _flat=0x7fad19231e30,_domask=1,_submask=0x7fad19233e30,_kernel=0x7fad1914d630,
 _kernels=0x1092b8030,_kerfftr=0x10916c030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad191a4c30,_x=0x7fad1a0fc830,_y=0x7fad1a13fc30,
 _centroidgain=1,_rayleigh=0x7fad1a838068,_bckgrdcalib=0x7fad19229230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8373b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838180,_ctrlden=0x7fad1a837c38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0c280,_xlast=0x7fad18c0cbd0,_ylast=[0x7fad1914e630,
 0x7fad1914e630,0x7fad1914e630],_y0=0x7fad19228630,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d04b20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a837c00,yposition=
 0x7fad1903fcc8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.938       84.1
Field Avg  2.20                     70.7   0.938       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a848790)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5eb80,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c4b590,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10b9e0030,_masks=0x0,_fluxpersub=0x7fad18d05a30,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18d05df0,_skyfluxpersub=0x7fad18d061b0,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00481132,0.00047929],
 _lastvalidtt=[0.00481132,0.00047929],_upttcommand=[0,0],_refmes=0x7fad1a106430,
 _tiprefv=0x7fad1a0ff830,_tiltrefv=0x7fad1a0fec30,_tiprefvn=0x7fad1a100430,
 _tiltrefvn=0x7fad1a116430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7fad18c4b950,_jstart=0x7fad18c5b470,_binindices=
 0x7fad1a118030,_binxy=2,_centroidw=0x7fad1903fda8,_fimage=0x7fad19226230,
 _fimage2=0x0,_imistart=0x7fad18e1de10,_imjstart=0x7fad18e22e70,_imistart2=
 0x7fad18e23230,_imjstart2=0x7fad18e235f0,_unittip=0x7fad18c0b5d0,_unittilt=
 0x7fad18c0e7d0,_lgs_defocuses=0x7fad1a8370d8,_unitdefocus=0x109ec5030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1986b430,_flat=
 0x7fad1986a230,_domask=1,_submask=0x7fad1981d030,_kernel=0x7fad19814430,
 _kernels=0x109398030,_kerfftr=0x10932e030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19285c30,_x=0x7fad19232c30,_y=0x7fad19227c30,
 _centroidgain=1,_rayleigh=0x7fad1a837c00,_bckgrdcalib=0x7fad1981e230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837df8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837e30,_ctrlden=0x7fad1903fb08,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e18170,_xlast=0x7fad18e229d0,_ylast=[0x7fad1a101030,
 0x7fad1a101030,0x7fad1a101030],_y0=0x7fad1a115830,_signus=0x7fad18e24f90,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d06570,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad19040080,yposition=
 0x7fad1903fc58,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.33,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.934       84.1
Field Avg  2.20                     70.7   0.934       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849ba0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c610a0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c5eb80,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109cc3030,_masks=0x0,_fluxpersub=0x7fad18f0bfb0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18f0c370,_skyfluxpersub=0x7fad18f0c730,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00480531,0.00162243],
 _lastvalidtt=[0.00480531,0.00162243],_upttcommand=[0,0],_refmes=0x7fad1a106430,
 _tiprefv=0x7fad1a0fc830,_tiltrefv=0x7fad1a127c30,_tiprefvn=0x7fad1a0ff830,
 _tiltrefvn=0x7fad1a0fec30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7fad18c54140,_jstart=0x7fad18c5ff60,_binindices=
 0x7fad1a830c30,_binxy=2,_centroidw=0x7fad1903f9f0,_fimage=0x7fad1981e230,
 _fimage2=0x0,_imistart=0x7fad18f0a490,_imjstart=0x7fad18f08e70,_imistart2=
 0x7fad18f09230,_imjstart2=0x7fad18f0bbf0,_unittip=0x7fad18c0e7d0,_unittilt=
 0x7fad18c0c280,_lgs_defocuses=0x7fad1a8376c0,_unitdefocus=0x1098b2030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a85a030,_flat=
 0x7fad1a819e30,_domask=1,_submask=0x7fad1a804630,_kernel=0x7fad1a832030,
 _kernels=0x1092b8030,_kerfftr=0x10916c030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19820430,_x=0x7fad1922a030,_y=0x7fad19233e30,
 _centroidgain=1,_rayleigh=0x7fad19040080,_bckgrdcalib=0x7fad1a85b230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838148)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837768,_ctrlden=0x7fad1a8384c8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e21c00,_xlast=0x7fad18e22b50,_ylast=[0x7fad1a115830,
 0x7fad1a115830,0x7fad1a115830],_y0=0x7fad1a112c30,_signus=0x7fad18e26d50,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c54910,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a8373b0,yposition=
 0x7fad1a838260,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.35,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.904       84.1
Field Avg  2.20                     70.7   0.904       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a8485f8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e23d70,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18f0a330,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109bc2030,_masks=0x0,_fluxpersub=0x7fad18c5eb80,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c570b0,_skyfluxpersub=0x7fad18c57470,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[0.00526486,7.97918e-05],
 _lastvalidtt=[0.00526486,7.97918e-05],_upttcommand=[0,0],_refmes=
 0x7fad1a113030,_tiprefv=0x7fad1a12de30,_tiltrefv=0x7fad1a14a030,_tiprefvn=
 0x7fad1a0fc830,_tiltrefvn=0x7fad1a127c30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18f0bbf0,_jstart=0x7fad18f0bfb0,
 _binindices=0x7fad1a831030,_binxy=2,_centroidw=0x7fad1a8385a8,_fimage=
 0x7fad19229a30,_fimage2=0x0,_imistart=0x7fad18f0c370,_imjstart=0x7fad18f0c730,
 _imistart2=0x7fad18f0d110,_imjstart2=0x7fad18f0d4d0,_unittip=0x7fad18d05bb0,
 _unittilt=0x7fad18d05de0,_lgs_defocuses=0x7fad1a837c00,_unitdefocus=
 0x109dc4030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1922e230,
 _flat=0x7fad19231e30,_domask=1,_submask=0x7fad19229230,_kernel=0x7fad19233e30,
 _kernels=0x109398030,_kerfftr=0x10932e030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19193030,_x=0x7fad1a81a630,_y=0x7fad1a859030,
 _centroidgain=1,_rayleigh=0x7fad1a8373b0,_bckgrdcalib=0x7fad192b2630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a838180)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903f9b8,_ctrlden=0x7fad1903f9f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0cbd0,_xlast=0x7fad18c0e7d0,_ylast=[0x7fad1914e630,
 0x7fad1914e630,0x7fad1914e630],_y0=0x7fad19230a30,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0d030,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a837df8,yposition=
 0x7fad1a838458,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    9674.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       71.6   0.763       96.1
Field Avg  2.20                     71.6   0.763       96.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a8488a0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e1f050,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e23b90,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109a34030,_masks=0x0,_fluxpersub=0x7fad18e26460,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e26820,_skyfluxpersub=0x7fad18e26be0,
 _nphotons=9674.02,_skynphotons=0.261814,_tt=[-0.000475548,0.00422603],
 _lastvalidtt=[-0.000475548,0.00422603],_upttcommand=[0,0],_refmes=
 0x7fad1919c630,_tiprefv=0x7fad1919ce30,_tiltrefv=0x7fad19193030,_tiprefvn=
 0x7fad19233e30,_tiltrefvn=0x7fad1919ec30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e24660,_jstart=0x7fad18e24a20,
 _binindices=0x7fad1a107c30,_binxy=2,_centroidw=0x7fad1903fd38,_fimage=
 0x7fad1a111830,_fimage2=0x0,_imistart=0x7fad18e25560,_imjstart=0x7fad18e25920,
 _imistart2=0x7fad18e25ce0,_imjstart2=0x7fad18e260a0,_unittip=0x7fad18e1e8d0,
 _unittilt=0x7fad18e23960,_lgs_defocuses=0x7fad1a8375e0,_unitdefocus=
 0x109643030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a116430,
 _flat=0x7fad1a0ffe30,_domask=1,_submask=0x7fad1a0fe030,_kernel=0x7fad1a830c30,
 _kernels=0x1092b8030,_kerfftr=0x10916c030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a112a30,_x=0x7fad1a13da30,_y=0x7fad1a0fee30,
 _centroidgain=1,_rayleigh=0x7fad1a837df8,_bckgrdcalib=0x7fad1a117630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837e30)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8376f8,_ctrlden=0x7fad1a838538,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e21c00,_xlast=0x7fad18e18170,_ylast=[0x7fad1a115830,
 0x7fad1a115830,0x7fad1a115830],_y0=0x7fad1a0fea30,_signus=0x7fad18e1e140,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e1bf00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a838148,yposition=
 0x7fad1a837c38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.45,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.0015,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.937       84.1
Field Avg  2.20                     70.7   0.937       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849dc0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c58a70,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e1de10,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109ec5030,_masks=0x0,_fluxpersub=0x7fad18c0b1f0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c5d9d0,_skyfluxpersub=0x7fad18c5eb80,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00463394,-0.00194174],
 _lastvalidtt=[0.00463394,-0.00194174],_upttcommand=[0,0],_refmes=
 0x7fad1922a230,_tiprefv=0x7fad1a0fda30,_tiltrefv=0x7fad1a12de30,_tiprefvn=
 0x7fad1a116430,_tiltrefvn=0x7fad1a0fee30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e22e70,_jstart=0x7fad18e23230,
 _binindices=0x7fad1a115430,_binxy=2,_centroidw=0x7fad1a8370d8,_fimage=
 0x7fad1a819e30,_fimage2=0x0,_imistart=0x7fad18e1f050,_imjstart=0x7fad18e24330,
 _imistart2=0x7fad18e246f0,_imjstart2=0x7fad18e24ab0,_unittip=0x7fad18e18170,
 _unittilt=0x7fad18e229d0,_lgs_defocuses=0x7fad1a838260,_unitdefocus=
 0x10bce0030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19227430,
 _flat=0x7fad19226230,_domask=1,_submask=0x7fad19195630,_kernel=0x7fad1a11a430,
 _kernels=0x109398030,_kerfftr=0x10932e030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a82c830,_x=0x7fad1a106430,_y=0x7fad1a107c30,
 _centroidgain=1,_rayleigh=0x7fad1a838148,_bckgrdcalib=0x7fad19196630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837768)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a8375e0,_ctrlden=0x7fad1903ffd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c0e7d0,_xlast=0x7fad18c0b5b0,_ylast=[0x7fad19230a30,
 0x7fad19230a30,0x7fad19230a30],_y0=0x7fad1914e630,_signus=0x7fad18c496e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c54910,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a838180,yposition=
 0x7fad1903fb08,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.2,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.941       84.1
Field Avg  2.20                     70.7   0.941       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849650)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e1de10,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c5a1e0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x1098b2030,_masks=0x0,_fluxpersub=0x7fad18c58980,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c58d40,_skyfluxpersub=0x7fad18c59100,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00439555,-0.00155301],
 _lastvalidtt=[0.00439555,-0.00155301],_upttcommand=[0,0],_refmes=
 0x7fad1a119430,_tiprefv=0x7fad1a120030,_tiltrefv=0x7fad1a11f430,_tiprefvn=
 0x7fad1a0fda30,_tiltrefvn=0x7fad1a12de30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c5b260,_jstart=0x7fad18c5b620,
 _binindices=0x7fad1922e230,_binxy=2,_centroidw=0x7fad1a837bc8,_fimage=
 0x7fad1a0fc830,_fimage2=0x0,_imistart=0x7fad18c5c160,_imjstart=0x7fad18c5c520,
 _imistart2=0x7fad18c5c8e0,_imjstart2=0x7fad18c585c0,_unittip=0x7fad18c496e0,
 _unittilt=0x7fad18c5f740,_lgs_defocuses=0x7fad1903fbe8,_unitdefocus=
 0x10c3e4030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad19198030,
 _flat=0x7fad19196e30,_domask=1,_submask=0x7fad19196630,_kernel=0x7fad1929f630,
 _kernels=0x1092b8030,_kerfftr=0x10916c030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a116430,_x=0x7fad19193a30,_y=0x7fad19194230,
 _centroidgain=1,_rayleigh=0x7fad1a838180,_bckgrdcalib=0x7fad19199230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903f9b8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837730,_ctrlden=0x7fad1a8370d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c4bad0,_xlast=0x7fad18c0e7d0,_ylast=[0x7fad1914e630,
 0x7fad1914e630,0x7fad1914e630],_y0=0x7fad19116a30,_signus=0x7fad18c0c280,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c59c50,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a837e30,yposition=
 0x7fad1a8384c8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.25,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.940       84.1
Field Avg  2.20                     70.7   0.940       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a848708)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c5a1c0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18c0b1f0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109dc4030,_masks=0x0,_fluxpersub=0x7fad18c5b3f0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18c58580,_skyfluxpersub=0x7fad18c58940,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00406534,-0.00187548],
 _lastvalidtt=[0.00406534,-0.00187548],_upttcommand=[0,0],_refmes=
 0x7fad192a3c30,_tiprefv=0x7fad192a2c30,_tiltrefv=0x7fad192b3830,_tiprefvn=
 0x7fad19192830,_tiltrefvn=0x7fad19232a30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18c4b590,_jstart=0x7fad18c50ef0,
 _binindices=0x7fad1922a230,_binxy=2,_centroidw=0x7fad19040080,_fimage=
 0x7fad191e5630,_fimage2=0x0,_imistart=0x7fad18c51670,_imjstart=0x7fad18c5a8b0,
 _imistart2=0x7fad18c5ac70,_imjstart2=0x7fad18c5b030,_unittip=0x7fad18c0e7d0,
 _unittilt=0x7fad18c54140,_lgs_defocuses=0x7fad1903fd38,_unitdefocus=
 0x10b0db030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad191e7a30,
 _flat=0x7fad191e6830,_domask=1,_submask=0x7fad1922e230,_kernel=0x7fad192b3030,
 _kernels=0x109398030,_kerfftr=0x10932e030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad192a1a30,_x=0x7fad1929c230,_y=0x7fad19228030,
 _centroidgain=1,_rayleigh=0x7fad1a837e30,_bckgrdcalib=0x7fad192a4c30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8376f8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a837bc8,_ctrlden=0x7fad1a837c38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18c4b950,_xlast=0x7fad18c54910,_ylast=[0x7fad19116a30,
 0x7fad19116a30,0x7fad19116a30],_y0=0x7fad192a3830,_signus=0x7fad18c582c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c0cbd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a837768,yposition=
 0x7fad1903f9f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.936       84.1
Field Avg  2.20                     70.7   0.936       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a8484e8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c4e320,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e23e80,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x109643030,_masks=0x0,_fluxpersub=0x7fad18e25470,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e25830,_skyfluxpersub=0x7fad18e25bf0,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00559412,-0.00152623],
 _lastvalidtt=[0.00559412,-0.00152623],_upttcommand=[0,0],_refmes=
 0x7fad1a106430,_tiprefv=0x7fad19825430,_tiltrefv=0x7fad19822030,_tiprefvn=
 0x7fad19826030,_tiltrefvn=0x7fad19824230,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e24cf0,_jstart=0x7fad18e250b0,
 _binindices=0x7fad1981d030,_binxy=2,_centroidw=0x7fad1a838148,_fimage=
 0x7fad1922e230,_fimage2=0x0,_imistart=0x7fad18d06e00,_imjstart=0x7fad18d071c0,
 _imistart2=0x7fad18d07580,_imjstart2=0x7fad18d07940,_unittip=0x7fad18e24330,
 _unittilt=0x7fad18e23c50,_lgs_defocuses=0x7fad1a838180,_unitdefocus=
 0x10abde030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a128e30,
 _flat=0x7fad1a127030,_domask=1,_submask=0x7fad1a126830,_kernel=0x7fad1a832030,
 _kernels=0x1092b8030,_kerfftr=0x10916c030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19231e30,_x=0x7fad1a13da30,_y=0x7fad1a115230,
 _centroidgain=1,_rayleigh=0x7fad1a837768,_bckgrdcalib=0x7fad1a12a030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a8375e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fc58,_ctrlden=0x7fad1a837df8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e18170,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a113a30,_signus=0x7fad18e1e120,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e21c00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1903f9b8,yposition=
 0x7fad1a838538,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.33,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.932       84.1
Field Avg  2.20                     70.7   0.932       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a8495c8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c58690,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e1de10,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10bce0030,_masks=0x0,_fluxpersub=0x7fad18e239b0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e23d70,_skyfluxpersub=0x7fad18e25230,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00643125,-0.00107243],
 _lastvalidtt=[0.00643125,-0.00107243],_upttcommand=[0,0],_refmes=
 0x7fad1a105430,_tiprefv=0x7fad1929ca30,_tiltrefv=0x7fad1922e230,_tiprefvn=
 0x7fad1929d630,_tiltrefvn=0x7fad19227a30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e22e70,_jstart=0x7fad18e23230,
 _binindices=0x7fad1a13fc30,_binxy=2,_centroidw=0x7fad19040048,_fimage=
 0x7fad19231e30,_fimage2=0x0,_imistart=0x7fad18e25d90,_imjstart=0x7fad18e24e70,
 _imistart2=0x7fad18e1e8d0,_imjstart2=0x7fad18e235f0,_unittip=0x7fad18e18170,
 _unittilt=0x7fad18e246f0,_lgs_defocuses=0x7fad1903fda8,_unitdefocus=
 0x10ad8e030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a116430,
 _flat=0x7fad1a104230,_domask=1,_submask=0x7fad1a12ce30,_kernel=0x7fad1a102c30,
 _kernels=0x109398030,_kerfftr=0x10932e030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19193830,_x=0x7fad1a101c30,_y=0x7fad1a102430,
 _centroidgain=1,_rayleigh=0x7fad1903f9b8,_bckgrdcalib=0x7fad1a117630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837730)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838180,_ctrlden=0x7fad1a838618,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18f09d10,_xlast=0x7fad18f09e90,_ylast=[0x7fad1a845830,
 0x7fad1a845830,0x7fad1a845830],_y0=0x7fad1a809630,_signus=0x7fad18f0a010,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18d04b20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a8376f8,yposition=
 0x7fad1903ffd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.35,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.907       84.1
Field Avg  2.20                     70.7   0.907       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a849b18)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18c585d0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e2bdf0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10c3e4030,_masks=0x0,_fluxpersub=0x7fad18e1e8d0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e260a0,_skyfluxpersub=0x7fad18e26460,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[0.00629866,-0.00243456],
 _lastvalidtt=[0.00629866,-0.00243456],_upttcommand=[0,0],_refmes=
 0x7fad19194030,_tiprefv=0x7fad1a102830,_tiltrefv=0x7fad1a101c30,_tiprefvn=
 0x7fad1a10fa30,_tiltrefvn=0x7fad1a104e30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e24de0,_jstart=0x7fad18e251a0,
 _binindices=0x7fad1a104430,_binxy=2,_centroidw=0x7fad1903fbe8,_fimage=
 0x7fad19252630,_fimage2=0x0,_imistart=0x7fad18e25ce0,_imjstart=0x7fad18e1de10,
 _imistart2=0x7fad18e24330,_imjstart2=0x7fad18e246f0,_unittip=0x7fad18e1e1d0,
 _unittilt=0x7fad18e18170,_lgs_defocuses=0x7fad1a8384c8,_unitdefocus=
 0x10af90030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a118830,
 _flat=0x7fad1a117630,_domask=1,_submask=0x7fad1a110e30,_kernel=0x7fad1a13da30,
 _kernels=0x1092b8030,_kerfftr=0x10916c030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad19226e30,_x=0x7fad1a12de30,_y=0x7fad1a110630,
 _centroidgain=1,_rayleigh=0x7fad1a8376f8,_bckgrdcalib=0x7fad1a11b630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1a837bc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1903fb08,_ctrlden=0x7fad19040048,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1bf00,_xlast=0x7fad18e21c00,_ylast=[0x7fad1a139c30,
 0x7fad1a139c30,0x7fad1a139c30],_y0=0x7fad1a109e30,_signus=0x7fad18e2bb30,
 _puppixoffset=[0,0],_nact=80,_def=0x10d0e7030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18c54910,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a8375e0,yposition=
 0x7fad1a8370d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.4,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    12898.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       72.9   0.770       96.1
Field Avg  2.20                     72.9   0.770       96.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fad1a8482c8,layerfrac=0x7fad1a848240,
 layerspeed=0x7fad1a848350,layeralt=0x7fad1a8481b8,winddir=0x7fad1a848130,
 _layeralt=0x7fad1a848f68)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fad1a837ce0,lgs_prof_alt=0x7fad1a8380d8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fad18e22e70,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fad18e25540,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10b0db030,_masks=0x0,_fluxpersub=0x7fad18e24330,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fad18e23d70,_skyfluxpersub=0x7fad18e1f050,
 _nphotons=12898.7,_skynphotons=0.349085,_tt=[-0.0107103,-0.00145931],
 _lastvalidtt=[-0.0107103,-0.00145931],_upttcommand=[0,0],_refmes=
 0x7fad1a11ac30,_tiprefv=0x7fad1a114e30,_tiltrefv=0x7fad1a12de30,_tiprefvn=
 0x7fad1a102830,_tiltrefvn=0x7fad1a101c30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fad18e246f0,_jstart=0x7fad18e26250,
 _binindices=0x7fad1a114630,_binxy=2,_centroidw=0x7fad1a837768,_fimage=
 0x7fad1a117630,_fimage2=0x0,_imistart=0x7fad18e235f0,_imjstart=0x7fad18e239b0,
 _imistart2=0x7fad18e24ab0,_imjstart2=0x7fad18e1de10,_unittip=0x7fad18e18170,
 _unittilt=0x7fad18e1e1d0,_lgs_defocuses=0x7fad1a838538,_unitdefocus=
 0x10b9e0030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fad1a0fe230,
 _flat=0x7fad1a0fd030,_domask=1,_submask=0x7fad1a0fc830,_kernel=0x7fad1a118e30,
 _kernels=0x109398030,_kerfftr=0x10932e030,_kerffti=0x10946c030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fad1a111c30,_x=0x7fad1a13da30,_y=0x7fad1a105030,
 _centroidgain=1,_rayleigh=0x7fad1a8375e0,_bckgrdcalib=0x7fad1a110a30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fad1903fc58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fad1a838260,_ctrlden=0x7fad1a837490,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fad18e1d510,_xlast=0x7fad18e1bf00,_ylast=[0x7fad1a109e30,
 0x7fad1a109e30,0x7fad1a109e30],_y0=0x7fad1a0fb430,_signus=0x7fad18e25cd0,
 _puppixoffset=[0,0],_nact=80,_def=0x10e7e0030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fad18e21c00,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fad1a838570,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fad1a8381f0,xposition=0x7fad1a837730,yposition=
 0x7fad1a837c38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fad1903f868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.45,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.002,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    644934.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.847       51.2
Field Avg  1.25                     40.2   0.847       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3660,winddir=0x7fce2b0a35d8,
 _layeralt=0x7fce2b0a3bb0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=1,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3bf8,lgs_prof_alt=0x7fce2b0b4ed8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fce29d26c10,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fce29f06480,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x108a10030,_masks=0x0,_fluxpersub=0x7fce29c47850,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fce29c47c10,_skyfluxpersub=0x7fce29c47fd0,
 _nphotons=644935,_skynphotons=0.174543,_tt=[-0.000353331,0.000568922],
 _lastvalidtt=[-0.000353331,0.000568922],_upttcommand=[0,0],_refmes=
 0x7fce2a169c30,_tiprefv=0x7fce2b0aac30,_tiltrefv=0x7fce2b890830,_tiprefvn=
 0x7fce2b02b030,_tiltrefvn=0x7fce2b898a30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fce29f07500,_jstart=0x7fce29f08510,
 _binindices=0x7fce2b88fe30,_binxy=2,_centroidw=0x7fce2a034c58,_fimage=
 0x7fce2a8e2030,_fimage2=0x0,_imistart=0x7fce29f09050,_imjstart=0x7fce29f04d00,
 _imistart2=0x7fce29f050c0,_imjstart2=0x7fce29f05480,_unittip=0x7fce29f02f30,
 _unittilt=0x7fce29f06cc0,_lgs_defocuses=0x7fce2b0b3ed8,_unitdefocus=
 0x108c57030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fce2a0e9430,
 _flat=0x7fce2a036c30,_domask=1,_submask=0x7fce2a0fe430,_kernel=0x7fce2a16a430,
 _kernels=0x1092da030,_kerfftr=0x1093c6030,_kerffti=0x109350030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fce2a955230,_x=0x7fce2b891c30,_y=0x7fce2b896430,
 _centroidgain=1,_rayleigh=0x7fce2b0b4b88,_bckgrdcalib=0x7fce2a0ea630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fce2b0b4300)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4488,_ctrlden=0x7fce2b0b4530,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29e10bd0,_xlast=0x7fce29e0a070,_ylast=[0x7fce2b037430,
 0x7fce2b037430,0x7fce2b037430],_y0=0x7fce2b079030,_signus=0x7fce29e16c00,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c38a20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b3920,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b48e8,xposition=0x7fce2b0b38b0,yposition=
 0x7fce2b0b39c8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bc0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.847       51.2
Field Avg  1.25                     40.2   0.847       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3660,winddir=0x7fce2b0a35d8,
 _layeralt=0x7fce2b0a3990)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3bf8,lgs_prof_alt=0x7fce2b0b4ed8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fce29c43e20,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fce29c47850,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10850d030,_masks=0x0,_fluxpersub=0x7fce29e16c00,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fce29e16fc0,_skyfluxpersub=0x7fce29e17380,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-4.53582e-05,0.0003223],
 _lastvalidtt=[-4.53582e-05,0.0003223],_upttcommand=[0,0],_refmes=
 0x7fce2b083e30,_tiprefv=0x7fce2b0c7a30,_tiltrefv=0x7fce2b899e30,_tiprefvn=
 0x7fce2b0aac30,_tiltrefvn=0x7fce2b890830,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fce29c48290,_jstart=0x7fce29c48650,
 _binindices=0x7fce2b891c30,_binxy=2,_centroidw=0x7fce2a034be8,_fimage=
 0x7fce2a8e2030,_fimage2=0x0,_imistart=0x7fce29f06240,_imjstart=0x7fce29f06600,
 _imistart2=0x7fce29f069c0,_imjstart2=0x7fce29f06d80,_unittip=0x7fce29c40ea0,
 _unittilt=0x7fce29c42e20,_lgs_defocuses=0x7fce2a034868,_unitdefocus=
 0x1087db030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fce2b0a8830,
 _flat=0x7fce2b897030,_domask=1,_submask=0x7fce2b037430,_kernel=0x7fce2a957030,
 _kernels=0x10943b030,_kerfftr=0x109527030,_kerffti=0x1092da030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fce2a8eaa30,_x=0x7fce2a159e30,_y=0x7fce2a15a630,
 _centroidgain=1,_rayleigh=0x7fce2b0b38b0,_bckgrdcalib=0x7fce2b898230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fce2b0b3b88)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2a0349b8,_ctrlden=0x7fce2a0348d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29f04a40,_xlast=0x7fce29f02f30,_ylast=[0x7fce2b803030,
 0x7fce2b803030,0x7fce2b803030],_y0=0x7fce2b80f630,_signus=0x7fce29f030b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29e10bd0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b3920,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b48e8,xposition=0x7fce2b0b45a0,yposition=
 0x7fce2b0b3878,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bc0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    406.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.843       51.2
Field Avg  1.25                     40.2   0.843       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3660,winddir=0x7fce2b0a35d8,
 _layeralt=0x7fce2b0a4af8)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3bf8,lgs_prof_alt=0x7fce2b0b4ed8,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7fce29f06360,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7fce29e16c00,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10b13d030,_masks=0x0,_fluxpersub=0x7fce29e18dc0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fce29e19180,_skyfluxpersub=0x7fce29e19540,
 _nphotons=406.926,_skynphotons=0.174543,_tt=[-0.00219113,0.00189625],
 _lastvalidtt=[-0.00219113,0.00189625],_upttcommand=[0,0],_refmes=
 0x7fce2b02b630,_tiprefv=0x7fce2a93c830,_tiltrefv=0x7fce2a938430,_tiprefvn=
 0x7fce2a93d430,_tiltrefvn=0x7fce2a93b230,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fce29e16fc0,_jstart=0x7fce29e17380,
 _binindices=0x7fce2b0c7a30,_binxy=2,_centroidw=0x7fce2b0b48b0,_fimage=
 0x7fce2b0a8830,_fimage2=0x0,_imistart=0x7fce29e17ec0,_imjstart=0x7fce29e18280,
 _imistart2=0x7fce29e18640,_imjstart2=0x7fce29e18a00,_unittip=0x7fce29c42e20,
 _unittilt=0x7fce29c39fd0,_lgs_defocuses=0x7fce2b0b3ed8,_unitdefocus=
 0x1083eb030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fce2b048e30,
 _flat=0x7fce2b0ac430,_domask=1,_submask=0x7fce2b068630,_kernel=0x7fce2b0abc30,
 _kernels=0x109350030,_kerfftr=0x1093c6030,_kerffti=0x10943b030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fce2b0a9a30,_x=0x7fce2b0c0430,_y=0x7fce2b02a430,
 _centroidgain=1,_rayleigh=0x7fce2b0b45a0,_bckgrdcalib=0x7fce2b04a030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fce2b0b44f8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4b88,_ctrlden=0x7fce2b0b38b0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29f04f80,_xlast=0x7fce29f04a40,_ylast=[0x7fce2b80f630,
 0x7fce2b80f630,0x7fce2b80f630],_y0=0x7fce2b805c30,_signus=0x7fce29f05cd0,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d24550,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b3920,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b48e8,xposition=0x7fce2b0b4300,yposition=
 0x7fce2a034da8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bc0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    162.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       40.2   0.834       51.2
Field Avg  1.25                     40.2   0.834       51.2
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3660,winddir=0x7fce2b0a35d8,
 _layeralt=0x7fce2b0a4c90)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3bf8,lgs_prof_alt=
 0x7fce2b0b4ed8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fce29f05710,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fce29d289d0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10b4c0030,_masks=0x0,_fluxpersub=0x7fce29e16c00,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fce29e16fc0,_skyfluxpersub=0x7fce29e17700,
 _nphotons=162,_skynphotons=0.174543,_tt=[-0.00033148,-0.00264985],_lastvalidtt=
 [-0.00033148,-0.00264985],_upttcommand=[0,0],_refmes=0x7fce2b854e30,_tiprefv=
 0x7fce2b857030,_tiltrefv=0x7fce2a93da30,_tiprefvn=0x7fce2b804a30,_tiltrefvn=
 0x7fce2a938430,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fce29d221f0,_jstart=0x7fce29d26460,_binindices=0x7fce2a93a830,
 _binxy=2,_centroidw=0x7fce2a034de0,_fimage=0x7fce2a15c830,_fimage2=0x0,
 _imistart=0x7fce29d29150,_imjstart=0x7fce29d27640,_imistart2=0x7fce29d27a00,
 _imjstart2=0x7fce29d27dc0,_unittip=0x7fce29d25390,_unittilt=0x7fce29d23180,
 _lgs_defocuses=0x7fce2b0b39c8,_unitdefocus=0x10a0c0030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fce2b02a430,_flat=0x7fce2b0a9a30,_domask=1,
 _submask=0x7fce2b0ae230,_kernel=0x7fce2b037430,_kernels=0x1092da030,_kerfftr=
 0x109258030,_kerffti=0x109350030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fce2a0fdc30,_x=0x7fce2a8cb230,_y=0x7fce2a8cba30,_centroidgain=1,_rayleigh=
 0x7fce2b0b4300,_bckgrdcalib=0x7fce2b04e230,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fce2b0b4488)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b3ed8,_ctrlden=0x7fce2b0b3878,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d24a10,_xlast=0x7fce29d1f370,_ylast=[0x7fce2a8c4430,
 0x7fce2a8c4430,0x7fce2a8c4430],_y0=0x7fce2a874430,_signus=0x7fce29d27380,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29c38a20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b3920,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b48e8,xposition=0x7fce2b0b3b88,yposition=
 0x7fce2b0b47d0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bc0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    40.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       46.5   0.237      187.7
Field Avg  1.25                     46.5   0.237      187.7
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3660,winddir=0x7fce2b0a35d8,
 _layeralt=0x7fce2b0a4d18)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 14,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3bf8,lgs_prof_alt=
 0x7fce2b0b4ed8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fce29d221f0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fce29c47c10,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10dc18030,_masks=0x0,_fluxpersub=0x7fce29c48ed0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fce29c49650,_skyfluxpersub=0x7fce29c49a10,
 _nphotons=40.6926,_skynphotons=1.74543,_tt=[-0.0028117,-0.00995111],
 _lastvalidtt=[-0.0028117,-0.00995111],_upttcommand=[0,0],_refmes=
 0x7fce2b02b630,_tiprefv=0x7fce2a0d0230,_tiltrefv=0x7fce2a93a230,_tiprefvn=
 0x7fce2a0e7430,_tiltrefvn=0x7fce2a93da30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7fce29c47fd0,_jstart=0x7fce29c39ca0,
 _binindices=0x7fce2a0ed030,_binxy=2,_centroidw=0x7fce2a034b08,_fimage=
 0x7fce2a8eaa30,_fimage2=0x0,_imistart=0x7fce29c49290,_imjstart=0x7fce29c48390,
 _imistart2=0x7fce29c48750,_imjstart2=0x7fce29c48b10,_unittip=0x7fce29c3a060,
 _unittilt=0x7fce29c42e20,_lgs_defocuses=0x7fce2b0b4f10,_unitdefocus=
 0x10864f030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7fce2a0e9230,
 _flat=0x7fce2a0fdc30,_domask=1,_submask=0x7fce2a208c30,_kernel=0x7fce2a0d3030,
 _kernels=0x109350030,_kerfftr=0x1093c6030,_kerffti=0x1092da030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7fce2a93c830,_x=0x7fce2a0d4a30,_y=0x7fce2a0fca30,
 _centroidgain=1,_rayleigh=0x7fce2b0b3b88,_bckgrdcalib=0x7fce2a0ea430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fce2a0349b8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4808,_ctrlden=0x7fce2b0b43a8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d24550,_xlast=0x7fce29d24a10,_ylast=[0x7fce2a874430,
 0x7fce2a874430,0x7fce2a874430],_y0=0x7fce2a8cbe30,_signus=0x7fce29d26820,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29f05000,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b3920,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b48e8,xposition=0x7fce2b0b44f8,yposition=
 0x7fce2b0b4530,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bc0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    16.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       51.9   0.187      187.7
Field Avg  1.25                     51.9   0.187      187.7
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3660,winddir=0x7fce2b0a35d8,
 _layeralt=0x7fce2b0a4a70)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3bf8,lgs_prof_alt=
 0x7fce2b0b4ed8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fce29e16f70,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fce29c47c30,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10d916030,_masks=0x0,_fluxpersub=0x7fce29f081e0,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fce29f085a0,_skyfluxpersub=0x7fce29f08960,
 _nphotons=16.2,_skynphotons=1.74543,_tt=[0.00505691,0.0324664],_lastvalidtt=
 [0.00505691,0.0324664],_upttcommand=[0,0],_refmes=0x7fce2a955a30,_tiprefv=
 0x7fce2a9d7a30,_tiltrefv=0x7fce2b857630,_tiprefvn=0x7fce2a9d8630,_tiltrefvn=
 0x7fce2b856630,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fce29c47ff0,_jstart=0x7fce29c48730,_binindices=0x7fce2b853230,
 _binxy=2,_centroidw=0x7fce2a034b78,_fimage=0x7fce2a208c30,_fimage2=0x0,
 _imistart=0x7fce29f072e0,_imjstart=0x7fce29f076a0,_imistart2=0x7fce29f07a60,
 _imjstart2=0x7fce29f07e20,_unittip=0x7fce29f06930,_unittilt=0x7fce29c42e20,
 _lgs_defocuses=0x7fce2a034a60,_unitdefocus=0x108c57030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fce2b85f430,_flat=0x7fce2b85c430,_domask=1,
 _submask=0x7fce2b855a30,_kernel=0x7fce2a0e4030,_kernels=0x1092da030,_kerfftr=
 0x109258030,_kerffti=0x109350030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fce2a036c30,_x=0x7fce2a159e30,_y=0x7fce2a15a630,_centroidgain=1,_rayleigh=
 0x7fce2b0b44f8,_bckgrdcalib=0x7fce2b860630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fce2b0b4b88)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4300,_ctrlden=0x7fce2b0b4b18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29f05660,_xlast=0x7fce29f057e0,_ylast=[0x7fce2b80f630,
 0x7fce2b80f630,0x7fce2b80f630],_y0=0x7fce2b857230,_signus=0x7fce29f06670,
 _puppixoffset=[0,0],_nact=80,_def=0x10f412030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29f08d20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b3920,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b48e8,xposition=0x7fce2b0b4488,yposition=
 0x7fce2a0348d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bc0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.25    0.0   0.0       71.3   0.102      215.0
Field Avg  1.25                     71.3   0.102      215.0
Field rms  1.25                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7fce2b0a3550,layerfrac=0x7fce2b0a34c8,
 layerspeed=0x7fce2b0a3440,layeralt=0x7fce2b0a3660,winddir=0x7fce2b0a35d8,
 _layeralt=0x7fce2b0a3aa0)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 16,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7fce2b0b3bf8,lgs_prof_alt=
 0x7fce2b0b4ed8,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7fce29d28050,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7fce29d27b10,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10af70030,_masks=0x0,_fluxpersub=0x7fce29d2a960,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7fce29d2ad20,_skyfluxpersub=0x7fce29d2b0e0,
 _nphotons=6.44935,_skynphotons=1.74543,_tt=[0.0296702,0.0156665],_lastvalidtt=
 [0.0296702,0.0156665],_upttcommand=[0,0],_refmes=0x7fce2a159e30,_tiprefv=
 0x7fce2a208c30,_tiltrefv=0x7fce2b0a9030,_tiprefvn=0x7fce2a0fb030,_tiltrefvn=
 0x7fce2b0a9c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7fce29d28b60,_jstart=0x7fce29d28f20,_binindices=0x7fce2b856830,
 _binxy=2,_centroidw=0x7fce2b0b4e68,_fimage=0x7fce2a955a30,_fimage2=0x0,
 _imistart=0x7fce29d29a60,_imjstart=0x7fce29d29e20,_imistart2=0x7fce29d2a1e0,
 _imjstart2=0x7fce29d2a5a0,_unittip=0x7fce29d25390,_unittilt=0x7fce29d26460,
 _lgs_defocuses=0x7fce2b0b4f10,_unitdefocus=0x1087db030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7fce2a938230,_flat=0x7fce2a937030,_domask=1,
 _submask=0x7fce2a8e3430,_kernel=0x7fce2a15a630,_kernels=0x109350030,_kerfftr=
 0x1093c6030,_kerffti=0x1092da030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7fce2a933230,_x=0x7fce2a8eaa30,_y=0x7fce2a8ebe30,_centroidgain=1,_rayleigh=
 0x7fce2b0b4488,_bckgrdcalib=0x7fce2a939430,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fce2b0b3ed8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fce2b0b4bf8,_ctrlden=0x7fce2b0b4530,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fce29d24a10,_xlast=0x7fce29d23180,_ylast=[0x7fce2a8cbe30,
 0x7fce2a8cbe30,0x7fce2a8cbe30],_y0=0x7fce2a956c30,_signus=0x7fce29d22520,
 _puppixoffset=[0,0],_nact=80,_def=0x10dd19030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7fce29d27ed0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7fce2b0b3920,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fce2b0b48e8,xposition=0x7fce2a0349b8,yposition=
 0x7fce2b0b38b0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fce2b0b4bc0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    644934.8
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7ff9130596c8,layerfrac=0x7ff913059640,
 layerspeed=0x7ff913059750,layeralt=0x7ff9130597d8,winddir=0x7ff913059860,
 _layeralt=0x7ff913059970)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=1,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7ff913069d50,lgs_prof_alt=0x7ff913069dc0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7ff911419950,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7ff91154fec0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x101da1030,_masks=0x0,_fluxpersub=0x7ff911550b60,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7ff911550f20,_skyfluxpersub=0x7ff9115512e0,
 _nphotons=644935,_skynphotons=0.174543,_tt=[-0.000367321,0.000550002],
 _lastvalidtt=[-0.000367321,0.000550002],_upttcommand=[0,0],_refmes=
 0x7ff912114230,_tiprefv=0x7ff91205f230,_tiltrefv=0x7ff911864030,_tiprefvn=
 0x7ff91215a630,_tiltrefvn=0x7ff911864c30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7ff911550280,_jstart=0x7ff911550640,
 _binindices=0x7ff912810a30,_binxy=2,_centroidw=0x7ff91306a768,_fimage=
 0x7ff911868a30,_fimage2=0x0,_imistart=0x7ff911601b70,_imjstart=0x7ff9116028d0,
 _imistart2=0x7ff911602c90,_imjstart2=0x7ff911603050,_unittip=0x7ff91154fa60,
 _unittilt=0x7ff91154fc90,_lgs_defocuses=0x7ff91306a308,_unitdefocus=
 0x107b90030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7ff911862e30,
 _flat=0x7ff91186e430,_domask=1,_submask=0x7ff912113a30,_kernel=0x7ff912184a30,
 _kernels=0x10752b030,_kerfftr=0x10330f030,_kerffti=0x1032a5030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7ff911869c30,_x=0x7ff91219ca30,_y=0x7ff91219d230,
 _centroidgain=1,_rayleigh=0x7ff91306a810,_bckgrdcalib=0x7ff911874430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7ff913069a40)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7ff91306a960,_ctrlden=0x7ff91306aa78,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7ff911603f50,_xlast=0x7ff9116040d0,_ylast=[0x7ff912808030,
 0x7ff912808030,0x7ff912808030],_y0=0x7ff912811a30,_signus=0x7ff911604250,
 _puppixoffset=[0,0],_nact=80,_def=0x1044fc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7ff9115516a0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7ff913069b58,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7ff913069ab0,xposition=0x7ff913069a78,yposition=
 0x7ff913069c00,xspeed=0x0,yspeed=0x0,dispzoom=0x7ff913069c38,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6449.3
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.948       78.1
Field Avg  2.20                     70.7   0.948       78.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7ff9130596c8,layerfrac=0x7ff913059640,
 layerspeed=0x7ff913059750,layeralt=0x7ff9130597d8,winddir=0x7ff913059860,
 _layeralt=0x7ff91305a038)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=6,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7ff913069d50,lgs_prof_alt=0x7ff913069dc0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7ff911556090,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7ff911711510,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x101ca0030,_masks=0x0,_fluxpersub=0x7ff911552280,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7ff91154fda0,_skyfluxpersub=0x7ff911550160,
 _nphotons=6449.35,_skynphotons=0.174543,_tt=[-0.000648682,0.000621045],
 _lastvalidtt=[-0.000648682,0.000621045],_upttcommand=[0,0],_refmes=
 0x7ff91187e830,_tiprefv=0x7ff911880230,_tiltrefv=0x7ff911869a30,_tiprefvn=
 0x7ff911868a30,_tiltrefvn=0x7ff911864030,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7ff9117118d0,_jstart=0x7ff911711c90,
 _binindices=0x7ff91280fe30,_binxy=2,_centroidw=0x7ff91306a148,_fimage=
 0x7ff91218bc30,_fimage2=0x0,_imistart=0x7ff911603050,_imjstart=0x7ff911603410,
 _imistart2=0x7ff9116037d0,_imjstart2=0x7ff911603b90,_unittip=0x7ff911710910,
 _unittilt=0x7ff9117112e0,_lgs_defocuses=0x7ff91306a3b0,_unitdefocus=
 0x107d90030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7ff912186430,
 _flat=0x7ff912185230,_domask=1,_submask=0x7ff91205f230,_kernel=0x7ff911875630,
 _kernels=0x10752b030,_kerfftr=0x107617030,_kerffti=0x103379030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7ff91219bc30,_x=0x7ff913062430,_y=0x7ff913062c30,
 _centroidgain=1,_rayleigh=0x7ff913069a78,_bckgrdcalib=0x7ff91219aa30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7ff913069d88)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7ff91306a998,_ctrlden=0x7ff91306ac70,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7ff911554fe0,_xlast=0x7ff911555160,_ylast=[0x7ff9120a7030,
 0x7ff9120a7030,0x7ff9120a7030],_y0=0x7ff91205c830,_signus=0x7ff911555dd0,
 _puppixoffset=[0,0],_nact=80,_def=0x107f90030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7ff91154f8b0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7ff913069b58,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7ff913069ab0,xposition=0x7ff913069b90,yposition=
 0x7ff913069ca8,xspeed=0x0,yspeed=0x0,dispzoom=0x7ff913069c38,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    406.9
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.946       84.1
Field Avg  2.20                     70.7   0.946       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7ff9130596c8,layerfrac=0x7ff913059640,
 layerspeed=0x7ff913059750,layeralt=0x7ff9130597d8,winddir=0x7ff913059860,
 _layeralt=0x7ff91305a148)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=9,
 skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,
 disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,
 nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,
 pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc=0x0,
 pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=1.24794,npixels=2,
 spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,shthreshold=0,
 shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",
 fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,centGainOpt=0,
 LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=
 0,lgs_focus_alt=0,lgs_prof_amp=0x7ff913069d50,lgs_prof_alt=0x7ff913069dc0,nzer=
 0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x7ff911419160,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=
 0x7ff9116017b0,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,_nsub=188,
 _nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=
 0x10179d030,_masks=0x0,_fluxpersub=0x7ff91142b760,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7ff91142bb20,_skyfluxpersub=0x7ff91142bee0,
 _nphotons=406.926,_skynphotons=0.174543,_tt=[0.000346617,0.00150929],
 _lastvalidtt=[0.000346617,0.00150929],_upttcommand=[0,0],_refmes=
 0x7ff91187e830,_tiprefv=0x7ff911864c30,_tiltrefv=0x7ff911880e30,_tiprefvn=
 0x7ff911880230,_tiltrefvn=0x7ff911869a30,_reordervec=0x0,_npixels=2,_npb=0,
 _sdim=32,_nx=22,_nx4fft=22,_istart=0x7ff911601b70,_jstart=0x7ff9116028d0,
 _binindices=0x7ff91219ea30,_binxy=2,_centroidw=0x7ff91306aa40,_fimage=
 0x7ff91185d430,_fimage2=0x0,_imistart=0x7ff9115566c0,_imjstart=0x7ff911556a80,
 _imistart2=0x7ff911556e40,_imjstart2=0x7ff91154fda0,_unittip=0x7ff911601f80,
 _unittilt=0x7ff911602300,_lgs_defocuses=0x7ff91306a5e0,_unitdefocus=
 0x107a8f030,_fimnx=32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7ff91186a630,
 _flat=0x7ff91186e430,_domask=1,_submask=0x7ff911860a30,_kernel=0x7ff91185a230,
 _kernels=0x101f18030,_kerfftr=0x102625030,_kerffti=0x1020a2030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7ff912059c30,_x=0x7ff91280cc30,_y=0x7ff91280e630,
 _centroidgain=1,_rayleigh=0x7ff913069b90,_bckgrdcalib=0x7ff911862e30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7ff91306a7a0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7ff91306a768,_ctrlden=0x7ff91306a6f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7ff91154ece0,_xlast=0x7ff911551630,_ylast=[0x7ff91205c830,
 0x7ff91205c830,0x7ff91205c830],_y0=0x7ff912114630,_signus=0x7ff911557a70,
 _puppixoffset=[0,0],_nact=80,_def=0x1044fc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7ff91170de20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7ff913069b58,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7ff913069ab0,xposition=0x7ff913069a40,yposition=
 0x7ff91306a490,xspeed=0x0,yspeed=0x0,dispzoom=0x7ff913069c38,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    162.0
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       70.7   0.943       84.1
Field Avg  2.20                     70.7   0.943       84.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7ff9130596c8,layerfrac=0x7ff913059640,
 layerspeed=0x7ff913059750,layeralt=0x7ff9130597d8,winddir=0x7ff913059860,
 _layeralt=0x7ff91305a478)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 10,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7ff913069d50,lgs_prof_alt=
 0x7ff913069dc0,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7ff9117122a0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7ff91141c530,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x10667b030,_masks=0x0,_fluxpersub=0x7ff911550470,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7ff91154fda0,_skyfluxpersub=0x7ff9115597b0,
 _nphotons=162,_skynphotons=0.174543,_tt=[-0.00225949,-0.00210652],_lastvalidtt=
 [-0.00225949,-0.00210652],_upttcommand=[0,0],_refmes=0x7ff912810830,_tiprefv=
 0x7ff91187dc30,_tiltrefv=0x7ff911867c30,_tiprefvn=0x7ff911864c30,_tiltrefvn=
 0x7ff911880e30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7ff91141d5b0,_jstart=0x7ff91141d970,_binindices=0x7ff9130a3230,
 _binxy=2,_centroidw=0x7ff91306a9d0,_fimage=0x7ff91218d830,_fimage2=0x0,
 _imistart=0x7ff911710fd0,_imjstart=0x7ff911711390,_imistart2=0x7ff911711750,
 _imjstart2=0x7ff911711b10,_unittip=0x7ff91170ffe0,_unittilt=0x7ff911710210,
 _lgs_defocuses=0x7ff91306a148,_unitdefocus=0x10778d030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7ff91218b430,_flat=0x7ff912185230,_domask=1,
 _submask=0x7ff91205b630,_kernel=0x7ff912061230,_kernels=0x102131030,_kerfftr=
 0x103379030,_kerffti=0x1032a5030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7ff91218fa30,_x=0x7ff91187e830,_y=0x7ff91187f030,_centroidgain=1,_rayleigh=
 0x7ff913069a40,_bckgrdcalib=0x7ff91218c630,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7ff91306a960)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7ff91306aab0,_ctrlden=0x7ff91306a5a8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7ff9114165f0,_xlast=0x7ff911414220,_ylast=[0x7ff911813e30,
 0x7ff911813e30,0x7ff911813e30],_y0=0x7ff91186f630,_signus=0x7ff91142bb20,
 _puppixoffset=[0,0],_nact=80,_def=0x107d90030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7ff911551630,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7ff913069b58,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7ff913069ab0,xposition=0x7ff913069d88,yposition=
 0x7ff91306a378,xspeed=0x0,yspeed=0x0,dispzoom=0x7ff913069c38,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    40.7
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       73.9   0.612      144.1
Field Avg  2.20                     73.9   0.612      144.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7ff9130596c8,layerfrac=0x7ff913059640,
 layerspeed=0x7ff913059750,layeralt=0x7ff9130597d8,winddir=0x7ff913059860,
 _layeralt=0x7ff91305a940)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 14,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7ff913069d50,lgs_prof_alt=
 0x7ff913069dc0,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7ff91141adc0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7ff911603510,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x1039a2030,_masks=0x0,_fluxpersub=0x7ff911604050,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7ff911604410,_skyfluxpersub=0x7ff9116047d0,
 _nphotons=40.6926,_skynphotons=1.74543,_tt=[0.0117201,-0.00347491],
 _lastvalidtt=[0.0117201,-0.00347491],_upttcommand=[0,0],_refmes=0x7ff911864430,
 _tiprefv=0x7ff911869a30,_tiltrefv=0x7ff911865830,_tiprefvn=0x7ff91187dc30,
 _tiltrefvn=0x7ff911867c30,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,
 _nx4fft=22,_istart=0x7ff9116038d0,_jstart=0x7ff911603c90,_binindices=
 0x7ff911871230,_binxy=2,_centroidw=0x7ff913069a78,_fimage=0x7ff911866430,
 _fimage2=0x0,_imistart=0x7ff91141a410,_imjstart=0x7ff9114172c0,_imistart2=
 0x7ff911418460,_imjstart2=0x7ff91141aa00,_unittip=0x7ff9116017b0,_unittilt=
 0x7ff9116019e0,_lgs_defocuses=0x7ff91306a3b0,_unitdefocus=0x10768c030,_fimnx=
 32,_fimny=32,_fimny2=0x0,_yoffset=0x0,_bias=0x7ff912821230,_flat=
 0x7ff912820030,_domask=1,_submask=0x7ff912808030,_kernel=0x7ff91205a630,
 _kernels=0x102131030,_kerfftr=0x107617030,_kerffti=0x102625030,_kernelconv=0,
 _cyclecounter=1,_dispimage=0x7ff911868830,_x=0x7ff912806630,_y=0x7ff91280f230,
 _centroidgain=1,_rayleigh=0x7ff913069d88,_bckgrdcalib=0x7ff912822430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7ff91306a998)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7ff91306a490,_ctrlden=0x7ff913069a40,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7ff9114143a0,_xlast=0x7ff91141d8d0,_ylast=[0x7ff91186f630,
 0x7ff91186f630,0x7ff91186f630],_y0=0x7ff91184fa30,_signus=0x7ff9114165f0,
 _puppixoffset=[0,0],_nact=80,_def=0x109489030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7ff91170de20,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7ff913069b58,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7ff913069ab0,xposition=0x7ff91306a7a0,yposition=
 0x7ff91306aa78,xspeed=0x0,yspeed=0x0,dispzoom=0x7ff913069c38,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    16.2
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       76.0   0.559      150.1
Field Avg  2.20                     76.0   0.559      150.1
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7ff9130596c8,layerfrac=0x7ff913059640,
 layerspeed=0x7ff913059750,layeralt=0x7ff9130597d8,winddir=0x7ff913059860,
 _layeralt=0x7ff91305a500)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 15,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7ff913069d50,lgs_prof_alt=
 0x7ff913069dc0,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7ff91141f0b0,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7ff911554c20,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x103fa5030,_masks=0x0,_fluxpersub=0x7ff911555760,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7ff911555b20,_skyfluxpersub=0x7ff911555ee0,
 _nphotons=16.2,_skynphotons=1.74543,_tt=[0.00908368,0.00206599],_lastvalidtt=
 [0.00908368,0.00206599],_upttcommand=[0,0],_refmes=0x7ff911877830,_tiprefv=
 0x7ff911867030,_tiltrefv=0x7ff911866430,_tiprefvn=0x7ff911869a30,_tiltrefvn=
 0x7ff911865830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7ff911554fe0,_jstart=0x7ff9115553a0,_binindices=0x7ff912810a30,
 _binxy=2,_centroidw=0x7ff91306a5e0,_fimage=0x7ff91185f830,_fimage2=0x0,
 _imistart=0x7ff911609520,_imjstart=0x7ff9116098e0,_imistart2=0x7ff911609ca0,
 _imjstart2=0x7ff91160a060,_unittip=0x7ff91141d780,_unittilt=0x7ff91141c200,
 _lgs_defocuses=0x7ff91306a9d0,_unitdefocus=0x103aa3030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7ff912184a30,_flat=0x7ff912060e30,_domask=1,
 _submask=0x7ff912059c30,_kernel=0x7ff9130bde30,_kernels=0x101ea2030,_kerfftr=
 0x1032a5030,_kerffti=0x103379030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7ff911867c30,_x=0x7ff91205b630,_y=0x7ff91205be30,_centroidgain=1,_rayleigh=
 0x7ff91306a7a0,_bckgrdcalib=0x7ff912185c30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7ff91306a768)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7ff91306a810,_ctrlden=0x7ff91306a8b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7ff911417ea0,_xlast=0x7ff9114143a0,_ylast=[0x7ff91184fa30,
 0x7ff91184fa30,0x7ff91184fa30],_y0=0x7ff911871a30,_signus=0x7ff91141d4c0,
 _puppixoffset=[0,0],_nact=80,_def=0x107b90030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7ff911602300,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7ff913069b58,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7ff913069ab0,xposition=0x7ff91306a960,yposition=
 0x7ff91306ac70,xspeed=0x0,yspeed=0x0,dispzoom=0x7ff913069c38,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
WFS# |     Pixel sizes        | Subaperture size | Numb of pixels | #photons
      | Desired Quantum Actual | Max  Actual Extd | Desired Actual | /sub/iter
 1      1.2479  0.1134  1.2479   3.63  2.50  2.50    2x 2    2x 2    6.4
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, hartmann (meth. 2), 188 subap., offaxis (+0.0",+0.0"), noise enabled
D/r0 (500nm) = 15.6; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     2.20    0.0   0.0       82.6   0.404      180.2
Field Avg  2.20                     82.6   0.404      180.2
Field rms  2.20                      0.0   0.000        0.0

Average images written in sh16x16_new-imav.fits
Some other graphics in sh16x16_new.ps

Original parameter file: sh16x16_new.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 176; //This is the pupil diameter in pixel
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 15.57;  // This is r0=0.37m, D/r0=6.5m/0.37m=17.57. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);// To be considered here
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "hartmann";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 14.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).shmethod	   = 2;   //1= Geometric, simple gradient average over subaperture. 2=Diffractive, full propagation
 wfs(n).shnxsub	   = 16;  //# of subapertures in telescope diameter, in 1D direction.
 wfs(n).pixsize     = 1.2; //Focal plane: Subaperture CCD pixel size in arcsec 72um/60um = 1.2, for plate scale is 60 um/arcsec.
 wfs(n).npixels     = 2;   //Focal plane: Final # of pixels per subaperture. After pixel-binning, the sub-aperture consists of 2x2 pixels.
 wfs(n).npixpersub  = 11;//# of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 11*12 = 132
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;// Read out noise by MMT, in paper McGuire 1999 P275 Section 3.1 paragraph 3.
 wfs(n).fracIllum   = 0.75; // 108/144=0.75, in paper McGuire 1999 Table 1.
 wfs(n).fssize      = 2.4; // Field stop size per sub-aperture, 1.2 arcsec/pixel * 2 pixel = 2.4 arcsec.
 wfs(n).fstop       = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 dm(n).thresholdresp = -0.1 ;//0 would filter all actuators and 1 would retain them all. 0.5 would retain all actuator which measurement max response is larger than the max response of all actuators. 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 
 //-------------------------------
 target.lambda	   = &([2.2]);// The wavelength of the science camera detector, unit micron. 1.65 microns(H band) or 2.2 microns(K band). convert pointer to string.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band(0.65 micron). (3.255e11); if we only change the wave-length of the wfs, this does not change...
 //-------------------------------
 loop.gain	       = 0.3;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 2000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=176,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=15.57,screen=0x7ff9130596c8,layerfrac=0x7ff913059640,
 layerspeed=0x7ff913059750,layeralt=0x7ff9130597d8,winddir=0x7ff913059860,
 _layeralt=0x7ff91305a258)
 [wfs_struct(type="hartmann",subsystem=1,lambda=0.65,noise=1,ron=3.7,
 darkcurrent=0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=
 16,skymag=17.9,filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,
 optthroughput=1,disjointpup=0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,
 framedelay=-1,nsubperring=0x0,angleoffset=0x0,l=0,rint=0x0,rout=0x0,
 fieldstopdiam=0,pyr_mod_ampl=0,pyr_mod_npts=0,pyr_mod_pos=0x0,pyr_padding=0,
 pyr_mod_loc=0x0,pyr_denom=0x0,shmethod=2,shnxsub=16,npixpersub=11,pixsize=
 1.24794,npixels=2,spotpitch=2,extfield=2.49587,pupoffset=[0,0],shthmethod=1,
 shthreshold=0,shcalibseeing=0.667,biasrmserror=0,flatrmserror=0,fsname=0x0,
 fstop="round",fssize=2.4,fsoffset=[0,0],kernel=0,nintegcycles=1,fracIllum=0.75,
 centGainOpt=0,LLTxy=[0,0],LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,
 rayleighflag=0,lgs_focus_alt=0,lgs_prof_amp=0x7ff913069d50,lgs_prof_alt=
 0x7ff913069dc0,nzer=0,ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,
 _svipc_init_done=0,_svipc_subok=0x7ff911556960,_fork_subs=0x0,_fork_subs2=0x0,
 _validsubs=0x7ff91141c200,_origpixsize=1.2,_rebinfactor=11,_gsalt=0,_gsdepth=0,
 _nsub=188,_nsub4disp=224,_nmes=376,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,
 _tiltsh=0x107a8f030,_masks=0x0,_fluxpersub=0x7ff91141ff00,_rayleighflux=0x0,
 _sodiumflux=0x0,_raylfluxpersub=0x7ff9114206a0,_skyfluxpersub=0x7ff911420a60,
 _nphotons=6.44935,_skynphotons=1.74543,_tt=[0.0105751,0.00140722],_lastvalidtt=
 [0.0105751,0.00140722],_upttcommand=[0,0],_refmes=0x7ff91205f230,_tiprefv=
 0x7ff912184a30,_tiltrefv=0x7ff91205b630,_tiprefvn=0x7ff912113a30,_tiltrefvn=
 0x7ff912189830,_reordervec=0x0,_npixels=2,_npb=0,_sdim=32,_nx=22,_nx4fft=22,
 _istart=0x7ff91141f780,_jstart=0x7ff91141fb40,_binindices=0x7ff9130a5e30,
 _binxy=2,_centroidw=0x7ff913069df8,_fimage=0x7ff912059c30,_fimage2=0x0,
 _imistart=0x7ff911710760,_imjstart=0x7ff911710fd0,_imistart2=0x7ff911711390,
 _imjstart2=0x7ff911711750,_unittip=0x7ff91141dac0,_unittilt=0x7ff91141f190,
 _lgs_defocuses=0x7ff91306a378,_unitdefocus=0x105ff7030,_fimnx=32,_fimny=32,
 _fimny2=0x0,_yoffset=0x0,_bias=0x7ff91185f830,_flat=0x7ff911874430,_domask=1,
 _submask=0x7ff91185f030,_kernel=0x7ff91205c230,_kernels=0x102131030,_kerfftr=
 0x102625030,_kerffti=0x101ea2030,_kernelconv=0,_cyclecounter=1,_dispimage=
 0x7ff9121eaa30,_x=0x7ff911875630,_y=0x7ff911871230,_centroidgain=1,_rayleigh=
 0x7ff91306a960,_bckgrdcalib=0x7ff911860a30,_bckgrdinit=0,_bckgrdsub=1,
 _meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],
 _LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=
 0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7ff91306aab0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh16x16_new-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=-0.1,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7ff91306a848,_ctrlden=0x7ff91306a5e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh16x16_new-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7ff911554ee0,_xlast=0x7ff911555060,_ylast=[0x7ff912199e30,
 0x7ff912199e30,0x7ff912199e30],_y0=0x7ff912114630,_signus=0x7ff911550160,
 _puppixoffset=[0,0],_nact=80,_def=0x109289030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile="sh16x16_new-if1-ext.fits",
 _edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=160,_n2=353,_pupil=0x0,_command=
 0x7ff91141e4a0,_flat_command=0x0,_extrapcmat=0x0,_eltdefsize=0,_regmatrix=0x0,
 _fMat=0x0)]
 mat_struct(method="svd",condition=0x7ff913069b58,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh16x16_new-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7ff913069ab0,xposition=0x7ff91306a998,yposition=
 0x7ff91306a6f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7ff913069c38,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.3,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.01,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
