=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      222.7   0.008      628.3
Field Avg  1.65                    222.7   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture.
 wfs(n).npixpersub   = 2;// Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*40 = 80   
 wfs(n).fssize       = 0.495;//calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;// 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float .... what is the modulation amplitude.... - - 
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7eb0,layerfrac=0x7f8a548c7c90,
 layerspeed=0x7f8a548c7f38,layeralt=0x7f8a548c7fc0,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a548c79e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54930e40,lgs_prof_alt=0x7f8a54930eb0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a5381fe30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00209255,
 0.00324536],_lastvalidtt=[0.00209255,0.00324536],_upttcommand=[0,0],_refmes=
 0x7f8a55016630,_tiprefv=0x7f8a540c2830,_tiltrefv=0x7f8a55019630,_tiprefvn=
 0x7f8a540e6230,_tiltrefvn=0x7f8a55011430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a54a01430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7f8a5497c430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a54a01430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a54821430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a54926630)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5492f468,_ctrlden=0x7f8a5403dfa0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5363b540,_xlast=0x7f8a53639140,_ylast=[0x7f8a54913630,
 0x7f8a54913630,0x7f8a54913630],_y0=0x7f8a54821a30,_signus=0x7f8a536385a0,
 _puppixoffset=[0,0],_nact=80,_def=0x1014b6030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7f8a5363c030,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a54930d60,xposition=0x7f8a54930cf0,yposition=
 0x7f8a54930cb8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930d28,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      367.4   0.006      628.3
Field Avg  1.65                    367.4   0.006      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture.
 wfs(n).npixpersub   = 2;// Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*40 = 80   
 wfs(n).fssize       = 0.495;//calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.05;// 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float .... what is the modulation amplitude.... - - 
 //10*lambda/D
 wfs(n).pyr_mod_npts = 8;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7c90,layerfrac=0x7f8a548c7f38,
 layerspeed=0x7f8a548c7eb0,layeralt=0x7f8a548c7af8,winddir=0x7f8a548c7e28,
 _layeralt=0x7f8a548c79e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54930c10,lgs_prof_alt=0x7f8a5403dfd8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a54101630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00556403,
 -0.00688845],_lastvalidtt=[-0.00556403,-0.00688845],_upttcommand=[0,0],_refmes=
 0x7f8a540e2830,_tiprefv=0x7f8a540e0a30,_tiltrefv=0x7f8a5411dc30,_tiprefvn=
 0x7f8a54101c30,_tiltrefvn=0x7f8a540b9a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a549aa430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7f8a540e1430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a549aa430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a54977030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a5403db40)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a549258d8,_ctrlden=0x7f8a5403e080,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5363b540,_xlast=0x7f8a53639750,_ylast=[0x7f8a54883a30,
 0x7f8a54883a30,0x7f8a54883a30],_y0=0x7f8a549cb230,_signus=0x7f8a53637fa0,
 _puppixoffset=[0,0],_nact=80,_def=0x1014b6030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7f8a5363c590,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930eb0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a54930d28,xposition=0x7f8a5492f468,yposition=
 0x7f8a5403dfa0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930c48,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      240.7   0.008      628.3
Field Avg  1.65                    240.7   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture.
 wfs(n).npixpersub   = 2;// Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*40 = 80   
 wfs(n).fssize       = 0.495;//calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;// 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float .... what is the modulation amplitude.... - - 
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7f38,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c8048,winddir=0x7f8a548c7fc0,
 _layeralt=0x7f8a548c79e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=20,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54926630,lgs_prof_alt=0x7f8a5403dda8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a5363f470,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000694625,0.0047013],_lastvalidtt=[-0.000694625,0.0047013],_upttcommand=[0,
 0],_refmes=0x7f8a549c9e30,_tiprefv=0x7f8a549e8830,_tiltrefv=0x7f8a549e6030,
 _tiprefvn=0x7f8a54a3f630,_tiltrefvn=0x7f8a54993c30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7f8a54101430,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7f8a549dc830,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a54101430,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a549de230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7f8a54930e08)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5492f660,_ctrlden=0x7f8a549310e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5363b540,_xlast=0x7f8a5352c3a0,_ylast=[0x7f8a5407ac30,
 0x7f8a5407ac30,0x7f8a5407ac30],_y0=0x7f8a549ca630,_signus=0x7f8a5352c520,
 _puppixoffset=[0,0],_nact=80,_def=0x1014b6030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7f8a5352dbe0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a5403dfd8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a54930c48,xposition=0x7f8a549258d8,yposition=
 0x7f8a5403e080,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930eb0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      124.8   0.009      628.3
Field Avg  1.65                    124.8   0.009      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture.
 wfs(n).npixpersub   = 2;// Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*40 = 80   
 wfs(n).fssize       = 0.495;//calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;// 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float .... what is the modulation amplitude.... - - 
 //10*lambda/D
 wfs(n).pyr_mod_npts = 36;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7c90,layerfrac=0x7f8a548c7f38,
 layerspeed=0x7f8a548c7eb0,layeralt=0x7f8a548c7fc0,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a548c79e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a549259b8,lgs_prof_alt=0x7f8a54925e50,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a53531e70,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00676909,
 0.00043269],_lastvalidtt=[-0.00676909,0.00043269],_upttcommand=[0,0],_refmes=
 0x7f8a540bba30,_tiprefv=0x7f8a540efe30,_tiltrefv=0x7f8a54913030,_tiprefvn=
 0x7f8a5415a030,_tiltrefvn=0x7f8a549ad630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a54103a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7f8a540ba630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a54103a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a549a5030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a54925cc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5403db78,_ctrlden=0x7f8a5492f740,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5363b540,_xlast=0x7f8a536385a0,_ylast=[0x7f8a54883a30,
 0x7f8a54883a30,0x7f8a54883a30],_y0=0x7f8a54929830,_signus=0x7f8a5363eb10,
 _puppixoffset=[0,0],_nact=80,_def=0x1013b5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7f8a5363b9f0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a5403d8d8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5492f660,xposition=0x7f8a5403dfd8,yposition=
 0x7f8a5403dda8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a549310e0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      279.4   0.006      628.3
Field Avg  1.65                    279.4   0.006      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture.
 wfs(n).npixpersub   = 2;// Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*40 = 80   
 wfs(n).fssize       = 0.495;//calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; // The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;// 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float .... what is the modulation amplitude.... - - 
 //10*lambda/D
 wfs(n).pyr_mod_npts = 16;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7eb0,layerfrac=0x7f8a548c7c90,
 layerspeed=0x7f8a548c7e28,layeralt=0x7f8a548c7af8,winddir=0x7f8a548c79e8,
 _layeralt=0x7f8a548c7fc0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a5492f6d0,lgs_prof_alt=0x7f8a5402f230,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a53639870,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00455117,
 5.14674e-05],_lastvalidtt=[0.00455117,5.14674e-05],_upttcommand=[0,0],_refmes=
 0x7f8a54975430,_tiprefv=0x7f8a54938030,_tiltrefv=0x7f8a54966630,_tiprefvn=
 0x7f8a54913030,_tiltrefvn=0x7f8a549a9630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a540bfe30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7f8a540b8230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a540bfe30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a548dfc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a5403dc90)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5492cbf8,_ctrlden=0x7f8a54925e18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5363b090,_xlast=0x7f8a5363c070,_ylast=[0x7f8a54929830,
 0x7f8a54929830,0x7f8a54929830],_y0=0x7f8a54975c30,_signus=0x7f8a5363ab80,
 _puppixoffset=[0,0],_nact=80,_def=0x1014b6030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7f8a5363c620,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a5403d9b8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403dde0,xposition=0x7f8a54925e50,yposition=
 0x7f8a54925c58,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54925b08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      223.8   0.007      628.3
Field Avg  1.65                    223.8   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.1;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 16;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7c90,layerfrac=0x7f8a548c7e28,
 layerspeed=0x7f8a548c7eb0,layeralt=0x7f8a548c8048,winddir=0x7f8a548c7f38,
 _layeralt=0x7f8a54934360)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a549311c0,lgs_prof_alt=0x7f8a5403d868,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a5363d100,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00759449,
 0.00492816],_lastvalidtt=[-0.00759449,0.00492816],_upttcommand=[0,0],_refmes=
 0x7f8a54a55030,_tiprefv=0x7f8a549a9c30,_tiltrefv=0x7f8a5497d030,_tiprefvn=
 0x7f8a54913030,_tiltrefvn=0x7f8a549aae30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a54992a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7f8a54a53c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a54992a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a549c1a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a54930c10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=7,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a548d8678,_ctrlden=0x7f8a54925be8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5363c5f0,_xlast=0x7f8a5363b0d0,_ylast=[0x7f8a54883a30,
 0x7f8a54883a30,0x7f8a54883a30],_y0=0x7f8a54929830,_signus=0x7f8a5363a8f0,
 _puppixoffset=[0,0],_nact=80,_def=0x1013b5030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7f8a53637fa0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a5402f230,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a54925b08,xposition=0x7f8a5492f6d0,yposition=
 0x7f8a5403de18,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a5403d9b8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1395.3   0.003      628.3
Field Avg  1.65                   1395.3   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.2;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 16;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7eb0,layerfrac=0x7f8a548c7c90,
 layerspeed=0x7f8a548c7e28,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a54934360)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54930c48,lgs_prof_alt=0x7f8a549310e0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a5363df00,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00213053,
 -0.00554643],_lastvalidtt=[-0.00213053,-0.00554643],_upttcommand=[0,0],_refmes=
 0x7f8a54a0f830,_tiprefv=0x7f8a549a0e30,_tiltrefv=0x7f8a54821c30,_tiprefvn=
 0x7f8a549ad630,_tiltrefvn=0x7f8a54a53c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a5411a230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7f8a54975430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a5411a230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a548dfc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a5403db78)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a549265f8,_ctrlden=0x7f8a5492f468,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a53707000,_xlast=0x7f8a53703880,_ylast=[0x7f8a55011830,
 0x7f8a55011830,0x7f8a55011830],_y0=0x7f8a55011430,_signus=0x7f8a53708160,
 _puppixoffset=[0,0],_nact=80,_def=0x1015a6030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7f8a5363b500,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a5403d9b8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a548d8678,xposition=0x7f8a5402f230,yposition=
 0x7f8a5403d868,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54925be8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      241.7   0.007      628.3
Field Avg  1.65                    241.7   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.02;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 16;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7c90,layerfrac=0x7f8a548c7e28,
 layerspeed=0x7f8a548c7eb0,layeralt=0x7f8a548c7af8,winddir=0x7f8a548c79e8,
 _layeralt=0x7f8a54934360)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=16,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54925b78,lgs_prof_alt=0x7f8a54930eb0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a5410ba30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000545338,0.00314949],_lastvalidtt=[-0.000545338,0.00314949],_upttcommand=
 [0,0],_refmes=0x7f8a54913030,_tiprefv=0x7f8a549ad630,_tiltrefv=0x7f8a54975430,
 _tiprefvn=0x7f8a5494de30,_tiltrefvn=0x7f8a54975e30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7f8a54978a30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7f8a5410f030,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a54978a30,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a54115030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7f8a54931038)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a54925b40,_ctrlden=0x7f8a5403db08,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5352dea0,_xlast=0x7f8a5352c0e0,_ylast=[0x7f8a5407ac30,
 0x7f8a5407ac30,0x7f8a5407ac30],_y0=0x7f8a540ad830,_signus=0x7f8a53530cc0,
 _puppixoffset=[0,0],_nact=80,_def=0x101394030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7f8a5352e3a0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a5403d868,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a54925be8,xposition=0x7f8a549265f8,yposition=
 0x7f8a5492f468,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a5403d9b8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      141.9   0.011      628.3
Field Avg  1.65                    141.9   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c8048,winddir=0x7f8a548c7f38,
 _layeralt=0x7f8a54933d88)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a5403db78,lgs_prof_alt=0x7f8a5403dde0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a55018630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00206932,
 0.00129505],_lastvalidtt=[0.00206932,0.00129505],_upttcommand=[0,0],_refmes=
 0x7f8a53866830,_tiprefv=0x7f8a53866030,_tiltrefv=0x7f8a5410b630,_tiprefvn=
 0x7f8a53821430,_tiltrefvn=0x7f8a55011430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a5409be30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7f8a540e8630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a5409be30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a5499a630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a5492f698)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5492f9a8,_ctrlden=0x7f8a54925e18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a53407b10,_xlast=0x7f8a53407c90,_ylast=[0x7f8a53816230,
 0x7f8a53816230,0x7f8a53816230],_y0=0x7f8a53821c30,_signus=0x7f8a5340a130,
 _puppixoffset=[0,0],_nact=80,_def=0x1014b6030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7f8a536385a0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a5492f468,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d9b8,xposition=0x7f8a54931000,yposition=
 0x7f8a5403db08,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a5403d868,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      134.8   0.012      628.3
Field Avg  1.65                    134.8   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ae60,winddir=0x7fba6c92add8,
 _layeralt=0x7fba6c92aaa8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6b808d80,lgs_prof_alt=0x7fba6c91d860,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9c5030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00294468,
 -0.00667043],_lastvalidtt=[0.00294468,-0.00667043],_upttcommand=[0,0],_refmes=
 0x7fba6b06f630,_tiprefv=0x7fba6b072230,_tiltrefv=0x7fba6c986630,_tiprefvn=
 0x7fba6b15c230,_tiltrefvn=0x7fba6c9caa30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cac2230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b80a830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cac2230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca84e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927ee0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9275e8,_ctrlden=0x7fba6b808fe8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af34720,_xlast=0x7fba6af394d0,_ylast=[0x7fba6ca19030,
 0x7fba6ca19030,0x7fba6ca19030],_y0=0x7fba6c976230,_signus=0x7fba6af3bfe0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d36d030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2bed0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c928ab8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c8cec40,xposition=0x7fba6c91d668,yposition=
 0x7fba6c928380,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928a48,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      145.3   0.014      628.3
Field Avg  1.65                    145.3   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92b080)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927f18,lgs_prof_alt=0x7fba6c9272a0,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ca19030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00424424,
 -0.00138599],_lastvalidtt=[0.00424424,-0.00138599],_upttcommand=[0,0],_refmes=
 0x7fba6c0a1a30,_tiprefv=0x7fba6c9c4830,_tiltrefv=0x7fba6c0b7830,_tiprefvn=
 0x7fba6c975a30,_tiltrefvn=0x7fba6c0afa30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0c8230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a5430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0c8230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927ff8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927620,_ctrlden=0x7fba6c927ea8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0df80,_xlast=0x7fba6ad0ad20,_ylast=[0x7fba6b839c30,
 0x7fba6b839c30,0x7fba6b839c30],_y0=0x7fba6b83f430,_signus=0x7fba6ad0d8b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2ca00,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c928380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928a48,xposition=0x7fba6c9283f0,yposition=
 0x7fba6b808fe8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928ab8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      133.4   0.014      628.3
Field Avg  1.65                    133.4   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b328)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b80d430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00405127,
 0.00133777],_lastvalidtt=[0.00405127,0.00133777],_upttcommand=[0,0],_refmes=
 0x7fba6b83b630,_tiprefv=0x7fba6b072a30,_tiltrefv=0x7fba6b089230,_tiprefvn=
 0x7fba6b06f630,_tiltrefvn=0x7fba6b0a0e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9c3c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca87a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9c3c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928428)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9275e8,_ctrlden=0x7fba6c927268,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c600,_xlast=0x7fba6ae0c780,_ylast=[0x7fba6c032c30,
 0x7fba6c032c30,0x7fba6c032c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c900,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0c780,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c91dba8,yposition=
 0x7fba6c927ea8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      178.6   0.014      628.3
Field Avg  1.65                    178.6   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92ab30)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae0fe00,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000136185,0.00842228],_lastvalidtt=[-0.000136185,0.00842228],_upttcommand=
 [0,0],_refmes=0x7fba6ca16e30,_tiprefv=0x7fba6c985e30,_tiltrefv=0x7fba6c0c1e30,
 _tiprefvn=0x7fba6c9cc830,_tiltrefvn=0x7fba6c0afa30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6c0a1e30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6b835630,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c0a1e30,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c9284d0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b8092c0,_ctrlden=0x7fba6c928fc0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c220,_xlast=0x7fba6ae0c3a0,_ylast=[0x7fba6c014c30,
 0x7fba6c014c30,0x7fba6c014c30],_y0=0x7fba6c0a4230,_signus=0x7fba6ae0c520,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c927f18,yposition=
 0x7fba6c91da90,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      181.4   0.012      628.3
Field Avg  1.65                    181.4   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bb00)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad11060,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00350908,
 -0.00284083],_lastvalidtt=[-0.00350908,-0.00284083],_upttcommand=[0,0],_refmes=
 0x7fba6c0c1030,_tiprefv=0x7fba6b831a30,_tiltrefv=0x7fba6c0b0230,_tiprefvn=
 0x7fba6b83ba30,_tiltrefvn=0x7fba6c0c1e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0d7030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9e8830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0d7030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c996c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927f50)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927850,_ctrlden=0x7fba6b809250,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0df80,_xlast=0x7fba6ad0ad20,_ylast=[0x7fba6b839c30,
 0x7fba6b839c30,0x7fba6b839c30],_y0=0x7fba6b83c230,_signus=0x7fba6ad0fcd0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0b810,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c928428,yposition=
 0x7fba6b81a088,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1105.1   0.004      628.3
Field Avg  1.65                   1105.1   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c270)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae0cb90,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000423191,
 0.00335436],_lastvalidtt=[0.000423191,0.00335436],_upttcommand=[0,0],_refmes=
 0x7fba6c0b8a30,_tiprefv=0x7fba6c9cc830,_tiltrefv=0x7fba6c0a3830,_tiprefvn=
 0x7fba6ca18430,_tiltrefvn=0x7fba6c0b0230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9e9e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b859830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9e9e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b08fc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d7f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9282d8,_ctrlden=0x7fba6b809138,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af31ab0,_xlast=0x7fba6af2c100,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6c976230,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2e530,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c9284d0,yposition=
 0x7fba6c927a80,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      201.9   0.010      628.3
Field Avg  1.65                    201.9   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b748)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b80e830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00525196,
 0.00146752],_lastvalidtt=[0.00525196,0.00146752],_upttcommand=[0,0],_refmes=
 0x7fba6b06f630,_tiprefv=0x7fba6b08e030,_tiltrefv=0x7fba6c9cc830,_tiprefvn=
 0x7fba6b07f430,_tiltrefvn=0x7fba6c974a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0d1230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c117630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0d1230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9eb230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927540)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d860,_ctrlden=0x7fba6c928fc0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac28c80,_xlast=0x7fba6ac29340,_ylast=[0x7fba6b07ae30,
 0x7fba6b07ae30,0x7fba6b07ae30],_y0=0x7fba6b022630,_signus=0x7fba6ac367d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2ca00,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c927f50,yposition=
 0x7fba6c927fc0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      297.3   0.008      628.3
Field Avg  1.65                    297.3   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c2f8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9e1e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00560818,
 -0.00213041],_lastvalidtt=[0.00560818,-0.00213041],_upttcommand=[0,0],_refmes=
 0x7fba6c99b030,_tiprefv=0x7fba6c9e0430,_tiltrefv=0x7fba6b0ca630,_tiprefvn=
 0x7fba6cad6e30,_tiltrefvn=0x7fba6b06f630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b15ac30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0f8230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b15ac30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c997630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dda0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927968,_ctrlden=0x7fba6c927578,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0df80,_xlast=0x7fba6ad0bfd0,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b839c30,_signus=0x7fba6ad0ad20,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac37750,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c91d7f0,yposition=
 0x7fba6b809020,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      139.2   0.014      628.3
Field Avg  1.65                    139.2   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bd20)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac38e10,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00228027,
 0.00245071],_lastvalidtt=[0.00228027,0.00245071],_upttcommand=[0,0],_refmes=
 0x7fba6b0a2030,_tiprefv=0x7fba6ca18430,_tiltrefv=0x7fba6c0afa30,_tiprefvn=
 0x7fba6c9e0430,_tiltrefvn=0x7fba6c0b0230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9dc230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9ea030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9dc230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c990230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928ff8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d9b0,_ctrlden=0x7fba6c927e38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac28ec0,_xlast=0x7fba6ac378d0,_ylast=[0x7fba6b022630,
 0x7fba6b022630,0x7fba6b022630],_y0=0x7fba6b0a9e30,_signus=0x7fba6ac38b20,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac381a0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c927540,yposition=
 0x7fba6c928f88,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      106.3   0.014      628.3
Field Avg  1.65                    106.3   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bda8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac2cd10,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00513648,
 -0.00398993],_lastvalidtt=[0.00513648,-0.00398993],_upttcommand=[0,0],_refmes=
 0x7fba6c985e30,_tiprefv=0x7fba6b0ca630,_tiltrefv=0x7fba6b06f630,_tiprefvn=
 0x7fba6b0f7830,_tiltrefvn=0x7fba6b0a1e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0d3030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a3030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0d3030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0a8030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928c40)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91db00,_ctrlden=0x7fba6c927428,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac33010,_xlast=0x7fba6ac28320,_ylast=[0x7fba6b0a9e30,
 0x7fba6b0a9e30,0x7fba6b0a9e30],_y0=0x7fba6b080030,_signus=0x7fba6ac32cf0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0b4e0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c91dda0,yposition=
 0x7fba6c927380,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      383.8   0.006      628.3
Field Avg  1.65                    383.8   0.006      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92ba78)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad10300,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-4.33335e-05,-0.0046493],_lastvalidtt=[-4.33335e-05,-0.0046493],_upttcommand=
 [0,0],_refmes=0x7fba6b85c830,_tiprefv=0x7fba6c09f030,_tiltrefv=0x7fba6b837230,
 _tiprefvn=0x7fba6c01b230,_tiltrefvn=0x7fba6b80e230,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b0a2830,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6b0cee30,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0a2830,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b098430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c928dc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91da20,_ctrlden=0x7fba6c91d7f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0df80,_xlast=0x7fba6ad0c780,_ylast=[0x7fba6b839c30,
 0x7fba6b839c30,0x7fba6b839c30],_y0=0x7fba6b83f430,_signus=0x7fba6ad0d8b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af33bc0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c928ff8,yposition=
 0x7fba6c928508,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      203.1   0.015      628.3
Field Avg  1.65                    203.1   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bc98)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b072a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00383258,
 -0.00170082],_lastvalidtt=[0.00383258,-0.00170082],_upttcommand=[0,0],_refmes=
 0x7fba6b081430,_tiprefv=0x7fba6c0b3830,_tiltrefv=0x7fba6b07d630,_tiprefvn=
 0x7fba6c0afa30,_tiltrefvn=0x7fba6b0d5c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9c2630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0b4c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9c2630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c975430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928498)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927f88,_ctrlden=0x7fba6c91dda0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c3d0,_xlast=0x7fba6ae0c550,_ylast=[0x7fba6c032c30,
 0x7fba6c032c30,0x7fba6c032c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0d3b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac28320,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c928c40,yposition=
 0x7fba6c924a30,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      123.9   0.017      628.3
Field Avg  1.65                    123.9   0.017      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c408)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c986430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00755176,
 -0.00287125],_lastvalidtt=[0.00755176,-0.00287125],_upttcommand=[0,0],_refmes=
 0x7fba6b855630,_tiprefv=0x7fba6b80a830,_tiltrefv=0x7fba6b80de30,_tiprefvn=
 0x7fba6b83b630,_tiltrefvn=0x7fba6b856030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0d1a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a2630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0d1a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b08fc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c929030)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d9e8,_ctrlden=0x7fba6c928c08,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac28950,_xlast=0x7fba6ac28ad0,_ylast=[0x7fba6b022630,
 0x7fba6b022630,0x7fba6b022630],_y0=0x7fba6b0a9e30,_signus=0x7fba6ac33220,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34720,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c928dc8,yposition=
 0x7fba6c928460,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      135.2   0.012      628.3
Field Avg  1.65                    135.2   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b3b0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac34720,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00825478,
 -0.000412396],_lastvalidtt=[0.00825478,-0.000412396],_upttcommand=[0,0],
 _refmes=0x7fba6b072230,_tiprefv=0x7fba6b0c9030,_tiltrefv=0x7fba6b072a30,
 _tiprefvn=0x7fba6b0b5830,_tiltrefvn=0x7fba6b079230,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b0d3a30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6ca14c30,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0d3a30,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b08fc30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6b808e28)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927f18,_ctrlden=0x7fba6c91db00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0c380,_xlast=0x7fba6ad0c930,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b80ec30,_signus=0x7fba6ad097c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c928498,yposition=
 0x7fba6c927380,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      158.2   0.015      628.3
Field Avg  1.65                    158.2   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b218)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af39430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00449463,
 -0.00372173],_lastvalidtt=[-0.00449463,-0.00372173],_upttcommand=[0,0],_refmes=
 0x7fba6b0d8030,_tiprefv=0x7fba6b80ae30,_tiltrefv=0x7fba6c9e4a30,_tiprefvn=
 0x7fba6b80ce30,_tiltrefvn=0x7fba6ca18c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0c5230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0c3e30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0c5230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928428)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927578,_ctrlden=0x7fba6b8091a8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2d1c0,_xlast=0x7fba6ac34d40,_ylast=[0x7fba6b0a9e30,
 0x7fba6b0a9e30,0x7fba6b0a9e30],_y0=0x7fba6b022630,_signus=0x7fba6ac38230,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af391c0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c929030,yposition=
 0x7fba6c927e38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      520.6   0.005      628.3
Field Avg  1.65                    520.6   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b7d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af376a0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00314901,
 -0.00716756],_lastvalidtt=[0.00314901,-0.00716756],_upttcommand=[0,0],_refmes=
 0x7fba6caca230,_tiprefv=0x7fba6b07ec30,_tiltrefv=0x7fba6c975230,_tiprefvn=
 0x7fba6b0b5830,_tiltrefvn=0x7fba6c9e4a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0d4a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0ade30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0d4a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cacaa30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d940)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927268,_ctrlden=0x7fba6c927fc0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0bcd0,_xlast=0x7fba6ae0c220,_ylast=[0x7fba6c032c30,
 0x7fba6c032c30,0x7fba6c032c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c3a0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac35280,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6b808e28,yposition=
 0x7fba6c9279d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.8   0.017      628.3
Field Avg  1.65                    117.8   0.017      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b638)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c986830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00813036,
 -0.00214586],_lastvalidtt=[0.00813036,-0.00214586],_upttcommand=[0,0],_refmes=
 0x7fba6c985e30,_tiprefv=0x7fba6b0b8830,_tiltrefv=0x7fba6b83ba30,_tiprefvn=
 0x7fba6b0bf230,_tiltrefvn=0x7fba6b80a830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca8c630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0ea830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca8c630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b076a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809138)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928e38,_ctrlden=0x7fba6c8cec40,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0ad20,_xlast=0x7fba6ad0d190,_ylast=[0x7fba6b839c30,
 0x7fba6b839c30,0x7fba6b839c30],_y0=0x7fba6b83f430,_signus=0x7fba6ad0a1d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af37a80,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c928428,yposition=
 0x7fba6c927a10,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      111.3   0.018      628.3
Field Avg  1.65                    111.3   0.018      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c050)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b85da30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00489516,
 -0.001167],_lastvalidtt=[0.00489516,-0.001167],_upttcommand=[0,0],_refmes=
 0x7fba6b0b7e30,_tiprefv=0x7fba6b08ea30,_tiltrefv=0x7fba6b0b7230,_tiprefvn=
 0x7fba6b0b8830,_tiltrefvn=0x7fba6b07ec30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b07ce30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0bba30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b07ce30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b05bc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b8093d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927ea8,_ctrlden=0x7fba6c928508,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0d310,_xlast=0x7fba6ad0ad20,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b804030,_signus=0x7fba6ad0a490,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2ca00,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c91d940,yposition=
 0x7fba6c928af0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      138.8   0.015      628.3
Field Avg  1.65                    138.8   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92beb8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac291f0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00400266,
 -0.00607051],_lastvalidtt=[0.00400266,-0.00607051],_upttcommand=[0,0],_refmes=
 0x7fba6c0b0230,_tiprefv=0x7fba6b072230,_tiltrefv=0x7fba6ca18430,_tiprefvn=
 0x7fba6b072a30,_tiltrefvn=0x7fba6ca91e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0ee630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9ca830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0ee630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9277e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928ce8,_ctrlden=0x7fba6c9279d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af35a40,_xlast=0x7fba6af34720,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6c9cbc30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6b809138,yposition=
 0x7fba6c928d20,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      190.6   0.011      628.3
Field Avg  1.65                    190.6   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bc10)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac38f50,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.002328,
 -0.00116331],_lastvalidtt=[-0.002328,-0.00116331],_upttcommand=[0,0],_refmes=
 0x7fba6b080c30,_tiprefv=0x7fba6b80a830,_tiltrefv=0x7fba6c985e30,_tiprefvn=
 0x7fba6b850230,_tiltrefvn=0x7fba6ca18430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cabaa30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9ea030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cabaa30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928f88)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c8cec40,_ctrlden=0x7fba6c928428,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af35a40,_ylast=[0x7fba6c9cbc30,
 0x7fba6c9cbc30,0x7fba6c9cbc30],_y0=0x7fba6c9eb430,_signus=0x7fba6af363b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34b10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6b8093d8,yposition=
 0x7fba6c927968,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1295.7   0.004      628.3
Field Avg  1.65                   1295.7   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bfc8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad10930,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00466876,
 -0.00378038],_lastvalidtt=[0.00466876,-0.00378038],_upttcommand=[0,0],_refmes=
 0x7fba6b0ca630,_tiprefv=0x7fba6b0de030,_tiltrefv=0x7fba6b850230,_tiprefvn=
 0x7fba6b06f630,_tiltrefvn=0x7fba6b80a830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0dc230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b82ca30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0dc230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b05bc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b8091e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9279d8,_ctrlden=0x7fba6c91da20,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0ad20,_xlast=0x7fba6ad0a1d0,_ylast=[0x7fba6b804030,
 0x7fba6b804030,0x7fba6b804030],_y0=0x7fba6b83f430,_signus=0x7fba6ad0a350,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0b6e0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c9277e0,yposition=
 0x7fba6c91d7b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      213.7   0.012      628.3
Field Avg  1.65                    213.7   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c518)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0b6430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00709949,
 0.00379064],_lastvalidtt=[0.00709949,0.00379064],_upttcommand=[0,0],_refmes=
 0x7fba6c9cb630,_tiprefv=0x7fba6c996c30,_tiltrefv=0x7fba6b83b030,_tiprefvn=
 0x7fba6c985e30,_tiltrefvn=0x7fba6b80b630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b08d430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9c4430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b08d430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927888)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d908,_ctrlden=0x7fba6b8092c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af34370,_xlast=0x7fba6af36760,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6c8c4a30,_signus=0x7fba6af399f0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac35aa0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c928f88,yposition=
 0x7fba6c9282a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      118.3   0.018      628.3
Field Avg  1.65                    118.3   0.018      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b108)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b83c030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00755151,
 -0.00380513],_lastvalidtt=[0.00755151,-0.00380513],_upttcommand=[0,0],_refmes=
 0x7fba6b0db030,_tiprefv=0x7fba6c99b830,_tiltrefv=0x7fba6c9e4430,_tiprefvn=
 0x7fba6c996c30,_tiltrefvn=0x7fba6c985e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9c7c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0e6c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9c7c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c990230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dba8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927fc0,_ctrlden=0x7fba6b808db8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0a1d0,_xlast=0x7fba6ad0df80,_ylast=[0x7fba6b804030,
 0x7fba6b804030,0x7fba6b804030],_y0=0x7fba6b837e30,_signus=0x7fba6ad0ad20,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac28320,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6b8091e0,yposition=
 0x7fba6c927f50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      149.5   0.012      628.3
Field Avg  1.65                    149.5   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bf40)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af39690,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000411662,-0.00458645],_lastvalidtt=[-0.000411662,-0.00458645],
 _upttcommand=[0,0],_refmes=0x7fba6ca18430,_tiprefv=0x7fba6b0e3e30,_tiltrefv=
 0x7fba6c996c30,_tiprefvn=0x7fba6b0e7430,_tiltrefvn=0x7fba6c99b830,_reordervec=
 0x0,_npixels=0,_npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,
 _binindices=0x0,_binxy=0,_centroidw=0x0,_fimage=0x7fba6cab7630,_fimage2=0x0,
 _imistart=0x0,_imjstart=0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,
 _unittilt=0x0,_lgs_defocuses=0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=
 0x0,_yoffset=0x0,_bias=0x0,_flat=0x0,_domask=0,_submask=0x7fba6b0e4830,_kernel=
 0x0,_kernels=0x0,_kerfftr=0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fba6cab7630,_x=0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,
 _bckgrdcalib=0x7fba6b076a30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fba6c91e3c0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b025830,_ctrlden=0x7fba6c928cb0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6c976230,_signus=0x7fba6af363b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2bd50,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c927888,yposition=
 0x7fba6c927968,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      135.7   0.018      628.3
Field Avg  1.65                    135.7   0.018      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b328)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af390d0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00359205,
 0.00277094],_lastvalidtt=[0.00359205,0.00277094],_upttcommand=[0,0],_refmes=
 0x7fba6c9eae30,_tiprefv=0x7fba6b80ce30,_tiltrefv=0x7fba6b0b7230,_tiprefvn=
 0x7fba6b80ae30,_tiltrefvn=0x7fba6b0c1430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca93c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cab3830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca93c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c929030)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d7b8,_ctrlden=0x7fba6c9273b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac35140,_xlast=0x7fba6ac329e0,_ylast=[0x7fba6b081a30,
 0x7fba6b081a30,0x7fba6b081a30],_y0=0x7fba6b0ca230,_signus=0x7fba6ac2bed0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0a1d0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c91dba8,yposition=
 0x7fba6c927540,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      903.0   0.004      628.3
Field Avg  1.65                    903.0   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92ab30)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af32ab0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000795494,
 0.00109091],_lastvalidtt=[0.000795494,0.00109091],_upttcommand=[0,0],_refmes=
 0x7fba6b06f630,_tiprefv=0x7fba6ca18430,_tiltrefv=0x7fba6b80bc30,_tiprefvn=
 0x7fba6c986630,_tiltrefvn=0x7fba6b80e430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caf5630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca92830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caf5630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c985e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927508)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927ea8,_ctrlden=0x7fba6c9283b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0bcd0,_xlast=0x7fba6ae0b4e0,_ylast=[0x7fba6c032c30,
 0x7fba6c032c30,0x7fba6c032c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0b660,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c91e3c0,yposition=
 0x7fba6c927f88,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      220.5   0.011      628.3
Field Avg  1.65                    220.5   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b638)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ee0,lgs_prof_alt=0x7fba6c927a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6caab630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.0029013,
 -0.0013034],_lastvalidtt=[-0.0029013,-0.0013034],_upttcommand=[0,0],_refmes=
 0x7fba6b80ce30,_tiprefv=0x7fba6c9ea630,_tiltrefv=0x7fba6b06f630,_tiprefvn=
 0x7fba6ca16230,_tiltrefvn=0x7fba6b072230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c0c3830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cae2a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c0c3830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0a8030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927428)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b8091e0,_ctrlden=0x7fba6c927380,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af32380,_xlast=0x7fba6af300c0,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6c976230,_signus=0x7fba6af38650,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2e490,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6b808fe8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928ab8,xposition=0x7fba6c929030,yposition=
 0x7fba6c9279a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c928380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      178.6   0.012      628.3
Field Avg  1.65                    178.6   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c2f8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b08fc30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00160709,
 -0.0125122],_lastvalidtt=[-0.00160709,-0.0125122],_upttcommand=[0,0],_refmes=
 0x7fba6c0afa30,_tiprefv=0x7fba6c01b230,_tiltrefv=0x7fba6c996c30,_tiprefvn=
 0x7fba6c0b7a30,_tiltrefvn=0x7fba6c99b830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b08a830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b80b230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b08a830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0a3230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b8093d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d668,_ctrlden=0x7fba6c9273f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0bcd0,_xlast=0x7fba6ae0c220,_ylast=[0x7fba6c014c30,
 0x7fba6c014c30,0x7fba6c014c30],_y0=0x7fba6c09fa30,_signus=0x7fba6ae0c3a0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0b7d0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927620,yposition=
 0x7fba6c927380,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      185.4   0.010      628.3
Field Avg  1.65                    185.4   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bb88)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b83b630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00684101,
 -0.00549901],_lastvalidtt=[-0.00684101,-0.00549901],_upttcommand=[0,0],_refmes=
 0x7fba6b895630,_tiprefv=0x7fba6b83bc30,_tiltrefv=0x7fba6b89ae30,_tiprefvn=
 0x7fba6b854430,_tiltrefvn=0x7fba6b890030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9ea030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0cee30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9ea030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca18e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928fc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91db38,_ctrlden=0x7fba6b809138,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6c976230,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af33b60,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927ee0,yposition=
 0x7fba6c928268,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      221.6   0.010      628.3
Field Avg  1.65                    221.6   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92b748)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0caa30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000671676,
 0.00656103],_lastvalidtt=[0.000671676,0.00656103],_upttcommand=[0,0],_refmes=
 0x7fba6b072230,_tiprefv=0x7fba6b0eb630,_tiltrefv=0x7fba6b83bc30,_tiprefvn=
 0x7fba6b0d4430,_tiltrefvn=0x7fba6b89ae30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b138630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9e7c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b138630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b85c630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9282d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d7b8,_ctrlden=0x7fba6b809100,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2c160,_xlast=0x7fba6af2ca00,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6c978430,_signus=0x7fba6af2f560,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac34ea0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6b8093d8,yposition=
 0x7fba6b808e28,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      246.7   0.008      628.3
Field Avg  1.65                    246.7   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c518)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c990230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.0011866,
 0.00206071],_lastvalidtt=[-0.0011866,0.00206071],_upttcommand=[0,0],_refmes=
 0x7fba6ca16230,_tiprefv=0x7fba6c996c30,_tiltrefv=0x7fba6cabd630,_tiprefvn=
 0x7fba6c985e30,_tiltrefvn=0x7fba6c9e0430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0d6e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9e1830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0d6e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dc50)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dc18,_ctrlden=0x7fba6c928460,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0d8b0,_xlast=0x7fba6ad0df80,_ylast=[0x7fba6b804030,
 0x7fba6b804030,0x7fba6b804030],_y0=0x7fba6b83f430,_signus=0x7fba6ad0c780,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0b140,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c928fc0,yposition=
 0x7fba6c928498,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.003      628.3
Field Avg  1.65                   1418.0   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92b9f0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad10f80,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[4.95784e+11,
 3.83021e+11],_lastvalidtt=[4.95784e+11,3.83021e+11],_upttcommand=[0,0],_refmes=
 0x7fba6b82fa30,_tiprefv=0x7fba6b850230,_tiltrefv=0x7fba6b835630,_tiprefvn=
 0x7fba6b835e30,_tiltrefvn=0x7fba6b851230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0e3830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b82c630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0e3830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928ce8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928bd0,_ctrlden=0x7fba6c928268,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac289d0,_xlast=0x7fba6ac2bff0,_ylast=[0x7fba6b022630,
 0x7fba6b022630,0x7fba6b022630],_y0=0x7fba6b096430,_signus=0x7fba6ac33b80,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0da30,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c9282d8,yposition=
 0x7fba6b809250,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      272.3   0.009      628.3
Field Avg  1.65                    272.3   0.009      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c380)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b08fc30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.0023411,
 0.00526335],_lastvalidtt=[-0.0023411,0.00526335],_upttcommand=[0,0],_refmes=
 0x7fba6b080c30,_tiprefv=0x7fba6b06f630,_tiltrefv=0x7fba6b0cf630,_tiprefvn=
 0x7fba6b0e3e30,_tiltrefvn=0x7fba6b0d0030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cad4e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0bdc30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cad4e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9277e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928540,_ctrlden=0x7fba6c9275e8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0e680,_xlast=0x7fba6ae0b4e0,_ylast=[0x7fba6c014c30,
 0x7fba6c014c30,0x7fba6c014c30],_y0=0x7fba6c0c4830,_signus=0x7fba6ae0f780,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c91dc50,yposition=
 0x7fba6c9284d0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      168.7   0.012      628.3
Field Avg  1.65                    168.7   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92aaa8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b072a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00777813,
 -0.0106106],_lastvalidtt=[0.00777813,-0.0106106],_upttcommand=[0,0],_refmes=
 0x7fba6c985e30,_tiprefv=0x7fba6ca18430,_tiltrefv=0x7fba6c999030,_tiprefvn=
 0x7fba6ca14c30,_tiltrefvn=0x7fba6ca16230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b852830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b836630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b852830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927f18)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928268,_ctrlden=0x7fba6c928460,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c420,_xlast=0x7fba6ae0c5a0,_ylast=[0x7fba6c0c4830,
 0x7fba6c0c4830,0x7fba6c0c4830],_y0=0x7fba6c09fa30,_signus=0x7fba6ae0ca30,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac38980,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c928ce8,yposition=
 0x7fba6b808e28,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      177.2   0.011      628.3
Field Avg  1.65                    177.2   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bd20)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b834430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.0103267,
 -0.00511263],_lastvalidtt=[0.0103267,-0.00511263],_upttcommand=[0,0],_refmes=
 0x7fba6b80be30,_tiprefv=0x7fba6b865e30,_tiltrefv=0x7fba6b868e30,_tiprefvn=
 0x7fba6b850c30,_tiltrefvn=0x7fba6b853630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0e1a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0ad230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0e1a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b80ea30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dac8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d898,_ctrlden=0x7fba6c9282d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af34720,_xlast=0x7fba6af2cc50,_ylast=[0x7fba6c90dc30,
 0x7fba6c90dc30,0x7fba6c90dc30],_y0=0x7fba6c9eb430,_signus=0x7fba6af2f560,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c9277e0,yposition=
 0x7fba6c924a30,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      177.2   0.014      628.3
Field Avg  1.65                    177.2   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92b108)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ca9d030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000828136,
 -0.000229484],_lastvalidtt=[0.000828136,-0.000229484],_upttcommand=[0,0],
 _refmes=0x7fba6c985e30,_tiprefv=0x7fba6c999030,_tiltrefv=0x7fba6cad8030,
 _tiprefvn=0x7fba6c99b830,_tiltrefvn=0x7fba6ca9d630,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6ca93230,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6ca96a30,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca93230,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9e9a30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c928ff8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928c08,_ctrlden=0x7fba6c91dc50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af379d0,_xlast=0x7fba6ac36c70,_ylast=[0x7fba6b08f030,
 0x7fba6b08f030,0x7fba6b08f030],_y0=0x7fba6c976230,_signus=0x7fba6ac33b80,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac28b70,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927f18,yposition=
 0x7fba6b81a088,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      110.2   0.013      628.3
Field Avg  1.65                    110.2   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c270)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0cb830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-9.52971e-05,0.00152054],_lastvalidtt=[-9.52971e-05,0.00152054],_upttcommand=
 [0,0],_refmes=0x7fba6b080c30,_tiprefv=0x7fba6c0afa30,_tiltrefv=0x7fba6c0b6430,
 _tiprefvn=0x7fba6c09f030,_tiltrefvn=0x7fba6c0b3830,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b0e1030,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6ca97e30,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0e1030,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b05bc30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c927888)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928f88,_ctrlden=0x7fba6c91e388,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0b830,_xlast=0x7fba6ad10560,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b85c830,_signus=0x7fba6ad10e40,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c91dac8,yposition=
 0x7fba6c927f50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      103.9   0.013      628.3
Field Avg  1.65                    103.9   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c490)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6caf9830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00434258,
 -0.00682581],_lastvalidtt=[0.00434258,-0.00682581],_upttcommand=[0,0],_refmes=
 0x7fba6c99b830,_tiprefv=0x7fba6b0dbc30,_tiltrefv=0x7fba6b06f630,_tiprefvn=
 0x7fba6b080c30,_tiltrefvn=0x7fba6b0d5230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0ec030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca95430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0ec030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b05bc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809170)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d7b8,_ctrlden=0x7fba6c91e3c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac33930,_xlast=0x7fba6ac29450,_ylast=[0x7fba6b096430,
 0x7fba6b096430,0x7fba6b096430],_y0=0x7fba6b022630,_signus=0x7fba6ac38670,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2cd10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c928ff8,yposition=
 0x7fba6c927700,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      850.9   0.004      628.3
Field Avg  1.65                    850.9   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92b6c0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9cae30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000203996,
 -0.0104045],_lastvalidtt=[0.000203996,-0.0104045],_upttcommand=[0,0],_refmes=
 0x7fba6c99b830,_tiprefv=0x7fba6c9c6630,_tiltrefv=0x7fba6c9dc230,_tiprefvn=
 0x7fba6c999030,_tiltrefvn=0x7fba6c9ea030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caa1630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca8fa30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caa1630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c990230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927fc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928540,_ctrlden=0x7fba6c928fc0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af32380,_ylast=[0x7fba6c90dc30,
 0x7fba6c90dc30,0x7fba6c90dc30],_y0=0x7fba6c9cb430,_signus=0x7fba6af369a0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af38910,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927888,yposition=
 0x7fba6b809020,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 140 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      583.7   0.005      628.3
Field Avg  1.65                    583.7   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92b328)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ca17630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=140,_nsub4disp=0,_nmes=
 280,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00065041,
 -0.000775958],_lastvalidtt=[0.00065041,-0.000775958],_upttcommand=[0,0],
 _refmes=0x7fba6c986430,_tiprefv=0x7fba6c9e3430,_tiltrefv=0x7fba6ca92430,
 _tiprefvn=0x7fba6c9c6630,_tiltrefvn=0x7fba6c9dc230,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b085c30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6b85b630,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b085c30,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9c1630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6b8093d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928bd0,_ctrlden=0x7fba6c91da90,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0bcd0,_xlast=0x7fba6ae0c220,_ylast=[0x7fba6c014c30,
 0x7fba6c014c30,0x7fba6c014c30],_y0=0x7fba6c09fa30,_signus=0x7fba6ae0c3a0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0b660,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6b809170,yposition=
 0x7fba6c927e38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      814.7   0.005      628.3
Field Avg  1.65                    814.7   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92aee8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c990230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.0028424,
 -0.00392681],_lastvalidtt=[-0.0028424,-0.00392681],_upttcommand=[0,0],_refmes=
 0x7fba6c996c30,_tiprefv=0x7fba6c999030,_tiltrefv=0x7fba6caa4830,_tiprefvn=
 0x7fba6c9e3430,_tiltrefvn=0x7fba6ca92430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b08d630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0c5430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b08d630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b08fc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dcc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928508,_ctrlden=0x7fba6c91dba8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac35140,_xlast=0x7fba6ac36c70,_ylast=[0x7fba6b022630,
 0x7fba6b022630,0x7fba6b022630],_y0=0x7fba6b081230,_signus=0x7fba6ac33b80,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927fc0,yposition=
 0x7fba6c927690,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 140 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      737.5   0.005      628.3
Field Avg  1.65                    737.5   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92b218)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b82e030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=140,_nsub4disp=0,_nmes=
 280,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00406559,
 -0.0074044],_lastvalidtt=[-0.00406559,-0.0074044],_upttcommand=[0,0],_refmes=
 0x7fba6b82e630,_tiprefv=0x7fba6b836830,_tiltrefv=0x7fba6b826e30,_tiprefvn=
 0x7fba6b837230,_tiltrefvn=0x7fba6b858430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9e2030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b853630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9e2030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b08fc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9282a0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928268,_ctrlden=0x7fba6c91d668,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2c100,_xlast=0x7fba6af39160,_ylast=[0x7fba6c986c30,
 0x7fba6c986c30,0x7fba6c986c30],_y0=0x7fba6ca9c630,_signus=0x7fba6af3a0f0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2e240,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6b8093d8,yposition=
 0x7fba6c91d940,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      537.7   0.006      628.3
Field Avg  1.65                    537.7   0.006      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92af70)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9e7230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00586064,
 -0.000825964],_lastvalidtt=[0.00586064,-0.000825964],_upttcommand=[0,0],
 _refmes=0x7fba6c9dee30,_tiprefv=0x7fba6c9cae30,_tiltrefv=0x7fba6ca95830,
 _tiprefvn=0x7fba6c985e30,_tiltrefvn=0x7fba6ca94e30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b826430,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6c9e0c30,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b826430,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c927a80)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b809100,_ctrlden=0x7fba6b809138,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6ca9c630,
 0x7fba6ca9c630,0x7fba6ca9c630],_y0=0x7fba6c986830,_signus=0x7fba6af2f560,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af35a40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c91dcc0,yposition=
 0x7fba6c928578,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      131.5   0.011      628.3
Field Avg  1.65                    131.5   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bfc8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ca94a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00501727,
 0.00056434],_lastvalidtt=[0.00501727,0.00056434],_upttcommand=[0,0],_refmes=
 0x7fba6c9e4830,_tiprefv=0x7fba6c9dee30,_tiltrefv=0x7fba6b837830,_tiprefvn=
 0x7fba6c9dc230,_tiltrefvn=0x7fba6b83b630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cabe030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0c0e30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cabe030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927850)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91e3c0,_ctrlden=0x7fba6c927fc0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af33ca0,_xlast=0x7fba6af2ca00,_ylast=[0x7fba6c986830,
 0x7fba6c986830,0x7fba6c986830],_y0=0x7fba6c986c30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34780,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c9282a0,yposition=
 0x7fba6c91d7f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      186.7   0.013      628.3
Field Avg  1.65                    186.7   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bb00)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af38cb0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00163449,
 0.00151423],_lastvalidtt=[-0.00163449,0.00151423],_upttcommand=[0,0],_refmes=
 0x7fba6c9df630,_tiprefv=0x7fba6c9dfe30,_tiltrefv=0x7fba6b0d5230,_tiprefvn=
 0x7fba6c9dee30,_tiltrefvn=0x7fba6b0a1e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b08c230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b831630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b08c230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9c1630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928348)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b808cd8,_ctrlden=0x7fba6b8093d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac34ea0,_xlast=0x7fba6ac38230,_ylast=[0x7fba6b0b8e30,
 0x7fba6b0b8e30,0x7fba6b0b8e30],_y0=0x7fba6b0d5a30,_signus=0x7fba6ac28e00,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af33ca0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927a80,yposition=
 0x7fba6b809250,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      180.0   0.012      628.3
Field Avg  1.65                    180.0   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92b7d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af39090,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00386115,
 0.00361077],_lastvalidtt=[0.00386115,0.00361077],_upttcommand=[0,0],_refmes=
 0x7fba6c0b5e30,_tiprefv=0x7fba6c9ea030,_tiltrefv=0x7fba6b83b030,_tiprefvn=
 0x7fba6c9dfe30,_tiltrefvn=0x7fba6b80b230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cac3830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0c9030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cac3830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b076a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928dc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927fc0,_ctrlden=0x7fba6c9284d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af3a630,_xlast=0x7fba6af32380,_ylast=[0x7fba6c90dc30,
 0x7fba6c90dc30,0x7fba6c90dc30],_y0=0x7fba6c9ea830,_signus=0x7fba6af2f560,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2d1f0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927850,yposition=
 0x7fba6c927310,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1214.8   0.004      628.3
Field Avg  1.65                   1214.8   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92beb8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac34160,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000462875,0.00604935],_lastvalidtt=[-0.000462875,0.00604935],_upttcommand=
 [0,0],_refmes=0x7fba6b0b7c30,_tiprefv=0x7fba6b08a230,_tiltrefv=0x7fba6c996c30,
 _tiprefvn=0x7fba6b0b8430,_tiltrefvn=0x7fba6c9dc230,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b0d1630,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6b857030,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0d1630,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c927f18)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928540,_ctrlden=0x7fba6b809138,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af31ab0,_xlast=0x7fba6af304d0,_ylast=[0x7fba6c9ea830,
 0x7fba6c9ea830,0x7fba6c9ea830],_y0=0x7fba6c976230,_signus=0x7fba6af354c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af30650,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c928348,yposition=
 0x7fba6c91d7b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      141.4   0.014      628.3
Field Avg  1.65                    141.4   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bf40)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0d3830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00128514,
 0.00499566],_lastvalidtt=[-0.00128514,0.00499566],_upttcommand=[0,0],_refmes=
 0x7fba6c0a7830,_tiprefv=0x7fba6b80e630,_tiltrefv=0x7fba6b080c30,_tiprefvn=
 0x7fba6b80bc30,_tiltrefvn=0x7fba6b0a1e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0ec430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0b2a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0ec430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0b2230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928030)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c8cec40,_ctrlden=0x7fba6b809138,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af357e0,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6caace30,_signus=0x7fba6af2f560,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af304d0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c928dc8,yposition=
 0x7fba6c927818,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      970.3   0.004      628.3
Field Avg  1.65                    970.3   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c050)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af3b270,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.0107724,
 0.00542581],_lastvalidtt=[0.0107724,0.00542581],_upttcommand=[0,0],_refmes=
 0x7fba6ca9ee30,_tiprefv=0x7fba6c9c6e30,_tiltrefv=0x7fba6b80dc30,_tiprefvn=
 0x7fba6c9e4e30,_tiltrefvn=0x7fba6b820030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca9f630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b850c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca9f630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809218)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927ea8,_ctrlden=0x7fba6b025830,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac33220,_xlast=0x7fba6ac33b80,_ylast=[0x7fba6b040030,
 0x7fba6b040030,0x7fba6b040030],_y0=0x7fba6b0d5a30,_signus=0x7fba6ac329e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2bfc0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927f18,yposition=
 0x7fba6b809170,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      626.7   0.005      628.3
Field Avg  1.65                    626.7   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bc98)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0ca030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00108704,
 0.004664],_lastvalidtt=[-0.00108704,0.004664],_upttcommand=[0,0],_refmes=
 0x7fba6b0c0c30,_tiprefv=0x7fba6b06f630,_tiltrefv=0x7fba6c01b230,_tiprefvn=
 0x7fba6b10dc30,_tiltrefvn=0x7fba6c0a0830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cac3630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caab030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cac3630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dda0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d668,_ctrlden=0x7fba6b809100,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af30650,_xlast=0x7fba6af2f560,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6c9ea830,_signus=0x7fba6af34240,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af3a340,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c928030,yposition=
 0x7fba6b81a088,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      786.5   0.005      628.3
Field Avg  1.65                    786.5   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92b858)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af390a0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00727102,
 -0.000341178],_lastvalidtt=[0.00727102,-0.000341178],_upttcommand=[0,0],
 _refmes=0x7fba6c99b830,_tiprefv=0x7fba6c985e30,_tiltrefv=0x7fba6b83ba30,
 _tiprefvn=0x7fba6c9dee30,_tiltrefvn=0x7fba6b850230,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b089c30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6c0a1c30,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b089c30,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c927a10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b808d80,_ctrlden=0x7fba6c91da90,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af304d0,_xlast=0x7fba6af30650,_ylast=[0x7fba6c9ea830,
 0x7fba6c9ea830,0x7fba6c9ea830],_y0=0x7fba6c978430,_signus=0x7fba6af2f560,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af35a40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6b809218,yposition=
 0x7fba6c91d7f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      286.3   0.008      628.3
Field Avg  1.65                    286.3   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bda8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9e5230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000724213,
 0.00184239],_lastvalidtt=[0.000724213,0.00184239],_upttcommand=[0,0],_refmes=
 0x7fba6c9dc230,_tiprefv=0x7fba6cad1c30,_tiltrefv=0x7fba6b83b030,_tiprefvn=
 0x7fba6c985e30,_tiltrefvn=0x7fba6b83ba30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b07d430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a3030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b07d430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c990230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808db8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d940,_ctrlden=0x7fba6c927f18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af304d0,_ylast=[0x7fba6c978430,
 0x7fba6c978430,0x7fba6c978430],_y0=0x7fba6c976230,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c91dda0,yposition=
 0x7fba6c928bd0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      118.8   0.017      628.3
Field Avg  1.65                    118.8   0.017      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bb88)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af3af50,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00476183,
 0.000203771],_lastvalidtt=[0.00476183,0.000203771],_upttcommand=[0,0],_refmes=
 0x7fba6c9e2430,_tiprefv=0x7fba6c986630,_tiltrefv=0x7fba6cae8c30,_tiprefvn=
 0x7fba6cad1c30,_tiltrefvn=0x7fba6c9dc230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0c3030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cae5230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0c3030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b08fc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9273f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9274d0,_ctrlden=0x7fba6c91db00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2c100,_xlast=0x7fba6af2ca00,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6c9ea830,_signus=0x7fba6af38e10,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af30650,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927a10,yposition=
 0x7fba6c927460,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      110.8   0.018      628.3
Field Avg  1.65                    110.8   0.018      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92b748)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac37bf0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00295968,
 -0.00519559],_lastvalidtt=[0.00295968,-0.00519559],_upttcommand=[0,0],_refmes=
 0x7fba6b07ca30,_tiprefv=0x7fba6b0a1e30,_tiltrefv=0x7fba6b07d230,_tiprefvn=
 0x7fba6b0df430,_tiltrefvn=0x7fba6b07e030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9e2030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b08cc30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9e2030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928e00)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927ea8,_ctrlden=0x7fba6c927380,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2d210,_xlast=0x7fba6ac28320,_ylast=[0x7fba6b06fc30,
 0x7fba6b06fc30,0x7fba6b06fc30],_y0=0x7fba6b07e830,_signus=0x7fba6ac2bc10,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2cd10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6b808db8,yposition=
 0x7fba6b809020,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      392.6   0.006      628.3
Field Avg  1.65                    392.6   0.006      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c518)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac308e0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.0102332,
 -0.00346278],_lastvalidtt=[-0.0102332,-0.00346278],_upttcommand=[0,0],_refmes=
 0x7fba6b0ffa30,_tiprefv=0x7fba6b0c1e30,_tiltrefv=0x7fba6b0b7230,_tiprefvn=
 0x7fba6b0a1e30,_tiltrefvn=0x7fba6b07d230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0c6830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b85b630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0c6830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b848430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928428)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d668,_ctrlden=0x7fba6c927f50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2e380,_xlast=0x7fba6ac2d210,_ylast=[0x7fba6b07e830,
 0x7fba6b07e830,0x7fba6b07e830],_y0=0x7fba6b0bb230,_signus=0x7fba6ac2bed0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac35800,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c9273f0,yposition=
 0x7fba6c91dbe0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      196.9   0.011      628.3
Field Avg  1.65                    196.9   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92b9f0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9e6830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00239712,
 0.00119537],_lastvalidtt=[0.00239712,0.00119537],_upttcommand=[0,0],_refmes=
 0x7fba6c99b830,_tiprefv=0x7fba6c9cae30,_tiltrefv=0x7fba6c9e9430,_tiprefvn=
 0x7fba6c9e5e30,_tiltrefvn=0x7fba6c996c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0f2430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9dd430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0f2430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927850)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dc50,_ctrlden=0x7fba6c9278f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2c100,_xlast=0x7fba6af35a40,_ylast=[0x7fba6c9ea830,
 0x7fba6c9ea830,0x7fba6c9ea830],_y0=0x7fba6c976230,_signus=0x7fba6af2f560,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34b10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c928e00,yposition=
 0x7fba6c928f88,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      793.3   0.005      628.3
Field Avg  1.65                    793.3   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c380)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9de430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00218784,
 -0.00230873],_lastvalidtt=[0.00218784,-0.00230873],_upttcommand=[0,0],_refmes=
 0x7fba6c986630,_tiprefv=0x7fba6c99b830,_tiltrefv=0x7fba6c9dd430,_tiprefvn=
 0x7fba6c9e8a30,_tiltrefvn=0x7fba6c9e5e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b08a830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0adc30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b08a830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927a80)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b8091a8,_ctrlden=0x7fba6b809100,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2e300,_xlast=0x7fba6ac34ea0,_ylast=[0x7fba6b0d5a30,
 0x7fba6b0d5a30,0x7fba6b0d5a30],_y0=0x7fba6b022630,_signus=0x7fba6ac31990,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af35a40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c928428,yposition=
 0x7fba6c928fc0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      530.8   0.005      628.3
Field Avg  1.65                    530.8   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92aaa8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b096430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00109296,
 -0.00193699],_lastvalidtt=[0.00109296,-0.00193699],_upttcommand=[0,0],_refmes=
 0x7fba6b0d1630,_tiprefv=0x7fba6b0cf630,_tiltrefv=0x7fba6b0d7e30,_tiprefvn=
 0x7fba6b0e0830,_tiltrefvn=0x7fba6b0a1e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0fa630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b85b630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0fa630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928e38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c924a30,_ctrlden=0x7fba6c9279d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af39c10,_xlast=0x7fba6af2f560,_ylast=[0x7fba6c9ea830,
 0x7fba6c9ea830,0x7fba6c9ea830],_y0=0x7fba6c976230,_signus=0x7fba6af3a4f0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2c100,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927850,yposition=
 0x7fba6b809020,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      224.9   0.010      628.3
Field Avg  1.65                    224.9   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bd20)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b05bc30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[4.60668e-05,
 0.00486975],_lastvalidtt=[4.60668e-05,0.00486975],_upttcommand=[0,0],_refmes=
 0x7fba6b0d6e30,_tiprefv=0x7fba6b0d4030,_tiltrefv=0x7fba6b081430,_tiprefvn=
 0x7fba6b06f630,_tiltrefvn=0x7fba6b104e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cad2030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0fbe30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cad2030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b025830)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9278f8,_ctrlden=0x7fba6c91dac8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2cc50,_xlast=0x7fba6af39b60,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6c9eb430,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34b10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927a80,yposition=
 0x7fba6c927690,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      123.4   0.017      628.3
Field Avg  1.65                    123.4   0.017      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92b108)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9dd430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00243902,
 -0.00111907],_lastvalidtt=[-0.00243902,-0.00111907],_upttcommand=[0,0],_refmes=
 0x7fba6c9cae30,_tiprefv=0x7fba6c986630,_tiltrefv=0x7fba6caa6430,_tiprefvn=
 0x7fba6caa6e30,_tiltrefvn=0x7fba6c9c6e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b124e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9c9a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b124e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6caf5430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928310)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927ee0,_ctrlden=0x7fba6c9284d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2cd10,_xlast=0x7fba6ac34ea0,_ylast=[0x7fba6b0d5a30,
 0x7fba6b0d5a30,0x7fba6b0d5a30],_y0=0x7fba6b096430,_signus=0x7fba6ac33b80,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac36910,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c928e38,yposition=
 0x7fba6c9282a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      164.3   0.012      628.3
Field Avg  1.65                    164.3   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c270)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af3a820,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00164942,
 -0.00472983],_lastvalidtt=[-0.00164942,-0.00472983],_upttcommand=[0,0],_refmes=
 0x7fba6b80ba30,_tiprefv=0x7fba6b0b7230,_tiltrefv=0x7fba6b0dba30,_tiprefvn=
 0x7fba6b088a30,_tiltrefvn=0x7fba6b0b7a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caff230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0ade30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caff230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927540)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928460,_ctrlden=0x7fba6c927fc0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac36770,_xlast=0x7fba6ac2c010,_ylast=[0x7fba6b096430,
 0x7fba6b096430,0x7fba6b096430],_y0=0x7fba6b022630,_signus=0x7fba6ac2e100,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af35a40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6b025830,yposition=
 0x7fba6c91dc18,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      221.6   0.010      628.3
Field Avg  1.65                    221.6   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92b3b0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac30d70,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00383585,
 0.00331545],_lastvalidtt=[-0.00383585,0.00331545],_upttcommand=[0,0],_refmes=
 0x7fba6c9cae30,_tiprefv=0x7fba6b80d630,_tiltrefv=0x7fba6cacb830,_tiprefvn=
 0x7fba6b80b230,_tiltrefvn=0x7fba6cb01a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b13a230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9c9a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b13a230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b05bc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928ce8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927620,_ctrlden=0x7fba6c91d9b0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0b140,_xlast=0x7fba6ad0d8b0,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b839c30,_signus=0x7fba6ad0fcd0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac28320,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c928310,yposition=
 0x7fba6c927460,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1161.9   0.004      628.3
Field Avg  1.65                   1161.9   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c160)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac32cf0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00949367,
 -0.00180494],_lastvalidtt=[0.00949367,-0.00180494],_upttcommand=[0,0],_refmes=
 0x7fba6b0f6830,_tiprefv=0x7fba6c0a0830,_tiltrefv=0x7fba6b80ce30,_tiprefvn=
 0x7fba6c0afa30,_tiltrefvn=0x7fba6b80b230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caad630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca14c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caad630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928af0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9274d0,_ctrlden=0x7fba6c927a80,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6c976230,_signus=0x7fba6af2f560,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac34ea0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927540,yposition=
 0x7fba6c927380,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      144.4   0.015      628.3
Field Avg  1.65                    144.4   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92ab30)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0ca030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00934574,
 0.00347667],_lastvalidtt=[0.00934574,0.00347667],_upttcommand=[0,0],_refmes=
 0x7fba6b0b1630,_tiprefv=0x7fba6b837230,_tiltrefv=0x7fba6c01b230,_tiprefvn=
 0x7fba6b80ba30,_tiltrefvn=0x7fba6c09f030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b157630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b861230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b157630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808db8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91e3c0,_ctrlden=0x7fba6c928498,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c220,_xlast=0x7fba6ae0c3a0,_ylast=[0x7fba6c014c30,
 0x7fba6c014c30,0x7fba6c014c30],_y0=0x7fba6c09fa30,_signus=0x7fba6ae0c520,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac33cc0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c928ce8,yposition=
 0x7fba6c927268,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      140.6   0.012      628.3
Field Avg  1.65                    140.6   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92af70)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c8d6830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000644253,
 -0.00303507],_lastvalidtt=[0.000644253,-0.00303507],_upttcommand=[0,0],_refmes=
 0x7fba6cab5830,_tiprefv=0x7fba6ca9fa30,_tiltrefv=0x7fba6caa1430,_tiprefvn=
 0x7fba6c9e4030,_tiltrefvn=0x7fba6c9e1630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0db030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0ed030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0db030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0cb830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927700)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b809138,_ctrlden=0x7fba6c928e00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0bcd0,_xlast=0x7fba6ae0c220,_ylast=[0x7fba6c09fa30,
 0x7fba6c09fa30,0x7fba6c09fa30],_y0=0x7fba6c032c30,_signus=0x7fba6ae0b4e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac31bd0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c928af0,yposition=
 0x7fba6c928f88,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      190.6   0.007      628.3
Field Avg  1.65                    190.6   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bfc8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b80c230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00137033,
 -0.000619153],_lastvalidtt=[-0.00137033,-0.000619153],_upttcommand=[0,0],
 _refmes=0x7fba6b08e230,_tiprefv=0x7fba6cadbe30,_tiltrefv=0x7fba6caa0430,
 _tiprefvn=0x7fba6ca9fa30,_tiltrefvn=0x7fba6caa1430,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b07aa30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6b0bdc30,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b07aa30,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6caabe30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c91db38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928cb0,_ctrlden=0x7fba6c927ea8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac30780,_xlast=0x7fba6ac30440,_ylast=[0x7fba6b0b5430,
 0x7fba6b0b5430,0x7fba6b0b5430],_y0=0x7fba6b11c230,_signus=0x7fba6ac35140,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0b4e0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6b808db8,yposition=
 0x7fba6c91dda0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      495.9   0.005      628.3
Field Avg  1.65                    495.9   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bb00)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac329e0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00870045,
 -0.00382478],_lastvalidtt=[0.00870045,-0.00382478],_upttcommand=[0,0],_refmes=
 0x7fba6b0b1630,_tiprefv=0x7fba6c0a1030,_tiltrefv=0x7fba6cab9a30,_tiprefvn=
 0x7fba6c0a1830,_tiltrefvn=0x7fba6ca9b830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9c9430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca9c230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9c9430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6caa1430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dba8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d7b8,_ctrlden=0x7fba6c91d9b0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af30550,_xlast=0x7fba6af2ca00,_ylast=[0x7fba6cabaa30,
 0x7fba6cabaa30,0x7fba6cabaa30],_y0=0x7fba6caa1a30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2e100,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927700,yposition=
 0x7fba6c927a10,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      127.8   0.012      628.3
Field Avg  1.65                    127.8   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92b7d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9c8230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00698542,
 -0.00374594],_lastvalidtt=[0.00698542,-0.00374594],_upttcommand=[0,0],_refmes=
 0x7fba6b852e30,_tiprefv=0x7fba6b0d4030,_tiltrefv=0x7fba6b08ba30,_tiprefvn=
 0x7fba6b08e430,_tiltrefvn=0x7fba6b0b7230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0c4e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b850230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0c4e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928c08)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928bd0,_ctrlden=0x7fba6c927ee0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0b140,_xlast=0x7fba6ad0b2c0,_ylast=[0x7fba6b839c30,
 0x7fba6b839c30,0x7fba6b839c30],_y0=0x7fba6b83f430,_signus=0x7fba6ad0b440,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac32f60,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c91db38,yposition=
 0x7fba6c9282d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       98.5   0.014      628.3
Field Avg  1.65                     98.5   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92beb8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad10fa0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00453744,
 0.00020679],_lastvalidtt=[-0.00453744,0.00020679],_upttcommand=[0,0],_refmes=
 0x7fba6b06f630,_tiprefv=0x7fba6c0afa30,_tiltrefv=0x7fba6c0b0230,_tiprefvn=
 0x7fba6c09f030,_tiltrefvn=0x7fba6c0b3830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b159830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0fd630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b159830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b81a088)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91e3c0,_ctrlden=0x7fba6c9284d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af32380,_xlast=0x7fba6af396c0,_ylast=[0x7fba6c9ea830,
 0x7fba6c9ea830,0x7fba6c9ea830],_y0=0x7fba6c9eb430,_signus=0x7fba6af39840,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af3a2e0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c91dba8,yposition=
 0x7fba6c927968,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      135.2   0.011      628.3
Field Avg  1.65                    135.2   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bf40)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae0f230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00360633,
 0.00339592],_lastvalidtt=[0.00360633,0.00339592],_upttcommand=[0,0],_refmes=
 0x7fba6b83ba30,_tiprefv=0x7fba6b06f630,_tiltrefv=0x7fba6b0b4430,_tiprefvn=
 0x7fba6b0d4030,_tiltrefvn=0x7fba6b0b7230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c0cbe30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b834630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c0cbe30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b15ce30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808d80)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c924a30,_ctrlden=0x7fba6c9274d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac325c0,_xlast=0x7fba6ac34160,_ylast=[0x7fba6b11c230,
 0x7fba6b11c230,0x7fba6b11c230],_y0=0x7fba6b0e6030,_signus=0x7fba6ac336c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac31ba0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c928c08,yposition=
 0x7fba6b808e28,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1055.6   0.004      628.3
Field Avg  1.65                   1055.6   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c050)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad10610,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00482555,
 -0.00251225],_lastvalidtt=[-0.00482555,-0.00251225],_upttcommand=[0,0],_refmes=
 0x7fba6b83bc30,_tiprefv=0x7fba6b089430,_tiltrefv=0x7fba6c996c30,_tiprefvn=
 0x7fba6b06f630,_tiltrefvn=0x7fba6ca16230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cafca30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9dd430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cafca30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b80d430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927818)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91da20,_ctrlden=0x7fba6c9274d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac28f00,_xlast=0x7fba6ac362c0,_ylast=[0x7fba6b0e6030,
 0x7fba6b0e6030,0x7fba6b0e6030],_y0=0x7fba6b0d3430,_signus=0x7fba6ac353c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6b81a088,yposition=
 0x7fba6c928c40,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      139.7   0.013      628.3
Field Avg  1.65                    139.7   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bc98)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b861430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00312257,
 -0.00293347],_lastvalidtt=[0.00312257,-0.00293347],_upttcommand=[0,0],_refmes=
 0x7fba6b0b7230,_tiprefv=0x7fba6b80e630,_tiltrefv=0x7fba6c9dd430,_tiprefvn=
 0x7fba6b837630,_tiltrefvn=0x7fba6cacc230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b144230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b850230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b144230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928310)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928460,_ctrlden=0x7fba6c9273b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0c300,_xlast=0x7fba6ad0d8b0,_ylast=[0x7fba6b839c30,
 0x7fba6b839c30,0x7fba6b839c30],_y0=0x7fba6b868a30,_signus=0x7fba6ad0d190,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac311d0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6b808d80,yposition=
 0x7fba6b8091a8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1145.7   0.004      628.3
Field Avg  1.65                   1145.7   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92b858)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b837230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000386159,-0.00887437],_lastvalidtt=[-0.000386159,-0.00887437],
 _upttcommand=[0,0],_refmes=0x7fba6b0b7230,_tiprefv=0x7fba6cace830,_tiltrefv=
 0x7fba6b83bc30,_tiprefvn=0x7fba6caccc30,_tiltrefvn=0x7fba6b853230,_reordervec=
 0x0,_npixels=0,_npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,
 _binindices=0x0,_binxy=0,_centroidw=0x0,_fimage=0x7fba6b148430,_fimage2=0x0,
 _imistart=0x0,_imjstart=0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,
 _unittilt=0x0,_lgs_defocuses=0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=
 0x0,_yoffset=0x0,_bias=0x0,_flat=0x0,_domask=0,_submask=0x7fba6c0b8e30,_kernel=
 0x0,_kernels=0x0,_kerfftr=0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fba6b148430,_x=0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,
 _bckgrdcalib=0x7fba6c997630,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fba6b025830)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dc18,_ctrlden=0x7fba6c928030,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af31ab0,_xlast=0x7fba6af34720,_ylast=[0x7fba6c9ea830,
 0x7fba6c9ea830,0x7fba6c9ea830],_y0=0x7fba6c976230,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0da30,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927818,yposition=
 0x7fba6c928348,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      886.8   0.004      628.3
Field Avg  1.65                    886.8   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bda8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9eb430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00638777,
 -0.00745331],_lastvalidtt=[0.00638777,-0.00745331],_upttcommand=[0,0],_refmes=
 0x7fba6c0a6830,_tiprefv=0x7fba6c0ab230,_tiltrefv=0x7fba6b154630,_tiprefvn=
 0x7fba6c0afa30,_tiltrefvn=0x7fba6b0d4030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cabdc30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b834830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cabdc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca15e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927540)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91db00,_ctrlden=0x7fba6c928c40,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0d350,_xlast=0x7fba6ad0ce60,_ylast=[0x7fba6b839c30,
 0x7fba6b839c30,0x7fba6b839c30],_y0=0x7fba6b83f430,_signus=0x7fba6ad0fcd0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac32000,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c928310,yposition=
 0x7fba6b808e28,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      122.4   0.014      628.3
Field Avg  1.65                    122.4   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bb88)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0a9c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00124612,
 -0.00271403],_lastvalidtt=[0.00124612,-0.00271403],_upttcommand=[0,0],_refmes=
 0x7fba6c9e9630,_tiprefv=0x7fba6c996c30,_tiltrefv=0x7fba6b80de30,_tiprefvn=
 0x7fba6ca15e30,_tiltrefvn=0x7fba6b80ce30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca8ee30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9c3e30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca8ee30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c990230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808cd8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9275e8,_ctrlden=0x7fba6b808d80,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0b950,_xlast=0x7fba6ad0cfe0,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b804030,_signus=0x7fba6ad0d160,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac34730,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6b025830,yposition=
 0x7fba6c91d898,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      146.5   0.013      628.3
Field Avg  1.65                    146.5   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bfc8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b08d630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.007779,
 0.000165418],_lastvalidtt=[0.007779,0.000165418],_upttcommand=[0,0],_refmes=
 0x7fba6c9c4630,_tiprefv=0x7fba6c9e9630,_tiltrefv=0x7fba6c0adc30,_tiprefvn=
 0x7fba6ca15230,_tiltrefvn=0x7fba6c0afa30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9e6830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b82ca30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9e6830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928af0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dda0,_ctrlden=0x7fba6c91d7b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0ce60,_xlast=0x7fba6ad0b940,_ylast=[0x7fba6b804030,
 0x7fba6b804030,0x7fba6b804030],_y0=0x7fba6b80ec30,_signus=0x7fba6ad0b2f0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0bfd0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927540,yposition=
 0x7fba6c9282a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      132.9   0.014      628.3
Field Avg  1.65                    132.9   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c380)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad11880,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00738082,
 -0.00242695],_lastvalidtt=[0.00738082,-0.00242695],_upttcommand=[0,0],_refmes=
 0x7fba6b0e4230,_tiprefv=0x7fba6c996c30,_tiltrefv=0x7fba6b08ea30,_tiprefvn=
 0x7fba6c997430,_tiltrefvn=0x7fba6b0e4a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b08a830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b834230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b08a830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927268)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9277e0,_ctrlden=0x7fba6c91db38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0bcd0,_xlast=0x7fba6ae0b4e0,_ylast=[0x7fba6c032c30,
 0x7fba6c032c30,0x7fba6c032c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0b660,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34b10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6b808cd8,yposition=
 0x7fba6b809138,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      189.3   0.012      628.3
Field Avg  1.65                    189.3   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c2f8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad11130,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.0020244,
 0.00205718],_lastvalidtt=[-0.0020244,0.00205718],_upttcommand=[0,0],_refmes=
 0x7fba6b0e3830,_tiprefv=0x7fba6cab5830,_tiltrefv=0x7fba6b80b230,_tiprefvn=
 0x7fba6c996c30,_tiltrefvn=0x7fba6b80dc30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b121a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0afa30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b121a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9c1630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809250)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928f88,_ctrlden=0x7fba6b025830,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0c780,_xlast=0x7fba6ad0c900,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b804030,_signus=0x7fba6ad0d8b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2d220,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c928af0,yposition=
 0x7fba6c927888,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1288.7   0.004      628.3
Field Avg  1.65                   1288.7   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92ba78)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad0bfd0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00463961,
 0.0103562],_lastvalidtt=[0.00463961,0.0103562],_upttcommand=[0,0],_refmes=
 0x7fba6b851a30,_tiprefv=0x7fba6b861c30,_tiltrefv=0x7fba6c9ca630,_tiprefvn=
 0x7fba6b869e30,_tiltrefvn=0x7fba6c996c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b853630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a1c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b853630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808db8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927818,_ctrlden=0x7fba6c927540,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0da90,_xlast=0x7fba6ae0dc10,_ylast=[0x7fba6c014c30,
 0x7fba6c014c30,0x7fba6c014c30],_y0=0x7fba6c0a9430,_signus=0x7fba6ae0e120,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0e3e0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c927268,yposition=
 0x7fba6c9273b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      171.6   0.012      628.3
Field Avg  1.65                    171.6   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92bb00)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9e3030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000542877,
 -0.00334214],_lastvalidtt=[0.000542877,-0.00334214],_upttcommand=[0,0],_refmes=
 0x7fba6b11ce30,_tiprefv=0x7fba6b0c9230,_tiltrefv=0x7fba6b08a430,_tiprefvn=
 0x7fba6b0c9c30,_tiltrefvn=0x7fba6b08ae30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b85ba30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b08d830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b85ba30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0cb830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9249f8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91e3c0,_ctrlden=0x7fba6c928268,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0d8b0,_xlast=0x7fba6ad0da30,_ylast=[0x7fba6b804030,
 0x7fba6b804030,0x7fba6b804030],_y0=0x7fba6b83f430,_signus=0x7fba6ad0c780,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6b809250,yposition=
 0x7fba6c927508,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      171.6   0.010      628.3
Field Avg  1.65                    171.6   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c050)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b096430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000511506,-0.00676625],_lastvalidtt=[-0.000511506,-0.00676625],
 _upttcommand=[0,0],_refmes=0x7fba6b07b230,_tiprefv=0x7fba6b0b7c30,_tiltrefv=
 0x7fba6b08c830,_tiprefvn=0x7fba6b15b030,_tiltrefvn=0x7fba6b08c030,_reordervec=
 0x0,_npixels=0,_npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,
 _binindices=0x0,_binxy=0,_centroidw=0x0,_fimage=0x7fba6caa4c30,_fimage2=0x0,
 _imistart=0x0,_imjstart=0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,
 _unittilt=0x0,_lgs_defocuses=0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=
 0x0,_yoffset=0x0,_bias=0x0,_flat=0x0,_domask=0,_submask=0x7fba6b822830,_kernel=
 0x0,_kernels=0x0,_kerfftr=0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fba6caa4c30,_x=0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,
 _bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fba6c9282d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928268,_ctrlden=0x7fba6c928e00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c220,_xlast=0x7fba6ae0c550,_ylast=[0x7fba6c032c30,
 0x7fba6c032c30,0x7fba6c032c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0b4e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac28830,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6b808db8,yposition=
 0x7fba6c91d860,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      425.0   0.006      628.3
Field Avg  1.65                    425.0   0.006      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c1e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac36610,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00441415,
 0.00446834],_lastvalidtt=[0.00441415,0.00446834],_upttcommand=[0,0],_refmes=
 0x7fba6b834e30,_tiprefv=0x7fba6caae630,_tiltrefv=0x7fba6caade30,_tiprefvn=
 0x7fba6c9e9430,_tiltrefvn=0x7fba6caa4630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b858830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cab9a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b858830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0b8c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927f18)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927540,_ctrlden=0x7fba6c91d9e8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0b7a0,_xlast=0x7fba6ae0bcd0,_ylast=[0x7fba6c014c30,
 0x7fba6c014c30,0x7fba6c014c30],_y0=0x7fba6c09f030,_signus=0x7fba6ae0c220,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac363c0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c9249f8,yposition=
 0x7fba6c927ea8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      556.6   0.006      628.3
Field Avg  1.65                    556.6   0.006      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c518)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ff8,lgs_prof_alt=0x7fba6c928a48,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac35da0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00472261,
 0.00363851],_lastvalidtt=[0.00472261,0.00363851],_upttcommand=[0,0],_refmes=
 0x7fba6caa0830,_tiprefv=0x7fba6ca9fe30,_tiltrefv=0x7fba6b08e030,_tiprefvn=
 0x7fba6caae630,_tiltrefvn=0x7fba6b07ca30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0b3c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a0830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0b3c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c924a30)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927460,_ctrlden=0x7fba6c91dac8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2f560,_xlast=0x7fba6af2c100,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6c976230,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9279a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c928380,xposition=0x7fba6c9282d8,yposition=
 0x7fba6c91d940,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       98.5   0.008      628.3
Field Avg  1.65                     98.5   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92ae60,winddir=0x7fba6c92add8,
 _layeralt=0x7fba6c92c518)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927428,lgs_prof_alt=0x7fba6c928ab8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af3b560,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.011816,
 0.00309989],_lastvalidtt=[0.011816,0.00309989],_upttcommand=[0,0],_refmes=
 0x7fba6cacb830,_tiprefv=0x7fba6ca16630,_tiltrefv=0x7fba6caf5430,_tiprefvn=
 0x7fba6caacc30,_tiltrefvn=0x7fba6c9e3e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0db830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cacc230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0db830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6caf4e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d7f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928348,_ctrlden=0x7fba6b808db8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af31ab0,_xlast=0x7fba6af304d0,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6c976230,_signus=0x7fba6af38d70,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af35a40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c91d940,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b8091e0,yposition=
 0x7fba6c91dac8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c9279a0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      246.7   0.007      628.3
Field Avg  1.65                    246.7   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92ae60,winddir=0x7fba6c92add8,
 _layeralt=0x7fba6c92c050)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927428,lgs_prof_alt=0x7fba6c928ab8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af39660,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00465783,
 0.00172881],_lastvalidtt=[0.00465783,0.00172881],_upttcommand=[0,0],_refmes=
 0x7fba6b0b7230,_tiprefv=0x7fba6b085030,_tiltrefv=0x7fba6b855c30,_tiprefvn=
 0x7fba6b0b7a30,_tiltrefvn=0x7fba6b80ce30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9c2c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cb0e230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9c2c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0e4e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928310)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dda0,_ctrlden=0x7fba6b8092c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6c978430,_signus=0x7fba6af39360,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac30640,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c91d940,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927ff8,yposition=
 0x7fba6c9278f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c9279a0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 140 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      108.5   0.014      628.3
Field Avg  1.65                    108.5   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92ae60,winddir=0x7fba6c92add8,
 _layeralt=0x7fba6c92bb88)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927428,lgs_prof_alt=0x7fba6c928ab8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6cab4830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=140,_nsub4disp=0,_nmes=
 280,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00731555,
 -0.00262106],_lastvalidtt=[0.00731555,-0.00262106],_upttcommand=[0,0],_refmes=
 0x7fba6b08d030,_tiprefv=0x7fba6b80d630,_tiltrefv=0x7fba6b85b830,_tiprefvn=
 0x7fba6b80e630,_tiltrefvn=0x7fba6b822230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cab5830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a5c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cab5830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928d20)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b809480,_ctrlden=0x7fba6c927f50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad097c0,_xlast=0x7fba6ad09940,_ylast=[0x7fba6b804030,
 0x7fba6b804030,0x7fba6b804030],_y0=0x7fba6b80c430,_signus=0x7fba6ad09ac0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0b4e0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c91d940,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91d7f0,yposition=
 0x7fba6b809218,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c9279a0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      324.1   0.006      628.3
Field Avg  1.65                    324.1   0.006      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6b00da50)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad10dc0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00107081,
 0.000200718],_lastvalidtt=[-0.00107081,0.000200718],_upttcommand=[0,0],_refmes=
 0x7fba6c967c30,_tiprefv=0x7fba6c968430,_tiltrefv=0x7fba6cab4830,_tiprefvn=
 0x7fba6caad430,_tiltrefvn=0x7fba6c9e1e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b111830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b820030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b111830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c990230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809100)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927f18,_ctrlden=0x7fba6c91d9e8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac28b00,_xlast=0x7fba6ac292e0,_ylast=[0x7fba6b040030,
 0x7fba6b040030,0x7fba6b040030],_y0=0x7fba6b096430,_signus=0x7fba6ac36810,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2cd10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c927460,yposition=
 0x7fba6c927f50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      185.4   0.010      628.3
Field Avg  1.65                    185.4   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92c160)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae0deb0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.0137738,
 -0.00804167],_lastvalidtt=[0.0137738,-0.00804167],_upttcommand=[0,0],_refmes=
 0x7fba6b0df230,_tiprefv=0x7fba6b15cc30,_tiltrefv=0x7fba6b0d3030,_tiprefvn=
 0x7fba6b07da30,_tiltrefvn=0x7fba6b08e030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b8a6c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b850230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b8a6c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b837c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dba8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927700,_ctrlden=0x7fba6c928498,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0b7a0,_xlast=0x7fba6ad0b920,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b804030,_signus=0x7fba6ad0a1d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0a610,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c927428,yposition=
 0x7fba6b8091e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 140 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      138.4   0.016      628.3
Field Avg  1.65                    138.4   0.016      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92c380)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b07d230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=140,_nsub4disp=0,_nmes=
 280,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00317072,
 0.00661204],_lastvalidtt=[-0.00317072,0.00661204],_upttcommand=[0,0],_refmes=
 0x7fba6b07c830,_tiprefv=0x7fba6b0c9c30,_tiltrefv=0x7fba6b0d7630,_tiprefvn=
 0x7fba6b07b230,_tiltrefvn=0x7fba6b07d830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b06fe30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b851630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b06fe30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6caa1030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927850)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927ff8,_ctrlden=0x7fba6c927888,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad10f30,_xlast=0x7fba6ad0b630,_ylast=[0x7fba6b804030,
 0x7fba6b804030,0x7fba6b804030],_y0=0x7fba6b80bc30,_signus=0x7fba6ad11ac0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6b809100,yposition=
 0x7fba6c9278f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      110.8   0.018      628.3
Field Avg  1.65                    110.8   0.018      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92b638)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0a9a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00246606,
 -0.00316834],_lastvalidtt=[0.00246606,-0.00316834],_upttcommand=[0,0],_refmes=
 0x7fba6c09ec30,_tiprefv=0x7fba6c0c7a30,_tiltrefv=0x7fba6c0ab830,_tiprefvn=
 0x7fba6c01b230,_tiltrefvn=0x7fba6c0c6c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caa9a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a6830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caa9a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6caa1030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808cd8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91da20,_ctrlden=0x7fba6b809250,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c220,_xlast=0x7fba6ae0c7d0,_ylast=[0x7fba6c0b0430,
 0x7fba6c0b0430,0x7fba6c0b0430],_y0=0x7fba6c0c7630,_signus=0x7fba6ae0c950,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac28810,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c91dba8,yposition=
 0x7fba6c9273f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      139.2   0.011      628.3
Field Avg  1.65                    139.2   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92af70)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0a9030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00151003,
 -0.00340073],_lastvalidtt=[0.00151003,-0.00340073],_upttcommand=[0,0],_refmes=
 0x7fba6b80a830,_tiprefv=0x7fba6b80e630,_tiltrefv=0x7fba6b837830,_tiprefvn=
 0x7fba6b824230,_tiltrefvn=0x7fba6b85b630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cacc230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a0830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cacc230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9284d0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928bd0,_ctrlden=0x7fba6c927428,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af384d0,_xlast=0x7fba6af38bb0,_ylast=[0x7fba6c978430,
 0x7fba6c978430,0x7fba6c978430],_y0=0x7fba6c976230,_signus=0x7fba6af39370,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0c3a0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c927850,yposition=
 0x7fba6c928e00,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      149.9   0.014      628.3
Field Avg  1.65                    149.9   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92bb00)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b85c030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00800206,
 -0.010241],_lastvalidtt=[0.00800206,-0.010241],_upttcommand=[0,0],_refmes=
 0x7fba6b835430,_tiprefv=0x7fba6b85aa30,_tiltrefv=0x7fba6b859830,_tiprefvn=
 0x7fba6b80e630,_tiltrefvn=0x7fba6b837830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caccc30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9df830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caccc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d898)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928dc8,_ctrlden=0x7fba6c927f18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0ba40,_xlast=0x7fba6ae0bbc0,_ylast=[0x7fba6c032c30,
 0x7fba6c032c30,0x7fba6c032c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0b4e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac33dd0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6b808cd8,yposition=
 0x7fba6c927738,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      281.1   0.009      628.3
Field Avg  1.65                    281.1   0.009      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92be30)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b05bc30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00262585,
 -0.00375023],_lastvalidtt=[0.00262585,-0.00375023],_upttcommand=[0,0],_refmes=
 0x7fba6b088a30,_tiprefv=0x7fba6b0e4430,_tiltrefv=0x7fba6c09ec30,_tiprefvn=
 0x7fba6b11b630,_tiltrefvn=0x7fba6c0a8030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b083630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0ade30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b083630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928ff8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d7f0,_ctrlden=0x7fba6c91dba8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac32490,_xlast=0x7fba6ac32610,_ylast=[0x7fba6b0ca230,
 0x7fba6b0ca230,0x7fba6b0ca230],_y0=0x7fba6b07ca30,_signus=0x7fba6ac34310,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0c040,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c9284d0,yposition=
 0x7fba6c927e38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.003      628.3
Field Avg  1.65                   1418.0   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92ba78)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae0d9e0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-6.30377e+11,-8.86283e+11],_lastvalidtt=[-6.30377e+11,-8.86283e+11],
 _upttcommand=[0,0],_refmes=0x7fba6c0c6a30,_tiprefv=0x7fba6b832630,_tiltrefv=
 0x7fba6b836830,_tiprefvn=0x7fba6b80a830,_tiltrefvn=0x7fba6b83b830,_reordervec=
 0x0,_npixels=0,_npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,
 _binindices=0x0,_binxy=0,_centroidw=0x0,_fimage=0x7fba6ca9b230,_fimage2=0x0,
 _imistart=0x0,_imjstart=0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,
 _unittilt=0x0,_lgs_defocuses=0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=
 0x0,_yoffset=0x0,_bias=0x0,_flat=0x0,_domask=0,_submask=0x7fba6c0c5630,_kernel=
 0x0,_kernels=0x0,_kerfftr=0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fba6ca9b230,_x=0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,
 _bckgrdcalib=0x7fba6b05bc30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fba6c928428)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928c40,_ctrlden=0x7fba6c928e00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af37af0,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6c978430,_signus=0x7fba6af38ae0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac291e0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c91d898,yposition=
 0x7fba6c928540,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      325.6   0.009      628.3
Field Avg  1.65                    325.6   0.009      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92c518)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0a0e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.0128895,
 -0.00408076],_lastvalidtt=[0.0128895,-0.00408076],_upttcommand=[0,0],_refmes=
 0x7fba6c0b2c30,_tiprefv=0x7fba6c01b230,_tiltrefv=0x7fba6c0ad230,_tiprefvn=
 0x7fba6c0b3630,_tiltrefvn=0x7fba6c0c8a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9e3e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9dd430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9e3e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927f88)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b808df0,_ctrlden=0x7fba6c9277a8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac30640,_xlast=0x7fba6ac35540,_ylast=[0x7fba6b040030,
 0x7fba6b040030,0x7fba6b040030],_y0=0x7fba6b15be30,_signus=0x7fba6ac30bb0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad09d40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c928ff8,yposition=
 0x7fba6c9275e8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      127.3   0.013      628.3
Field Avg  1.65                    127.3   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92bd20)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b071c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000987226,0.00187059],_lastvalidtt=[-0.000987226,0.00187059],_upttcommand=
 [0,0],_refmes=0x7fba6b06fe30,_tiprefv=0x7fba6b0a9830,_tiltrefv=0x7fba6b0d8830,
 _tiprefvn=0x7fba6b159230,_tiltrefvn=0x7fba6b157c30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6ca9fe30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6b08cc30,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca9fe30,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c927e00)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dda0,_ctrlden=0x7fba6c927d58,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0d120,_xlast=0x7fba6ad0d2a0,_ylast=[0x7fba6b83c230,
 0x7fba6b83c230,0x7fba6b83c230],_y0=0x7fba6b80ec30,_signus=0x7fba6ad0c040,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0a1d0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c928428,yposition=
 0x7fba6c927738,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      171.6   0.012      628.3
Field Avg  1.65                    171.6   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92bc98)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c968630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00325237,
 -0.00647544],_lastvalidtt=[0.00325237,-0.00647544],_upttcommand=[0,0],_refmes=
 0x7fba6b837830,_tiprefv=0x7fba6b884c30,_tiltrefv=0x7fba6ca14a30,_tiprefvn=
 0x7fba6b832430,_tiltrefvn=0x7fba6c9e2a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b088230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b854e30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b088230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b08fc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928b98)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d7b8,_ctrlden=0x7fba6c91d898,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0b7a0,_xlast=0x7fba6ae0c620,_ylast=[0x7fba6c01b230,
 0x7fba6c01b230,0x7fba6c01b230],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c7a0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad09d40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c927f88,yposition=
 0x7fba6c91e388,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      145.7   0.008      628.3
Field Avg  1.65                    145.7   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92b108)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af39490,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00362858,
 0.0026727],_lastvalidtt=[0.00362858,0.0026727],_upttcommand=[0,0],_refmes=
 0x7fba6c996c30,_tiprefv=0x7fba6c9e0c30,_tiltrefv=0x7fba6c01b630,_tiprefvn=
 0x7fba6caacc30,_tiltrefvn=0x7fba6b0df230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b08ba30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9e5e30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b08ba30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b87c230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b81a088)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91da20,_ctrlden=0x7fba6c928ff8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af31ab0,_xlast=0x7fba6af304d0,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6c978430,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac33c50,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c927e00,yposition=
 0x7fba6c927fc0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      129.7   0.008      628.3
Field Avg  1.65                    129.7   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92af70)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af36f20,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00823707,
 -0.0112982],_lastvalidtt=[0.00823707,-0.0112982],_upttcommand=[0,0],_refmes=
 0x7fba6caad430,_tiprefv=0x7fba6b80ba30,_tiltrefv=0x7fba6c0a5230,_tiprefvn=
 0x7fba6b88d430,_tiltrefvn=0x7fba6c01b630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca8f830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0ed030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca8f830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dbe0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b8092c0,_ctrlden=0x7fba6c928428,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0df80,_xlast=0x7fba6ad0d320,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b804030,_signus=0x7fba6ad0a8c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c928b98,yposition=
 0x7fba6b8091e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      158.2   0.014      628.3
Field Avg  1.65                    158.2   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92c2f8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b823a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00141738,
 0.000621293],_lastvalidtt=[0.00141738,0.000621293],_upttcommand=[0,0],_refmes=
 0x7fba6ca14a30,_tiprefv=0x7fba6c996c30,_tiltrefv=0x7fba6c9e3630,_tiprefvn=
 0x7fba6c9e4030,_tiltrefvn=0x7fba6cacc230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b127830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b850230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b127830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b08fc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808db8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928c40,_ctrlden=0x7fba6c927f88,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad09d40,_xlast=0x7fba6ad0df80,_ylast=[0x7fba6b804030,
 0x7fba6b804030,0x7fba6b804030],_y0=0x7fba6b839c30,_signus=0x7fba6ad109a0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac33c50,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6b81a088,yposition=
 0x7fba6c9272a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      180.0   0.015      628.3
Field Avg  1.65                    180.0   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92b7d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0a7430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00241286,
 -0.000221222],_lastvalidtt=[0.00241286,-0.000221222],_upttcommand=[0,0],
 _refmes=0x7fba6c0b8a30,_tiprefv=0x7fba6c09f430,_tiltrefv=0x7fba6c996c30,
 _tiprefvn=0x7fba6c01b230,_tiltrefvn=0x7fba6c9e3630,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6ca9b230,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6c0ad430,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca9b230,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c997630,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c928ce8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d7f0,_ctrlden=0x7fba6c927e00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0a380,_xlast=0x7fba6ad09d40,_ylast=[0x7fba6b839c30,
 0x7fba6b839c30,0x7fba6b839c30],_y0=0x7fba6b83f430,_signus=0x7fba6ad0a500,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac36090,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c91dbe0,yposition=
 0x7fba6c927a10,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      232.4   0.013      628.3
Field Avg  1.65                    232.4   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92bb00)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ca15430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00726869,
 -0.0021531],_lastvalidtt=[0.00726869,-0.0021531],_upttcommand=[0,0],_refmes=
 0x7fba6ca14a30,_tiprefv=0x7fba6ca9c030,_tiltrefv=0x7fba6c9e4030,_tiprefvn=
 0x7fba6caa0c30,_tiltrefvn=0x7fba6c996c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b153230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0b9430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b153230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808cd8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927690,_ctrlden=0x7fba6c928e00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac30a30,_xlast=0x7fba6ac2cd10,_ylast=[0x7fba6b158430,
 0x7fba6b158430,0x7fba6b158430],_y0=0x7fba6b040030,_signus=0x7fba6ac33c50,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac34310,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6b808db8,yposition=
 0x7fba6c9283b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      158.2   0.013      628.3
Field Avg  1.65                    158.2   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92b748)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0df230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.0143704,
 0.00420059],_lastvalidtt=[0.0143704,0.00420059],_upttcommand=[0,0],_refmes=
 0x7fba6b07d230,_tiprefv=0x7fba6b13fc30,_tiltrefv=0x7fba6b0c4c30,_tiprefvn=
 0x7fba6b0c1e30,_tiltrefvn=0x7fba6b08e030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0dda30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b14c030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0dda30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0a8030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928fc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9278f8,_ctrlden=0x7fba6c928508,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0b9f0,_xlast=0x7fba6ae0bb70,_ylast=[0x7fba6c032c30,
 0x7fba6c032c30,0x7fba6c032c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0b4e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af33b60,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c928ce8,yposition=
 0x7fba6c927540,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1209.3   0.004      628.3
Field Avg  1.65                   1209.3   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6b00da50)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c8d6830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000787209,
 0.00109387],_lastvalidtt=[0.000787209,0.00109387],_upttcommand=[0,0],_refmes=
 0x7fba6c996c30,_tiprefv=0x7fba6caa0c30,_tiltrefv=0x7fba6cb4d430,_tiprefvn=
 0x7fba6c9e1e30,_tiltrefvn=0x7fba6ca99830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0dde30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b08cc30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0dde30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0a8030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927968)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dda0,_ctrlden=0x7fba6c91dbe0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af37e10,_xlast=0x7fba6af32c80,_ylast=[0x7fba6ca15830,
 0x7fba6ca15830,0x7fba6ca15830],_y0=0x7fba6c978430,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2f560,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6b808cd8,yposition=
 0x7fba6c91dc50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 140 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      586.2   0.005      628.3
Field Avg  1.65                    586.2   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92b968)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ca99230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=140,_nsub4disp=0,_nmes=
 280,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00405604,
 0.00452577],_lastvalidtt=[-0.00405604,0.00452577],_upttcommand=[0,0],_refmes=
 0x7fba6c996c30,_tiprefv=0x7fba6caa0230,_tiltrefv=0x7fba6b0c9430,_tiprefvn=
 0x7fba6caa0c30,_tiltrefvn=0x7fba6b07ca30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b08b630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0b3630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b08b630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b83c030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9279d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91e388,_ctrlden=0x7fba6b809138,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac32180,_xlast=0x7fba6ac2c1b0,_ylast=[0x7fba6b040030,
 0x7fba6b040030,0x7fba6b040030],_y0=0x7fba6b071e30,_signus=0x7fba6ac33c50,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac30700,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c928fc0,yposition=
 0x7fba6c927d90,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      704.1   0.005      628.3
Field Avg  1.65                    704.1   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92c050)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0df230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000368152,
 0.00102973],_lastvalidtt=[0.000368152,0.00102973],_upttcommand=[0,0],_refmes=
 0x7fba6b0e4430,_tiprefv=0x7fba6b087830,_tiltrefv=0x7fba6b08e230,_tiprefvn=
 0x7fba6b0a9830,_tiltrefvn=0x7fba6b0c9430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c0ab230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca9b230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c0ab230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c032c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808f08)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928268,_ctrlden=0x7fba6c927818,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae13820,_xlast=0x7fba6ae12da0,_ylast=[0x7fba6c0b0230,
 0x7fba6c0b0230,0x7fba6c0b0230],_y0=0x7fba6c014c30,_signus=0x7fba6ae12f20,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af32380,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c927968,yposition=
 0x7fba6c91e3c0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 140 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      906.5   0.004      628.3
Field Avg  1.65                    906.5   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92b8e0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6cab3830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=140,_nsub4disp=0,_nmes=
 280,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00395394,
 -0.00142933],_lastvalidtt=[-0.00395394,-0.00142933],_upttcommand=[0,0],_refmes=
 0x7fba6c9e1e30,_tiprefv=0x7fba6cab9a30,_tiltrefv=0x7fba6ca92830,_tiprefvn=
 0x7fba6ca99830,_tiltrefvn=0x7fba6ca9b230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca90a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0c3830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca90a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928dc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928460,_ctrlden=0x7fba6c91d898,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2e400,_xlast=0x7fba6ac30440,_ylast=[0x7fba6b040030,
 0x7fba6b040030,0x7fba6b040030],_y0=0x7fba6b071e30,_signus=0x7fba6ac305c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34b10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6c9279d8,yposition=
 0x7fba6c928030,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      393.9   0.007      628.3
Field Avg  1.65                    393.9   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92c5a0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c924a30,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c032c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.0104787,
 0.00307625],_lastvalidtt=[-0.0104787,0.00307625],_upttcommand=[0,0],_refmes=
 0x7fba6b835430,_tiprefv=0x7fba6b835e30,_tiltrefv=0x7fba6b85a430,_tiprefvn=
 0x7fba6b80a830,_tiltrefvn=0x7fba6b85ae30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca9d830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b836830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca9d830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928348)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927428,_ctrlden=0x7fba6c927540,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0df80,_xlast=0x7fba6ad09d40,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b839c30,_signus=0x7fba6ad0d120,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2ca00,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927268,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9279a0,xposition=0x7fba6b808f08,yposition=
 0x7fba6c91da90,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      119.3   0.010      628.3
Field Avg  1.65                    119.3   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b748)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af363b0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00042715,
 7.45251e-05],_lastvalidtt=[0.00042715,7.45251e-05],_upttcommand=[0,0],_refmes=
 0x7fba6caacc30,_tiprefv=0x7fba6caad430,_tiltrefv=0x7fba6cb17830,_tiprefvn=
 0x7fba6cac0030,_tiltrefvn=0x7fba6cb0fe30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cacc430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca98e30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cacc430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928e38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928d20,_ctrlden=0x7fba6c91d898,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac28a70,_xlast=0x7fba6ac2d040,_ylast=[0x7fba6b071e30,
 0x7fba6b071e30,0x7fba6b071e30],_y0=0x7fba6b040030,_signus=0x7fba6ac33c50,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0df80,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927f50,yposition=
 0x7fba6c927540,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      246.7   0.007      628.3
Field Avg  1.65                    246.7   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c1e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af38720,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.0037407,
 -0.00505669],_lastvalidtt=[0.0037407,-0.00505669],_upttcommand=[0,0],_refmes=
 0x7fba6c9e4830,_tiprefv=0x7fba6ca15230,_tiltrefv=0x7fba6cacc430,_tiprefvn=
 0x7fba6caad430,_tiltrefvn=0x7fba6cb17830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caccc30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a0830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caccc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0e4e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928b98)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b809250,_ctrlden=0x7fba6c928428,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2cd10,_xlast=0x7fba6ac2ce90,_ylast=[0x7fba6b040030,
 0x7fba6b040030,0x7fba6b040030],_y0=0x7fba6b0d5a30,_signus=0x7fba6ac29000,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af39960,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c924a30,yposition=
 0x7fba6c91e430,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 140 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      120.8   0.013      628.3
Field Avg  1.65                    120.8   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92ab30)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b857e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=140,_nsub4disp=0,_nmes=
 280,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-1.66526e-05,-0.0016975],_lastvalidtt=[-1.66526e-05,-0.0016975],_upttcommand=
 [0,0],_refmes=0x7fba6b864c30,_tiprefv=0x7fba6b827430,_tiltrefv=0x7fba6b15b030,
 _tiprefvn=0x7fba6b854830,_tiltrefvn=0x7fba6b857430,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b85a430,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6b850230,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b85a430,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c928af0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9272a0,_ctrlden=0x7fba6c927f18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2d210,_xlast=0x7fba6ac2cd10,_ylast=[0x7fba6b0d5a30,
 0x7fba6b0d5a30,0x7fba6b0d5a30],_y0=0x7fba6b096430,_signus=0x7fba6ac28690,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af376a0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928e38,yposition=
 0x7fba6c91dc18,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      132.5   0.015      628.3
Field Avg  1.65                    132.5   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c0d8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0b6e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00462175,
 -0.00180339],_lastvalidtt=[0.00462175,-0.00180339],_upttcommand=[0,0],_refmes=
 0x7fba6b0b7830,_tiprefv=0x7fba6b159230,_tiltrefv=0x7fba6b0e0230,_tiprefvn=
 0x7fba6b0b1630,_tiltrefvn=0x7fba6b15b030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0e2030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0c7030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0e2030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0cb830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928f88)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dba8,_ctrlden=0x7fba6c927f50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2e100,_xlast=0x7fba6ac30440,_ylast=[0x7fba6b096430,
 0x7fba6b096430,0x7fba6b096430],_y0=0x7fba6b040030,_signus=0x7fba6ac2e3c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928b98,yposition=
 0x7fba6b808cd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      132.0   0.010      628.3
Field Avg  1.65                    132.0   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c270)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b80ce30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00528751,
 -0.00320669],_lastvalidtt=[0.00528751,-0.00320669],_upttcommand=[0,0],_refmes=
 0x7fba6cb06a30,_tiprefv=0x7fba6c9e4c30,_tiltrefv=0x7fba6c9c5e30,_tiprefvn=
 0x7fba6ca99430,_tiltrefvn=0x7fba6cacca30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caa8630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0b2c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caa8630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0cb830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928ce8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d9b0,_ctrlden=0x7fba6c8cec40,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c220,_xlast=0x7fba6ae0c3a0,_ylast=[0x7fba6c0b0230,
 0x7fba6c0b0230,0x7fba6c0b0230],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c520,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac35400,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928af0,yposition=
 0x7fba6c927d58,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      190.6   0.011      628.3
Field Avg  1.65                    190.6   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bc10)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0a0830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00272,
 -0.00271506],_lastvalidtt=[-0.00272,-0.00271506],_upttcommand=[0,0],_refmes=
 0x7fba6b80e230,_tiprefv=0x7fba6c9e3630,_tiltrefv=0x7fba6c9e7830,_tiprefvn=
 0x7fba6c9e4c30,_tiltrefvn=0x7fba6c9c5e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caff830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cacd430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caff830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b076a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91db70)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928ff8,_ctrlden=0x7fba6c924a30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac35c50,_xlast=0x7fba6ac28e00,_ylast=[0x7fba6b040030,
 0x7fba6b040030,0x7fba6b040030],_y0=0x7fba6b0b8030,_signus=0x7fba6ac36530,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2f560,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928f88,yposition=
 0x7fba6c91dda0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      350.3   0.007      628.3
Field Avg  1.65                    350.3   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c408)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9c1630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00259032,
 0.00210571],_lastvalidtt=[-0.00259032,0.00210571],_upttcommand=[0,0],_refmes=
 0x7fba6c9c4c30,_tiprefv=0x7fba6caa7230,_tiltrefv=0x7fba6b85b430,_tiprefvn=
 0x7fba6c9e3630,_tiltrefvn=0x7fba6b862c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca93630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cb02630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca93630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9e4030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dac8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927e00,_ctrlden=0x7fba6c928b98,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac31410,_xlast=0x7fba6ac368c0,_ylast=[0x7fba6b0b8030,
 0x7fba6b0b8030,0x7fba6b0b8030],_y0=0x7fba6b096430,_signus=0x7fba6ac35ad0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2ca00,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928ce8,yposition=
 0x7fba6b8092c0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.003      628.3
Field Avg  1.65                   1418.0   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c380)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac33f60,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[2.7635e+11,
 5.88976e+11],_lastvalidtt=[2.7635e+11,5.88976e+11],_upttcommand=[0,0],_refmes=
 0x7fba6b836430,_tiprefv=0x7fba6b85be30,_tiltrefv=0x7fba6b15b030,_tiprefvn=
 0x7fba6b80ce30,_tiltrefvn=0x7fba6b159230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb39e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cb12c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb39e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9c1630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927fc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dc18,_ctrlden=0x7fba6c927d58,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac30440,_xlast=0x7fba6af34b10,_ylast=[0x7fba6caa7830,
 0x7fba6caa7830,0x7fba6caa7830],_y0=0x7fba6b159a30,_signus=0x7fba6af2e6c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af337b0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c91db70,yposition=
 0x7fba6c928c40,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      257.4   0.010      628.3
Field Avg  1.65                    257.4   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c518)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0a8e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00659597,
 0.000791169],_lastvalidtt=[-0.00659597,0.000791169],_upttcommand=[0,0],_refmes=
 0x7fba6b155c30,_tiprefv=0x7fba6b07b230,_tiltrefv=0x7fba6b0d9e30,_tiprefvn=
 0x7fba6b07bc30,_tiltrefvn=0x7fba6b07c630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b1dec30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b836c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b1dec30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9c1630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9277e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dbe0,_ctrlden=0x7fba6c928460,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af37380,_xlast=0x7fba6af34240,_ylast=[0x7fba6c978430,
 0x7fba6c978430,0x7fba6c978430],_y0=0x7fba6c9ea830,_signus=0x7fba6af36b40,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad09d40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c91dac8,yposition=
 0x7fba6c927d90,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      186.7   0.013      628.3
Field Avg  1.65                    186.7   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92af70)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b076a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00110877,
 0.00415858],_lastvalidtt=[-0.00110877,0.00415858],_upttcommand=[0,0],_refmes=
 0x7fba6caa8630,_tiprefv=0x7fba6caa7230,_tiltrefv=0x7fba6c9e8230,_tiprefvn=
 0x7fba6ca9f430,_tiltrefvn=0x7fba6caacc30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca92a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b887430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca92a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b05bc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808db8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d898,_ctrlden=0x7fba6c928428,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2c1b0,_xlast=0x7fba6ac30440,_ylast=[0x7fba6b0d5a30,
 0x7fba6b0d5a30,0x7fba6b0d5a30],_y0=0x7fba6b096430,_signus=0x7fba6ac33220,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac33770,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927fc0,yposition=
 0x7fba6c91dda0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      177.2   0.015      628.3
Field Avg  1.65                    177.2   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6b00da50)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ca17630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00970992,
 0.00367575],_lastvalidtt=[0.00970992,0.00367575],_upttcommand=[0,0],_refmes=
 0x7fba6caa6830,_tiprefv=0x7fba6cb3c430,_tiltrefv=0x7fba6c9dfa30,_tiprefvn=
 0x7fba6caa7230,_tiltrefvn=0x7fba6c9e8230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb2de30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b08d830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb2de30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9e9630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dcc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9278f8,_ctrlden=0x7fba6c91db70,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af31ab0,_xlast=0x7fba6af2f560,_ylast=[0x7fba6c978430,
 0x7fba6c978430,0x7fba6c978430],_y0=0x7fba6c9e9c30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2c100,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c9277e0,yposition=
 0x7fba6c927a48,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      162.8   0.008      628.3
Field Avg  1.65                    162.8   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bc98)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af365f0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.0010146,
 0.00345971],_lastvalidtt=[-0.0010146,0.00345971],_upttcommand=[0,0],_refmes=
 0x7fba6c9e4630,_tiprefv=0x7fba6c9e3630,_tiltrefv=0x7fba6c9e4e30,_tiprefvn=
 0x7fba6ca14a30,_tiltrefvn=0x7fba6cab9a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b850e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a6630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b850e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0dec30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d668)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928ff8,_ctrlden=0x7fba6c928ce8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0df80,_xlast=0x7fba6ad09d40,_ylast=[0x7fba6b839c30,
 0x7fba6b839c30,0x7fba6b839c30],_y0=0x7fba6b83f430,_signus=0x7fba6ad0d120,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac33c50,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6b808db8,yposition=
 0x7fba6c927968,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      173.0   0.008      628.3
Field Avg  1.65                    173.0   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b218)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac36650,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00542082,
 -0.0033243],_lastvalidtt=[-0.00542082,-0.0033243],_upttcommand=[0,0],_refmes=
 0x7fba6b0dbe30,_tiprefv=0x7fba6b0b7230,_tiltrefv=0x7fba6b0e4c30,_tiprefvn=
 0x7fba6b0e4230,_tiltrefvn=0x7fba6b207c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b831630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caa8630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b831630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b83c030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9283b8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dba8,_ctrlden=0x7fba6c927fc0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c220,_xlast=0x7fba6ae0c3a0,_ylast=[0x7fba6c032c30,
 0x7fba6c032c30,0x7fba6c032c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c520,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0c960,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c91dcc0,yposition=
 0x7fba6c927f18,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      131.1   0.013      628.3
Field Avg  1.65                    131.1   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c6b0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6caa1030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00383279,
 -0.00499808],_lastvalidtt=[0.00383279,-0.00499808],_upttcommand=[0,0],_refmes=
 0x7fba6ca99430,_tiprefv=0x7fba6caa8630,_tiltrefv=0x7fba6c9e5e30,_tiprefvn=
 0x7fba6caa9030,_tiltrefvn=0x7fba6c9c6e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0c0c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b830230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0c0c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928c08)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9272a0,_ctrlden=0x7fba6c91dac8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6ca99e30,_signus=0x7fba6af2e6c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2f560,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c91d668,yposition=
 0x7fba6c927578,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      182.7   0.013      628.3
Field Avg  1.65                    182.7   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92aee8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b15b030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00414828,
 -0.00797884],_lastvalidtt=[0.00414828,-0.00797884],_upttcommand=[0,0],_refmes=
 0x7fba6b856430,_tiprefv=0x7fba6b85a830,_tiltrefv=0x7fba6b82a230,_tiprefvn=
 0x7fba6b824230,_tiltrefvn=0x7fba6b856e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cac4230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b836c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cac4230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d7b8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9277e0,_ctrlden=0x7fba6b808db8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac30440,_xlast=0x7fba6af2ca00,_ylast=[0x7fba6ca99e30,
 0x7fba6ca99e30,0x7fba6ca99e30],_y0=0x7fba6cab7430,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34b10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c9283b8,yposition=
 0x7fba6b808cd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      129.7   0.014      628.3
Field Avg  1.65                    129.7   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c518)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0b7c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00620991,
 0.00813169],_lastvalidtt=[0.00620991,0.00813169],_upttcommand=[0,0],_refmes=
 0x7fba6b0e4430,_tiprefv=0x7fba6caa7230,_tiltrefv=0x7fba6caa6830,_tiprefvn=
 0x7fba6cab7830,_tiltrefvn=0x7fba6caacc30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caae630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b858230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caae630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cace430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928f88)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dc18,_ctrlden=0x7fba6c91dcc0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2c1b0,_xlast=0x7fba6ac33c50,_ylast=[0x7fba6b040030,
 0x7fba6b040030,0x7fba6b040030],_y0=0x7fba6b096430,_signus=0x7fba6ac28e00,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928c08,yposition=
 0x7fba6c9275e8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      107.4   0.017      628.3
Field Avg  1.65                    107.4   0.017      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c5a0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6cab7230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00117034,
 -0.0024738],_lastvalidtt=[0.00117034,-0.0024738],_upttcommand=[0,0],_refmes=
 0x7fba6cab0030,_tiprefv=0x7fba6b853230,_tiltrefv=0x7fba6b80a830,_tiprefvn=
 0x7fba6b853c30,_tiltrefvn=0x7fba6b85da30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b836430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0b9a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b836430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928cb0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9279d8,_ctrlden=0x7fba6b025830,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af384c0,_xlast=0x7fba6af2c100,_ylast=[0x7fba6ca15830,
 0x7fba6ca15830,0x7fba6ca15830],_y0=0x7fba6c9eb430,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2ca00,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c91d7b8,yposition=
 0x7fba6b808e28,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      791.4   0.005      628.3
Field Avg  1.65                    791.4   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c628)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0ae830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000791112,
 -0.0043512],_lastvalidtt=[0.000791112,-0.0043512],_upttcommand=[0,0],_refmes=
 0x7fba6cb45630,_tiprefv=0x7fba6c9e4630,_tiltrefv=0x7fba6caa0c30,_tiprefvn=
 0x7fba6cacda30,_tiltrefvn=0x7fba6c9ddc30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca9d030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caa6830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca9d030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b098430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809250)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928ff8,_ctrlden=0x7fba6c9283b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac31af0,_xlast=0x7fba6ac2c1b0,_ylast=[0x7fba6b040030,
 0x7fba6b040030,0x7fba6b040030],_y0=0x7fba6b096430,_signus=0x7fba6ac321d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928f88,yposition=
 0x7fba6c927d58,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 140 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      925.5   0.004      628.3
Field Avg  1.65                    925.5   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6b00da50)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b076a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=140,_nsub4disp=0,_nmes=
 280,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000898671,
 0.000820395],_lastvalidtt=[0.000898671,0.000820395],_upttcommand=[0,0],_refmes=
 0x7fba6b0e4430,_tiprefv=0x7fba6cab9a30,_tiltrefv=0x7fba6cab0c30,_tiprefvn=
 0x7fba6c9e4630,_tiltrefvn=0x7fba6caa0c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0c5e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cb42030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0c5e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928e00)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928af0,_ctrlden=0x7fba6c928268,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af30550,_xlast=0x7fba6af2ca00,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6caaa630,_signus=0x7fba6af351b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0d120,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928cb0,yposition=
 0x7fba6c928e38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      775.8   0.005      628.3
Field Avg  1.65                    775.8   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bf40)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0db830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.0006958,
 0.00668148],_lastvalidtt=[-0.0006958,0.00668148],_upttcommand=[0,0],_refmes=
 0x7fba6caa7230,_tiprefv=0x7fba6caa6830,_tiltrefv=0x7fba6cab0230,_tiprefvn=
 0x7fba6cab9a30,_tiltrefvn=0x7fba6cab0c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb05a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0bba30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb05a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b05bc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9273f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927d90,_ctrlden=0x7fba6c9284d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af31ab0,_xlast=0x7fba6af34b10,_ylast=[0x7fba6caaa630,
 0x7fba6caaa630,0x7fba6caaa630],_y0=0x7fba6c976230,_signus=0x7fba6af2e6c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2f560,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6b809250,yposition=
 0x7fba6c928498,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 140 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      825.4   0.005      628.3
Field Avg  1.65                    825.4   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92ba78)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0ddc30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=140,_nsub4disp=0,_nmes=
 280,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00375031,
 0.00722465],_lastvalidtt=[0.00375031,0.00722465],_upttcommand=[0,0],_refmes=
 0x7fba6b0cf630,_tiprefv=0x7fba6b0dd230,_tiltrefv=0x7fba6c9e4630,_tiprefvn=
 0x7fba6b1ef830,_tiltrefvn=0x7fba6cab0230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b1e1630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0c1030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b1e1630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0cb830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927a10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d9b0,_ctrlden=0x7fba6c9249f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2c100,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6ca15830,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac32eb0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928e00,yposition=
 0x7fba6c91d978,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      319.5   0.007      628.3
Field Avg  1.65                    319.5   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b968)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c8d6830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00346866,
 0.00968099],_lastvalidtt=[0.00346866,0.00968099],_upttcommand=[0,0],_refmes=
 0x7fba6b07b230,_tiprefv=0x7fba6b0c9c30,_tiltrefv=0x7fba6b0bae30,_tiprefvn=
 0x7fba6b0dd230,_tiltrefvn=0x7fba6b1ef830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0d0630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a0830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0d0630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809218)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927888,_ctrlden=0x7fba6c928cb0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad09da0,_xlast=0x7fba6ad0d120,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b839c30,_signus=0x7fba6ad0fcd0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0d2a0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c9273f0,yposition=
 0x7fba6c928460,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      331.6   0.007      628.3
Field Avg  1.65                    331.6   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bc10)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af38bc0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00764769,
 0.000776639],_lastvalidtt=[0.00764769,0.000776639],_upttcommand=[0,0],_refmes=
 0x7fba6b80a830,_tiprefv=0x7fba6c9e4630,_tiltrefv=0x7fba6b80c030,_tiprefvn=
 0x7fba6ca14a30,_tiltrefvn=0x7fba6b82da30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b083630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c09e630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b083630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927460)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928e38,_ctrlden=0x7fba6b809250,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af304d0,_xlast=0x7fba6af2f560,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6c976230,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af32c60,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927a10,yposition=
 0x7fba6c927ff8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      212.5   0.007      628.3
Field Avg  1.65                    212.5   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92af70)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac35140,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00154606,
 0.00883754],_lastvalidtt=[0.00154606,0.00883754],_upttcommand=[0,0],_refmes=
 0x7fba6b200030,_tiprefv=0x7fba6caacc30,_tiltrefv=0x7fba6cab1430,_tiprefvn=
 0x7fba6c9e4630,_tiltrefvn=0x7fba6ca14a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cacbc30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0c9230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cacbc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c990230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809020)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91db70,_ctrlden=0x7fba6c927578,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af363b0,_xlast=0x7fba6af304d0,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6c9ea830,_signus=0x7fba6af36d50,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af37a80,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6b809218,yposition=
 0x7fba6c91d9e8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      217.1   0.011      628.3
Field Avg  1.65                    217.1   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b080)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ca17630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000574273,
 0.0059971],_lastvalidtt=[0.000574273,0.0059971],_upttcommand=[0,0],_refmes=
 0x7fba6b0d2e30,_tiprefv=0x7fba6ca15230,_tiltrefv=0x7fba6caad430,_tiprefvn=
 0x7fba6cab9a30,_tiltrefvn=0x7fba6cacb230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca93630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0da230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca93630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c990230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928c40)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b808e60,_ctrlden=0x7fba6c9273f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0df80,_xlast=0x7fba6ad09d40,_ylast=[0x7fba6b839c30,
 0x7fba6b839c30,0x7fba6b839c30],_y0=0x7fba6b83f430,_signus=0x7fba6ad0d120,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af35ae0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927460,yposition=
 0x7fba6b808f08,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      126.8   0.013      628.3
Field Avg  1.65                    126.8   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c0d8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b040030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000113591,
 -0.00133612],_lastvalidtt=[0.000113591,-0.00133612],_upttcommand=[0,0],_refmes=
 0x7fba6caa5e30,_tiprefv=0x7fba6ca95230,_tiltrefv=0x7fba6c01ba30,_tiprefvn=
 0x7fba6c9de230,_tiltrefvn=0x7fba6c09e630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9e7630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caae630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9e7630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808cd8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928d20,_ctrlden=0x7fba6c9278f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0cda0,_xlast=0x7fba6ae0c420,_ylast=[0x7fba6c0b0230,
 0x7fba6c0b0230,0x7fba6c0b0230],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c5a0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0e0a0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6b809020,yposition=
 0x7fba6c928f88,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      225.9   0.010      628.3
Field Avg  1.65                    225.9   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bf40)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac36700,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00460958,
 0.000100287],_lastvalidtt=[0.00460958,0.000100287],_upttcommand=[0,0],_refmes=
 0x7fba6b0b7230,_tiprefv=0x7fba6b0dd230,_tiltrefv=0x7fba6b0cfe30,_tiprefvn=
 0x7fba6b0c7230,_tiltrefvn=0x7fba6b0db030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b1eac30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9dea30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b1eac30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0dec30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d7b8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d668,_ctrlden=0x7fba6c91d710,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c220,_xlast=0x7fba6ae0c9e0,_ylast=[0x7fba6c014c30,
 0x7fba6c014c30,0x7fba6c014c30],_y0=0x7fba6c032c30,_signus=0x7fba6ae0cb60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac359a0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928c40,yposition=
 0x7fba6c928fc0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      190.6   0.011      628.3
Field Avg  1.65                    190.6   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c380)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae0ea10,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00164301,
 0.00284652],_lastvalidtt=[0.00164301,0.00284652],_upttcommand=[0,0],_refmes=
 0x7fba6c0a2830,_tiprefv=0x7fba6c9e6630,_tiltrefv=0x7fba6b80d630,_tiprefvn=
 0x7fba6ca14a30,_tiltrefvn=0x7fba6b856230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0cfe30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0ada30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0cfe30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9283b8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927d90,_ctrlden=0x7fba6c927460,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6c9ea830,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2f560,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6b808cd8,yposition=
 0x7fba6c924a30,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1107.6   0.004      628.3
Field Avg  1.65                   1107.6   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b7d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac35710,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000669171,0.000413229],_lastvalidtt=[-0.000669171,0.000413229],
 _upttcommand=[0,0],_refmes=0x7fba6b07c830,_tiprefv=0x7fba6b0b3030,_tiltrefv=
 0x7fba6b0da430,_tiprefvn=0x7fba6b0dd230,_tiltrefvn=0x7fba6b0b7830,_reordervec=
 0x0,_npixels=0,_npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,
 _binindices=0x0,_binxy=0,_centroidw=0x0,_fimage=0x7fba6b0c7230,_fimage2=0x0,
 _imistart=0x0,_imjstart=0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,
 _unittilt=0x0,_lgs_defocuses=0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=
 0x0,_yoffset=0x0,_bias=0x0,_flat=0x0,_domask=0,_submask=0x7fba6b0d2030,_kernel=
 0x0,_kernels=0x0,_kerfftr=0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fba6b0c7230,_x=0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,
 _bckgrdcalib=0x7fba6b0b7230,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fba6c927a48)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d9e8,_ctrlden=0x7fba6c91d9b0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0a1d0,_xlast=0x7fba6ad0d120,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b839c30,_signus=0x7fba6ad10400,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad10df0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c91d7b8,yposition=
 0x7fba6c928268,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      181.4   0.014      628.3
Field Avg  1.65                    181.4   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6b00da50)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0c1430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000932207,
 0.00297435],_lastvalidtt=[0.000932207,0.00297435],_upttcommand=[0,0],_refmes=
 0x7fba6b07c830,_tiprefv=0x7fba6b0e4430,_tiltrefv=0x7fba6b0d2630,_tiprefvn=
 0x7fba6b0d0830,_tiltrefvn=0x7fba6b0b2e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb4a230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b08d830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb4a230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927540)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9282a0,_ctrlden=0x7fba6b025830,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af384d0,_xlast=0x7fba6af37aa0,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6c9cac30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af39540,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c9283b8,yposition=
 0x7fba6b809170,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      852.7   0.004      628.3
Field Avg  1.65                    852.7   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92be30)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af3a2e0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000122977,
 -0.00814536],_lastvalidtt=[0.000122977,-0.00814536],_upttcommand=[0,0],_refmes=
 0x7fba6b0b1630,_tiprefv=0x7fba6b0dd230,_tiltrefv=0x7fba6ca14a30,_tiprefvn=
 0x7fba6b0b7230,_tiltrefvn=0x7fba6cb53e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9df230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a7630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9df230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b098430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9277e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9249f8,_ctrlden=0x7fba6c9275e8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af31ab0,_xlast=0x7fba6af34b10,_ylast=[0x7fba6c9cac30,
 0x7fba6c9cac30,0x7fba6c9cac30],_y0=0x7fba6cb54630,_signus=0x7fba6af2e6c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac34710,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927a48,yposition=
 0x7fba6b8092c0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      884.6   0.004      628.3
Field Avg  1.65                    884.6   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c518)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c977630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00474929,
 -0.0109442],_lastvalidtt=[-0.00474929,-0.0109442],_upttcommand=[0,0],_refmes=
 0x7fba6caacc30,_tiprefv=0x7fba6caae630,_tiltrefv=0x7fba6cb85630,_tiprefvn=
 0x7fba6ca15230,_tiltrefvn=0x7fba6cb47e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0c2030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0e0230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0c2030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b83c030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dac8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927690,_ctrlden=0x7fba6c927d58,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6cb54630,
 0x7fba6cb54630,0x7fba6cb54630],_y0=0x7fba6c976230,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2f560,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927540,yposition=
 0x7fba6c927738,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      610.4   0.005      628.3
Field Avg  1.65                    610.4   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bfc8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af39b80,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00546646,
 -0.00587194],_lastvalidtt=[-0.00546646,-0.00587194],_upttcommand=[0,0],_refmes=
 0x7fba6c09e630,_tiprefv=0x7fba6c09ee30,_tiltrefv=0x7fba6caacc30,_tiprefvn=
 0x7fba6c01b230,_tiltrefvn=0x7fba6ca15230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cabe430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cab0430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cabe430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927f18)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927f50,_ctrlden=0x7fba6c928c08,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad09d40,_xlast=0x7fba6ad0d120,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b839c30,_signus=0x7fba6ad0a1d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac28b20,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c9277e0,yposition=
 0x7fba6c9279d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      201.9   0.008      628.3
Field Avg  1.65                    201.9   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bc10)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af34240,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00645718,
 -0.0029058],_lastvalidtt=[0.00645718,-0.0029058],_upttcommand=[0,0],_refmes=
 0x7fba6b0d2e30,_tiprefv=0x7fba6c0be630,_tiltrefv=0x7fba6c0bee30,_tiprefvn=
 0x7fba6c09ee30,_tiltrefvn=0x7fba6c01b230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caa8630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0ba430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caa8630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0dec30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928030)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928e00,_ctrlden=0x7fba6c927a48,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2c100,_xlast=0x7fba6af32c60,_ylast=[0x7fba6c9ea830,
 0x7fba6c9ea830,0x7fba6c9ea830],_y0=0x7fba6c976230,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c91dac8,yposition=
 0x7fba6c927e70,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      161.3   0.009      628.3
Field Avg  1.65                    161.3   0.009      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b968)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af3bee0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00961954,
 0.000709014],_lastvalidtt=[0.00961954,0.000709014],_upttcommand=[0,0],_refmes=
 0x7fba6c9c6e30,_tiprefv=0x7fba6caab030,_tiltrefv=0x7fba6c9dd430,_tiprefvn=
 0x7fba6ca14a30,_tiltrefvn=0x7fba6cabea30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb9d630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caafc30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb9d630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6caaa230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928a48)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928cb0,_ctrlden=0x7fba6b809170,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af373e0,_xlast=0x7fba6af2c100,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6c978430,_signus=0x7fba6af2e6c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0d120,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927f18,yposition=
 0x7fba6c9278f8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      164.3   0.014      628.3
Field Avg  1.65                    164.3   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92beb8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0a8030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00337625,
 0.00210158],_lastvalidtt=[-0.00337625,0.00210158],_upttcommand=[0,0],_refmes=
 0x7fba6b0dd230,_tiprefv=0x7fba6b0b7230,_tiltrefv=0x7fba6b80a830,_tiprefvn=
 0x7fba6b0bac30,_tiltrefvn=0x7fba6b830c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b234e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cabc430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b234e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927a10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9277a8,_ctrlden=0x7fba6c91dbe0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac29310,_xlast=0x7fba6ac2c1b0,_ylast=[0x7fba6b040030,
 0x7fba6b040030,0x7fba6b040030],_y0=0x7fba6b159a30,_signus=0x7fba6ac33f60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2e100,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928030,yposition=
 0x7fba6c91d978,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      282.9   0.008      628.3
Field Avg  1.65                    282.9   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bb00)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b237030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00793478,
 0.00498203],_lastvalidtt=[0.00793478,0.00498203],_upttcommand=[0,0],_refmes=
 0x7fba6b203030,_tiprefv=0x7fba6b236630,_tiltrefv=0x7fba6b23fc30,_tiprefvn=
 0x7fba6b0ba230,_tiltrefvn=0x7fba6b0dd230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b23d230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b1e6230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b23d230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b05bc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809218)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927fc0,_ctrlden=0x7fba6c91dac8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af34b10,_xlast=0x7fba6af2c100,_ylast=[0x7fba6c978430,
 0x7fba6c978430,0x7fba6c978430],_y0=0x7fba6c976230,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af37e10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928a48,yposition=
 0x7fba6c928e38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      136.1   0.015      628.3
Field Avg  1.65                    136.1   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c380)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac31890,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00161884,
 -0.00187799],_lastvalidtt=[0.00161884,-0.00187799],_upttcommand=[0,0],_refmes=
 0x7fba6b0e4a30,_tiprefv=0x7fba6b0b7a30,_tiltrefv=0x7fba6b24a430,_tiprefvn=
 0x7fba6b236630,_tiltrefvn=0x7fba6b23fc30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c0a0830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0e3630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c0a0830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c990230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d710)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dbe0,_ctrlden=0x7fba6c91db70,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af37aa0,_xlast=0x7fba6af34b10,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6c9eb430,_signus=0x7fba6af354c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af304d0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927a10,yposition=
 0x7fba6c91e388,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.8   0.015      628.3
Field Avg  1.65                    117.8   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c738)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad11a60,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00083654,
 -8.0389e-07],_lastvalidtt=[0.00083654,-8.0389e-07],_upttcommand=[0,0],_refmes=
 0x7fba6b80a830,_tiprefv=0x7fba6b80d630,_tiltrefv=0x7fba6c9c8a30,_tiprefvn=
 0x7fba6b80de30,_tiltrefvn=0x7fba6caa8630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cabbe30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a4830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cabbe30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cace430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809020)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928498,_ctrlden=0x7fba6c928030,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2e430,_xlast=0x7fba6ac2d040,_ylast=[0x7fba6b159a30,
 0x7fba6b159a30,0x7fba6b159a30],_y0=0x7fba6b040030,_signus=0x7fba6ac329e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac32ca0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6b809218,yposition=
 0x7fba6c91d9b0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      714.5   0.005      628.3
Field Avg  1.65                    714.5   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c628)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af37830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000963412,0.00151263],_lastvalidtt=[-0.000963412,0.00151263],_upttcommand=
 [0,0],_refmes=0x7fba6c09ee30,_tiprefv=0x7fba6b1f3a30,_tiltrefv=0x7fba6c01b230,
 _tiprefvn=0x7fba6b08e030,_tiltrefvn=0x7fba6c0ae430,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6cb52230,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6b0c8c30,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb52230,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b05bc30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c91e3c0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9273b8,_ctrlden=0x7fba6c928a48,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af31ab0,_xlast=0x7fba6af376a0,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6c9eb430,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af352f0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c91d710,yposition=
 0x7fba6c9282a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      193.2   0.014      628.3
Field Avg  1.65                    193.2   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c160)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6cb62030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000329633,
 0.00343309],_lastvalidtt=[0.000329633,0.00343309],_upttcommand=[0,0],_refmes=
 0x7fba6cb8b430,_tiprefv=0x7fba6c9e7630,_tiltrefv=0x7fba6cb59430,_tiprefvn=
 0x7fba6cb59e30,_tiltrefvn=0x7fba6ca94030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0b1630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caae630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0b1630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b05bc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dc18)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928cb0,_ctrlden=0x7fba6c91d908,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac30440,_xlast=0x7fba6ac35140,_ylast=[0x7fba6b040030,
 0x7fba6b040030,0x7fba6b040030],_y0=0x7fba6b159a30,_signus=0x7fba6ac287d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6b809020,yposition=
 0x7fba6c928508,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      903.0   0.004      628.3
Field Avg  1.65                    903.0   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92ab30)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9eb430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00741413,
 -0.000482846],_lastvalidtt=[0.00741413,-0.000482846],_upttcommand=[0,0],
 _refmes=0x7fba6b0b4e30,_tiprefv=0x7fba6b0d2430,_tiltrefv=0x7fba6b0bda30,
 _tiprefvn=0x7fba6b0e4430,_tiltrefvn=0x7fba6b0dda30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6cb5b030,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6c0b5430,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb5b030,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0cb830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c927a80)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927ff8,_ctrlden=0x7fba6c927d58,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af37450,_xlast=0x7fba6af34b10,_ylast=[0x7fba6c978430,
 0x7fba6c978430,0x7fba6c978430],_y0=0x7fba6c976230,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2ca00,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c91e3c0,yposition=
 0x7fba6c928428,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      729.5   0.005      628.3
Field Avg  1.65                    729.5   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b858)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b80ec30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00566416,
 -0.00853306],_lastvalidtt=[0.00566416,-0.00853306],_upttcommand=[0,0],_refmes=
 0x7fba6c0a4230,_tiprefv=0x7fba6c9e7630,_tiltrefv=0x7fba6c01b230,_tiprefvn=
 0x7fba6ca99430,_tiltrefvn=0x7fba6c0ae830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b226430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caafe30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b226430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca9c830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927738)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d710,_ctrlden=0x7fba6c927f50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c510,_xlast=0x7fba6ae0c690,_ylast=[0x7fba6c032c30,
 0x7fba6c032c30,0x7fba6c032c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0d900,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac30440,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c91dc18,yposition=
 0x7fba6c91d9b0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      184.0   0.011      628.3
Field Avg  1.65                    184.0   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c6b0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0d3030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00388857,
 0.00232351],_lastvalidtt=[0.00388857,0.00232351],_upttcommand=[0,0],_refmes=
 0x7fba6b07b230,_tiprefv=0x7fba6b20fe30,_tiltrefv=0x7fba6b232030,_tiprefvn=
 0x7fba6b21e030,_tiltrefvn=0x7fba6b21ea30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0cfe30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b21b430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0cfe30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b224c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928ff8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928a48,_ctrlden=0x7fba6c927e00,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2c1b0,_xlast=0x7fba6af3a070,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6c978430,_signus=0x7fba6af39160,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0c660,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927a80,yposition=
 0x7fba6b809138,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      102.1   0.009      628.3
Field Avg  1.65                    102.1   0.009      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6b00da50)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af363b0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00692682,
 -0.00466818],_lastvalidtt=[0.00692682,-0.00466818],_upttcommand=[0,0],_refmes=
 0x7fba6ca99430,_tiprefv=0x7fba6b0b1630,_tiltrefv=0x7fba6b0b1e30,_tiprefvn=
 0x7fba6b07b230,_tiltrefvn=0x7fba6b21da30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b08d230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0d2030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b08d230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca99c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927540)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dda0,_ctrlden=0x7fba6c91dba8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2f5e0,_xlast=0x7fba6af2ca00,_ylast=[0x7fba6c978430,
 0x7fba6c978430,0x7fba6c978430],_y0=0x7fba6c9eb430,_signus=0x7fba6af39f40,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34720,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927738,yposition=
 0x7fba6c927700,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      101.5   0.011      628.3
Field Avg  1.65                    101.5   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c0d8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac2e240,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.005762,
 -0.0062394],_lastvalidtt=[0.005762,-0.0062394],_upttcommand=[0,0],_refmes=
 0x7fba6b0d1a30,_tiprefv=0x7fba6b0c4a30,_tiltrefv=0x7fba6b0c5430,_tiprefvn=
 0x7fba6b0b1630,_tiltrefvn=0x7fba6b0b1e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caa9a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b850230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caa9a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6caab430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928b98)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91e430,_ctrlden=0x7fba6c91dc18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af31ab0,_xlast=0x7fba6af38470,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6ca93230,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac32660,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928ff8,yposition=
 0x7fba6c927690,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      168.7   0.010      628.3
Field Avg  1.65                    168.7   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c2f8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0b3230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00142484,
 -0.00247272],_lastvalidtt=[-0.00142484,-0.00247272],_upttcommand=[0,0],_refmes=
 0x7fba6c0be630,_tiprefv=0x7fba6b1e6630,_tiltrefv=0x7fba6c09e630,_tiprefvn=
 0x7fba6b1e7030,_tiltrefvn=0x7fba6c0c0030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9de830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b853430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9de830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c990230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9275e8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9284d0,_ctrlden=0x7fba6b809250,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac33220,_xlast=0x7fba6ac28e00,_ylast=[0x7fba6b159a30,
 0x7fba6b159a30,0x7fba6b159a30],_y0=0x7fba6b071e30,_signus=0x7fba6ac289a0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927540,yposition=
 0x7fba6b809218,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      124.4   0.014      628.3
Field Avg  1.65                    124.4   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b7d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b80ce30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00304854,
 -0.00527017],_lastvalidtt=[-0.00304854,-0.00527017],_upttcommand=[0,0],_refmes=
 0x7fba6b0e4230,_tiprefv=0x7fba6c01b230,_tiltrefv=0x7fba6b80a830,_tiprefvn=
 0x7fba6c0bf430,_tiltrefvn=0x7fba6b855630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb5c430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b07bc30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb5c430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0cb830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927578)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927e00,_ctrlden=0x7fba6c928cb0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af376a0,_xlast=0x7fba6af2f560,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6caab630,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2ca00,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928b98,yposition=
 0x7fba6c927ee0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      134.8   0.014      628.3
Field Avg  1.65                    134.8   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92af70)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad12130,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00126683,
 0.00129721],_lastvalidtt=[0.00126683,0.00129721],_upttcommand=[0,0],_refmes=
 0x7fba6b829630,_tiprefv=0x7fba6b822830,_tiltrefv=0x7fba6b07ba30,_tiprefvn=
 0x7fba6b80b230,_tiltrefvn=0x7fba6b0e4230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca91030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b083630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca91030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6caa9030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808e28)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927dc8,_ctrlden=0x7fba6c927620,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af31ab0,_xlast=0x7fba6af376a0,_ylast=[0x7fba6caab630,
 0x7fba6caab630,0x7fba6caab630],_y0=0x7fba6cac3630,_signus=0x7fba6af363b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af304d0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c9275e8,yposition=
 0x7fba6c928540,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      131.1   0.015      628.3
Field Avg  1.65                    131.1   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b968)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae0f650,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00169696,
 -0.000844891],_lastvalidtt=[0.00169696,-0.000844891],_upttcommand=[0,0],
 _refmes=0x7fba6cac2e30,_tiprefv=0x7fba6ca91030,_tiltrefv=0x7fba6c0ade30,
 _tiprefvn=0x7fba6caacc30,_tiltrefvn=0x7fba6c09e630,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6caa3030,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6c0a0830,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caa3030,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0d2830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6b808df0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928428,_ctrlden=0x7fba6c927a80,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2c1b0,_xlast=0x7fba6ac2d200,_ylast=[0x7fba6b159a30,
 0x7fba6b159a30,0x7fba6b159a30],_y0=0x7fba6b071e30,_signus=0x7fba6ac2e100,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2cd10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927578,yposition=
 0x7fba6c928030,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      928.4   0.004      628.3
Field Avg  1.65                    928.4   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bfc8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad12610,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00147384,
 0.00109389],_lastvalidtt=[0.00147384,0.00109389],_upttcommand=[0,0],_refmes=
 0x7fba6b0e2a30,_tiprefv=0x7fba6b0e4230,_tiltrefv=0x7fba6c09ee30,_tiprefvn=
 0x7fba6b07c030,_tiltrefvn=0x7fba6c0ade30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b210c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b856a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b210c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9249f8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927fc0,_ctrlden=0x7fba6c928b98,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac32fd0,_xlast=0x7fba6ac2c1b0,_ylast=[0x7fba6b071e30,
 0x7fba6b071e30,0x7fba6b071e30],_y0=0x7fba6b040030,_signus=0x7fba6ac34010,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac333c0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6b808e28,yposition=
 0x7fba6c927850,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      237.6   0.012      628.3
Field Avg  1.65                    237.6   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b218)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b80c230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00266446,
 -0.00230441],_lastvalidtt=[0.00266446,-0.00230441],_upttcommand=[0,0],_refmes=
 0x7fba6cab0630,_tiprefv=0x7fba6cab8e30,_tiltrefv=0x7fba6c01b230,_tiprefvn=
 0x7fba6cb4a830,_tiltrefvn=0x7fba6c0ae630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cac6830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9dd430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cac6830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809020)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dbe0,_ctrlden=0x7fba6c927968,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af34b10,_xlast=0x7fba6af2cc50,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6cab1030,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af32380,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6b808df0,yposition=
 0x7fba6c8cec40,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      165.8   0.013      628.3
Field Avg  1.65                    165.8   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b080)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9cfe30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00986544,
 -0.00558704],_lastvalidtt=[0.00986544,-0.00558704],_upttcommand=[0,0],_refmes=
 0x7fba6cabbe30,_tiprefv=0x7fba6cab0630,_tiltrefv=0x7fba6ca96e30,_tiprefvn=
 0x7fba6cab8e30,_tiltrefvn=0x7fba6cb4a830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca91030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b836430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca91030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cb54430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809170)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928a48,_ctrlden=0x7fba6c927700,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af31ab0,_xlast=0x7fba6af34b10,_ylast=[0x7fba6cab1030,
 0x7fba6cab1030,0x7fba6cab1030],_y0=0x7fba6c978430,_signus=0x7fba6af335b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac32f70,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c9249f8,yposition=
 0x7fba6c928508,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      235.5   0.009      628.3
Field Avg  1.65                    235.5   0.009      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c7c0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0a3630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00359102,
 -0.00399377],_lastvalidtt=[0.00359102,-0.00399377],_upttcommand=[0,0],_refmes=
 0x7fba6b08b230,_tiprefv=0x7fba6b80ce30,_tiltrefv=0x7fba6b08a830,_tiprefvn=
 0x7fba6b80b830,_tiltrefvn=0x7fba6b07c030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cabdc30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a0830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cabdc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b08fc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d7b8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928f88,_ctrlden=0x7fba6c928d20,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2f560,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c978430,
 0x7fba6c978430,0x7fba6c978430],_y0=0x7fba6c9e8230,_signus=0x7fba6af363b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac33770,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6b809020,yposition=
 0x7fba6c924a30,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      522.0   0.006      628.3
Field Avg  1.65                    522.0   0.006      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b6c0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af381e0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.015867,
 0.00323896],_lastvalidtt=[0.015867,0.00323896],_upttcommand=[0,0],_refmes=
 0x7fba6b20dc30,_tiprefv=0x7fba6b80d830,_tiltrefv=0x7fba6caa6830,_tiprefvn=
 0x7fba6b80e030,_tiltrefvn=0x7fba6cabbe30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0e0a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0ac630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0e0a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808e60)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9278f8,_ctrlden=0x7fba6c9274d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af34720,_ylast=[0x7fba6c9e8230,
 0x7fba6c9e8230,0x7fba6c9e8230],_y0=0x7fba6c9eb430,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac35140,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6b809170,yposition=
 0x7fba6c91d908,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      260.3   0.007      628.3
Field Avg  1.65                    260.3   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c160)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac30b90,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00795741,
 -0.00840066],_lastvalidtt=[0.00795741,-0.00840066],_upttcommand=[0,0],_refmes=
 0x7fba6b0b1e30,_tiprefv=0x7fba6caa7030,_tiltrefv=0x7fba6b0cfe30,_tiprefvn=
 0x7fba6c9e7630,_tiltrefvn=0x7fba6b0b2630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cac1230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b820030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cac1230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0b5230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927738)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91e388,_ctrlden=0x7fba6c9277e0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0a1d0,_xlast=0x7fba6ad12590,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b837630,_signus=0x7fba6ad0d120,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0bb70,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c91d7b8,yposition=
 0x7fba6c927690,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      119.3   0.008      628.3
Field Avg  1.65                    119.3   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b8e0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af38cc0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00129313,
 0.0064261],_lastvalidtt=[0.00129313,0.0064261],_upttcommand=[0,0],_refmes=
 0x7fba6c9c9c30,_tiprefv=0x7fba6b80a830,_tiltrefv=0x7fba6b07be30,_tiprefvn=
 0x7fba6b80ce30,_tiltrefvn=0x7fba6b0cfe30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca93030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a5830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca93030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928ff8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9274d0,_ctrlden=0x7fba6b809020,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c220,_xlast=0x7fba6ae0c3a0,_ylast=[0x7fba6c0a6c30,
 0x7fba6c0a6c30,0x7fba6c0a6c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c520,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac30440,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6b808e60,yposition=
 0x7fba6b8091e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      117.8   0.014      628.3
Field Avg  1.65                    117.8   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c270)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c101430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.0043333,
 0.00414745],_lastvalidtt=[-0.0043333,0.00414745],_upttcommand=[0,0],_refmes=
 0x7fba6c9c2c30,_tiprefv=0x7fba6c100630,_tiltrefv=0x7fba6b855630,_tiprefvn=
 0x7fba6c09e630,_tiltrefvn=0x7fba6b85b630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9c5c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b856030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9c5c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d9b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927a48,_ctrlden=0x7fba6b809020,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0b9f0,_xlast=0x7fba6ae0c220,_ylast=[0x7fba6c014c30,
 0x7fba6c014c30,0x7fba6c014c30],_y0=0x7fba6c101030,_signus=0x7fba6ae0caa0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac329e0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927738,yposition=
 0x7fba6c927540,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      119.8   0.017      628.3
Field Avg  1.65                    119.8   0.017      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c628)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b80ce30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00173279,
 8.09655e-05],_lastvalidtt=[0.00173279,8.09655e-05],_upttcommand=[0,0],_refmes=
 0x7fba6b0e2230,_tiprefv=0x7fba6c9c2c30,_tiltrefv=0x7fba6b850230,_tiprefvn=
 0x7fba6c9e7630,_tiltrefvn=0x7fba6b855630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca9b230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b251630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca9b230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6caaa230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9283b8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927700,_ctrlden=0x7fba6c927690,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c550,_xlast=0x7fba6ae0b9f0,_ylast=[0x7fba6c101030,
 0x7fba6c101030,0x7fba6c101030],_y0=0x7fba6c0b0230,_signus=0x7fba6ae0c6d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad09d40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928ff8,yposition=
 0x7fba6c91dcc0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      135.7   0.015      628.3
Field Avg  1.65                    135.7   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c518)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af38240,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00816592,
 0.00683885],_lastvalidtt=[0.00816592,0.00683885],_upttcommand=[0,0],_refmes=
 0x7fba6c9e0230,_tiprefv=0x7fba6b80ce30,_tiltrefv=0x7fba6caaa230,_tiprefvn=
 0x7fba6b80d630,_tiltrefvn=0x7fba6caaaa30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb52e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a0830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb52e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b83c030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927578)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b809170,_ctrlden=0x7fba6c927a80,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af31ab0,_xlast=0x7fba6af2c100,_ylast=[0x7fba6c978430,
 0x7fba6c978430,0x7fba6c978430],_y0=0x7fba6c9e0a30,_signus=0x7fba6af2e6c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af35a40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c91d9b0,yposition=
 0x7fba6c928e00,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      138.8   0.013      628.3
Field Avg  1.65                    138.8   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c0d8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af35290,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00280183,
 0.000325132],_lastvalidtt=[0.00280183,0.000325132],_upttcommand=[0,0],_refmes=
 0x7fba6c09ee30,_tiprefv=0x7fba6b80de30,_tiltrefv=0x7fba6b850830,_tiprefvn=
 0x7fba6b80ce30,_tiltrefvn=0x7fba6b80e630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b1dfa30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca91a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b1dfa30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928c40)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9278f8,_ctrlden=0x7fba6c928a48,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0bba0,_xlast=0x7fba6ae0bd20,_ylast=[0x7fba6c0b0230,
 0x7fba6c0b0230,0x7fba6c0b0230],_y0=0x7fba6c014c30,_signus=0x7fba6ae0ce30,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2ca00,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c9283b8,yposition=
 0x7fba6c9272a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      854.7   0.004      628.3
Field Avg  1.65                    854.7   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c6b0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac35450,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00485706,
 -0.00250522],_lastvalidtt=[0.00485706,-0.00250522],_upttcommand=[0,0],_refmes=
 0x7fba6b08d630,_tiprefv=0x7fba6b08c830,_tiltrefv=0x7fba6c9e7630,_tiprefvn=
 0x7fba6b0d1030,_tiltrefvn=0x7fba6caaa030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b083630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0b2c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b083630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0b5230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927850)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b809100,_ctrlden=0x7fba6c928ff8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af36560,_xlast=0x7fba6af32380,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6c978430,_signus=0x7fba6af38010,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927578,yposition=
 0x7fba6c91dc50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      137.5   0.016      628.3
Field Avg  1.65                    137.5   0.016      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c5a0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6cb45030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00164194,
 -0.0067487],_lastvalidtt=[0.00164194,-0.0067487],_upttcommand=[0,0],_refmes=
 0x7fba6caae630,_tiprefv=0x7fba6b80a830,_tiltrefv=0x7fba6caaa830,_tiprefvn=
 0x7fba6b80b230,_tiltrefvn=0x7fba6c9dd430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cac7a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caaf030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cac7a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928b98)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b8091a8,_ctrlden=0x7fba6c91dac8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c220,_xlast=0x7fba6ae0b9f0,_ylast=[0x7fba6c0b0230,
 0x7fba6c0b0230,0x7fba6c0b0230],_y0=0x7fba6c014c30,_signus=0x7fba6ae0bb70,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af37390,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928c40,yposition=
 0x7fba6c928e38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      732.5   0.005      628.3
Field Avg  1.65                    732.5   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c848)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9dec30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00357834,
 0.00123386],_lastvalidtt=[0.00357834,0.00123386],_upttcommand=[0,0],_refmes=
 0x7fba6caa6830,_tiprefv=0x7fba6cb63e30,_tiltrefv=0x7fba6caa0430,_tiprefvn=
 0x7fba6caa0c30,_tiltrefvn=0x7fba6caa7030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0c4030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b1dd430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0c4030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927888)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9275e8,_ctrlden=0x7fba6c927f50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac31d40,_xlast=0x7fba6ac30440,_ylast=[0x7fba6b096430,
 0x7fba6b096430,0x7fba6b096430],_y0=0x7fba6b040030,_signus=0x7fba6ac29190,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad09d40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927850,yposition=
 0x7fba6c927d58,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      693.2   0.005      628.3
Field Avg  1.65                    693.2   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c8d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b80c430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.0103882,
 -0.00507439],_lastvalidtt=[0.0103882,-0.00507439],_upttcommand=[0,0],_refmes=
 0x7fba6b850a30,_tiprefv=0x7fba6b1dd430,_tiltrefv=0x7fba6caa0c30,_tiprefvn=
 0x7fba6b1ddc30,_tiltrefvn=0x7fba6caa0430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cab5830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caae630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cab5830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b8093d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9277a8,_ctrlden=0x7fba6c928fc0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0b9f0,_xlast=0x7fba6ae0bb70,_ylast=[0x7fba6c0b0230,
 0x7fba6c0b0230,0x7fba6c0b0230],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c700,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af304d0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928b98,yposition=
 0x7fba6c9272a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      167.3   0.011      628.3
Field Avg  1.65                    167.3   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bc10)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b83f430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00727862,
 -0.000163369],_lastvalidtt=[0.00727862,-0.000163369],_upttcommand=[0,0],
 _refmes=0x7fba6b850a30,_tiprefv=0x7fba6b0e2230,_tiltrefv=0x7fba6cb4fc30,
 _tiprefvn=0x7fba6b1dd430,_tiltrefvn=0x7fba6caa0c30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6ca93030,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6b1e0230,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca93030,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0a8030,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c91d710)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927e00,_ctrlden=0x7fba6c927ff8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c9e0a30,
 0x7fba6c9e0a30,0x7fba6c9e0a30],_y0=0x7fba6c9eb430,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0e8f0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927888,yposition=
 0x7fba6c927e70,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       72.6   0.009      628.3
Field Avg  1.65                     72.6   0.009      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b218)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac34580,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00362623,
 0.000466866],_lastvalidtt=[0.00362623,0.000466866],_upttcommand=[0,0],_refmes=
 0x7fba6cab0630,_tiprefv=0x7fba6c0a0830,_tiltrefv=0x7fba6b07b230,_tiprefvn=
 0x7fba6c0d1230,_tiltrefvn=0x7fba6b0b4230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b23dc30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9dd430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b23dc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cab0e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927fc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928030,_ctrlden=0x7fba6c91d908,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad09d40,_xlast=0x7fba6ad0d120,_ylast=[0x7fba6b804030,
 0x7fba6b804030,0x7fba6b804030],_y0=0x7fba6b83f430,_signus=0x7fba6ad0a1d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6b8093d8,yposition=
 0x7fba6c928268,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      119.8   0.009      628.3
Field Avg  1.65                    119.8   0.009      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c380)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad123e0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.0082955,
 -0.0081161],_lastvalidtt=[0.0082955,-0.0081161],_upttcommand=[0,0],_refmes=
 0x7fba6b0b3830,_tiprefv=0x7fba6c9c4430,_tiltrefv=0x7fba6c9de830,_tiprefvn=
 0x7fba6cace230,_tiltrefvn=0x7fba6cac6030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9c4c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b08d630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9c4c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c990230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c8cec40)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927ee0,_ctrlden=0x7fba6c927ff8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac292e0,_xlast=0x7fba6ac34c30,_ylast=[0x7fba6b096430,
 0x7fba6b096430,0x7fba6b096430],_y0=0x7fba6b040030,_signus=0x7fba6ac28690,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0c550,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c91d710,yposition=
 0x7fba6c91da20,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      150.7   0.010      628.3
Field Avg  1.65                    150.7   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c738)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b076a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00189285,
 0.00852972],_lastvalidtt=[0.00189285,0.00852972],_upttcommand=[0,0],_refmes=
 0x7fba6b08dc30,_tiprefv=0x7fba6c09f230,_tiltrefv=0x7fba6b854430,_tiprefvn=
 0x7fba6c0a1c30,_tiltrefvn=0x7fba6b80a830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b26aa30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a0830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b26aa30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b05bc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927a80)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dda0,_ctrlden=0x7fba6c927888,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c6d0,_xlast=0x7fba6ae0c850,_ylast=[0x7fba6c0b0230,
 0x7fba6c0b0230,0x7fba6c0b0230],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c9d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac36a00,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927fc0,yposition=
 0x7fba6c928e00,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      119.3   0.016      628.3
Field Avg  1.65                    119.3   0.016      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bfc8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9de830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000585814,
 0.00171084],_lastvalidtt=[0.000585814,0.00171084],_upttcommand=[0,0],_refmes=
 0x7fba6c0a1230,_tiprefv=0x7fba6b80b830,_tiltrefv=0x7fba6b0d6e30,_tiprefvn=
 0x7fba6b82e630,_tiltrefvn=0x7fba6b0c9830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca9d830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9dd430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca9d830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0d2830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928ce8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927540,_ctrlden=0x7fba6b8093d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6cabc830,_signus=0x7fba6af2e6c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0d120,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c8cec40,yposition=
 0x7fba6c91e3c0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      114.1   0.014      628.3
Field Avg  1.65                    114.1   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b858)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac34280,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00110471,
 -0.00153659],_lastvalidtt=[-0.00110471,-0.00153659],_upttcommand=[0,0],_refmes=
 0x7fba6b269e30,_tiprefv=0x7fba6b269630,_tiltrefv=0x7fba6b0d1830,_tiprefvn=
 0x7fba6b0c8e30,_tiltrefvn=0x7fba6b0cfe30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b893230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cb53030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b893230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cb52a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9277e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9277a8,_ctrlden=0x7fba6b808e28,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0d2a0,_xlast=0x7fba6ad0fcd0,_ylast=[0x7fba6b804030,
 0x7fba6b804030,0x7fba6b804030],_y0=0x7fba6b83f430,_signus=0x7fba6ad0a490,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af30550,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927a80,yposition=
 0x7fba6c927a10,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      254.6   0.010      628.3
Field Avg  1.65                    254.6   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b8e0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac33c50,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00626357,
 -0.00259434],_lastvalidtt=[0.00626357,-0.00259434],_upttcommand=[0,0],_refmes=
 0x7fba6b0e2830,_tiprefv=0x7fba6b0d6e30,_tiltrefv=0x7fba6b07b230,_tiprefvn=
 0x7fba6b269630,_tiltrefvn=0x7fba6b0d1830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb59430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b850c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb59430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9278f8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b8093d8,_ctrlden=0x7fba6c9282a0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2e6c0,_xlast=0x7fba6af2c190,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6cb54630,_signus=0x7fba6af37270,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2ca00,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c928ce8,yposition=
 0x7fba6c928f88,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1216.6   0.004      628.3
Field Avg  1.65                   1216.6   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b6c0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af391e0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.0074423,
 0.00319135],_lastvalidtt=[-0.0074423,0.00319135],_upttcommand=[0,0],_refmes=
 0x7fba6cab0630,_tiprefv=0x7fba6c0b2c30,_tiltrefv=0x7fba6cacda30,_tiprefvn=
 0x7fba6c01b230,_tiltrefvn=0x7fba6caafc30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b28e030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0b3630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b28e030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6caa1030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9274d0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928460,_ctrlden=0x7fba6c924a30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af3a090,_xlast=0x7fba6af2e6c0,_ylast=[0x7fba6cb54630,
 0x7fba6cb54630,0x7fba6cb54630],_y0=0x7fba6cb5ce30,_signus=0x7fba6af376a0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac334a0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c9277e0,yposition=
 0x7fba6b808f08,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      247.7   0.009      628.3
Field Avg  1.65                    247.7   0.009      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c1e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b828630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00133163,
 -0.00154379],_lastvalidtt=[0.00133163,-0.00154379],_upttcommand=[0,0],_refmes=
 0x7fba6b088230,_tiprefv=0x7fba6b0d6e30,_tiltrefv=0x7fba6cab0430,_tiprefvn=
 0x7fba6b0c6c30,_tiltrefvn=0x7fba6caaee30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b22ca30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b856a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b22ca30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0dec30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b8091e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d860,_ctrlden=0x7fba6c928b98,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2cd50,_xlast=0x7fba6af2f560,_ylast=[0x7fba6cb5ce30,
 0x7fba6cb5ce30,0x7fba6cb5ce30],_y0=0x7fba6cab0030,_signus=0x7fba6af39f50,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac33770,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c9278f8,yposition=
 0x7fba6b8091a8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      165.8   0.011      628.3
Field Avg  1.65                    165.8   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c958)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b1e1230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000842123,
 0.00542825],_lastvalidtt=[0.000842123,0.00542825],_upttcommand=[0,0],_refmes=
 0x7fba6b284430,_tiprefv=0x7fba6b0b4e30,_tiltrefv=0x7fba6b85c030,_tiprefvn=
 0x7fba6b0e2230,_tiltrefvn=0x7fba6b85a830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b28d030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caa8630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b28d030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b85b030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927dc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dc18,_ctrlden=0x7fba6c928498,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6cab0030,
 0x7fba6cab0030,0x7fba6cab0030],_y0=0x7fba6caa1230,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2c1b0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c9274d0,yposition=
 0x7fba6c927e70,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      371.4   0.006      628.3
Field Avg  1.65                    371.4   0.006      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c9e0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af39670,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00941266,
 0.00275268],_lastvalidtt=[0.00941266,0.00275268],_upttcommand=[0,0],_refmes=
 0x7fba6b07b230,_tiprefv=0x7fba6c0b8c30,_tiltrefv=0x7fba6c01b230,_tiprefvn=
 0x7fba6c0ad230,_tiltrefvn=0x7fba6c0b7630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9c4430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca93030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9c4430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9283b8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d898,_ctrlden=0x7fba6b809138,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af304d0,_xlast=0x7fba6af2ca00,_ylast=[0x7fba6caa1230,
 0x7fba6caa1230,0x7fba6caa1230],_y0=0x7fba6c9eb430,_signus=0x7fba6af2e6c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2f560,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6b8091e0,yposition=
 0x7fba6c927f50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      727.5   0.005      628.3
Field Avg  1.65                    727.5   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.01;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 20;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6b00da50)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91db38,lgs_prof_alt=0x7fba6b81a088,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af3be50,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000900814,
 0.000495365],_lastvalidtt=[0.000900814,0.000495365],_upttcommand=[0,0],_refmes=
 0x7fba6b85b030,_tiprefv=0x7fba6b0d6e30,_tiltrefv=0x7fba6b0cfe30,_tiprefvn=
 0x7fba6b0d0630,_tiltrefvn=0x7fba6b0d0e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9c8630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c09e630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9c8630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cabc630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d9e8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927620,_ctrlden=0x7fba6c928d20,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0b9f0,_xlast=0x7fba6ae0bb70,_ylast=[0x7fba6c014c30,
 0x7fba6c014c30,0x7fba6c014c30],_y0=0x7fba6c09fa30,_signus=0x7fba6ae0cae0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac30440,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927380,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c927dc8,yposition=
 0x7fba6c927f18,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927268,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      229.2   0.007      628.3
Field Avg  1.65                    229.2   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6b00da50)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.45,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ea8,lgs_prof_alt=0x7fba6b808fe8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b076a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00367234,
 0.000934808],_lastvalidtt=[0.00367234,0.000934808],_upttcommand=[0,0],_refmes=
 0x7fba6b22e430,_tiprefv=0x7fba6b22ee30,_tiltrefv=0x7fba6b280c30,_tiprefvn=
 0x7fba6b0d8630,_tiltrefvn=0x7fba6b0e2830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0c2a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caa6830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0c2a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928d58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9282a0,_ctrlden=0x7fba6c927ee0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af3a090,_xlast=0x7fba6af2ca00,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6c9e0a30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af304d0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927f18,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c927268,xposition=0x7fba6c927620,yposition=
 0x7fba6c928d20,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      254.6   0.007      628.3
Field Avg  1.65                    254.6   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92c848)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.45,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927ea8,lgs_prof_alt=0x7fba6b808fe8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6cb72a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00317422,
 -0.00234477],_lastvalidtt=[-0.00317422,-0.00234477],_upttcommand=[0,0],_refmes=
 0x7fba6ca91030,_tiprefv=0x7fba6ca93230,_tiltrefv=0x7fba6cb53a30,_tiprefvn=
 0x7fba6c9c9630,_tiltrefvn=0x7fba6cb53030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0d9830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caa8630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0d9830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b848430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9273f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9283b8,_ctrlden=0x7fba6c91d940,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af34b10,_xlast=0x7fba6af34720,_ylast=[0x7fba6c9e0a30,
 0x7fba6c9e0a30,0x7fba6c9e0a30],_y0=0x7fba6c976230,_signus=0x7fba6af2e6c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927f18,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c927268,xposition=0x7fba6b809218,yposition=
 0x7fba6c9273b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927380,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      185.4   0.008      628.3
Field Avg  1.65                    185.4   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92b858)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c9273f0,lgs_prof_alt=0x7fba6c91e388,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae0f3d0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00426261,
 -2.5801e-05],_lastvalidtt=[0.00426261,-2.5801e-05],_upttcommand=[0,0],_refmes=
 0x7fba6c0a5e30,_tiprefv=0x7fba6c9c3430,_tiltrefv=0x7fba6c9de830,_tiprefvn=
 0x7fba6c967230,_tiltrefvn=0x7fba6c9e1e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b274030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a0830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b274030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cb72a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b025830)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928fc0,_ctrlden=0x7fba6c928d58,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad09d40,_xlast=0x7fba6ad0d120,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b80c430,_signus=0x7fba6ad0a1d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10d6e6030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac329e0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c91d940,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c927f18,xposition=0x7fba6b8093d8,yposition=
 0x7fba6c927738,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      164.3   0.007      628.3
Field Avg  1.65                    164.3   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92caf0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c9273f0,lgs_prof_alt=0x7fba6c91e388,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac33f40,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00487269,
 -0.00726065],_lastvalidtt=[-0.00487269,-0.00726065],_upttcommand=[0,0],_refmes=
 0x7fba6c9ddc30,_tiprefv=0x7fba6c9e7630,_tiltrefv=0x7fba6b80ce30,_tiprefvn=
 0x7fba6c9c3430,_tiltrefvn=0x7fba6b80de30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b828430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b271030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b828430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809020)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927a80,_ctrlden=0x7fba6c927f50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af3a080,_xlast=0x7fba6af379d0,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6cb54630,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac338f0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c91d940,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c927f18,xposition=0x7fba6c91d9e8,yposition=
 0x7fba6c927888,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 140 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      129.7   0.014      628.3
Field Avg  1.65                    129.7   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92be30)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c9273f0,lgs_prof_alt=0x7fba6c91e388,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0b8c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=140,_nsub4disp=0,_nmes=
 280,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00935085,
 -0.00160797],_lastvalidtt=[0.00935085,-0.00160797],_upttcommand=[0,0],_refmes=
 0x7fba6b85da30,_tiprefv=0x7fba6b854230,_tiltrefv=0x7fba6b1dec30,_tiprefvn=
 0x7fba6b86b430,_tiltrefvn=0x7fba6b1df630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb6cc30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca91030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb6cc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0a8030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d710)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c924a30,_ctrlden=0x7fba6c91dcc0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af366a0,_xlast=0x7fba6af36820,_ylast=[0x7fba6cb54630,
 0x7fba6cb54630,0x7fba6cb54630],_y0=0x7fba6c8c4a30,_signus=0x7fba6af36cd0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af39fc0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c91d940,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c927f18,xposition=0x7fba6b025830,yposition=
 0x7fba6c928c08,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      111.3   0.015      628.3
Field Avg  1.65                    111.3   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92b638)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c9273f0,lgs_prof_alt=0x7fba6c91e388,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b858c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00579558,
 -0.00064812],_lastvalidtt=[0.00579558,-0.00064812],_upttcommand=[0,0],_refmes=
 0x7fba6b85da30,_tiprefv=0x7fba6ca9f430,_tiltrefv=0x7fba6caa0630,_tiprefvn=
 0x7fba6cacce30,_tiltrefvn=0x7fba6cacd830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b08b830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b851e30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b08b830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809170)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91da90,_ctrlden=0x7fba6b8093d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af34b10,_xlast=0x7fba6af366a0,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6c9e0a30,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af304d0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c91d940,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c927f18,xposition=0x7fba6b809020,yposition=
 0x7fba6c927ff8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      177.2   0.011      628.3
Field Avg  1.65                    177.2   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92ba78)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c9273f0,lgs_prof_alt=0x7fba6c91e388,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ca9ec30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00122265,
 0.000370323],_lastvalidtt=[0.00122265,0.000370323],_upttcommand=[0,0],_refmes=
 0x7fba6b852230,_tiprefv=0x7fba6b084a30,_tiltrefv=0x7fba6c01b230,_tiprefvn=
 0x7fba6b089e30,_tiltrefvn=0x7fba6c0a0830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca97630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caa8630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca97630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9c1630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809480)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928460,_ctrlden=0x7fba6c91d9e8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad09d40,_xlast=0x7fba6ad0d120,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b804030,_signus=0x7fba6ad0a1d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0bb70,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c91d940,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c927f18,xposition=0x7fba6c91d710,yposition=
 0x7fba6c928af0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      245.7   0.011      628.3
Field Avg  1.65                    245.7   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92b218)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c9273f0,lgs_prof_alt=0x7fba6c91e388,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c11b630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00338707,
 0.00140377],_lastvalidtt=[0.00338707,0.00140377],_upttcommand=[0,0],_refmes=
 0x7fba6c0a2e30,_tiprefv=0x7fba6c0e3230,_tiltrefv=0x7fba6c11ce30,_tiprefvn=
 0x7fba6c11bc30,_tiltrefvn=0x7fba6c01b230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caa8630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0e3e30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caa8630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9c1630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9274d0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928348,_ctrlden=0x7fba6b025830,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c360,_xlast=0x7fba6ae0c4e0,_ylast=[0x7fba6c014c30,
 0x7fba6c014c30,0x7fba6c014c30],_y0=0x7fba6c0e5230,_signus=0x7fba6ae0c660,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2c1b0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c91d940,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c927f18,xposition=0x7fba6b809170,yposition=
 0x7fba6c928d20,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      333.1   0.008      628.3
Field Avg  1.65                    333.1   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92c518)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c9273f0,lgs_prof_alt=0x7fba6c91e388,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9c3430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00249015,
 0.00162545],_lastvalidtt=[0.00249015,0.00162545],_upttcommand=[0,0],_refmes=
 0x7fba6cabbe30,_tiprefv=0x7fba6c9ca030,_tiltrefv=0x7fba6ca91030,_tiprefvn=
 0x7fba6ca98e30,_tiltrefvn=0x7fba6c9dd430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca95230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca9b230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca95230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b848430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928268)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91db38,_ctrlden=0x7fba6b809020,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac32e70,_xlast=0x7fba6ac33770,_ylast=[0x7fba6b040030,
 0x7fba6b040030,0x7fba6b040030],_y0=0x7fba6b08ac30,_signus=0x7fba6ac33c50,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac28e00,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c91d940,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c927f18,xposition=0x7fba6b809480,yposition=
 0x7fba6b809250,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.003      628.3
Field Avg  1.65                   1418.0   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92bda8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c9273f0,lgs_prof_alt=0x7fba6c91e388,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af366a0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[2.44767e+10,
 4.87815e+11],_lastvalidtt=[2.44767e+10,4.87815e+11],_upttcommand=[0,0],_refmes=
 0x7fba6c9e7e30,_tiprefv=0x7fba6ca95230,_tiltrefv=0x7fba6cacb030,_tiprefvn=
 0x7fba6caca630,_tiltrefvn=0x7fba6c9c9e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca91030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cb52230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca91030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91e430)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927a48,_ctrlden=0x7fba6c91d978,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0cf60,_xlast=0x7fba6ae0d0e0,_ylast=[0x7fba6c032c30,
 0x7fba6c032c30,0x7fba6c032c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0d5f0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0c3a0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c91d940,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c927f18,xposition=0x7fba6c9274d0,yposition=
 0x7fba6b809138,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      403.7   0.008      628.3
Field Avg  1.65                    403.7   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92c050)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c9273f0,lgs_prof_alt=0x7fba6c91e388,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b098430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00133238,
 -0.00199449],_lastvalidtt=[-0.00133238,-0.00199449],_upttcommand=[0,0],_refmes=
 0x7fba6b0c3630,_tiprefv=0x7fba6b0c4830,_tiltrefv=0x7fba6c01b230,_tiprefvn=
 0x7fba6b24d030,_tiltrefvn=0x7fba6c0cbc30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb4d430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0cd030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb4d430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927e00)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927428,_ctrlden=0x7fba6c927850,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af32c60,_xlast=0x7fba6af2cc50,_ylast=[0x7fba6c9e0a30,
 0x7fba6c9e0a30,0x7fba6c9e0a30],_y0=0x7fba6c8c4a30,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34720,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c91d940,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c927f18,xposition=0x7fba6c928268,yposition=
 0x7fba6c91d7f0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      142.3   0.012      628.3
Field Avg  1.65                    142.3   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6c92bf40)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c9273f0,lgs_prof_alt=0x7fba6c91e388,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0c2e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00315262,
 0.00100926],_lastvalidtt=[0.00315262,0.00100926],_upttcommand=[0,0],_refmes=
 0x7fba6b0da030,_tiprefv=0x7fba6b1dd430,_tiltrefv=0x7fba6b1df230,_tiprefvn=
 0x7fba6b0c4830,_tiltrefvn=0x7fba6b0e2230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cac0230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b1dde30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cac0230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b81a088)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927a80,_ctrlden=0x7fba6b808d80,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af38720,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6caa9e30,_signus=0x7fba6af2e6c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af32380,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c91d940,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c927f18,xposition=0x7fba6c91e430,yposition=
 0x7fba6c928d20,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6b808fe8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      188.0   0.007      628.3
Field Avg  1.65                    188.0   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92ba78)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af38e20,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00115118,
 -0.0159186],_lastvalidtt=[-0.00115118,-0.0159186],_upttcommand=[0,0],_refmes=
 0x7fba6cabbe30,_tiprefv=0x7fba6ca15a30,_tiltrefv=0x7fba6c9de830,_tiprefvn=
 0x7fba6cb4fa30,_tiltrefvn=0x7fba6c9c7c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca92430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cb59430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca92430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6caa9c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927a10)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927e38,_ctrlden=0x7fba6c91d9e8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0ca40,_xlast=0x7fba6ae0cf10,_ylast=[0x7fba6c032c30,
 0x7fba6c032c30,0x7fba6c032c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0d090,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0d930,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b8092c0,yposition=
 0x7fba6b808d80,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      243.7   0.008      628.3
Field Avg  1.65                    243.7   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92beb8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae0dab0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00367307,
 0.00659803],_lastvalidtt=[0.00367307,0.00659803],_upttcommand=[0,0],_refmes=
 0x7fba6c0a3030,_tiprefv=0x7fba6c125e30,_tiltrefv=0x7fba6c0cbc30,_tiprefvn=
 0x7fba6c109830,_tiltrefvn=0x7fba6c126630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0af030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a3e30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0af030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0daa30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b8091e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928d20,_ctrlden=0x7fba6c928268,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2f560,_xlast=0x7fba6af304d0,_ylast=[0x7fba6c9e0a30,
 0x7fba6c9e0a30,0x7fba6c9e0a30],_y0=0x7fba6c8c4a30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0d320,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c9273f0,yposition=
 0x7fba6b025830,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 140 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      161.3   0.014      628.3
Field Avg  1.65                    161.3   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92cc00)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c8d6830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=140,_nsub4disp=0,_nmes=
 280,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000632223,
 0.000677576],_lastvalidtt=[0.000632223,0.000677576],_upttcommand=[0,0],_refmes=
 0x7fba6ca93630,_tiprefv=0x7fba6c9de230,_tiltrefv=0x7fba6c9ca030,_tiprefvn=
 0x7fba6c9dd430,_tiltrefvn=0x7fba6cb51830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c0ff230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c10a030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c0ff230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927f88)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b8091a8,_ctrlden=0x7fba6c928bd0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae10b90,_xlast=0x7fba6ae10d10,_ylast=[0x7fba6c032c30,
 0x7fba6c032c30,0x7fba6c032c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae10e90,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac32f60,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927a10,yposition=
 0x7fba6c91dc50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       99.7   0.016      628.3
Field Avg  1.65                     99.7   0.016      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92ab30)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b076a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00699215,
 0.00104962],_lastvalidtt=[-0.00699215,0.00104962],_upttcommand=[0,0],_refmes=
 0x7fba6b0e0c30,_tiprefv=0x7fba6b85b830,_tiltrefv=0x7fba6b860630,_tiprefvn=
 0x7fba6b852630,_tiltrefvn=0x7fba6b827030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b1dd430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b821e30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b1dd430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0b8c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9277e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928030,_ctrlden=0x7fba6b8092c0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae11640,_xlast=0x7fba6ae10b90,_ylast=[0x7fba6c014c30,
 0x7fba6c014c30,0x7fba6c014c30],_y0=0x7fba6c0b0230,_signus=0x7fba6ae117c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2c1b0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b8091e0,yposition=
 0x7fba6b809138,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      127.8   0.011      628.3
Field Avg  1.65                    127.8   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92aee8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6caa7630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00123642,
 -0.000292514],_lastvalidtt=[-0.00123642,-0.000292514],_upttcommand=[0,0],
 _refmes=0x7fba6caa0230,_tiprefv=0x7fba6b0d1230,_tiltrefv=0x7fba6b0ae230,
 _tiprefvn=0x7fba6b0c2e30,_tiltrefvn=0x7fba6b089e30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b867430,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6c0ad230,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b867430,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b05bc30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c927fc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9278f8,_ctrlden=0x7fba6c9273f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af34b10,_xlast=0x7fba6af38720,_ylast=[0x7fba6c9e0a30,
 0x7fba6c9e0a30,0x7fba6c9e0a30],_y0=0x7fba6c8c4a30,_signus=0x7fba6af376a0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927f88,yposition=
 0x7fba6c927738,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      204.3   0.012      628.3
Field Avg  1.65                    204.3   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c160)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6cb53430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00196376,
 -0.00382154],_lastvalidtt=[0.00196376,-0.00382154],_upttcommand=[0,0],_refmes=
 0x7fba6ca15a30,_tiprefv=0x7fba6b80d830,_tiltrefv=0x7fba6b80ce30,_tiprefvn=
 0x7fba6b80e230,_tiltrefvn=0x7fba6b864e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caa4830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a1230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caa4830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b05bc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809170)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dcc0,_ctrlden=0x7fba6c927a10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af34440,_xlast=0x7fba6af34b10,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6cb54630,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac30440,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c9277e0,yposition=
 0x7fba6c928fc0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      317.2   0.007      628.3
Field Avg  1.65                    317.2   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c958)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ca17630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00230266,
 -0.00486548],_lastvalidtt=[-0.00230266,-0.00486548],_upttcommand=[0,0],_refmes=
 0x7fba6caa9830,_tiprefv=0x7fba6c01b830,_tiltrefv=0x7fba6c09e630,_tiprefvn=
 0x7fba6c0abc30,_tiltrefvn=0x7fba6c0a6630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caa4a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0aca30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caa4a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca99430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927310)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927700,_ctrlden=0x7fba6c927d90,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0e430,_xlast=0x7fba6ae0dda0,_ylast=[0x7fba6c014c30,
 0x7fba6c014c30,0x7fba6c014c30],_y0=0x7fba6c0ac630,_signus=0x7fba6ae0c220,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0cda0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927fc0,yposition=
 0x7fba6c927690,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1418.0   0.003      628.3
Field Avg  1.65                   1418.0   0.003      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b108)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af39900,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-1.87456e+10,3.22718e+11],_lastvalidtt=[-1.87456e+10,3.22718e+11],
 _upttcommand=[0,0],_refmes=0x7fba6ca15a30,_tiprefv=0x7fba6caa9830,_tiltrefv=
 0x7fba6b82ca30,_tiprefvn=0x7fba6b0c7e30,_tiltrefvn=0x7fba6b82d230,_reordervec=
 0x0,_npixels=0,_npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,
 _binindices=0x0,_binxy=0,_centroidw=0x0,_fimage=0x7fba6b2a2430,_fimage2=0x0,
 _imistart=0x0,_imjstart=0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,
 _unittilt=0x0,_lgs_defocuses=0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=
 0x0,_yoffset=0x0,_bias=0x0,_flat=0x0,_domask=0,_submask=0x7fba6cb55230,_kernel=
 0x0,_kernels=0x0,_kerfftr=0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fba6b2a2430,_x=0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,
 _bckgrdcalib=0x7fba6cb5a630,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fba6c924a30)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9275e8,_ctrlden=0x7fba6c927738,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af392a0,_xlast=0x7fba6af356a0,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6ca16230,_signus=0x7fba6af36b70,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac35280,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b809170,yposition=
 0x7fba6c927ee0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      404.9   0.008      628.3
Field Avg  1.65                    404.9   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c8d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ca99430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00474524,
 -0.000668516],_lastvalidtt=[0.00474524,-0.000668516],_upttcommand=[0,0],
 _refmes=0x7fba6b80e630,_tiprefv=0x7fba6b851030,_tiltrefv=0x7fba6c01b230,
 _tiprefvn=0x7fba6b855630,_tiltrefvn=0x7fba6c0a6430,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b0bb630,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6c0a2630,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0bb630,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cb51830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c928348)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91e430,_ctrlden=0x7fba6b808df0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0dda0,_xlast=0x7fba6ae0df20,_ylast=[0x7fba6c01bc30,
 0x7fba6c01bc30,0x7fba6c01bc30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c220,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0cf90,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927310,yposition=
 0x7fba6b809250,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      140.1   0.015      628.3
Field Avg  1.65                    140.1   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c490)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6cab0230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00691923,
 0.00671914],_lastvalidtt=[-0.00691923,0.00671914],_upttcommand=[0,0],_refmes=
 0x7fba6c0ae630,_tiprefv=0x7fba6b852430,_tiltrefv=0x7fba6ca15a30,_tiprefvn=
 0x7fba6b851030,_tiltrefvn=0x7fba6cabbe30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b1dee30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caa8e30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b1dee30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9283f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9279d8,_ctrlden=0x7fba6c91d9e8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2c1b0,_xlast=0x7fba6ac28a70,_ylast=[0x7fba6b1e1230,
 0x7fba6b1e1230,0x7fba6b1e1230],_y0=0x7fba6b040030,_signus=0x7fba6ac30b10,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af35aa0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c924a30,yposition=
 0x7fba6c928fc0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 136 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      253.6   0.011      628.3
Field Avg  1.65                    253.6   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b6c0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9c9030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=136,_nsub4disp=0,_nmes=
 272,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00118857,
 -0.00602631],_lastvalidtt=[0.00118857,-0.00602631],_upttcommand=[0,0],_refmes=
 0x7fba6c9c8630,_tiprefv=0x7fba6cb59430,_tiltrefv=0x7fba6c9de630,_tiprefvn=
 0x7fba6cab0230,_tiltrefvn=0x7fba6ca15a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6caa2630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b855630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6caa2630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0dec30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808cd8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927a10,_ctrlden=0x7fba6b809170,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af363b0,_xlast=0x7fba6af36b80,_ylast=[0x7fba6cb54630,
 0x7fba6cb54630,0x7fba6cb54630],_y0=0x7fba6c8c4a30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c928348,yposition=
 0x7fba6c9282a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      175.9   0.009      628.3
Field Avg  1.65                    175.9   0.009      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92af70)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac34880,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.0162067,
 -0.00755001],_lastvalidtt=[0.0162067,-0.00755001],_upttcommand=[0,0],_refmes=
 0x7fba6b80e230,_tiprefv=0x7fba6cb52e30,_tiltrefv=0x7fba6cb52630,_tiprefvn=
 0x7fba6cabdc30,_tiltrefvn=0x7fba6c9dd430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b1dee30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b08c230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b1dee30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b076a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928428)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928030,_ctrlden=0x7fba6c928af0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c510,_xlast=0x7fba6ae0c690,_ylast=[0x7fba6c0b0230,
 0x7fba6c0b0230,0x7fba6c0b0230],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c810,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af351b0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c9283f0,yposition=
 0x7fba6c928c40,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      131.1   0.008      628.3
Field Avg  1.65                    131.1   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92aaa8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae0dbc0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00906282,
 0.0108328],_lastvalidtt=[0.00906282,0.0108328],_upttcommand=[0,0],_refmes=
 0x7fba6c0a3430,_tiprefv=0x7fba6c01b830,_tiltrefv=0x7fba6c0c6230,_tiprefvn=
 0x7fba6c09e630,_tiltrefvn=0x7fba6c09ee30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b1dd430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a0830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b1dd430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c0b6e30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b8093d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9278f8,_ctrlden=0x7fba6c927f50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af30530,_xlast=0x7fba6af2c100,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6cb53630,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34720,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b808cd8,yposition=
 0x7fba6b809100,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      170.2   0.013      628.3
Field Avg  1.65                    170.2   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bc98)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c977630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00193032,
 0.000579947],_lastvalidtt=[0.00193032,0.000579947],_upttcommand=[0,0],_refmes=
 0x7fba6cab0230,_tiprefv=0x7fba6cb59430,_tiltrefv=0x7fba6cb70230,_tiprefvn=
 0x7fba6cb50e30,_tiltrefvn=0x7fba6cac9030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0cfe30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caaee30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0cfe30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927460)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d9b0,_ctrlden=0x7fba6c924a30,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af36460,_xlast=0x7fba6af304d0,_ylast=[0x7fba6cb53630,
 0x7fba6cb53630,0x7fba6cb53630],_y0=0x7fba6cb54630,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af35a40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c928428,yposition=
 0x7fba6b808db8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      185.4   0.012      628.3
Field Avg  1.65                    185.4   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b858)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b1e0230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00117019,
 -0.00674993],_lastvalidtt=[0.00117019,-0.00674993],_upttcommand=[0,0],_refmes=
 0x7fba6b85ac30,_tiprefv=0x7fba6b85b630,_tiltrefv=0x7fba6b0d8e30,_tiprefvn=
 0x7fba6b82ca30,_tiltrefvn=0x7fba6b0e0a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b259430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a2630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b259430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9282d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928dc8,_ctrlden=0x7fba6c91dc50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2c1b0,_xlast=0x7fba6ac33220,_ylast=[0x7fba6b1e1230,
 0x7fba6b1e1230,0x7fba6b1e1230],_y0=0x7fba6b0d9830,_signus=0x7fba6ac33770,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac28810,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b8093d8,yposition=
 0x7fba6c927738,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      170.2   0.014      628.3
Field Avg  1.65                    170.2   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c8d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6caa9830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.0030829,
 -0.00296849],_lastvalidtt=[0.0030829,-0.00296849],_upttcommand=[0,0],_refmes=
 0x7fba6caa8e30,_tiprefv=0x7fba6cb59430,_tiltrefv=0x7fba6c0ae830,_tiprefvn=
 0x7fba6cb53030,_tiltrefvn=0x7fba6c0a6e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b085030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a5a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b085030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9277e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b8092c0,_ctrlden=0x7fba6c927dc8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2e100,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6cb54630,
 0x7fba6cb54630,0x7fba6cb54630],_y0=0x7fba6caa9e30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af304d0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927460,yposition=
 0x7fba6c928b98,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       99.1   0.014      628.3
Field Avg  1.65                     99.1   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c518)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0a4830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00220261,
 0.00134569],_lastvalidtt=[0.00220261,0.00134569],_upttcommand=[0,0],_refmes=
 0x7fba6c0d9230,_tiprefv=0x7fba6c0a9830,_tiltrefv=0x7fba6c0eb230,_tiprefvn=
 0x7fba6c09ec30,_tiltrefvn=0x7fba6c0ae830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb03430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0c3c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb03430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cabc630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91da90)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c929030,_ctrlden=0x7fba6c9273f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2f560,_xlast=0x7fba6af301e0,_ylast=[0x7fba6caa9e30,
 0x7fba6caa9e30,0x7fba6caa9e30],_y0=0x7fba6cb53630,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34b10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c9282d8,yposition=
 0x7fba6c91d9e8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      735.8   0.005      628.3
Field Avg  1.65                    735.8   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92caf0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0a8030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00415912,
 2.21271e-05],_lastvalidtt=[0.00415912,2.21271e-05],_upttcommand=[0,0],_refmes=
 0x7fba6b08d630,_tiprefv=0x7fba6b0d8e30,_tiltrefv=0x7fba6c9c9a30,_tiprefvn=
 0x7fba6b087830,_tiltrefvn=0x7fba6c9ca430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b248630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b08b830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b248630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0d2830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928d58)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928460,_ctrlden=0x7fba6c928348,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af354c0,_xlast=0x7fba6af2f560,_ylast=[0x7fba6cb53630,
 0x7fba6cb53630,0x7fba6cb53630],_y0=0x7fba6cab0830,_signus=0x7fba6af39ee0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c9277e0,yposition=
 0x7fba6b809138,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 140 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1080.4   0.004      628.3
Field Avg  1.65                   1080.4   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b6c0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6cb72a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=140,_nsub4disp=0,_nmes=
 280,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00227073,
 -0.00386788],_lastvalidtt=[0.00227073,-0.00386788],_upttcommand=[0,0],_refmes=
 0x7fba6caa7230,_tiprefv=0x7fba6caa6830,_tiltrefv=0x7fba6b08a630,_tiprefvn=
 0x7fba6caaee30,_tiltrefvn=0x7fba6b0e2630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca91030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a0830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca91030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928540)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927a10,_ctrlden=0x7fba6c928428,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2c1b0,_xlast=0x7fba6ac28e40,_ylast=[0x7fba6b1e1230,
 0x7fba6b1e1230,0x7fba6b1e1230],_y0=0x7fba6b088a30,_signus=0x7fba6ac33220,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2c100,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91da90,yposition=
 0x7fba6c927818,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      543.6   0.005      628.3
Field Avg  1.65                    543.6   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c050)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c9dea30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00368052,
 -0.00368385],_lastvalidtt=[-0.00368052,-0.00368385],_upttcommand=[0,0],_refmes=
 0x7fba6caa7230,_tiprefv=0x7fba6caaf830,_tiltrefv=0x7fba6caa9830,_tiprefvn=
 0x7fba6caa6830,_tiltrefvn=0x7fba6caaee30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cabdc30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a3a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cabdc30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0d9630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927540)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dac8,_ctrlden=0x7fba6c927850,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac334e0,_xlast=0x7fba6ac2c1b0,_ylast=[0x7fba6b088a30,
 0x7fba6b088a30,0x7fba6b088a30],_y0=0x7fba6b0dac30,_signus=0x7fba6ac2cd60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac351a0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c928d58,yposition=
 0x7fba6c928ce8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 140 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1039.7   0.004      628.3
Field Avg  1.65                   1039.7   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c848)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0b8c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=140,_nsub4disp=0,_nmes=
 280,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00415999,
 -0.00084278],_lastvalidtt=[-0.00415999,-0.00084278],_upttcommand=[0,0],_refmes=
 0x7fba6b0c8a30,_tiprefv=0x7fba6b0bda30,_tiltrefv=0x7fba6b1c5a30,_tiprefvn=
 0x7fba6b0aca30,_tiltrefvn=0x7fba6b247830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b248230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b820030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b248230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d7f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c924a30,_ctrlden=0x7fba6b8091a8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c220,_xlast=0x7fba6ae0c3a0,_ylast=[0x7fba6c0b0230,
 0x7fba6c0b0230,0x7fba6c0b0230],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c520,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac349c0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c928540,yposition=
 0x7fba6c927a48,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      538.2   0.006      628.3
Field Avg  1.65                    538.2   0.006      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c958)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6cabc630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00491414,
 -0.00731457],_lastvalidtt=[-0.00491414,-0.00731457],_upttcommand=[0,0],_refmes=
 0x7fba6caa6830,_tiprefv=0x7fba6caa9830,_tiltrefv=0x7fba6cb50e30,_tiprefvn=
 0x7fba6caa7230,_tiltrefvn=0x7fba6cb52630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b249630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0b2630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b249630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c990230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927fc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927738,_ctrlden=0x7fba6c9278f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6cacde30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af37e10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927540,yposition=
 0x7fba6b809250,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       97.8   0.009      628.3
Field Avg  1.65                     97.8   0.009      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b218)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad0a760,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00784227,
 0.00184692],_lastvalidtt=[0.00784227,0.00184692],_upttcommand=[0,0],_refmes=
 0x7fba6b85b030,_tiprefv=0x7fba6b0bb630,_tiltrefv=0x7fba6b85b830,_tiprefvn=
 0x7fba6b0bd430,_tiltrefvn=0x7fba6b80d430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b248230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca91a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b248230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9c1630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928c40)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d860,_ctrlden=0x7fba6c928d58,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0df80,_xlast=0x7fba6ad09d90,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b854a30,_signus=0x7fba6ad0d120,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac36950,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91d7f0,yposition=
 0x7fba6c91d898,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      174.5   0.008      628.3
Field Avg  1.65                    174.5   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c490)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af363b0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.0144466,
 -0.00159335],_lastvalidtt=[0.0144466,-0.00159335],_upttcommand=[0,0],_refmes=
 0x7fba6caaf630,_tiprefv=0x7fba6cb50e30,_tiltrefv=0x7fba6caaee30,_tiprefvn=
 0x7fba6ca9f430,_tiltrefvn=0x7fba6ca97230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb66a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0b2c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb66a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808df0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927f88,_ctrlden=0x7fba6c928540,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c4e0,_xlast=0x7fba6ae0c660,_ylast=[0x7fba6c014c30,
 0x7fba6c014c30,0x7fba6c014c30],_y0=0x7fba6c0aee30,_signus=0x7fba6ae0c7e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af39ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927fc0,yposition=
 0x7fba6c927f50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      116.2   0.012      628.3
Field Avg  1.65                    116.2   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c9e0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0a8030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00927645,
 -0.000539108],_lastvalidtt=[0.00927645,-0.000539108],_upttcommand=[0,0],
 _refmes=0x7fba6b0c8a30,_tiprefv=0x7fba6b089e30,_tiltrefv=0x7fba6b80de30,
 _tiprefvn=0x7fba6b08de30,_tiltrefvn=0x7fba6b85ba30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6c9c9830,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6cac6030,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9c9830,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6b809170)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928d20,_ctrlden=0x7fba6c9279d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6ca93e30,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac34320,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c928c40,yposition=
 0x7fba6c91dcc0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      147.8   0.014      628.3
Field Avg  1.65                    147.8   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bda8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ca16230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00182728,
 -0.00118566],_lastvalidtt=[0.00182728,-0.00118566],_upttcommand=[0,0],_refmes=
 0x7fba6caa5230,_tiprefv=0x7fba6caa5a30,_tiltrefv=0x7fba6c09e630,_tiprefvn=
 0x7fba6ca9f430,_tiltrefvn=0x7fba6c01b230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b086230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a0830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b086230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927310)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d908,_ctrlden=0x7fba6c91e430,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad09d40,_xlast=0x7fba6ad0fcd0,_ylast=[0x7fba6b854a30,
 0x7fba6b854a30,0x7fba6b854a30],_y0=0x7fba6b83f430,_signus=0x7fba6ad0d120,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad10360,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b808df0,yposition=
 0x7fba6c9277e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      118.8   0.015      628.3
Field Avg  1.65                    118.8   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c050)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac28e00,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00183439,
 -0.00479711],_lastvalidtt=[0.00183439,-0.00479711],_upttcommand=[0,0],_refmes=
 0x7fba6b80a830,_tiprefv=0x7fba6b0e0a30,_tiltrefv=0x7fba6c0c5030,_tiprefvn=
 0x7fba6b0c2e30,_tiltrefvn=0x7fba6c09e630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca9de30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b855630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca9de30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b1df430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809100)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927738,_ctrlden=0x7fba6b808e60,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af38dc0,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6caa7830,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2c1b0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b809170,yposition=
 0x7fba6c927818,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      165.8   0.012      628.3
Field Avg  1.65                    165.8   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b108)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac31690,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000543615,
 -0.00228889],_lastvalidtt=[0.000543615,-0.00228889],_upttcommand=[0,0],_refmes=
 0x7fba6b08dc30,_tiprefv=0x7fba6b08e430,_tiltrefv=0x7fba6c0b5830,_tiprefvn=
 0x7fba6b0e0a30,_tiltrefvn=0x7fba6c0c5030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c0ad230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b858830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c0ad230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927968)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d860,_ctrlden=0x7fba6c928c40,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0ec10,_xlast=0x7fba6ae0dd00,_ylast=[0x7fba6c0b6830,
 0x7fba6c0b6830,0x7fba6c0b6830],_y0=0x7fba6c0b9830,_signus=0x7fba6ae0e5e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac338f0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927310,yposition=
 0x7fba6c928348,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      669.8   0.005      628.3
Field Avg  1.65                    669.8   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c738)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac36460,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00580588,
 -0.00388867],_lastvalidtt=[-0.00580588,-0.00388867],_upttcommand=[0,0],_refmes=
 0x7fba6cab0230,_tiprefv=0x7fba6ca99230,_tiltrefv=0x7fba6b1dbe30,_tiprefvn=
 0x7fba6cb50e30,_tiltrefvn=0x7fba6b0e2430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c0b7c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0ba230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c0b7c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0e2c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809480)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9279d8,_ctrlden=0x7fba6c928030,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac34c60,_xlast=0x7fba6ac2e100,_ylast=[0x7fba6b1e1230,
 0x7fba6b1e1230,0x7fba6b1e1230],_y0=0x7fba6b040030,_signus=0x7fba6ac36840,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2d220,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b809100,yposition=
 0x7fba6c928428,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      140.6   0.015      628.3
Field Avg  1.65                    140.6   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b6c0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b853430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00821781,
 -0.00580502],_lastvalidtt=[0.00821781,-0.00580502],_upttcommand=[0,0],_refmes=
 0x7fba6b1dd430,_tiprefv=0x7fba6ca93030,_tiltrefv=0x7fba6b1dde30,_tiprefvn=
 0x7fba6caa8e30,_tiltrefvn=0x7fba6b0c8a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0b0a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0bb230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0b0a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b80a830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927e38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928460,_ctrlden=0x7fba6c91dba8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af366c0,_xlast=0x7fba6af32380,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6cab0830,_signus=0x7fba6af37140,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af35330,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927968,yposition=
 0x7fba6c9282d8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      655.0   0.005      628.3
Field Avg  1.65                    655.0   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c518)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af3b520,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00171743,
 -0.00253648],_lastvalidtt=[-0.00171743,-0.00253648],_upttcommand=[0,0],_refmes=
 0x7fba6caaee30,_tiprefv=0x7fba6cb55230,_tiltrefv=0x7fba6cb58c30,_tiprefvn=
 0x7fba6cb50e30,_tiltrefvn=0x7fba6ca93030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0c7830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0bc630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0c7830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c0b0230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c8cec40)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928540,_ctrlden=0x7fba6b808d80,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad09d90,_xlast=0x7fba6ad0d120,_ylast=[0x7fba6b854a30,
 0x7fba6b854a30,0x7fba6b854a30],_y0=0x7fba6b83f430,_signus=0x7fba6ad0a1d0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0d0e0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b809480,yposition=
 0x7fba6b8091a8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1259.2   0.004      628.3
Field Avg  1.65                   1259.2   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c270)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ca17630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000484726,
 0.00225037],_lastvalidtt=[0.000484726,0.00225037],_upttcommand=[0,0],_refmes=
 0x7fba6b0d0630,_tiprefv=0x7fba6ca93830,_tiltrefv=0x7fba6b0e2030,_tiprefvn=
 0x7fba6b0c3630,_tiltrefvn=0x7fba6b08d830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b244230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0c0c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b244230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d9b0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928fc0,_ctrlden=0x7fba6c928d20,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c220,_xlast=0x7fba6ae0f760,_ylast=[0x7fba6c0f4a30,
 0x7fba6c0f4a30,0x7fba6c0f4a30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0f8e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0ced0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927e38,yposition=
 0x7fba6c91e430,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      654.6   0.005      628.3
Field Avg  1.65                    654.6   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92beb8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac31a20,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000888954,-0.00247822],_lastvalidtt=[-0.000888954,-0.00247822],
 _upttcommand=[0,0],_refmes=0x7fba6b087830,_tiprefv=0x7fba6b0d0630,_tiltrefv=
 0x7fba6b851e30,_tiprefvn=0x7fba6b08b830,_tiltrefvn=0x7fba6b852e30,_reordervec=
 0x0,_npixels=0,_npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,
 _binindices=0x0,_binxy=0,_centroidw=0x0,_fimage=0x7fba6b24de30,_fimage2=0x0,
 _imistart=0x0,_imjstart=0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,
 _unittilt=0x0,_lgs_defocuses=0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=
 0x0,_yoffset=0x0,_bias=0x0,_flat=0x0,_domask=0,_submask=0x7fba6b850a30,_kernel=
 0x0,_kernels=0x0,_kerfftr=0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fba6b24de30,_x=0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,
 _bckgrdcalib=0x7fba6b08fc30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fba6b809250)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928d58,_ctrlden=0x7fba6c928cb0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c9eb430,
 0x7fba6c9eb430,0x7fba6c9eb430],_y0=0x7fba6c8c4a30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2f560,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c8cec40,yposition=
 0x7fba6b808e28,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      343.2   0.007      628.3
Field Avg  1.65                    343.2   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bb00)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af38d50,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00288832,
 -0.00024679],_lastvalidtt=[0.00288832,-0.00024679],_upttcommand=[0,0],_refmes=
 0x7fba6b837630,_tiprefv=0x7fba6b0b4630,_tiltrefv=0x7fba6caa8e30,_tiprefvn=
 0x7fba6b0d0630,_tiltrefvn=0x7fba6ca15a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca96630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0bec30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca96630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9caa30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d7f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d860,_ctrlden=0x7fba6b809480,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad09d40,_xlast=0x7fba6ad0d120,_ylast=[0x7fba6b85c430,
 0x7fba6b85c430,0x7fba6b85c430],_y0=0x7fba6b837e30,_signus=0x7fba6ad0fcd0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0c3a0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91d9b0,yposition=
 0x7fba6b025830,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      278.5   0.007      628.3
Field Avg  1.65                    278.5   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c050)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae105a0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00920235,
 -0.000733685],_lastvalidtt=[0.00920235,-0.000733685],_upttcommand=[0,0],
 _refmes=0x7fba6c0ac830,_tiprefv=0x7fba6c0ac030,_tiltrefv=0x7fba6b80e830,
 _tiprefvn=0x7fba6c0ab630,_tiltrefvn=0x7fba6b85ac30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b0b0430,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6ca95230,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0b0430,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b076a30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c927700)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928e38,_ctrlden=0x7fba6c928af0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2c1b0,_xlast=0x7fba6ac33430,_ylast=[0x7fba6b096430,
 0x7fba6b096430,0x7fba6b096430],_y0=0x7fba6b1e1230,_signus=0x7fba6ac33770,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b809250,yposition=
 0x7fba6c927f88,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      137.0   0.012      628.3
Field Avg  1.65                    137.0   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b748)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0bde30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00106253,
 0.00530452],_lastvalidtt=[-0.00106253,0.00530452],_upttcommand=[0,0],_refmes=
 0x7fba6b0b0c30,_tiprefv=0x7fba6b0ba230,_tiltrefv=0x7fba6c0a8030,_tiprefvn=
 0x7fba6b0b3e30,_tiltrefvn=0x7fba6c0a8a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca92830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b80ce30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca92830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928bd0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c924a30,_ctrlden=0x7fba6c8cec40,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af34b10,_xlast=0x7fba6af304d0,_ylast=[0x7fba6caa0230,
 0x7fba6caa0230,0x7fba6caa0230],_y0=0x7fba6cacde30,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac33420,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91d7f0,yposition=
 0x7fba6c9275e8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      151.1   0.012      628.3
Field Avg  1.65                    151.1   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b9f0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b1e1230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000149571,
 -0.00319526],_lastvalidtt=[0.000149571,-0.00319526],_upttcommand=[0,0],_refmes=
 0x7fba6c0c1830,_tiprefv=0x7fba6ca9f830,_tiltrefv=0x7fba6c0c2030,_tiprefvn=
 0x7fba6cb50e30,_tiltrefvn=0x7fba6c01b230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0bb030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a2430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0bb030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b05bc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9277e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9283f0,_ctrlden=0x7fba6b808cd8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af35a40,_xlast=0x7fba6af34b10,_ylast=[0x7fba6cacde30,
 0x7fba6cacde30,0x7fba6cacde30],_y0=0x7fba6caa9e30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2c1b0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927700,yposition=
 0x7fba6c927460,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      130.6   0.014      628.3
Field Avg  1.65                    130.6   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b218)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac354b0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00787825,
 -0.00137124],_lastvalidtt=[0.00787825,-0.00137124],_upttcommand=[0,0],_refmes=
 0x7fba6b85bc30,_tiprefv=0x7fba6caaee30,_tiltrefv=0x7fba6b80b830,_tiprefvn=
 0x7fba6ca9f830,_tiltrefvn=0x7fba6b80e030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9c9830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b1db030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9c9830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c929030)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b809100,_ctrlden=0x7fba6b808df0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6caa9e30,
 0x7fba6caa9e30,0x7fba6caa9e30],_y0=0x7fba6c8c4a30,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af35a40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c928bd0,yposition=
 0x7fba6c927a10,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      115.1   0.017      628.3
Field Avg  1.65                    115.1   0.017      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bc98)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac323f0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.0075289,
 -0.00640609],_lastvalidtt=[0.0075289,-0.00640609],_upttcommand=[0,0],_refmes=
 0x7fba6b0b2c30,_tiprefv=0x7fba6b083630,_tiltrefv=0x7fba6b859e30,_tiprefvn=
 0x7fba6b22ca30,_tiltrefvn=0x7fba6b80b830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b1c0630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0bec30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b1c0630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cacdc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809170)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928428,_ctrlden=0x7fba6c9282a0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad11140,_xlast=0x7fba6ad11eb0,_ylast=[0x7fba6b854a30,
 0x7fba6b854a30,0x7fba6b854a30],_y0=0x7fba6b83f430,_signus=0x7fba6ad127c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac338f0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c9277e0,yposition=
 0x7fba6c91dc18,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      432.5   0.006      628.3
Field Avg  1.65                    432.5   0.006      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92aee8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ad118f0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000755031,-0.000819908],_lastvalidtt=[-0.000755031,-0.000819908],
 _upttcommand=[0,0],_refmes=0x7fba6b858630,_tiprefv=0x7fba6b858e30,_tiltrefv=
 0x7fba6b0e2a30,_tiprefvn=0x7fba6b875030,_tiltrefvn=0x7fba6b08d830,_reordervec=
 0x0,_npixels=0,_npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,
 _binindices=0x0,_binxy=0,_centroidw=0x0,_fimage=0x7fba6ca96c30,_fimage2=0x0,
 _imistart=0x0,_imjstart=0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,
 _unittilt=0x0,_lgs_defocuses=0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=
 0x0,_yoffset=0x0,_bias=0x0,_flat=0x0,_domask=0,_submask=0x7fba6b0ba230,_kernel=
 0x0,_kernels=0x0,_kerfftr=0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,
 _dispimage=0x7fba6ca96c30,_x=0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,
 _bckgrdcalib=0x7fba6cb72a30,_bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,
 _zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,
 _LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],_LLT_pupil=0x0,
 _LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=0x7fba6c91da20)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dda0,_ctrlden=0x7fba6c928e38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c220,_xlast=0x7fba6ae0c3a0,_ylast=[0x7fba6c032c30,
 0x7fba6c032c30,0x7fba6c032c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c520,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac33770,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c929030,yposition=
 0x7fba6c927578,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      167.3   0.012      628.3
Field Avg  1.65                    167.3   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b6c0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b05bc30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000869277,
 -0.0108267],_lastvalidtt=[0.000869277,-0.0108267],_upttcommand=[0,0],_refmes=
 0x7fba6b0e0a30,_tiprefv=0x7fba6b0b4230,_tiltrefv=0x7fba6b850a30,_tiprefvn=
 0x7fba6b0aca30,_tiltrefvn=0x7fba6b852e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca95230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b851430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca95230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca93c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91da90)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b808cd8,_ctrlden=0x7fba6c927a10,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac31ff0,_xlast=0x7fba6ac28e00,_ylast=[0x7fba6b1dc830,
 0x7fba6b1dc830,0x7fba6b1dc830],_y0=0x7fba6b08de30,_signus=0x7fba6ac30440,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0fcd0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b809170,yposition=
 0x7fba6b808d80,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1106.0   0.004      628.3
Field Avg  1.65                   1106.0   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92caf0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0c2a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00103352,
 0.0138931],_lastvalidtt=[-0.00103352,0.0138931],_upttcommand=[0,0],_refmes=
 0x7fba6b08d230,_tiprefv=0x7fba6b0e0a30,_tiltrefv=0x7fba6c0a8030,_tiprefvn=
 0x7fba6b08b830,_tiltrefvn=0x7fba6c0a8830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0bec30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b855630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0bec30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0cb830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927dc8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927d90,_ctrlden=0x7fba6c927f88,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2cd10,_xlast=0x7fba6ac30900,_ylast=[0x7fba6b08de30,
 0x7fba6b08de30,0x7fba6b08de30],_y0=0x7fba6b096430,_signus=0x7fba6ac31110,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2f560,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91da20,yposition=
 0x7fba6c928d20,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      282.9   0.006      628.3
Field Avg  1.65                    282.9   0.006      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c160)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0a7c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000705471,-0.0038978],_lastvalidtt=[-0.000705471,-0.0038978],_upttcommand=
 [0,0],_refmes=0x7fba6b08c830,_tiprefv=0x7fba6b08c030,_tiltrefv=0x7fba6b80a830,
 _tiprefvn=0x7fba6b0e0a30,_tiltrefvn=0x7fba6b80b030,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b236230,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6c0c0c30,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b236230,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c0cbe30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c927968)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928540,_ctrlden=0x7fba6b808e28,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c2b0,_xlast=0x7fba6ae0c430,_ylast=[0x7fba6c032c30,
 0x7fba6c032c30,0x7fba6c032c30],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c5b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac34cc0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91da90,yposition=
 0x7fba6c91dc18,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      196.9   0.010      628.3
Field Avg  1.65                    196.9   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c2f8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b0d2830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00608538,
 0.00194767],_lastvalidtt=[-0.00608538,0.00194767],_upttcommand=[0,0],_refmes=
 0x7fba6cac9c30,_tiprefv=0x7fba6caa6830,_tiltrefv=0x7fba6cb50e30,_tiprefvn=
 0x7fba6caa7230,_tiltrefvn=0x7fba6ca9f430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0bca30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b1cc230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0bca30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b1e0230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809480)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927f88,_ctrlden=0x7fba6c927e38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af33ca0,_xlast=0x7fba6af384b0,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6c976230,_signus=0x7fba6af38120,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34b10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927dc8,yposition=
 0x7fba6c927a48,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      330.9   0.007      628.3
Field Avg  1.65                    330.9   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bb00)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae0f8f0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00197539,
 0.00560764],_lastvalidtt=[-0.00197539,0.00560764],_upttcommand=[0,0],_refmes=
 0x7fba6b1dd430,_tiprefv=0x7fba6b0b4030,_tiltrefv=0x7fba6b855c30,_tiprefvn=
 0x7fba6b1ddc30,_tiltrefvn=0x7fba6b85b630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b1c5a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b856a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b1c5a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b855630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808db8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91da20,_ctrlden=0x7fba6b809138,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac315a0,_xlast=0x7fba6ac310e0,_ylast=[0x7fba6b040030,
 0x7fba6b040030,0x7fba6b040030],_y0=0x7fba6b1de430,_signus=0x7fba6ac35ba0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac290c0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927968,yposition=
 0x7fba6c928cb0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      218.2   0.007      628.3
Field Avg  1.65                    218.2   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92beb8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af39e20,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00783366,
 -0.00333595],_lastvalidtt=[0.00783366,-0.00333595],_upttcommand=[0,0],_refmes=
 0x7fba6c9ddc30,_tiprefv=0x7fba6b857830,_tiltrefv=0x7fba6b1dd430,_tiprefvn=
 0x7fba6b858030,_tiltrefvn=0x7fba6b0e2a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c09e630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b858830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c09e630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9282d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928fc0,_ctrlden=0x7fba6c91da90,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af34b10,_xlast=0x7fba6af2c100,_ylast=[0x7fba6c976230,
 0x7fba6c976230,0x7fba6c976230],_y0=0x7fba6c8c4a30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac33770,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b809480,yposition=
 0x7fba6c927690,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      134.3   0.011      628.3
Field Avg  1.65                    134.3   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c848)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6cabc630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000681575,0.00746305],_lastvalidtt=[-0.000681575,0.00746305],_upttcommand=
 [0,0],_refmes=0x7fba6b851430,_tiprefv=0x7fba6b1ddc30,_tiltrefv=0x7fba6b235a30,
 _tiprefvn=0x7fba6b0c8830,_tiltrefvn=0x7fba6b0e0a30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b086830,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6b0c4830,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b086830,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9cfe30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6b8093d8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91dba8,_ctrlden=0x7fba6c927d58,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af357d0,_xlast=0x7fba6af34b10,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6cb54630,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af31ab0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b808db8,yposition=
 0x7fba6c928498,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      114.6   0.018      628.3
Field Avg  1.65                    114.6   0.018      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92ab30)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0ae630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.0074652,
 0.000483736],_lastvalidtt=[0.0074652,0.000483736],_upttcommand=[0,0],_refmes=
 0x7fba6b08b830,_tiprefv=0x7fba6b80b830,_tiltrefv=0x7fba6b0e1430,_tiprefvn=
 0x7fba6b80ce30,_tiltrefvn=0x7fba6b235a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb47a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b0e1e30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb47a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c9c1630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927ff8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927578,_ctrlden=0x7fba6c928268,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af34780,_xlast=0x7fba6af2f560,_ylast=[0x7fba6cb54630,
 0x7fba6cb54630,0x7fba6cb54630],_y0=0x7fba6caa9e30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af304d0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c9282d8,yposition=
 0x7fba6c928c08,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      121.9   0.015      628.3
Field Avg  1.65                    121.9   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bc98)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af36dc0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00256317,
 0.000652929],_lastvalidtt=[-0.00256317,0.000652929],_upttcommand=[0,0],_refmes=
 0x7fba6cab9030,_tiprefv=0x7fba6b80d830,_tiltrefv=0x7fba6b1dd430,_tiprefvn=
 0x7fba6b80e030,_tiltrefvn=0x7fba6b08b830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb6ea30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caf7430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb6ea30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0d2830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9277e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927fc0,_ctrlden=0x7fba6b809480,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af37450,_xlast=0x7fba6af35a40,_ylast=[0x7fba6caa9e30,
 0x7fba6caa9e30,0x7fba6caa9e30],_y0=0x7fba6caa0230,_signus=0x7fba6af36970,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34b10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b8093d8,yposition=
 0x7fba6c9284d0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      144.4   0.014      628.3
Field Avg  1.65                    144.4   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6b00da50)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af34240,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00199426,
 0.00542578],_lastvalidtt=[-0.00199426,0.00542578],_upttcommand=[0,0],_refmes=
 0x7fba6b08c030,_tiprefv=0x7fba6c0ae830,_tiltrefv=0x7fba6b232230,_tiprefvn=
 0x7fba6c09ee30,_tiltrefvn=0x7fba6b1dd430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b23b630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b80b230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b23b630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d898)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b808e28,_ctrlden=0x7fba6b808db8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac28690,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6caa0230,
 0x7fba6caa0230,0x7fba6caa0230],_y0=0x7fba6c9dec30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2f560,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927ff8,yposition=
 0x7fba6c9272a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      582.4   0.005      628.3
Field Avg  1.65                    582.4   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c490)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac37410,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00420457,
 0.00215829],_lastvalidtt=[0.00420457,0.00215829],_upttcommand=[0,0],_refmes=
 0x7fba6b08c030,_tiprefv=0x7fba6b1ddc30,_tiltrefv=0x7fba6b230e30,_tiprefvn=
 0x7fba6b23ee30,_tiltrefvn=0x7fba6b232230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca9e230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b238e30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca9e230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6ca17630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928f88)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927ee0,_ctrlden=0x7fba6c927428,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac312a0,_xlast=0x7fba6ac28690,_ylast=[0x7fba6b0c9230,
 0x7fba6b0c9230,0x7fba6b0c9230],_y0=0x7fba6b1de430,_signus=0x7fba6ac2cd10,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2e150,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c9277e0,yposition=
 0x7fba6c91db38,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      168.7   0.016      628.3
Field Avg  1.65                    168.7   0.016      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c6b0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b076a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00613947,
 -0.000778244],_lastvalidtt=[0.00613947,-0.000778244],_upttcommand=[0,0],
 _refmes=0x7fba6b22fc30,_tiprefv=0x7fba6b0b4430,_tiltrefv=0x7fba6c09f230,
 _tiprefvn=0x7fba6b231630,_tiltrefvn=0x7fba6c0a0830,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6ca96630,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6b22e830,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca96630,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c927738)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928ff8,_ctrlden=0x7fba6c928428,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6cb54630,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad09d40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91d898,yposition=
 0x7fba6c91d908,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       97.2   0.017      628.3
Field Avg  1.65                     97.2   0.017      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c8d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b238030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00136298,
 0.0029942],_lastvalidtt=[0.00136298,0.0029942],_upttcommand=[0,0],_refmes=
 0x7fba6b237630,_tiprefv=0x7fba6b851830,_tiltrefv=0x7fba6b231630,_tiprefvn=
 0x7fba6b80ce30,_tiltrefvn=0x7fba6b0b4430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b1d1e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0b2c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b1d1e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d9e8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91db70,_ctrlden=0x7fba6c927a48,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af30530,_xlast=0x7fba6af2ca00,_ylast=[0x7fba6cb54630,
 0x7fba6cb54630,0x7fba6cb54630],_y0=0x7fba6c9cac30,_signus=0x7fba6af376a0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac34880,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c928f88,yposition=
 0x7fba6c927dc8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      285.5   0.007      628.3
Field Avg  1.65                    285.5   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92ba78)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0a2830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00514522,
 0.00111716],_lastvalidtt=[0.00514522,0.00111716],_upttcommand=[0,0],_refmes=
 0x7fba6c0cfe30,_tiprefv=0x7fba6b80bc30,_tiltrefv=0x7fba6b80d830,_tiprefvn=
 0x7fba6b851830,_tiltrefvn=0x7fba6b80ce30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca95c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c9ddc30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca95c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cb72a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d978)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927e38,_ctrlden=0x7fba6c9284d0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad11c60,_xlast=0x7fba6ad10d50,_ylast=[0x7fba6b83f430,
 0x7fba6b83f430,0x7fba6b83f430],_y0=0x7fba6b851430,_signus=0x7fba6ad11630,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0c3a0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927738,yposition=
 0x7fba6b809170,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      553.9   0.005      628.3
Field Avg  1.65                    553.9   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c9e0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac35510,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00468171,
 0.000255159],_lastvalidtt=[0.00468171,0.000255159],_upttcommand=[0,0],_refmes=
 0x7fba6b0e2430,_tiprefv=0x7fba6c0cc230,_tiltrefv=0x7fba6c0cca30,_tiprefvn=
 0x7fba6c0cd230,_tiltrefvn=0x7fba6c0ae430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb0e030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cb4e830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb0e030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cb72a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928460)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9273f0,_ctrlden=0x7fba6c9278f8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac35140,_xlast=0x7fba6af2ca00,_ylast=[0x7fba6cacd030,
 0x7fba6cacd030,0x7fba6cacd030],_y0=0x7fba6caa9e30,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2f560,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91d9e8,yposition=
 0x7fba6b808cd8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      162.8   0.008      628.3
Field Avg  1.65                    162.8   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b6c0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af3a6b0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00239387,
 -0.00585194],_lastvalidtt=[-0.00239387,-0.00585194],_upttcommand=[0,0],_refmes=
 0x7fba6cb0d030,_tiprefv=0x7fba6b23be30,_tiltrefv=0x7fba6b855630,_tiprefvn=
 0x7fba6b23a630,_tiltrefvn=0x7fba6b80d630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca9b230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c105430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca9b230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6caafe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d710)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928fc0,_ctrlden=0x7fba6c927a48,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af384c0,_xlast=0x7fba6af2c100,_ylast=[0x7fba6caa9e30,
 0x7fba6caa9e30,0x7fba6caa9e30],_y0=0x7fba6caa0230,_signus=0x7fba6af3a2e0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac30630,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91d978,yposition=
 0x7fba6c927d90,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      173.0   0.008      628.3
Field Avg  1.65                    173.0   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b9f0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae0fc80,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00745517,
 -0.00641395],_lastvalidtt=[-0.00745517,-0.00641395],_upttcommand=[0,0],_refmes=
 0x7fba6b0bda30,_tiprefv=0x7fba6b22d830,_tiltrefv=0x7fba6c0b7630,_tiprefvn=
 0x7fba6b23be30,_tiltrefvn=0x7fba6c0b7e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb6ea30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca9ee30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb6ea30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cb72a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928268)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b809020,_ctrlden=0x7fba6c9282d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac338b0,_xlast=0x7fba6ac34b40,_ylast=[0x7fba6b040030,
 0x7fba6b040030,0x7fba6b040030],_y0=0x7fba6b0ae630,_signus=0x7fba6ac2e100,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2e3c0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c928460,yposition=
 0x7fba6c928030,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      158.2   0.011      628.3
Field Avg  1.65                    158.2   0.011      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b7d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6cabc630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00170299,
 0.000131043],_lastvalidtt=[-0.00170299,0.000131043],_upttcommand=[0,0],_refmes=
 0x7fba6ca15a30,_tiprefv=0x7fba6c9c9830,_tiltrefv=0x7fba6ca91830,_tiprefvn=
 0x7fba6ca9f430,_tiltrefvn=0x7fba6c9ddc30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b22e830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b1aa430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b22e830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cacdc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d7f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927310,_ctrlden=0x7fba6c927540,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af37af0,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6cb54630,
 0x7fba6cb54630,0x7fba6cb54630],_y0=0x7fba6c9cac30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af38470,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91d710,yposition=
 0x7fba6c8cec40,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      100.3   0.019      628.3
Field Avg  1.65                    100.3   0.019      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92aee8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b1e0230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.0039641,
 0.00846114],_lastvalidtt=[0.0039641,0.00846114],_upttcommand=[0,0],_refmes=
 0x7fba6b0c7430,_tiprefv=0x7fba6b198030,_tiltrefv=0x7fba6c9de630,_tiprefvn=
 0x7fba6b0c7e30,_tiltrefvn=0x7fba6ca91830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c0a0830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cb3de30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c0a0830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0dec30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928bd0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91db38,_ctrlden=0x7fba6c91d978,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad09d40,_xlast=0x7fba6ad0d120,_ylast=[0x7fba6b854a30,
 0x7fba6b854a30,0x7fba6b854a30],_y0=0x7fba6b83f430,_signus=0x7fba6ad0fe80,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0d2a0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c928268,yposition=
 0x7fba6c91d860,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      103.3   0.017      628.3
Field Avg  1.65                    103.3   0.017      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c050)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac310a0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00212472,
 -0.00119387],_lastvalidtt=[0.00212472,-0.00119387],_upttcommand=[0,0],_refmes=
 0x7fba6b22d230,_tiprefv=0x7fba6c9ddc30,_tiltrefv=0x7fba6cb50e30,_tiprefvn=
 0x7fba6ca15a30,_tiltrefvn=0x7fba6cacc630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb6fe30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a6a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb6fe30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cacce30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927428)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b81a088,_ctrlden=0x7fba6c927540,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af2cd40,_ylast=[0x7fba6ca16230,
 0x7fba6ca16230,0x7fba6ca16230],_y0=0x7fba6caa7830,_signus=0x7fba6af38720,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af36790,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91d7f0,yposition=
 0x7fba6c927fc0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      126.8   0.014      628.3
Field Avg  1.65                    126.8   0.014      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92beb8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af34240,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.0097479,
 -0.00382205],_lastvalidtt=[-0.0097479,-0.00382205],_upttcommand=[0,0],_refmes=
 0x7fba6b0e1230,_tiprefv=0x7fba6cab9030,_tiltrefv=0x7fba6b194830,_tiprefvn=
 0x7fba6c9ddc30,_tiltrefvn=0x7fba6b0e1a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca3aa30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a2630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca3aa30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0dec30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b809250)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9282a0,_ctrlden=0x7fba6b808e60,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af31ab0,_xlast=0x7fba6af2ca00,_ylast=[0x7fba6caa7830,
 0x7fba6caa7830,0x7fba6caa7830],_y0=0x7fba6caa0230,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2cc50,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c928bd0,yposition=
 0x7fba6c929030,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1150.4   0.004      628.3
Field Avg  1.65                   1150.4   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c2f8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af36630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00903603,
 -0.00270971],_lastvalidtt=[-0.00903603,-0.00270971],_upttcommand=[0,0],_refmes=
 0x7fba6b22d230,_tiprefv=0x7fba6b851630,_tiltrefv=0x7fba6b0ba230,_tiprefvn=
 0x7fba6b855630,_tiltrefvn=0x7fba6b194830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b23a230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b085e30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b23a230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b848430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dbe0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928fc0,_ctrlden=0x7fba6c928268,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af35a40,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6caa0230,
 0x7fba6caa0230,0x7fba6caa0230],_y0=0x7fba6c9cac30,_signus=0x7fba6af38720,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac2e500,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927428,yposition=
 0x7fba6c928dc8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      161.3   0.015      628.3
Field Avg  1.65                    161.3   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b190)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b05bc30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00752993,
 0.00947284],_lastvalidtt=[0.00752993,0.00947284],_upttcommand=[0,0],_refmes=
 0x7fba6b0bb430,_tiprefv=0x7fba6b22f830,_tiltrefv=0x7fba6cb50e30,_tiprefvn=
 0x7fba6b0c7e30,_tiltrefvn=0x7fba6ca15a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b23ea30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b24fe30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b23ea30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0cb830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91e430)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b808d80,_ctrlden=0x7fba6c928460,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c220,_xlast=0x7fba6ae0c3a0,_ylast=[0x7fba6c0b0230,
 0x7fba6c0b0230,0x7fba6c0b0230],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c520,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34b10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b809250,yposition=
 0x7fba6c927f50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      959.4   0.004      628.3
Field Avg  1.65                    959.4   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b748)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c0b4230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.0113293,
 -0.00418459],_lastvalidtt=[0.0113293,-0.00418459],_upttcommand=[0,0],_refmes=
 0x7fba6caa8e30,_tiprefv=0x7fba6c01ba30,_tiltrefv=0x7fba6cabdc30,_tiprefvn=
 0x7fba6c0a0830,_tiltrefvn=0x7fba6c9ddc30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b821e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a1230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b821e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927460)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b808cd8,_ctrlden=0x7fba6c928348,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac2c1b0,_xlast=0x7fba6ac32d20,_ylast=[0x7fba6b0c9230,
 0x7fba6b0c9230,0x7fba6b0c9230],_y0=0x7fba6b040030,_signus=0x7fba6ac368b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac32ea0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91dbe0,yposition=
 0x7fba6c927e70,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      593.7   0.005      628.3
Field Avg  1.65                    593.7   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c628)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ca93e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00270952,
 0.00691622],_lastvalidtt=[0.00270952,0.00691622],_upttcommand=[0,0],_refmes=
 0x7fba6ca9fc30,_tiprefv=0x7fba6c0b3830,_tiltrefv=0x7fba6b822e30,_tiprefvn=
 0x7fba6c01ba30,_tiltrefvn=0x7fba6b80b830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b236230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a5a30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b236230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b0cb830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c928428)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c9277e0,_ctrlden=0x7fba6c927738,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac33920,_xlast=0x7fba6ac2cd10,_ylast=[0x7fba6b040030,
 0x7fba6b040030,0x7fba6b040030],_y0=0x7fba6b096430,_signus=0x7fba6ac28a70,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af32380,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91e430,yposition=
 0x7fba6c929030,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      170.2   0.012      628.3
Field Avg  1.65                    170.2   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b8e0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=36,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b22dc30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00133958,
 -0.00204836],_lastvalidtt=[-0.00133958,-0.00204836],_upttcommand=[0,0],_refmes=
 0x7fba6c9ddc30,_tiprefv=0x7fba6ca9fc30,_tiltrefv=0x7fba6c0ae830,_tiprefvn=
 0x7fba6cb4ea30,_tiltrefvn=0x7fba6c09ee30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b249630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b083e30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b249630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cacdc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dc18)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928460,_ctrlden=0x7fba6c927310,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af30280,_xlast=0x7fba6af300c0,_ylast=[0x7fba6cb54630,
 0x7fba6cb54630,0x7fba6cb54630],_y0=0x7fba6ca93e30,_signus=0x7fba6af37280,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af363b0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927460,yposition=
 0x7fba6c927d90,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      273.2   0.007      628.3
Field Avg  1.65                    273.2   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c6b0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af354c0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000876327,0.00251226],_lastvalidtt=[-0.000876327,0.00251226],_upttcommand=
 [0,0],_refmes=0x7fba6cb4f230,_tiprefv=0x7fba6b237c30,_tiltrefv=0x7fba6b856a30,
 _tiprefvn=0x7fba6b22f030,_tiltrefvn=0x7fba6b855630,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b877c30,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6b857430,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b877c30,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b1e0230,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c928498)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91d860,_ctrlden=0x7fba6c91dbe0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af32380,_xlast=0x7fba6af30240,_ylast=[0x7fba6ca93e30,
 0x7fba6ca93e30,0x7fba6ca93e30],_y0=0x7fba6c9cac30,_signus=0x7fba6af351b0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af34b10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c928428,yposition=
 0x7fba6b8091a8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      162.8   0.008      628.3
Field Avg  1.65                    162.8   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b638)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.01,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af37010,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00401501,
 -0.00320811],_lastvalidtt=[-0.00401501,-0.00320811],_upttcommand=[0,0],_refmes=
 0x7fba6cb58030,_tiprefv=0x7fba6ca91830,_tiltrefv=0x7fba6b0ba230,_tiprefvn=
 0x7fba6ca9fc30,_tiltrefvn=0x7fba6b0bd830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0e1a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b233630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0e1a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6caa9c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d908)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b809170,_ctrlden=0x7fba6c91d9e8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c9cac30,
 0x7fba6c9cac30,0x7fba6c9cac30],_y0=0x7fba6c8c4a30,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af304d0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91dc18,yposition=
 0x7fba6c927690,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      129.2   0.012      628.3
Field Avg  1.65                    129.2   0.012      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92af70)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.02,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6cabc630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=
 [-0.000744995,-0.0146373],_lastvalidtt=[-0.000744995,-0.0146373],_upttcommand=
 [0,0],_refmes=0x7fba6b0e1230,_tiprefv=0x7fba6c01b830,_tiltrefv=0x7fba6b22f030,
 _tiprefvn=0x7fba6c0ad430,_tiltrefvn=0x7fba6b22fa30,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b287830,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6c0bf630,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b287830,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b848430,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6b808e28)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b808db8,_ctrlden=0x7fba6b81a088,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af33b60,_xlast=0x7fba6af2ca00,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6ca93e30,_signus=0x7fba6af36710,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac365e0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c928498,yposition=
 0x7fba6c91d9b0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      102.1   0.022      628.3
Field Avg  1.65                    102.1   0.022      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c490)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.05,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6c990230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=132,_nsub4disp=0,_nmes=
 264,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00140969,
 0.00187196],_lastvalidtt=[0.00140969,0.00187196],_upttcommand=[0,0],_refmes=
 0x7fba6cb55230,_tiprefv=0x7fba6cb4e030,_tiltrefv=0x7fba6b80ce30,_tiprefvn=
 0x7fba6ca98030,_tiltrefvn=0x7fba6b80a830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6c9c4430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca95230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6c9c4430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b857230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9273f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927700,_ctrlden=0x7fba6c9279d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac28b80,_xlast=0x7fba6ac34b90,_ylast=[0x7fba6b0c9230,
 0x7fba6b0c9230,0x7fba6b0c9230],_y0=0x7fba6b096430,_signus=0x7fba6ac2e100,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad09d40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91d908,yposition=
 0x7fba6c927dc8,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      159.8   0.015      628.3
Field Avg  1.65                    159.8   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c160)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae0f940,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00751455,
 -0.00418506],_lastvalidtt=[0.00751455,-0.00418506],_upttcommand=[0,0],_refmes=
 0x7fba6b22d230,_tiprefv=0x7fba6cb55230,_tiltrefv=0x7fba6cb58230,_tiprefvn=
 0x7fba6c9ddc30,_tiltrefvn=0x7fba6cb3de30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0b3030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6caa2630,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0b3030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cabc630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927fc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927578,_ctrlden=0x7fba6c928540,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac34d10,_xlast=0x7fba6ac2c1b0,_ylast=[0x7fba6b096430,
 0x7fba6b096430,0x7fba6b096430],_y0=0x7fba6b1de430,_signus=0x7fba6ac33770,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af38450,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6b808e28,yposition=
 0x7fba6b8091e0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      137.0   0.013      628.3
Field Avg  1.65                    137.0   0.013      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b9f0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.15,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac28690,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00634977,
 -0.00215508],_lastvalidtt=[0.00634977,-0.00215508],_upttcommand=[0,0],_refmes=
 0x7fba6cb42830,_tiprefv=0x7fba6ca44e30,_tiltrefv=0x7fba6b237430,_tiprefvn=
 0x7fba6cb55230,_tiltrefvn=0x7fba6b22d230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca40e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b836c30,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca40e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c977630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927e38)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b808cd8,_ctrlden=0x7fba6c928cb0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0df80,_xlast=0x7fba6ad09d80,_ylast=[0x7fba6b854a30,
 0x7fba6b854a30,0x7fba6b854a30],_y0=0x7fba6b83f430,_signus=0x7fba6ad0d120,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac32d40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c9273f0,yposition=
 0x7fba6b025830,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0     1308.0   0.004      628.3
Field Avg  1.65                   1308.0   0.004      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c9e0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac30b60,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000926901,
 -0.000888196],_lastvalidtt=[0.000926901,-0.000888196],_upttcommand=[0,0],
 _refmes=0x7fba6b22f030,_tiprefv=0x7fba6c09e630,_tiltrefv=0x7fba6b087630,
 _tiprefvn=0x7fba6c09f630,_tiltrefvn=0x7fba6b237430,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7fba6b0e1230,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x7fba6b855630,_kernel=0x0,_kernels=0x0,_kerfftr=
 0x0,_kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0e1230,_x=
 0x0,_y=0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cb72a30,
 _bckgrdinit=0,_bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,
 _wpha2dhc=0x0,_n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,
 _LLT_pos=[0,0],_LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,
 _dmnotinpath=0x7fba6c91dcc0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91da20,_ctrlden=0x7fba6b809170,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2f560,_xlast=0x7fba6af2c100,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6cb54630,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af39fe0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927fc0,yposition=
 0x7fba6c927968,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 128 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      141.0   0.015      628.3
Field Avg  1.65                    141.0   0.015      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92b108)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.25,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ca98230,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=128,_nsub4disp=0,_nmes=
 256,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00171371,
 -0.00682744],_lastvalidtt=[0.00171371,-0.00682744],_upttcommand=[0,0],_refmes=
 0x7fba6c0ae830,_tiprefv=0x7fba6b80ce30,_tiltrefv=0x7fba6b237c30,_tiprefvn=
 0x7fba6b852e30,_tiltrefvn=0x7fba6b22d230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b086430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b80b230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b086430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c9282a0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928540,_ctrlden=0x7fba6c91dbe0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af34440,_xlast=0x7fba6af2f560,_ylast=[0x7fba6cb54630,
 0x7fba6cb54630,0x7fba6cb54630],_y0=0x7fba6c9cac30,_signus=0x7fba6af33b60,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af35a40,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c927e38,yposition=
 0x7fba6c927f50,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      206.7   0.010      628.3
Field Avg  1.65                    206.7   0.010      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92ca68)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6b08d630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00327398,
 0.00509551],_lastvalidtt=[0.00327398,0.00509551],_upttcommand=[0,0],_refmes=
 0x7fba6b08b830,_tiprefv=0x7fba6c0adc30,_tiltrefv=0x7fba6c0ad430,_tiprefvn=
 0x7fba6c0ab430,_tiltrefvn=0x7fba6c01b230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b23d030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b22f030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b23d030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c09e630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dc50)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928c40,_ctrlden=0x7fba6c9282d8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af34240,_xlast=0x7fba6af32c60,_ylast=[0x7fba6c9cac30,
 0x7fba6c9cac30,0x7fba6c9cac30],_y0=0x7fba6c8c4a30,_signus=0x7fba6af37990,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2c100,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91dcc0,yposition=
 0x7fba6c8cec40,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      394.5   0.006      628.3
Field Avg  1.65                    394.5   0.006      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c5a0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.35,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae0f570,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00809101,
 -0.00628693],_lastvalidtt=[0.00809101,-0.00628693],_upttcommand=[0,0],_refmes=
 0x7fba6b08d030,_tiprefv=0x7fba6ca3de30,_tiltrefv=0x7fba6b08b830,_tiprefvn=
 0x7fba6ca15a30,_tiltrefvn=0x7fba6b236830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b23ce30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6ca3e830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b23ce30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cb72a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91d898)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91da90,_ctrlden=0x7fba6b809170,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac33930,_xlast=0x7fba6ac34880,_ylast=[0x7fba6b1de430,
 0x7fba6b1de430,0x7fba6b1de430],_y0=0x7fba6b251030,_signus=0x7fba6ac340f0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac32780,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c9282a0,yposition=
 0x7fba6c928d58,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 116 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      552.1   0.005      628.3
Field Avg  1.65                    552.1   0.005      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92bb00)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91e3c0,lgs_prof_alt=0x7fba6c927380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6af39360,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=116,_nsub4disp=0,_nmes=
 232,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00118398,
 -0.00272958],_lastvalidtt=[0.00118398,-0.00272958],_upttcommand=[0,0],_refmes=
 0x7fba6b08c030,_tiprefv=0x7fba6b851e30,_tiltrefv=0x7fba6b0b4430,_tiprefvn=
 0x7fba6b852e30,_tiltrefvn=0x7fba6b08b830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cac7c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6cac6830,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cac7c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cacdc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927850)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c91db70,_ctrlden=0x7fba6c927968,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ac37780,_xlast=0x7fba6ac2d220,_ylast=[0x7fba6b251030,
 0x7fba6b251030,0x7fba6b251030],_y0=0x7fba6b0e2030,_signus=0x7fba6ac30620,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ac33c50,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9249f8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6b808fe8,xposition=0x7fba6c91dc50,yposition=
 0x7fba6c91d710,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d940,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      230.3   0.007      628.3
Field Avg  1.65                    230.3   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92ad50,winddir=0x7fba6c92a910,
 _layeralt=0x7fba6c92b190)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c928a48,lgs_prof_alt=0x7fba6c927f18,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac36710,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00336188,
 -0.0194447],_lastvalidtt=[-0.00336188,-0.0194447],_upttcommand=[0,0],_refmes=
 0x7fba6b80ce30,_tiprefv=0x7fba6b80be30,_tiltrefv=0x7fba6b857230,_tiprefvn=
 0x7fba6b80b430,_tiltrefvn=0x7fba6b80de30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b086230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b2bd230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b086230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b247230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c91dda0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c927428,_ctrlden=0x7fba6c91dcc0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2ca00,_xlast=0x7fba6af31ab0,_ylast=[0x7fba6c8c4a30,
 0x7fba6c8c4a30,0x7fba6c8c4a30],_y0=0x7fba6c9cac30,_signus=0x7fba6af2e6c0,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af2f560,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c91d710,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d940,xposition=0x7fba6c91d898,yposition=
 0x7fba6c927968,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c9249f8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      182.7   0.008      628.3
Field Avg  1.65                    182.7   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92ac40,layerfrac=0x7fba6c92acc8,
 layerspeed=0x7fba6c92abb8,layeralt=0x7fba6c92ae60,winddir=0x7fba6c92add8,
 _layeralt=0x7fba6c92c518)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927850,lgs_prof_alt=0x7fba6c927268,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ae0f9b0,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.000996807,
 -0.00772238],_lastvalidtt=[0.000996807,-0.00772238],_upttcommand=[0,0],_refmes=
 0x7fba6b282830,_tiprefv=0x7fba6b0e1230,_tiltrefv=0x7fba6b237e30,_tiprefvn=
 0x7fba6b087c30,_tiltrefvn=0x7fba6b0e1a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6ca25030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6c0a1230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6ca25030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6cacdc30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6c927a80)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928460,_ctrlden=0x7fba6c9282a0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6af2f560,_xlast=0x7fba6af2c100,_ylast=[0x7fba6c9cac30,
 0x7fba6c9cac30,0x7fba6c9cac30],_y0=0x7fba6cb50230,_signus=0x7fba6af32380,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6af304d0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c927968,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c9249f8,xposition=0x7fba6c927f88,yposition=
 0x7fba6c91dcc0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91d710,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      138.8   0.008      628.3
Field Avg  1.65                    138.8   0.008      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92acc8,layerfrac=0x7fba6c92abb8,
 layerspeed=0x7fba6c92ac40,layeralt=0x7fba6c92a910,winddir=0x7fba6c92ad50,
 _layeralt=0x7fba6b00da50)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c91dda0,lgs_prof_alt=0x7fba6c928380,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac30750,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[0.00377849,
 0.00935889],_lastvalidtt=[0.00377849,0.00935889],_upttcommand=[0,0],_refmes=
 0x7fba6c0ad430,_tiprefv=0x7fba6c09f030,_tiltrefv=0x7fba6c0d6030,_tiprefvn=
 0x7fba6c09e630,_tiltrefvn=0x7fba6c0bca30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6cb55230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b240430,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6cb55230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6b22da30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b8091e0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6c928e38,_ctrlden=0x7fba6b81a088,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ad0a1d0,_xlast=0x7fba6ad0a350,_ylast=[0x7fba6b839c30,
 0x7fba6b839c30,0x7fba6b839c30],_y0=0x7fba6b83f430,_signus=0x7fba6ad0d120,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ad0fcd0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c91dcc0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c91d710,xposition=0x7fba6c928c40,yposition=
 0x7fba6c9282a0,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c927968,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 112 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0      224.9   0.007      628.3
Field Avg  1.65                    224.9   0.007      628.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 24; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 2;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 0.495; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.45;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 4;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=24,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=64,_cent=32.5)
 atm_struct(dr0at05mic=43.33,screen=0x7fba6c92abb8,layerfrac=0x7fba6c92ac40,
 layerspeed=0x7fba6c92acc8,layeralt=0x7fba6c92add8,winddir=0x7fba6c92ae60,
 _layeralt=0x7fba6c92c628)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.001,
 pyr_mod_npts=4,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=2,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=0.495,fsoffset=
 [0,0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7fba6c927a80,lgs_prof_alt=0x7fba6c928e00,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7fba6ac35a70,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=112,_nsub4disp=0,_nmes=
 224,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=4.33352,_tt=[-0.00847863,
 0.0039655],_lastvalidtt=[-0.00847863,0.0039655],_upttcommand=[0,0],_refmes=
 0x7fba6cb58030,_tiprefv=0x7fba6c9c9830,_tiltrefv=0x7fba6cacbe30,_tiprefvn=
 0x7fba6caa8e30,_tiltrefvn=0x7fba6cb50e30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7fba6b0b2030,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x7fba6b24c230,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7fba6b0b2030,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7fba6c8d6830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7fba6b808d80)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7fba6b809170,_ctrlden=0x7fba6c927f50,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7fba6ae0c220,_xlast=0x7fba6ae0c3a0,_ylast=[0x7fba6c0b0230,
 0x7fba6c0b0230,0x7fba6c0b0230],_y0=0x7fba6c014c30,_signus=0x7fba6ae0c520,
 _puppixoffset=[0,0],_nact=80,_def=0x10c8cc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=12,_n2=53,
 _pupil=0x0,_command=0x7fba6ae0c960,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7fba6c9282a0,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7fba6c927968,xposition=0x7fba6c927428,yposition=
 0x7fba6b81a088,xspeed=0x0,yspeed=0x0,dispzoom=0x7fba6c91dcc0,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 132 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 124 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 124 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       72.3   0.154      300.7
Field Avg  1.65                     72.3   0.154      300.7
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 4.4;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 8;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7af8,winddir=0x7f8a548c79e8,
 _layeralt=0x7f8a54933d88)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=4.4,
 pyr_mod_npts=8,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a5492f708,lgs_prof_alt=0x7f8a549258d8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a55017a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=124,_nsub4disp=0,_nmes=
 248,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[0.0214323,
 -0.0238237],_lastvalidtt=[0.0214323,-0.0238237],_upttcommand=[0,0],_refmes=
 0x7f8a54040230,_tiprefv=0x7f8a540c2a30,_tiltrefv=0x7f8a5409c630,_tiprefvn=
 0x7f8a540bde30,_tiltrefvn=0x7f8a5408f430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a54086230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x102091030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a54086230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a540efe30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a5403db78)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5403d8d8,_ctrlden=0x7f8a54925980,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a536385a0,_xlast=0x7f8a5363c590,_ylast=[0x7f8a54929830,
 0x7f8a54929830,0x7f8a54929830],_y0=0x7f8a5480fc30,_signus=0x7f8a53639c90,
 _puppixoffset=[0,0],_nact=80,_def=0x10324a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a5363c710,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a5492f9a8,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5492f468,xposition=0x7f8a54925e18,yposition=
 0x7f8a5403d868,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a5403db08,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 1000 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       56.0   0.486      226.3
Field Avg  1.65                     56.0   0.486      226.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7eb0,layerfrac=0x7f8a548c7c90,
 layerspeed=0x7f8a548c7e28,layeralt=0x7f8a548c8048,winddir=0x7f8a548c7f38,
 _layeralt=0x7f8a54933d88)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.5,
 pyr_mod_npts=40,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54930eb0,lgs_prof_alt=0x7f8a54930ee8,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a54938c30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[0.008384,
 -0.000100653],_lastvalidtt=[0.008384,-0.000100653],_upttcommand=[0,0],_refmes=
 0x7f8a5497d030,_tiprefv=0x7f8a54999c30,_tiltrefv=0x7f8a54976830,_tiprefvn=
 0x7f8a5499a430,_tiltrefvn=0x7f8a54978c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a540e3630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10216b030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a540e3630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a54938030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a54931188)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a549259f0,_ctrlden=0x7f8a54930c48,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a536385a0,_xlast=0x7f8a5363b1b0,_ylast=[0x7f8a5480fc30,
 0x7f8a5480fc30,0x7f8a5480fc30],_y0=0x7f8a54913630,_signus=0x7f8a5363c590,
 _puppixoffset=[0,0],_nact=80,_def=0x10324a030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a5363b9f0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a5403d868,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403db08,xposition=0x7f8a5403d8d8,yposition=
 0x7f8a54925980,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a5492f9a8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=1000,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.539      145.3
Field Avg  1.65                     55.4   0.539      145.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a549330e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a55016630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.00199938,
 0.000214671],_lastvalidtt=[-0.00199938,0.000214671],_upttcommand=[0,0],_refmes=
 0x7f8a54099630,_tiprefv=0x7f8a540e0a30,_tiltrefv=0x7f8a540e4a30,_tiprefvn=
 0x7f8a540e1230,_tiltrefvn=0x7f8a5409aa30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a54967230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10222e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a54967230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a540e6230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a54925c20)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a54925b78,_ctrlden=0x7f8a5492f778,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a536385a0,_xlast=0x7f8a53639fb0,_ylast=[0x7f8a54929830,
 0x7f8a54929830,0x7f8a54929830],_y0=0x7f8a5480fc30,_signus=0x7f8a53638f90,
 _puppixoffset=[0,0],_nact=80,_def=0x1078dc030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a5352d620,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a549259f0,yposition=
 0x7f8a54925868,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.3   0.572      128.4
Field Avg  1.65                     54.3   0.572      128.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a54933948)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a540ee630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.0121379,
 0.00133555],_lastvalidtt=[-0.0121379,0.00133555],_upttcommand=[0,0],_refmes=
 0x7f8a55016e30,_tiprefv=0x7f8a53811630,_tiltrefv=0x7f8a540e4030,_tiprefvn=
 0x7f8a5383ce30,_tiltrefvn=0x7f8a540e4a30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a54a08c30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x101eb9030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a54a08c30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a5497f430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a54925910)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5403d980,_ctrlden=0x7f8a5403d9b8,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a53404b60,_xlast=0x7f8a534096b0,_ylast=[0x7f8a53804230,
 0x7f8a53804230,0x7f8a53804230],_y0=0x7f8a5381c830,_signus=0x7f8a53409830,
 _puppixoffset=[0,0],_nact=80,_def=0x105572030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a53530880,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a5403db78,yposition=
 0x7f8a5403e010,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.553      145.3
Field Avg  1.65                     54.4   0.553      145.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a549339d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a54968830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.0116856,
 0.0010768],_lastvalidtt=[-0.0116856,0.0010768],_upttcommand=[0,0],_refmes=
 0x7f8a54965c30,_tiprefv=0x7f8a54976c30,_tiltrefv=0x7f8a54992030,_tiprefvn=
 0x7f8a54913030,_tiltrefvn=0x7f8a54a09230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a54966430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x102091030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a54966430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a54994c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a54926630)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5492f708,_ctrlden=0x7f8a5403da98,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5363db10,_xlast=0x7f8a5363bf10,_ylast=[0x7f8a5480fc30,
 0x7f8a5480fc30,0x7f8a5480fc30],_y0=0x7f8a54929830,_signus=0x7f8a536426b0,
 _puppixoffset=[0,0],_nact=80,_def=0x103126030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a53638f90,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a54925c20,yposition=
 0x7f8a54925c58,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       60.9   0.291      459.4
Field Avg  1.65                     60.9   0.291      459.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a54933170)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a540f0830,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.0202467,
 0.00965732],_lastvalidtt=[-0.0202467,0.00965732],_upttcommand=[0,0],_refmes=
 0x7f8a54978e30,_tiprefv=0x7f8a55044230,_tiltrefv=0x7f8a5497b630,_tiprefvn=
 0x7f8a55016630,_tiltrefvn=0x7f8a54992030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a54979630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10143d030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a54979630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a540e6c30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a5492f5f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5403da28,_ctrlden=0x7f8a549259f0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5363a540,_xlast=0x7f8a5363db10,_ylast=[0x7f8a54929830,
 0x7f8a54929830,0x7f8a54929830],_y0=0x7f8a5497d430,_signus=0x7f8a5363e8e0,
 _puppixoffset=[0,0],_nact=80,_def=0x1076ec030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a5352e8e0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a54925910,yposition=
 0x7f8a54930c80,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       60.0   0.365      402.0
Field Avg  1.65                     60.0   0.365      402.0
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a54934250)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.5,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a5407ac30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.0385959,
 -0.00287261],_lastvalidtt=[-0.0385959,-0.00287261],_upttcommand=[0,0],_refmes=
 0x7f8a54979630,_tiprefv=0x7f8a540e4c30,_tiltrefv=0x7f8a5497a630,_tiprefvn=
 0x7f8a54099630,_tiltrefvn=0x7f8a5497b630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a55022630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10147e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a55022630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a54964a30,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a5403dda8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5403dd38,_ctrlden=0x7f8a5492fa18,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5352e680,_xlast=0x7f8a53530740,_ylast=[0x7f8a54070030,
 0x7f8a54070030,0x7f8a54070030],_y0=0x7f8a540ad830,_signus=0x7f8a53533eb0,
 _puppixoffset=[0,0],_nact=80,_def=0x105b74030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a5363b870,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a54926630,yposition=
 0x7f8a5403dfa0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       56.0   0.494      155.4
Field Avg  1.65                     56.0   0.494      155.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a54934360)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.6,
 pyr_mod_npts=24,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a540e4030,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.0185,
 0.0111656],_lastvalidtt=[-0.0185,0.0111656],_upttcommand=[0,0],_refmes=
 0x7f8a54992030,_tiprefv=0x7f8a549ad630,_tiltrefv=0x7f8a5380ce30,_tiprefvn=
 0x7f8a54979a30,_tiltrefvn=0x7f8a5381ba30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a540ec630,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10193a030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a540ec630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a5494e830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a5403dd00)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a54925a98,_ctrlden=0x7f8a5403e010,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a53530db0,_xlast=0x7f8a5352db80,_ylast=[0x7f8a540ad830,
 0x7f8a540ad830,0x7f8a540ad830],_y0=0x7f8a5407ac30,_signus=0x7f8a5352d620,
 _puppixoffset=[0,0],_nact=80,_def=0x105373030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a5363d340,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a5492f5f0,yposition=
 0x7f8a54925d70,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.2   0.545      141.9
Field Avg  1.65                     55.2   0.545      141.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a54933528)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a54087630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.00214279,
 0.00035041],_lastvalidtt=[-0.00214279,0.00035041],_upttcommand=[0,0],_refmes=
 0x7f8a540ede30,_tiprefv=0x7f8a5497c830,_tiltrefv=0x7f8a54085030,_tiprefvn=
 0x7f8a549ad630,_tiltrefvn=0x7f8a54099c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a54179230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x102343030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a54179230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a53804230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a54925b40)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5492f970,_ctrlden=0x7f8a5492f708,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5363b870,_xlast=0x7f8a536385a0,_ylast=[0x7f8a54883a30,
 0x7f8a54883a30,0x7f8a54883a30],_y0=0x7f8a54929830,_signus=0x7f8a53638f90,
 _puppixoffset=[0,0],_nact=80,_def=0x107eed030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a53405b50,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a5403dda8,yposition=
 0x7f8a5403db78,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.8   0.578      121.6
Field Avg  1.65                     54.8   0.578      121.6
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a54934608)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a549aca30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.0107545,
 0.00103141],_lastvalidtt=[-0.0107545,0.00103141],_upttcommand=[0,0],_refmes=
 0x7f8a540e9e30,_tiprefv=0x7f8a54966a30,_tiltrefv=0x7f8a540ec230,_tiprefvn=
 0x7f8a5497c830,_tiltrefvn=0x7f8a54085030,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a54086230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x1016a7030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a54086230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a5494e830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a54925948)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a54925c20,_ctrlden=0x7f8a54931230,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5363eda0,_xlast=0x7f8a5363b870,_ylast=[0x7f8a54929830,
 0x7f8a54929830,0x7f8a54929830],_y0=0x7f8a5480fc30,_signus=0x7f8a5363a280,
 _puppixoffset=[0,0],_nact=80,_def=0x104d70030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a53533eb0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a5403dd00,yposition=
 0x7f8a5492f660,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.572      128.4
Field Avg  1.65                     54.4   0.572      128.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a549341c8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a5407ac30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.0120502,
 0.000357833],_lastvalidtt=[-0.0120502,0.000357833],_upttcommand=[0,0],_refmes=
 0x7f8a55016e30,_tiprefv=0x7f8a5497b630,_tiltrefv=0x7f8a549aaa30,_tiprefvn=
 0x7f8a54966a30,_tiltrefvn=0x7f8a5497be30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a540e1e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x102091030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a540e1e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a5409d030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a5492f778)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5492f858,_ctrlden=0x7f8a5492f468,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a535335d0,_xlast=0x7f8a535331b0,_ylast=[0x7f8a540f0830,
 0x7f8a540f0830,0x7f8a540f0830],_y0=0x7f8a54085630,_signus=0x7f8a5352d620,
 _puppixoffset=[0,0],_nact=80,_def=0x105b74030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a5363b870,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a54925b40,yposition=
 0x7f8a54925be8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.551      145.3
Field Avg  1.65                     54.4   0.551      145.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a5480b450)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a540e6e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.0128022,
 0.00125299],_lastvalidtt=[-0.0128022,0.00125299],_upttcommand=[0,0],_refmes=
 0x7f8a54a22c30,_tiprefv=0x7f8a54099630,_tiltrefv=0x7f8a54111830,_tiprefvn=
 0x7f8a54099e30,_tiltrefvn=0x7f8a540e1230,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a54113430,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10147e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a54113430,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a55016630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a5403d9b8)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a549311c0,_ctrlden=0x7f8a5403dc90,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5363d480,_xlast=0x7f8a5363bf10,_ylast=[0x7f8a54883a30,
 0x7f8a54883a30,0x7f8a54883a30],_y0=0x7f8a5480fc30,_signus=0x7f8a5363e8e0,
 _puppixoffset=[0,0],_nact=80,_def=0x107eed030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a53709420,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a54925948,yposition=
 0x7f8a54930cf0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.9   0.512      172.3
Field Avg  1.65                     54.9   0.512      172.3
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a54933280)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.5,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a540e6a30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.0145283,
 0.00101451],_lastvalidtt=[-0.0145283,0.00101451],_upttcommand=[0,0],_refmes=
 0x7f8a5383f630,_tiprefv=0x7f8a54102230,_tiltrefv=0x7f8a54995430,_tiprefvn=
 0x7f8a55019430,_tiltrefvn=0x7f8a54975430,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a54967230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x102343030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a54967230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a5494e830,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a5403da98)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5492fa50,_ctrlden=0x7f8a5403dec0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a53532820,_xlast=0x7f8a53530db0,_ylast=[0x7f8a5407ac30,
 0x7f8a5407ac30,0x7f8a5407ac30],_y0=0x7f8a540e6e30,_signus=0x7f8a5352d620,
 _puppixoffset=[0,0],_nact=80,_def=0x105571030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a53533eb0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a5492f778,yposition=
 0x7f8a54826c88,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.4   0.515      155.4
Field Avg  1.65                     55.4   0.515      155.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a54933838)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.6,
 pyr_mod_npts=28,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a53835e30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.0284764,
 0.00368202],_lastvalidtt=[-0.0284764,0.00368202],_upttcommand=[0,0],_refmes=
 0x7f8a54086a30,_tiprefv=0x7f8a54114830,_tiltrefv=0x7f8a54086230,_tiprefvn=
 0x7f8a54102230,_tiltrefvn=0x7f8a54126c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a540e3830,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10216b030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a540e3830,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a55016630,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a549259f0)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5492f6d0,_ctrlden=0x7f8a5492f778,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5363b870,_xlast=0x7f8a536385a0,_ylast=[0x7f8a5480fc30,
 0x7f8a5480fc30,0x7f8a5480fc30],_y0=0x7f8a54883a30,_signus=0x7f8a53638f90,
 _puppixoffset=[0,0],_nact=80,_def=0x104d70030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a5363db10,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a5403d9b8,yposition=
 0x7f8a54930e08,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       55.1   0.545      141.9
Field Avg  1.65                     55.1   0.545      141.9
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a54933d00)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.1,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a5409d430,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.00204196,
 0.000112896],_lastvalidtt=[-0.00204196,0.000112896],_upttcommand=[0,0],_refmes=
 0x7f8a540e3e30,_tiprefv=0x7f8a54976a30,_tiltrefv=0x7f8a54976230,_tiprefvn=
 0x7f8a54992030,_tiltrefvn=0x7f8a54992830,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a55096e30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10147e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a55096e30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a54993030,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a5492fa18)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a54925910,_ctrlden=0x7f8a5403dad0,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5363e0c0,_xlast=0x7f8a5363b870,_ylast=[0x7f8a54883a30,
 0x7f8a54883a30,0x7f8a54883a30],_y0=0x7f8a54977230,_signus=0x7f8a5363e8e0,
 _puppixoffset=[0,0],_nact=80,_def=0x103b29030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a53530db0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a5403da98,yposition=
 0x7f8a5492f8c8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.8   0.580      121.6
Field Avg  1.65                     54.8   0.580      121.6
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a549330e8)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.2,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a5501cc30,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.0110044,
 0.00060288],_lastvalidtt=[-0.0110044,0.00060288],_upttcommand=[0,0],_refmes=
 0x7f8a54086a30,_tiprefv=0x7f8a540e9c30,_tiltrefv=0x7f8a5503a230,_tiprefvn=
 0x7f8a540e2a30,_tiltrefvn=0x7f8a55024630,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a540e3230,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x101548030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a540e3230,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a53836430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a5403e010)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5403db40,_ctrlden=0x7f8a5403dd38,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a53531e70,_xlast=0x7f8a53533ff0,_ylast=[0x7f8a54044030,
 0x7f8a54044030,0x7f8a54044030],_y0=0x7f8a5407ac30,_signus=0x7f8a5352f4a0,
 _puppixoffset=[0,0],_nact=80,_def=0x105d72030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a536385a0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a549259f0,yposition=
 0x7f8a54925d00,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.535      182.4
Field Avg  1.65                     54.4   0.535      182.4
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a54933948)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.3,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a54085630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.0113816,
 0.00170747],_lastvalidtt=[-0.0113816,0.00170747],_upttcommand=[0,0],_refmes=
 0x7f8a5497c230,_tiprefv=0x7f8a54086230,_tiltrefv=0x7f8a54111830,_tiprefvn=
 0x7f8a540e9c30,_tiltrefvn=0x7f8a540e8c30,_reordervec=0x0,_npixels=0,_npb=0,
 _sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=0,
 _centroidw=0x0,_fimage=0x7f8a54a82a30,_fimage2=0x0,_imistart=0x0,_imjstart=0x0,
 _imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=0x0,
 _unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,_flat=
 0x0,_domask=0,_submask=0x10143d030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a54a82a30,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a540e9430,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a5492f708)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a549265f8,_ctrlden=0x7f8a5403db78,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a5352bd20,_xlast=0x7f8a5352d620,_ylast=[0x7f8a5407ac30,
 0x7f8a5407ac30,0x7f8a5407ac30],_y0=0x7f8a5413ee30,_signus=0x7f8a5352b730,
 _puppixoffset=[0,0],_nact=80,_def=0x105571030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a53708af0,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a5492fa18,yposition=
 0x7f8a5492f5b8,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations

         lambda   XPos   YPos  FWHM[mas]  Strehl  E50d[mas]
Star# 1     1.65    0.0   0.0       54.4   0.498      233.1
Field Avg  1.65                     54.4   0.498      233.1
Field rms  1.65                      0.0   0.000        0.0

Average images written in sh12x12_pyr_24-imav.fits
Some other graphics in sh12x12_pyr_24.ps

Original parameter file: sh12x12_pyr_24.par:
 // YAO parameter file
 //-------------------------------
 sim.name           = "SH 12x12 w/ TT mirror and WFS, full diffraction WFS";
 sim.pupildiam      = 132; //This is the pupil diameter in pixel, original version 80 pixels. but we want to compare with the SHWFS, which consists of 24 pixels.
 sim.debug          = 0;
 sim.verbose        = 1; //The amount of information you get during the aoinit. 0, means you get no feedback at all except for warnings and error messages; 1 will print out a lot of information.
 
 //-------------------------------
 atm.dr0at05mic     = 43.33;  // This is r0=0.15m, D/r0=6.5m/0.15m=43.33. The diameter of the atmosphere over the critial length of the atmosphere turbulence.
 atm.screen	       = &("~/.yorick/data/screen"+["1","2","3","4"]+".fits");// Default values from the atmosphere.
 atm.layerfrac      = &([0.4,0.2,0.3,0.1]);
 atm.layerspeed     = &([11.,20,29,35]);
 atm.layeralt	   = &([0.,400,6000,9000]);
 atm.winddir        = &([0,0,0,0]);
 
 //-------------------------------
 nwfs               = 1; // number of WFSs (=1, single object adaptive optics; >1 if e.g. mcao multi-conjugate adaptive optics)
 wfs = array(wfss,nwfs);
 
 n   = 1;
 wfs(n).type	       = "pyramid";
 wfs(n).lambda	   = 0.65;// All the information related to the wfs should be in band centred in 650 nm. R band.
 wfs(n).gspos       = [0.,0.];
 wfs(n).gsalt       = 0.;
 wfs(n).gsmag       = 5.;
 wfs(n).skymag      = 17.9;// see https://www.gemini.edu/sciops/telescopes-and-sites/observing-condition-constraints/optical-sky-background for reference. Bright sky with full moon, the equivalent number of photons received by one arcsec^2.
 wfs(n).noise       = 1; //whether the noise could be switched on or off
 wfs(n).ron         = 3.7;
 
 //---------------------- Not Clear yet....--------------
 wfs(n).shnxsub	    = 12;  //# of subapertures in telescope diameter, in 1D direction, but this should be the result from the previous one... number of pixels in each sub-aperture. in each micro-pupil.
 wfs(n).npixpersub   = 11;   // Pupil plane. # of pixels per sub-aperture. wfs.npixpersub * wfs.shnxsub = 2*12 = 24   
 wfs(n).fssize       = 2.4; //calculated from lambda/(diameter/sim.pupil)=650nm/(6.5m/80) = 1.65
 wfs(n).fstop        = "round"; //The field stop size and shape are mentioned in paper McGuire 1999, abstract. 
 wfs(n).pyr_mod_ampl = 0.5;  // 5*lambda/D = 5*650*10^(-9)/6.5=1.031 arcsec. float ....  
 //10*lambda/D
 wfs(n).pyr_mod_npts = 40;// 5*lambda/D*2*pi/(2 lambda/D), number of points in a circle.; square, we will result in 5*sqrt(2)/2=3.5 and we take 3. type: long........... 4 has the best strehl ratio.
 wfs(n).pyr_mod_loc  = "after";// the modulation is placed after the field stop.
 
 //-------------------------------
 ndm                = 1;
 dm = array(dms,ndm);
 
 n  =1;
 dm(n).type	       = "zernike";// Type zernike, because the number of the actuators 336 is larger than the number of the measurements 132*2(number of pixels times the two directions x and y).
 dm(n).nzer         = 80;// # of zernike modes.
 //dm(n).pitch	       = 7;//
 
 //-------------------------------
 mat.condition      = &([15.]);
 mat.file	       = "";
 //-------------------------------
 tel.diam	       = 6.5; // Diameter of MMT.
 tel.cobs	       = 0.1; // 64cm/6.5m = 0.1
 //-------------------------------
 target.lambda	   = &([1.65]);// The wavelength of the science camera detector, unit micron.
 target.xposition   = &([0.]);
 target.yposition   = &([0]);
 target.dispzoom    = &([1.]);
 //-------------------------------
 gs.zeropoint	   = 3.255e11;//calibrate Photometric zero point (#photons@pupil/s/full_aper, mag0 star). See evernote, this calculated in R band.
 //-------------------------------
 loop.gain	       = 0.5;
 loop.framedelay    = 2; //Loop delay (# of frames). Regular CCD 1 frame integration -> framedelay=1 + readout & Calculation -> framedelay=2. Because there is 1.6ms Frame Rate, 1.596 ms read time; so the framedelay is calculated as 1+readoutdelay/itime-> 1+1.596/1.6=2
 loop.niter	       = 1000; //Total number of iterations.
 loop.ittime	       = 1e-3; //Iteration time (sampling time), unit second.
 loop.modalgainfile = "simulModeGains.fits";
 //-------------------------------
 
==== dump of structures ====
 sim_struct(name="SH 12x12 w/ TT mirror and WFS, full diffraction WFS",
 pupildiam=132,pupilapod=0,debug=0,verbose=1,svipc=0,svipc_wfs_nfork=0,
 svipc_wfs_forknb=0x0,shmkey=0,semkey=0,_size=512,_cent=256.5)
 atm_struct(dr0at05mic=43.33,screen=0x7f8a548c7e28,layerfrac=0x7f8a548c7eb0,
 layerspeed=0x7f8a548c7c90,layeralt=0x7f8a548c7f38,winddir=0x7f8a548c8048,
 _layeralt=0x7f8a549339d0)
 [wfs_struct(type="pyramid",subsystem=1,lambda=0.65,noise=1,ron=3.7,darkcurrent=
 0,excessnoise=1,gspos=[0,0],gsalt=0,gsdepth=0,laserpower=0,gsmag=5,skymag=17.9,
 filtertilt=0,correctUpTT=0,uplinkgain=0,dispzoom=1,optthroughput=1,disjointpup=
 0,svipc=0,zeropoint=0,ncpdm=0,dmnotinpath=0x0,framedelay=-1,nsubperring=0x0,
 angleoffset=0x0,l=0,rint=0x0,rout=0x0,fieldstopdiam=0,pyr_mod_ampl=0.4,
 pyr_mod_npts=32,pyr_mod_pos=0x0,pyr_padding=0,pyr_mod_loc="after",pyr_denom=
 "subap",shmethod=0,shnxsub=12,npixpersub=11,pixsize=0,npixels=0,spotpitch=0,
 extfield=0,pupoffset=[0,0],shthmethod=0,shthreshold=0,shcalibseeing=0.667,
 biasrmserror=0,flatrmserror=0,fsname=0x0,fstop="round",fssize=2.4,fsoffset=[0,
 0],kernel=0,nintegcycles=1,fracIllum=0.5,centGainOpt=0,LLTxy=[0,0],
 LLT_uplink_turb=0,LLTr0=0,LLTdiam=0,LLT1overe2diam=0,rayleighflag=0,
 lgs_focus_alt=0,lgs_prof_amp=0x7f8a54931188,lgs_prof_alt=0x7f8a5403db08,nzer=0,
 ndh=0,ndhfiltered=0,_framedelay=2,_initkernels=0,_svipc_init_done=0,
 _svipc_subok=0x0,_fork_subs=0x0,_fork_subs2=0x0,_validsubs=0x7f8a54913630,
 _origpixsize=0,_rebinfactor=0,_gsalt=0,_gsdepth=0,_nsub=120,_nsub4disp=0,_nmes=
 240,_sind=0x0,_nsind=0x0,_cxdef=0x0,_sxdef=0x0,_tiltsh=0x0,_masks=0x0,
 _fluxpersub=0x0,_rayleighflux=0x0,_sodiumflux=0x0,_raylfluxpersub=0x0,
 _skyfluxpersub=0x0,_nphotons=3.25498e+06,_skynphotons=101.871,_tt=[-0.0134647,
 -0.000762366],_lastvalidtt=[-0.0134647,-0.000762366],_upttcommand=[0,0],
 _refmes=0x7f8a53839e30,_tiprefv=0x7f8a5409ce30,_tiltrefv=0x7f8a54102a30,
 _tiprefvn=0x7f8a54086230,_tiltrefvn=0x7f8a54111830,_reordervec=0x0,_npixels=0,
 _npb=0,_sdim=0,_nx=0,_nx4fft=0,_istart=0x0,_jstart=0x0,_binindices=0x0,_binxy=
 0,_centroidw=0x0,_fimage=0x7f8a540e2630,_fimage2=0x0,_imistart=0x0,_imjstart=
 0x0,_imistart2=0x0,_imjstart2=0x0,_unittip=0x0,_unittilt=0x0,_lgs_defocuses=
 0x0,_unitdefocus=0x0,_fimnx=0,_fimny=0,_fimny2=0x0,_yoffset=0x0,_bias=0x0,
 _flat=0x0,_domask=0,_submask=0x10147e030,_kernel=0x0,_kernels=0x0,_kerfftr=0x0,
 _kerffti=0x0,_kernelconv=0,_cyclecounter=1,_dispimage=0x7f8a540e2630,_x=0x0,_y=
 0x0,_centroidgain=1,_rayleigh=0x0,_bckgrdcalib=0x7f8a53804230,_bckgrdinit=0,
 _bckgrdsub=1,_meashist=0x0,_zeropoint=3.255e+11,_pha2dhc=0x0,_wpha2dhc=0x0,
 _n12=[0,0],_LLT_use=0,_LLT_pscreen_name=0x0,_LLT_pscreen=0x0,_LLT_pos=[0,0],
 _LLT_pupil=0x0,_LLT_phase=0x0,_LLT_kernel=0x0,_nkernels=1,_dmnotinpath=
 0x7f8a54931230)]
 [dm_struct(type="zernike",subsystem=1,virtual=0,dmfit_which=0x0,iffile=
 "sh12x12_pyr_24-if1.fits",pitch=0,alt=0,hyst=0,push4imat=20,thresholdresp=0.3,
 unitpervolt=0.0005,maxvolt=0,gain=1,ctrlnum=0x0,ctrlden=0x0,_ctrlnum=
 0x7f8a5492f938,_ctrlden=0x7f8a5492f740,misreg=[0,0],xflip=0,yflip=0,pupoffset=
 [0,0],disjointpup=0,pegged=0x0,epegged=0x0,ncp=0,ncpfit_type=0x0,ncpfit_which=
 0,use_def_of=0,ifunrot=0,xscale=0,actlocfile=0x0,nelperring=0x0,angleoffset=
 0x0,rint=0x0,rout=0x0,supportRadius=0,supportOffset=0,nxact=0,pitchMargin=0,
 coupling=0.2,ecmatfile="sh12x12_pyr_24-ecmat1.fits",noextrap=0,elt=0,irexp=0,
 irfact=0,filtertilt=0,nzer=80,minzer=1,ndh=0,nkl=0,nxseg=0,fradius=0,regparam=
 0,regtype=0x0,regmatrix=0x0,_alpha=[0.01,0.2,4],_beta=[0.4,0.63,0.89],_w=[0.2,
 0.35,0.45],_x0=0x7f8a53530db0,_xlast=0x7f8a5352bd20,_ylast=[0x7f8a5413ee30,
 0x7f8a5413ee30,0x7f8a5413ee30],_y0=0x7f8a54070030,_signus=0x7f8a53530740,
 _puppixoffset=[0,0],_nact=80,_def=0x103b29030,_x=0x0,_y=0x0,_i1=0x0,_j1=0x0,
 _ei1=0x0,_ej1=0x0,_indval=0x0,_indext=0x0,_eiffile=
 "sh12x12_pyr_24-if1-ext.fits",_edef=0x0,_ex=0x0,_ey=0x0,_enact=0,_n1=182,_n2=
 331,_pupil=0x0,_command=0x7f8a53705c30,_flat_command=0x0,_extrapcmat=0x0,
 _eltdefsize=0,_regmatrix=0x0,_fMat=0x0)]
 mat_struct(method="svd",condition=0x7f8a54930c48,sparse_MR=10000,sparse_MN=
 200000,sparse_thresh=1e-08,sparse_pcgtol=1e-06,file="sh12x12_pyr_24-mat.fits",
 fit_simple=0,fit_subsamp=1,fit_type="target",fit_which=1,fit_minval=0.01)
 tel_struct(diam=6.5,cobs=0.1,tipvib_white_rms=0,tipvib_1overf_rms=0,
 tipvib_peaks=0x0,tipvib_peaks_rms=0x0,tipvib_peaks_width=0x0,tiltvib_white_rms=
 0,tiltvib_1overf_rms=0,tiltvib_peaks=0x0,tiltvib_peaks_rms=0x0,
 tiltvib_peaks_width=0x0)
 target_struct(lambda=0x7f8a5403d868,xposition=0x7f8a5403e010,yposition=
 0x7f8a54925de0,xspeed=0x0,yspeed=0x0,dispzoom=0x7f8a54930ee8,ncpdm=0x0,
 _ntarget=1,_nlambda=1)
 gs_struct(zeropoint=3.255e+11,zenithangle=0,lgsreturnperwatt=0)
 loop_struct(gain=0.5,leak=0,gainho=0x0,leakho=0x0,framedelay=2,niter=500,
 ittime=0.001,startskip=10,skipevery=0,skipby=10000,stats_every=4,
 jumps2swapscreen=0,modalgainfile="simulModeGains.fits",method="closed-loop")
=============================
SH 12x12 w/ TT mirror and WFS, full diffraction WFS
 
Summary:
Mirror #1, zernike, 80 actuators, conjugated @ 0 m
WFS # 1, pyramid (meth. 0), 120 subap., offaxis (+0.0",+0.0"), noise disabled
D/r0 (500nm) = 43.3; 500 iterations
